<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>PaixãoFlix TV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

    <style>
        /* RESET E FONTE POPPINS GLOBAL */
        * { 
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif !important;
            overflow: hidden; 
            -ms-overflow-style: none; 
            scrollbar-width: none; 
            touch-action: manipulation;
            user-select: none; /* Impede seleção de texto no APK */
        }
        
        *::-webkit-scrollbar { display: none !important; }

        html, body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #fff; 
            height: 100vh; 
            width: 100vw; 
        }

        #app { display: flex; height: 100%; width: 100%; position: relative; }

        /* MENU LATERAL */
        #menu { 
            width: 280px; 
            background: #0d0d0d; 
            display: flex; 
            flex-direction: column; 
            z-index: 100; 
            padding: 15px; 
            border-right: 2px solid #ff9800; /* Cor da Marca */
            height: 100%; 
        }

        #menuHeader { 
            padding: 10px 0 20px 0; 
            text-align: center; 
            border-bottom: 1px solid #222; 
            margin-bottom: 15px; 
        }

        #menuHeader img { 
            height: 80px; 
            width: auto; 
            object-fit: contain; 
            filter: drop-shadow(0px 0px 5px rgba(255, 152, 0, 0.3));
        }

        #clock { margin-top: 10px; font-size: 13px; color: #ff9800; font-weight: 300; }

        #nowPlaying { margin: 15px 0; text-align: center; }
        #nowPlaying span { display: block; font-size: 11px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        
        #currentTitle { 
            display: inline-block; 
            padding: 6px 12px; 
            color: #fff; 
            font-size: 14px; 
            font-weight: 600; 
            background: rgba(255, 152, 0, 0.2); 
            border-radius: 4px; 
            max-width: 240px; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        /* BUSCA */
        #searchBox { margin-bottom: 15px; }
        #searchInput { 
            width: 100%; 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #333; 
            background: #1a1a1a; 
            color: #fff; 
            outline: none; 
            font-size: 14px; 
            transition: 0.3s;
        }
        #searchInput.focused { border-color: #ff9800; background: #222; box-shadow: 0 0 10px rgba(255,152,0,0.2); }

        /* ITENS DO MENU */
        .menu-item { 
            padding: 12px 15px; 
            font-size: 14px; 
            margin-bottom: 8px; 
            border-radius: 8px; 
            background: #1a1a1a; 
            border: 1px solid transparent; 
            display: flex; 
            align-items: center; 
            color: #bbb; 
            cursor: pointer; 
            transition: 0.2s;
        }
        .menu-item i { margin-right: 12px; width: 20px; text-align: center; font-size: 16px; }
        .menu-item.active { background: #ff9800; color: #000; font-weight: 700; }

        .menu-item.kids { border-left: 4px solid #ffeb3b; }

        /* CONTEÚDO E PLAYER */
        #content { 
            position: absolute; 
            top: 0; 
            left: 280px; 
            width: calc(100% - 280px); 
            height: 100%; 
            z-index: 10; 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }

        #videoContainer { width: 100%; height: 100%; background: #000; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* LISTA DE CANAIS */
        #channelList { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 350px; 
            height: 100%; 
            background: rgba(10, 10, 10, 0.95); 
            display: none; 
            z-index: 110; 
            overflow-y: auto; 
            border-right: 2px solid #ff9800;
            backdrop-filter: blur(10px);
        }

        .channel { 
            padding: 18px 20px; 
            font-size: 15px; 
            border-bottom: 1px solid #222; 
            color: #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
        }
        .channel.active { background: #ff9800 !important; color: #000 !important; font-weight: 700; }

        .fav-btn { color: #444; font-size: 18px; }
        .fav-btn.active { color: #ffeb3b; }

        /* PREVIEW DO POSTER */
        #posterPreview { 
            position: absolute; 
            top: 50%; 
            left: 380px; 
            transform: translateY(-50%); 
            width: 280px; 
            height: 400px; 
            border-radius: 15px; 
            z-index: 120; 
            display: none; 
            background: #222; 
            object-fit: cover; 
            border: 3px solid #ff9800; 
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
    </style>
</head>

<body>
<div id="app">
    <div id="menu">
        <div id="menuHeader">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="PaixãoFlix">
            <div id="clock">Carregando...</div>
            <div id="nowPlaying">
                <span>Você está assistindo:</span>
                <div id="currentTitle">Selecione um canal</div>
            </div>
        </div>
        <div id="searchBox">
            <input type="text" id="searchInput" placeholder="Pesquisar conteúdo...">
        </div>
        <div class="menu-item active" data-type="channels"><i class="fas fa-tv"></i> TV ao vivo</div>
        <div class="menu-item" data-type="fav"><i class="fas fa-star" style="color:#ffeb3b"></i> Favoritos</div>
        <div class="menu-item" data-type="categories"><i class="fas fa-film"></i> Cinema</div>
        <div class="menu-item" data-type="series"><i class="fas fa-clapperboard"></i> Séries</div>
        <div class="menu-item kids" data-type="kids_channels"><i class="fas fa-child"></i> Canal Kids</div>
        <div class="menu-item kids" data-type="kids_movies"><i class="fas fa-icons"></i> Filmes Kids</div>
        <div class="menu-item kids" data-type="kids_series"><i class="fas fa-robot"></i> Séries Kids</div>
    </div>

    <div id="content">
        <div id="videoContainer">
            <video id="video" autoplay playsinline></video>
        </div>
        <div id="channelList"></div>
        <img id="posterPreview">
    </div>
</div>

<script>
    const video = document.getElementById("video");
    const channelList = document.getElementById("channelList");
    const posterPreview = document.getElementById("posterPreview");
    const searchInput = document.getElementById("searchInput");
    const menuItems = document.querySelectorAll(".menu-item");
    const currentTitleDisplay = document.getElementById("currentTitle");

    let channels = [], movies = [], series = [], kidsChannels = [], kidsMovies = [], kidsSeries = [];
    let favorites = JSON.parse(localStorage.getItem("paixaoflix_favs") || "[]");
    let filteredList = [], viewMode = "channels", selectedIndex = 0, menuIndex = 0, menuFocused = true, hls = null;

    const movieCats = ["Lançamentos 2026","Lançamentos 2025","AÇÃO","AVENTURA","ANIME","ANIMAÇÃO","COMÉDIA","DRAMA","DORAMA","SUSPENSE","POLICIAL","TERROR","DOCUMENTÁRIOS","FICCIÓN CIENTÍFICA","CLÁSSICOS","FAROESTE","NACIONAL","ROMANCE","RELIGIOSO","ADULTO"];

    function updateClock() {
        const d = new Date();
        const meses = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
        document.getElementById("clock").innerText = `${d.getDate()} de ${meses[d.getMonth()]} | ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
    }
    setInterval(updateClock, 1000); updateClock();

    function playMedia(item) {
        if (!item || (!item.url && !item.link)) return;
        const url = item.url || item.link;
        currentTitleDisplay.innerText = item.titulo || item.name;
        
        channelList.style.display = "none"; 
        posterPreview.style.display = "none";
        
        if (Hls.isSupported() && url.includes("m3u8")) {
            if (hls) hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = url;
            video.play().catch(e => console.log("Erro ao dar play"));
        }
    }

    function renderList() {
        channelList.innerHTML = "";
        let seriesCats = [...new Set(series.map(s => s.genero?.toUpperCase()).filter(Boolean))];
        let data = viewMode === "categories" ? movieCats : (viewMode === "series" ? seriesCats : (viewMode === "channels" ? channels : (viewMode === "fav" ? favorites : filteredList)));
        
        data.forEach((item, i) => {
            const div = document.createElement("div");
            div.className = `channel ${i === selectedIndex ? "active" : ""}`;
            const isFav = favorites.some(f => (f.url || f.link) === (item.url || item.link));
            const favIcon = (viewMode !== "categories" && viewMode !== "series") ? `<i class="fas fa-star fav-btn ${isFav?'active':''}"></i>` : "";
            div.innerHTML = `<span>${item.titulo || item.name || item}</span> ${favIcon}`;
            channelList.appendChild(div);
            
            if (i === selectedIndex && !menuFocused) {
                div.scrollIntoView({ block: "center", behavior: "smooth" });
            }
        });

        const cur = data[selectedIndex];
        if (!menuFocused && cur?.poster) { 
            posterPreview.src = cur.poster; 
            posterPreview.style.display = "block"; 
        } else { 
            posterPreview.style.display = "none"; 
        }
    }

    // Gerenciamento de Teclas (Controle Remoto / APK)
    document.addEventListener("keydown", e => {
        let seriesCats = [...new Set(series.map(s => s.genero?.toUpperCase()).filter(Boolean))];
        let dataLen = (viewMode === "categories" ? movieCats.length : (viewMode === "series" ? seriesCats.length : (viewMode === "channels" ? channels.length : (viewMode === "fav" ? favorites.length : filteredList.length))));
        
        switch(e.key){
            case "ArrowUp":
                if (menuFocused) {
                    menuIndex = (menuIndex <= 0) ? menuItems.length - 1 : menuIndex - 1;
                } else {
                    selectedIndex = (selectedIndex <= 0) ? dataLen - 1 : selectedIndex - 1;
                }
                renderList();
                break;
            case "ArrowDown":
                if (menuFocused) {
                    menuIndex = (menuIndex >= menuItems.length - 1) ? 0 : menuIndex + 1;
                } else {
                    selectedIndex = (selectedIndex >= dataLen - 1) ? 0 : selectedIndex + 1;
                }
                renderList();
                break;
            case "ArrowRight":
                if (menuFocused) {
                    menuFocused = false;
                    channelList.style.display = "block";
                    viewMode = menuItems[menuIndex].dataset.type;
                    selectedIndex = 0;
                    renderList();
                }
                break;
            case "ArrowLeft":
                if (!menuFocused) {
                    menuFocused = true;
                    channelList.style.display = "none";
                    posterPreview.style.display = "none";
                }
                break;
            case "Enter":
                if (!menuFocused) {
                    const data = (viewMode === "categories" ? movieCats : (viewMode === "series" ? seriesCats : (viewMode === "channels" ? channels : (viewMode === "fav" ? favorites : filteredList))));
                    playMedia(data[selectedIndex]);
                }
                break;
        }
        menuItems.forEach((m, i) => m.classList.toggle("active", i === menuIndex));
    });

    function loadM3U(path, array) {
        fetch(path).then(r=>r.text()).then(text=>{
            let temp=null;
            text.split("\n").forEach(l=>{
                if(l.startsWith("#EXTINF")) temp={titulo:l.split(",").pop().trim()};
                else if(l.startsWith("http") && temp){ temp.url=l.trim(); array.push(temp); temp=null; }
            });
            if(array === channels && channels.length > 0) renderList();
        }).catch(e => console.log("Erro ao carregar lista"));
    }

    window.onload = () => {
        loadM3U("data/canais.m3u", channels);
        updateClock();
    };
</script>
</body>
</html>
