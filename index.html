<!DOCTYPE html>

<html lang="pt-BR">

<head>

<meta charset="UTF-8" />

<title>PaixãoFlix TV V.28.7.49</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;500;700;900&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>



<style>

    * { 

        overflow: hidden !important; 

        touch-action: manipulation; 

        box-sizing: border-box; 

        outline: none; 

        -ms-overflow-style: none; 

        scrollbar-width: none; 

        font-family: 'Poppins', sans-serif; 

    }

    

    body { 

        margin: 0; padding: 0; 

        background: #000; 

        color: #fff; height: 100vh; width: 100vw;

    }



    #detailsOverlay {

        position: fixed; inset: 0; background: #000; z-index: 8000;

        display: none; flex-direction: column; justify-content: center;

    }

    #detailsBg {

        position: absolute; inset: 0;

        background-size: cover; background-position: center;

        filter: blur(20px) brightness(0.3); opacity: 0.6; z-index: -1;

    }

    #detailsContent {

        display: flex; align-items: center; padding: 0 80px; gap: 60px; z-index: 1;

    }

    .details-poster-wrapper {

        flex: 0 0 380px; height: 550px;

        border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);

        overflow: hidden; border: 3px solid rgba(255,255,255,0.1);

    }

    .details-poster-wrapper img { width: 100%; height: 100%; object-fit: contain; background: #000; }

    .details-info { flex: 1; }

    #detTitle { font-size: 70px; font-weight: 900; margin-bottom: 10px; line-height: 1.1; text-transform: uppercase; }

    #detMeta { font-size: 28px; color: #FFCE44; font-weight: 600; margin-bottom: 30px; }

    #detDesc { 

        font-size: 24px; color: #fff; line-height: 1.6; font-weight: 400;

        max-width: 950px; margin-bottom: 40px; 

        display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden;

    }

    .details-btns { display: flex; gap: 13px; }

    .btn-3d {

        padding: 20px 45px; font-size: 22px; font-weight: 900; border: none;

        border-radius: 12px; cursor: pointer; text-transform: uppercase;

        transition: 0.2s; border-bottom: 5px solid #FFCE44; color: #fff;

    }

    .btn-play-3d { background: #1f2332; }

    .btn-back-3d { background: #E50914; }

    .btn-3d.focused { transform: scale(1.2) translateY(3px); border-bottom-width: 2px; box-shadow: 0 0 30px rgba(255, 206, 68, 0.4); }



    #topBar { 

        position: fixed; top: 0; left: 0; width: 100%; height: 75px; 

        display: flex; align-items: center; justify-content: space-between; 

        padding: 0 50px; z-index: 11000; background: #000; 

        border-bottom: 1px solid rgba(255,255,255,0.05);

    }



    #menuBrands {

        position: fixed; left: 0; top: 75px; width: 80px; height: calc(100vh - 75px);

        z-index: 12000; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(15px);

        transition: width 0.4s ease; display: flex; flex-direction: column; padding: 40px 15px;

        border-right: 1px solid rgba(255, 255, 255, 0.05);

    }

    #menuBrands.expanded { width: 260px; }



    #mainScroll {

        margin-top: 75px; margin-left: 80px; padding: 20px 20px 20px 40px;

        height: calc(100vh - 75px); overflow-y: auto !important;

    }

   

    #logoMain { height: 50px; cursor: pointer; }



    #carouselContainer { width: 100%; padding: 20px 50px; }

    #editorSlider { 

        width: 100%; height: 350px; border-radius: 20px; 

        background-size: cover; background-position: center; 

        border: 5px solid rgba(255,255,255,0.1); display: flex; 

        align-items: flex-end; padding: 30px; position: relative; 

        cursor: pointer; transition: 0.5s ease-in-out; 

    }

    #editorTitle { font-size: 35px; font-weight: 900; margin-bottom: 5px; text-shadow: 2px 2px 10px #000; z-index: 2; }

    #editorMeta { font-size: 18px; color: #FFCE44; font-weight: 500; margin-bottom: 20px; z-index: 2; }

    .btn-watch { background: #FFCE44; color: #000; padding: 10px 30px; border-radius: 8px; font-weight: 900; font-size: 13px; text-transform: uppercase; display: inline-block; z-index: 2; }



    .brand-card {

        width: 100%; min-height: 60px; display: flex; align-items: center; gap: 20px;

        padding: 0 15px; border-radius: 12px; cursor: pointer; transition: 0.3s;

        color: rgba(255, 255, 255, 0.6); background: transparent; border: none;

    }

    .brand-card i { font-size: 24px; min-width: 30px; text-align: center; }

    .brand-card span { font-size: 18px; font-weight: 500; white-space: nowrap; opacity: 0; transition: opacity 0.3s; }

    #menuBrands.expanded .brand-card span { opacity: 1; }

    .brand-card.focused { background: #FFCE44 !important; color: #000 !important; transform: scale(1.1); }



    #top6Section { 

    margin-left: 20px; 

    width: 100%; 

    padding: 60px 0; /* Aumentado para dar espaço ao movimento de subida (translateY) */

    background: transparent !important; 

    overflow: visible !important; /* Impede o corte/barra preta nos efeitos */

}



#top6Title { 

    font-size: 26px; 

    font-weight: 500; 

    color: #FFCE44; 

    margin-bottom: 50px; /* Espaço extra para o item focado não encostar no texto */

    text-transform: uppercase;

}



.top6-grid { 

    display: flex !important; 

    gap: 60px; 

    padding-left: 60px; 

    overflow: visible !important; /* Garante que a sombra e o brilho apareçam */

}



.top6-item { 

    position: relative; 

    flex: 0 0 180px; 

    height: 270px; 

    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 

    z-index: 1;

}



.top6-number { 

    position: absolute; 

    left: -55px; 

    bottom: -15px; 

    font-size: 110px; 

    font-weight: 900; 

    color: rgba(0,0,0,0.5); 

    -webkit-text-stroke: 2px #FFCE44; 

    z-index: -1; 

}



.top6-poster { 

    width: 100%; 

    height: 100%; 

    object-fit: cover; 

    border-radius: 12px; 

    border: 2px solid rgba(255, 255, 255, 0.1); 

    transition: all 0.4s ease;

}



/* Efeito de foco otimizado: sobe e brilha sem cortar */

.top6-item.focused { 

    transform: translateY(-25px) scale(1.1); 

    z-index: 100; 

}



.top6-item.focused .top6-poster { 

    border: 3px solid #fff; 

    box-shadow: 0 15px 40px rgba(255, 206, 68, 0.4); /* Brilho amarelo Pipoca */

    filter: brightness(1.1);

}

   /* Container de Filmes: Rola para baixo (Vertical) */
#moviesOverlay, #channelsOverlay {
    position: fixed;
    top: 75px;
    left: 80px;
    width: calc(100vw - 80px);
    height: calc(100vh - 75px);
    background: #000;
    z-index: 10000;
    display: none;
    flex-direction: column;
    overflow-y: auto !important; /* Permite ver as categorias abaixo */
    padding-bottom: 100px;
}

/* Fileira de Categoria: Rola para os lados (Horizontal) */
.category-container {
    width: 100%;
    margin-bottom: 50px;
    padding: 0 40px;
}

.channels-row.movie-grid {
    display: flex !important; /* Mudado de grid para flex para o estilo Netflix */
    flex-wrap: nowrap !important;
    overflow-x: hidden !important; /* O JS controla o foco */
    gap: 25px;
    padding: 20px 0;
}

.movie-card {
    flex: 0 0 220px; /* Largura fixa para manter a linha horizontal */
    scroll-margin: 50px;
}

.movie-poster {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid rgba(255,255,255,0.1);
    transition: 0.3s;
}

/* Foco da Capa */
.movie-card.focused .movie-poster {
    border: 4px solid #fff;
    transform: scale(1.1);
    box-shadow: 0 0 30px rgba(255, 206, 68, 0.5);
}

   /* Informações abaixo das capas no Grid */

.movie-info-overlay {

    padding: 4px 2px;

    background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.8));

    border-radius: 0 0 10px 10px;

}

.movie-title-grid {

    font-size: 14px;

    font-weight: 500;

    white-space: nowrap;

    overflow: hidden;

    text-overflow: ellipsis;

    display: block;

}

.movie-meta-grid {

    font-size: 12px;

    color: #FFCE44;

    display: flex;

    justify-content: space-between;

}

   const TMDB_KEY = 'b275ce8e1a6b3d5d879bb0907e4f56ad';

const TMDB_BASE_URL = 'https://api.themoviedb.org/3';



// Função para buscar dados extras do TMDB

async function getTMDBData(item) {

    const query = encodeURIComponent(item.titulo || item.name);

    // Identifica se é série ou filme (baseado na sua estrutura de pastas do PaixãoFlix)

    const type = item.isSerie ? 'tv' : 'movie'; 

    

    try {

        const searchRes = await fetch(`${TMDB_BASE_URL}/search/${type}?api_key=${TMDB_KEY}&query=${query}&language=pt-BR`);

        const searchData = await searchRes.json();

        

        if (searchData.results && searchData.results.length > 0) {

            const result = searchData.results[0];

            return {

                ano: (result.release_date || result.first_air_date || "2026").substring(0, 4),

                nota: result.vote_average.toFixed(1),

                descricao: result.overview || item.descricao,

                backdrop: `https://image.tmdb.org/t/p/original${result.backdrop_path}`

            };

        }

    } catch (e) { console.error("Erro TMDB:", e); }

    return null;

}



// Atualização da função openDetails para ser assíncrona

async function openDetails(item) {

    currentItem = item;

    isDetailsOpen = true;

    detIdx = 0;



    // Feedback visual de carregando

    document.getElementById("detTitle").innerText = "Carregando...";

    document.getElementById("detailsOverlay").style.display = "flex";



    const extra = await getTMDBData(item);

    

    const poster = item.poster;

    const titulo = item.titulo || item.name;

    const ano = extra ? extra.ano : (item.year || "2026");

    const nota = extra ? extra.nota : (item.rating || "0.0");

    const desc = extra ? extra.descricao : (item.descricao || "Sinopse não disponível.");

    const bg = extra ? extra.backdrop : poster;



    document.getElementById("detPoster").src = poster;

    document.getElementById("detailsBg").style.backgroundImage = `url(${bg})`;

    document.getElementById("detTitle").innerText = titulo;

    document.getElementById("detMeta").innerText = `${ano} • ★ ${nota}`;

    document.getElementById("detDesc").innerText = desc;

    document.getElementById("detDesc").style.display = "block"; // Garante que a descrição apareça completa

    document.getElementById("detDesc").style.webkitLineClamp = "unset"; // Remove o limite de linhas nos detalhes



    document.getElementById("btnDetPlay").onclick = () => playChannel(item.url, titulo);

    updateFocus();

}

/* Isso faz com que o navegador centralize o item focado suavemente */

.movie-card, .channel-card, .brand-card, .top6-item {

    scroll-margin: 100px; /* Dá um respiro nas bordas ao rolar */

}



#moviesOverlay, #channelsOverlay, #mainScroll {

    scroll-behavior: smooth;

}

   

.channels-row.movie-grid {
    display: flex !important;
    flex-wrap: nowrap !important; /* Impede que os filmes caiam para a linha de baixo */
    overflow-x: auto !important;
    scroll-behavior: smooth;
    padding: 20px 0;
    width: 100%;
}

.movie-card {
    flex: 0 0 220px; /* Mantém o tamanho fixo para o cálculo de foco */
    margin-right: 25px;
}
   
</style>

</head>

<body>



<div id="topBar">

    <img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" onclick="location.reload()">

    <div id="barCounter">JÁ TEMOS <span id="totalItems">0</span> CONTEÚDOS</div>

    <div id="barDateTime">CARREGANDO...</div>

</div>



<div id="menuBrands" class="main-menu">

    <div class="brand-card" onclick="openChannelsPage()"><i class="fas fa-tv"></i><span>Canais</span></div>

    <div class="brand-card" onclick="renderCategoryPage(movies, 'Cinema')"><i class="fas fa-film"></i><span>Cinema</span></div>

    <div class="brand-card" onclick="renderCategoryPage(series, 'Séries')"><i class="fas fa-clapperboard"></i><span>Séries</span></div>

    <div class="brand-card" onclick="openChannelsPage()"><i class="fas fa-child"></i><span>Kids TV</span></div>

    <div class="brand-card" onclick="renderCategoryPage(kidsMovies, 'Kids Filmes')"><i class="fas fa-baby"></i><span>Kids Filmes</span></div>

    <div class="brand-card" onclick="renderCategoryPage(kidsSeries, 'Kids Séries')"><i class="fas fa-robot"></i><span>Kids Séries</span></div>

    <div class="brand-card"><i class="fas fa-heart"></i><span>Favoritos</span></div>

</div>



<div id="mainScroll">

    <div id="carouselContainer">

        <div id="editorSlider">

            <div id="editorInfo">

                <div id="editorTitle">...</div>

                <div id="editorMeta">ANO • ★ 0.0</div>

                <div class="btn-watch">Assistir Agora</div>

            </div>

        </div>

    </div>

    <div id="top6Section">

        <div id="top6Title">Preferidos do momento</div>

        <div class="top6-grid" id="top6Container"></div>

    </div>

    <div style="height: 150px;"></div>

</div>



<div id="detailsOverlay">

    <div id="detailsBg"></div>

    <div id="detailsContent">

        <div class="details-poster-wrapper"><img id="detPoster" src=""></div>

        <div class="details-info">

            <div id="detTitle">...</div>

            <div id="detMeta">...</div>

            <div id="detDesc">...</div>

            <div class="details-btns">

                <button id="btnDetPlay" class="btn-3d btn-play-3d">Assistir Agora</button>

                <button id="btnDetBack" class="btn-3d btn-back-3d" onclick="closeDetails()">Voltar</button>

            </div>

        </div>

    </div>

</div>



<div id="channelsOverlay"><div id="channelsScroll"></div></div>

<div id="moviesOverlay"><div id="moviesScroll"></div></div>



<div id="playerOverlay">

    <button id="btnClosePlayer" onclick="closePlayer()">SAIR DO PLAY</button>

    <div id="player" style="width:100%; height:100%;"></div>

</div>



<div id="globalFooter">

    <div id="footerText" style="font-style: italic; font-weight: 500; color: #ffffff; font-size: 20px; text-shadow: 2px 2px 4px #000;">PaixãoFlix, transformando momentos de lazer em lembranças felizes!</div>

</div>



<script>

let movies = [], series = [], kidsMovies = [], kidsSeries = [], channels = [];

let top6Data = [], editorsChoice = [], edIdx = 0;

let currentFocus = "editor", menuIdx = 0, gridIdx = 0, chanIdx = 0, movieIdx = 0, detIdx = 0;

let isChannelsOpen = false, isMoviesOpen = false, isPlayerOpen = false, isDetailsOpen = false, playerInstance = null, currentItem = null;



const Keys = { UP: [38, 1], DOWN: [40, 2], LEFT: [37, 3], RIGHT: [39, 4], ENTER: [13, 29443, 117], BACK: [8, 27, 461, 10009] };



async function loadData() {

    const fetchJSON = async (url) => { try { const r = await fetch(url); return await r.json(); } catch(e) { return []; } };

    movies = await fetchJSON("data/filmes.json");

    series = await fetchJSON("data/series.json");

    kidsMovies = await fetchJSON("data/kids_filmes.json");

    kidsSeries = await fetchJSON("data/kids_series.json");

    try { const r = await fetch("data/ativa_canais.m3u"); const t = await r.text(); parseM3U(t); } catch(e) {}

    

    document.getElementById("totalItems").innerText = movies.length + series.length + kidsMovies.length + kidsSeries.length;

    editorsChoice = [...movies, ...series].sort(() => 0.5 - Math.random()).slice(0, 10);

    top6Data = [...movies, ...series].sort(() => 0.5 - Math.random()).slice(0, 6);

    

    startCarousel(); renderTop6(); startClock(); updateFocus();

}



function openDetails(item) {

    currentItem = item;

    isDetailsOpen = true;

    detIdx = 0;

    document.getElementById("detPoster").src = item.poster;

    document.getElementById("detailsBg").style.backgroundImage = `url(${item.poster})`;

    document.getElementById("detTitle").innerText = item.titulo || item.name;

    document.getElementById("detMeta").innerText = `${item.year || '2026'} • ★ ${item.rating || '9.5'}`;

    document.getElementById("detDesc").innerText = item.descricao || "Aproveite este conteúdo exclusivo na PaixãoFlix.";

    document.getElementById("detailsOverlay").style.display = "flex";

    document.getElementById("btnDetPlay").onclick = () => playChannel(item.url, item.titulo);

    updateFocus();

}



function closeDetails() {

    isDetailsOpen = false;

    document.getElementById("detailsOverlay").style.display = "none";

    updateFocus();

}



function renderCategoryPage(dataList, title) {

    isChannelsOpen = false; isMoviesOpen = true;

    document.getElementById("mainScroll").style.display = "none";

    document.getElementById("channelsOverlay").style.display = "none";

    document.getElementById("moviesOverlay").style.display = "flex";

    renderGridSystem(dataList);

    currentFocus = "movie_grid";

    movieIdx = 0;

    updateFocus();

}



function openChannelsPage() {

    isMoviesOpen = false; isChannelsOpen = true;

    document.getElementById("mainScroll").style.display = "none";

    document.getElementById("moviesOverlay").style.display = "none";

    document.getElementById("channelsOverlay").style.display = "flex";

    currentFocus = "channel_grid";

    chanIdx = 0;

    updateFocus();

}



function renderGridSystem(list) {
    const cont = document.getElementById("moviesScroll");
    cont.innerHTML = "";
    
    // ORDEM OBRIGATÓRIA DAS CATEGORIAS
    const ordemCategorias = [
        "Lançamento 2026", "Lançamento 2025", "Cinema", "Séries", 
        "Ação", "Aventura", "Comédia", "Terror", "Adulto"
    ];

    ordemCategorias.forEach(cat => {
        const filmesDaCat = list.filter(m => m.genero && m.genero.includes(cat));

        if (filmesDaCat.length > 0) {
            const section = document.createElement("div");
            section.className = "category-container";
            section.innerHTML = `
                <div class="channel-category-title">${cat}</div>
                <div class="channels-row movie-grid"></div>
            `;
            const grid = section.querySelector(".movie-grid");
            
            filmesDaCat.forEach(m => {
                const card = document.createElement("div");
                card.className = "movie-card";
                card.innerHTML = `<img class="movie-poster" src="${m.poster}">`;
                card.onclick = () => openDetails(m);
                grid.appendChild(card);
            });
            cont.appendChild(section);
        }
    });
}
   
   function updateFocus() {

    if(isPlayerOpen) return;

    document.querySelectorAll(".focused").forEach(el => el.classList.remove("focused"));

    const sideBar = document.getElementById("menuBrands");



    if (currentFocus === "menu") sideBar.classList.add("expanded");

    else sideBar.classList.remove("expanded");



    if(isDetailsOpen) {

        const btns = document.querySelectorAll(".btn-3d");

        btns[detIdx]?.classList.add("focused");

    } 

    else if(isMoviesOpen) {

        if(currentFocus === "menu") {

            document.querySelectorAll(".main-menu .brand-card")[menuIdx]?.classList.add("focused");

        } else {

            const items = document.querySelectorAll("#moviesScroll .movie-card");

            items[movieIdx]?.classList.add("focused");

            items[movieIdx]?.scrollIntoView({ behavior: 'smooth', block: 'center' });

        }

    } 

    else if(isChannelsOpen) {

        if(currentFocus === "menu") {

            document.querySelectorAll(".main-menu .brand-card")[menuIdx]?.classList.add("focused");

        } else {

            const cards = document.querySelectorAll("#channelsScroll .channel-card");

            cards[chanIdx]?.classList.add("focused");

            cards[chanIdx]?.scrollIntoView({ behavior: 'smooth', block: 'center' });

        }

    } 

    else {

        if(currentFocus === "menu") {

            document.querySelectorAll(".main-menu .brand-card")[menuIdx]?.classList.add("focused");

        } else if(currentFocus === "editor") {

            document.getElementById("editorSlider")?.classList.add("focused");

        } else if(currentFocus === "grid") {

            const gridItems = document.querySelectorAll(".top6-item");

            gridItems[gridIdx]?.classList.add("focused");

            gridItems[gridIdx]?.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });

        }

    }

}



document.addEventListener("keydown", e => {
    const k = e.keyCode;

    // Bloqueio Global: Se o player estiver aberto, apenas o BACK funciona
    if (isPlayerOpen) {
        if (Keys.BACK.includes(k)) closePlayer();
        return;
    }
    
    // 1. Lógica: Detalhes/Sinopse abertos
    if (isDetailsOpen) {
        if (Keys.RIGHT.includes(k)) detIdx = 1;
        if (Keys.LEFT.includes(k)) detIdx = 0;
        if (Keys.ENTER.includes(k)) {
            const btnPlay = document.getElementById("btnDetPlay");
            (detIdx === 0 && btnPlay) ? btnPlay.click() : closeDetails();
        }
        if (Keys.BACK.includes(k)) closeDetails();
        updateFocus();
        return;
    } 

    // 2. Lógica: Menu Lateral (Foco na esquerda)
    if (currentFocus === "menu") {
        const totalMenu = 7; 
        if (Keys.DOWN.includes(k)) menuIdx = (menuIdx + 1) % totalMenu;
        if (Keys.UP.includes(k)) menuIdx = (menuIdx - 1 + totalMenu) % totalMenu;
        if (Keys.RIGHT.includes(k)) { 
            if (isMoviesOpen) {
                currentFocus = "movie_grid";
                // Reset de segurança ao entrar no grid
                rowIdx = rowIdx || 0;
                movieIdx = movieIdx || 0;
            } 
            else if (isChannelsOpen) currentFocus = "channel_grid";
            else currentFocus = "editor";
        }
        if (Keys.ENTER.includes(k)) {
            const cards = document.querySelectorAll(".main-menu .brand-card");
            cards[menuIdx]?.click();
        }
    }
    
    // 3. Lógica: Grid de Filmes (Netflix Style - 4 Direções Corretas)
    else if (currentFocus === "movie_grid") {
        const rows = document.querySelectorAll(".movie-grid");
        if (!rows[rowIdx]) rowIdx = 0; // Proteção contra erro de índice

        const items = rows[rowIdx].querySelectorAll(".movie-card");
        const totalItemsInRow = items.length;

        // Esquerda e Direita: Navegação Horizontal Infinita
        if (Keys.RIGHT.includes(k)) {
            movieIdx = (movieIdx + 1) % totalItemsInRow; 
        }
        if (Keys.LEFT.includes(k)) {
            if (movieIdx === 0) {
                currentFocus = "menu";
            } else {
                movieIdx = (movieIdx - 1 + totalItemsInRow) % totalItemsInRow;
            }
        }

        // Cima e Baixo: Navegação Vertical entre Categorias
        if (Keys.DOWN.includes(k)) {
            if (rowIdx < rows.length - 1) {
                rowIdx++;
                // Ajusta movieIdx para não cair em posição inexistente na nova linha
                const nextRowItems = rows[rowIdx].querySelectorAll(".movie-card").length;
                if (movieIdx >= nextRowItems) movieIdx = nextRowItems - 1;
            }
        }
        if (Keys.UP.includes(k)) {
            if (rowIdx > 0) {
                rowIdx--;
                const prevRowItems = rows[rowIdx].querySelectorAll(".movie-card").length;
                if (movieIdx >= prevRowItems) movieIdx = prevRowItems - 1;
            } else {
                // Se estiver na primeira linha e subir, volta para o destaque (Editor)
                currentFocus = "editor";
            }
        }

        if (Keys.ENTER.includes(k)) items[movieIdx]?.click();
        if (Keys.BACK.includes(k)) { 
            // Se estiver em uma página de categoria, volta para a Home
            if (isMoviesOpen) {
                isMoviesOpen = false;
                document.getElementById("moviesOverlay").style.display = "none";
                document.getElementById("mainScroll").style.display = "block";
                currentFocus = "editor";
            } else {
                location.reload();
            }
        }
    }

    // 4. Lógica: Home (Destaque/Editor e Top 6)
    else if (currentFocus === "editor") {
        if (Keys.DOWN.includes(k)) { currentFocus = "grid"; gridIdx = 0; }
        if (Keys.LEFT.includes(k)) currentFocus = "menu";
        if (Keys.ENTER.includes(k)) openDetails(editorsChoice[edIdx]);
        if (Keys.BACK.includes(k)) location.reload();
    }
    else if (currentFocus === "grid") {
        if (Keys.UP.includes(k)) currentFocus = "editor";
        if (Keys.LEFT.includes(k)) {
            if (gridIdx === 0) currentFocus = "menu";
            else gridIdx--;
        }
        if (Keys.RIGHT.includes(k)) gridIdx = (gridIdx + 1) % 6;
        if (Keys.ENTER.includes(k)) openDetails(top6Data[gridIdx]);
        if (Keys.BACK.includes(k)) currentFocus = "editor";
    }

    updateFocus();
});

   
function parseM3U(content) {

    const lines = content.split('\n');

    let cats = {};

    lines.forEach((line, i) => {

        if(line.startsWith("#EXTINF")) {

            const name = line.split(',')[1] || "Canal";

            const logo = line.match(/tvg-logo="([^"]+)"/)?.[1] || "";

            const cat = line.match(/group-title="([^"]+)"/)?.[1]?.trim() || "Geral";

            const url = lines[i+1]?.trim();

            if(url && url.startsWith("http")) { 

                if(!cats[cat]) cats[cat] = []; 

                cats[cat].push({ name, logo, url }); 

            }

        }

    });

    renderChannels(cats);

}



function renderChannels(cats) {

    const cont = document.getElementById("channelsScroll");

    cont.innerHTML = "";

    Object.keys(cats).forEach(cat => {

        const div = document.createElement("div");

        div.className = "category-container";

        div.innerHTML = `<div class="channel-category-title"><i class="fas fa-play"></i> ${cat}</div><div class="channels-row"></div>`;

        const row = div.querySelector(".channels-row");

        cats[cat].forEach(c => {

            const card = document.createElement("div");

            card.className = "channel-card";

            card.onclick = () => playChannel(c.url, c.name);

            card.innerHTML = `<img src="${c.logo}">`;

            row.appendChild(card);

        });

        cont.appendChild(div);

    });

}



function playChannel(url, name) {

    isPlayerOpen = true; 

    document.getElementById("playerOverlay").style.display = "block";

    if(playerInstance) playerInstance.destroy();

    playerInstance = new Clappr.Player({ source: url, parentId: "#player", width: "100%", height: "100%", autoPlay: true });

}



function closePlayer() { if(playerInstance) playerInstance.destroy(); document.getElementById("playerOverlay").style.display = "none"; isPlayerOpen = false; }



function startCarousel() {

    const slider = document.getElementById("editorSlider");

    setInterval(() => {

        if(editorsChoice.length > 0) {

            slider.style.opacity = 0;

            setTimeout(() => {

                edIdx = (edIdx + 1) % editorsChoice.length;

                const item = editorsChoice[edIdx];

                slider.style.backgroundImage = `url(${item.poster})`;

                document.getElementById("editorTitle").innerText = item.titulo || item.name;

                document.getElementById("editorMeta").innerText = `${item.year || '2026'} • ★ ${item.rating || '9.5'}`;

                slider.style.opacity = 1;

            }, 800);

        }

    }, 8000);

}



function renderTop6() {

    const cont = document.getElementById("top6Container");

    top6Data.forEach((item, i) => {

        const div = document.createElement("div"); div.className = "top6-item";

        div.innerHTML = `<span class="top6-number">${i+1}</span><img class="top6-poster" src="${item.poster}">`;

        div.onclick = () => openDetails(item);

        cont.appendChild(div);

    });

}



function startClock() { setInterval(() => { const now = new Date(); document.getElementById("barDateTime").innerText = now.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }).toUpperCase(); }, 1000); }



window.onload = loadData;

</script>

</body>

</html>
