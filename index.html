<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV - Oficial</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
/* ROTAÇÃO FORÇADA E TELA DEITADA */
@media screen and (orientation: portrait) {
    body { transform: rotate(90deg); transform-origin: left top; width: 100vh; height: 100vw; position: absolute; top: 0; left: 100%; overflow: hidden; }
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; height: 100vh; width: 100vw; overflow: hidden; }

#layout-principal { display: flex; height: 100%; width: 100%; }

/* BARRAS REDUZIDAS COM ROLAGEM INFINITA SEM BARRA VISÍVEL */
#barra-menu { width: 150px; background: #001a1a; border-right: 2px solid #003333; display: flex; flex-direction: column; z-index: 100; flex-shrink: 0; }
#itens-menu { flex: 1; padding: 5px; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; scrollbar-width: none; -ms-overflow-style: none; }
#itens-menu::-webkit-scrollbar { display: none; }

#header-logo { padding: 10px; text-align: center; }
#header-logo img { height: 55px; width: auto; }
#relogio { font-size: 10px; color: #aaa; text-align: center; margin-bottom: 5px; }

#searchBox { padding: 5px 10px; }
#searchInput { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #003333; background: #000; color: #fff; font-size: 11px; outline: none; }
#searchInput:focus { border-color: #0080ff; }

/* ÍCONES E ITENS DO MENU */
.item-clicavel { padding: 10px; font-size: 11px; border-radius: 4px; background: #0080ff; border-bottom: 3px solid #004d99; display: flex; align-items: center; cursor: pointer; color: #fff; text-transform: uppercase; font-weight: bold; }
.item-clicavel i { margin-right: 8px; width: 16px; text-align: center; font-size: 14px; }
.item-clicavel.selecionado { background: #fff !important; color: #000 !important; border-bottom: 3px solid #ccc; }

/* ÁREA DO PLAYER E CONTEÚDO */
#area-player { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
#meu-video { width: 100%; height: 100%; object-fit: contain; }
#btn-sair-player { position: absolute; top: 15px; right: 15px; background: #ff0000; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; z-index: 1000; display: none; cursor: pointer; }

#painel-conteudo { position: absolute; inset: 0; background: rgba(0,0,0,0.96); z-index: 50; display: none; }
#flex-container { display: flex; height: 100%; width: 100%; }

/* LISTA DE CONTEÚDO COM ROLAGEM INFINITA */
#lista-canais { width: 200px; height: 100%; border-right: 1px solid #222; overflow-y: auto; background: #000; flex-shrink: 0; scrollbar-width: none; -ms-overflow-style: none; }
#lista-canais::-webkit-scrollbar { display: none; }

.canal-item { padding: 12px; font-size: 12px; border-bottom: 1px solid #111; color: #fff; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
.canal-item.ativo { background: #222 !important; border-left: 4px solid #0080ff; }

/* CAPA - GRANDE E SEMPRE VISÍVEL */
#container-capa { flex: 1; display: flex; align-items: center; justify-content: center; padding: 15px; background: #000; }
#imagem-capa { max-height: 92%; max-width: 90%; border: 3px solid #fff; border-radius: 8px; cursor: pointer; display: none; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

/* SMART TV - FONTES MAIORES */
@media screen and (min-width: 1280px) {
    #barra-menu { width: 210px; }
    .item-clicavel { font-size: 14px; padding: 15px; }
    #lista-canais { width: 320px; }
    .canal-item { font-size: 18px; }
}
</style>
</head>
<body>

<div id="layout-principal">
    <div id="barra-menu">
        <div id="header-logo">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
            <div id="relogio"></div>
        </div>
        <div id="searchBox"><input type="text" id="searchInput" placeholder="BUSCAR..."></div>
        <div id="itens-menu"></div>
    </div>

    <div id="area-player">
        <video id="meu-video" playsinline></video>
        <button id="btn-sair-player" onclick="fecharPlayer()">Sair</button>
        <div id="painel-conteudo">
            <div id="flex-container">
                <div id="lista-canais"></div>
                <div id="container-capa"><img id="imagem-capa"></div>
            </div>
        </div>
    </div>
</div>

<script>
const video = document.getElementById("meu-video"), btnSair = document.getElementById("btn-sair-player"), painelConteudo = document.getElementById("painel-conteudo");
const listaCanaisDiv = document.getElementById("lista-canais"), imgCapa = document.getElementById("imagem-capa"), menuContainer = document.getElementById('itens-menu'), searchInput = document.getElementById("searchInput");

let globalDB = [], hls = null, menuIndex = 0, itemIndex = -1, focoAtual = "menu";

const fontes = [
    { n: "Canais", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u", t: "m3u", i: "fa-tv" },
    { n: "Favoritos", t: "fav", u: "", i: "fa-star" },
    { n: "Cinema", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json", t: "json", i: "fa-film" },
    { n: "Séries", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json", t: "json", i: "fa-clapperboard" },
    { n: "Kids TV", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_kids_canais.m3u", t: "m3u", i: "fa-child" },
    { n: "Kids Cine", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json", t: "json", i: "fa-icons" },
    { n: "Kids Séries", u: "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_series.json", t: "json", i: "fa-robot" }
];

async function carregarTudo() {
    menuContainer.innerHTML = "";
    for (let f of fontes) {
        if (!f.u && f.t !== "fav") continue;
        const res = f.u ? await fetch(f.u) : null;
        const data = res ? (f.t === "m3u" ? parseM3U(await res.text()) : await res.json()) : [];

        if (data.categories) {
            data.categories.forEach(cat => {
                criarBotaoMenu(cat.name, f.i, () => renderLista(cat.items));
                cat.items.forEach(i => globalDB.push(i));
            });
        } else if (f.t === "fav") {
            criarBotaoMenu(f.n, f.i, () => renderLista(JSON.parse(localStorage.getItem('paixaoflix_favs')) || []));
        } else {
            criarBotaoMenu(f.n, f.i, () => renderLista(data));
            if(Array.isArray(data)) data.forEach(i => globalDB.push(i));
        }
    }
}

function criarBotaoMenu(nome, icone, acao) {
    const div = document.createElement('div');
    div.className = "item-clicavel";
    div.innerHTML = `<i class="fas ${icone}"></i> ${nome}`;
    div.onclick = () => {
        document.querySelectorAll('.item-clicavel').forEach(m => m.classList.remove('selecionado'));
        div.classList.add('selecionado');
        acao();
        painelConteudo.style.display = "block";
    };
    menuContainer.appendChild(div);
}

function parseM3U(text) {
    let items = [], temp = null;
    text.split('\n').forEach(line => {
        if (line.startsWith('#EXTINF')) {
            const logo = line.match(/tvg-logo="([^"]+)"/)?.[1];
            temp = { name: line.split(',').pop().trim(), poster: logo };
        } else if (line.startsWith('http') && temp) {
            temp.link = line.trim(); items.push(temp); temp = null;
        }
    });
    return items;
}

function renderLista(items) {
    listaCanaisDiv.innerHTML = "";
    if(!items) return;
    items.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = "canal-item";
        div.innerHTML = item.name || item.titulo;
        div.onclick = () => {
            itemIndex = i;
            document.querySelectorAll('.canal-item').forEach(c => c.classList.remove('ativo'));
            div.classList.add('ativo');
            imgCapa.src = item.poster || item.logo || "";
            imgCapa.style.display = "block";
            imgCapa.onclick = () => playMedia(item);
        };
        listaCanaisDiv.appendChild(div);
    });
}

function playMedia(item) {
    const url = item.link || item.url;
    if (hls) hls.destroy();
    if (url.includes(".m3u8")) {
        hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else { video.src = url; video.play(); }
    painelConteudo.style.display = "none"; btnSair.style.display = "block";
}

function fecharPlayer() { video.pause(); video.src = ""; btnSair.style.display = "none"; painelConteudo.style.display = "block"; }

searchInput.oninput = () => {
    const v = searchInput.value.toLowerCase();
    if(!v) return;
    renderLista(globalDB.filter(i => (i.name || i.titulo || "").toLowerCase().includes(v)));
    painelConteudo.style.display = "block";
};

// NAVEGAÇÃO POR SETAS TOTAL (MENU -> BUSCA -> LISTA)
document.onkeydown = (e) => {
    const menus = document.querySelectorAll('.item-clicavel');
    const itens = document.querySelectorAll('.canal-item');

    if (e.key === "ArrowDown") {
        if (focoAtual === "menu") { menuIndex = (menuIndex + 1) % menus.length; menus[menuIndex].scrollIntoView({block:"center"}); }
        else if (focoAtual === "lista") { itemIndex = (itemIndex + 1) % itens.length; if(itens[itemIndex]) itens[itemIndex].click(); }
        else if (focoAtual === "busca") { focoAtual = "menu"; menuIndex = 0; }
    } else if (e.key === "ArrowUp") {
        if (focoAtual === "menu") { 
            if (menuIndex === 0) { focoAtual = "busca"; searchInput.focus(); } 
            else { menuIndex--; menus[menuIndex].scrollIntoView({block:"center"}); }
        }
        else if (focoAtual === "lista") { itemIndex = (itemIndex - 1 + itens.length) % itens.length; if(itens[itemIndex]) itens[itemIndex].click(); }
    } else if (e.key === "ArrowRight") {
        if (focoAtual === "menu") { focoAtual = "lista"; itemIndex = 0; if(itens[0]) itens[0].click(); }
    } else if (e.key === "ArrowLeft") {
        if (focoAtual === "lista") focoAtual = "menu";
    } else if (e.key === "Enter") {
        if (focoAtual === "menu") menus[menuIndex].click();
        else if (focoAtual === "lista") imgCapa.click();
    }
    
    if (focoAtual !== "busca") {
        searchInput.blur();
        menus.forEach((m, i) => m.classList.toggle('selecionado', i === menuIndex && focoAtual === "menu"));
    }
};

function updateClock() {
    const d = new Date();
    document.getElementById("relogio").innerText = `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}
setInterval(updateClock, 1000); updateClock(); carregarTudo();
</script>
</body>
</html>
