<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixãoFlix TV</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* RESET */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
html, body {
    width: 100%;
    height: 100%;
    background: #000;
    color: #fff;
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
}

/* TOPO */
#topo {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    background: linear-gradient(to bottom, #000, transparent);
    position: absolute;
    width: 100%;
    z-index: 10;
}
#logo {
    height: 72px;
}
#hora {
    font-size: 16px;
    opacity: 0.9;
}

/* CONTAINER */
#container {
    display: flex;
    height: 100%;
    padding-top: 90px;
}

/* LISTA DE CANAIS */
#lista {
    width: 340px;
    background: rgba(0,0,0,0.85);
    overflow: hidden;
}
#canais {
    list-style: none;
}
.canal {
    padding: 14px 18px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
}
.canal.ativo {
    background: #1db954;
    color: #000;
    font-weight: bold;
}

/* PLAYER */
#player-container {
    flex: 1;
    background: #000;
}
video {
    width: 100%;
    height: 100%;
    background: #000;
}
</style>
</head>

<body>

<div id="topo">
    <img id="logo" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
    <div id="hora"></div>
</div>

<div id="container">
    <div id="lista">
        <ul id="canais"></ul>
    </div>
    <div id="player-container">
        <video id="player" autoplay controls></video>
    </div>
</div>

<script>
/* DATA / HORA */
function atualizarHora() {
    const agora = new Date();
    const dias = ["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];
    const meses = ["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"];
    document.getElementById("hora").innerText =
        `${dias[agora.getDay()]}, ${String(agora.getDate()).padStart(2,'0')} ${meses[agora.getMonth()]} ${agora.getFullYear()} | ${agora.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`;
}
setInterval(atualizarHora, 1000);
atualizarHora();

/* VARIÁVEIS */
let canais = [];
let indiceAtual = 0;
const lista = document.getElementById("canais");
const player = document.getElementById("player");

/* CARREGAR M3U */
fetch("playlist/canais.m3u")
.then(r => r.text())
.then(texto => {
    const linhas = texto.split("\n");
    for (let i = 0; i < linhas.length; i++) {
        if (linhas[i].startsWith("#EXTINF")) {
            const nome = linhas[i].split(",")[1];
            const url = linhas[i+1];
            canais.push({ nome, url });
        }
    }
    montarLista();
    tocarCanal(0);
});

/* MONTAR LISTA */
function montarLista() {
    lista.innerHTML = "";
    canais.forEach((canal, i) => {
        const li = document.createElement("li");
        li.className = "canal";
        li.innerText = canal.nome;
        li.onclick = () => tocarCanal(i);
        lista.appendChild(li);
    });
}

/* TOCAR CANAL */
function tocarCanal(i) {
    indiceAtual = (i + canais.length) % canais.length;
    document.querySelectorAll(".canal").forEach((c, idx) => {
        c.classList.toggle("ativo", idx === indiceAtual);
    });
    player.src = canais[indiceAtual].url;
    player.play();
    manterItemVisivel();
}

/* SCROLL INVISÍVEL */
function manterItemVisivel() {
    const ativo = document.querySelector(".canal.ativo");
    if (ativo) ativo.scrollIntoView({ block: "center" });
}

/* CONTROLE REMOTO */
document.addEventListener("keydown", e => {
    switch (e.key) {
        case "ArrowDown":
            tocarCanal(indiceAtual + 1);
            break;
        case "ArrowUp":
            tocarCanal(indiceAtual - 1);
            break;
        case "ChannelUp":
        case "MediaTrackNext":
            tocarCanal(indiceAtual + 1);
            break;
        case "ChannelDown":
        case "MediaTrackPrevious":
            tocarCanal(indiceAtual - 1);
            break;
    }

    if (e.keyCode === 427) tocarCanal(indiceAtual + 1); // Samsung CH+
    if (e.keyCode === 428) tocarCanal(indiceAtual - 1); // Samsung CH-
});
</script>

</body>
</html>
