<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Paix√£oFlix</title>
<link href="data:font/woff2;base64,..." rel="stylesheet"><!-- Poppins via Google Fonts embutida via @import no <style> -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;font-size:16px}
body{height:100vh;display:flex;background:#111;color:#fff;overflow:hidden}
#sidebar{position:fixed;left:0;top:0;height:100%;width:250px;background:#C0C0C0;color:#000;display:flex;flex-direction:column;align-items:center;z-index:9999}
#logo{margin-top:10px;height:180px}
#clock{margin:8px 0;font-weight:600}
#search{width:90%;margin:5px 0;padding:8px;border-radius:5px;border:0}
#search:focus{outline:none}
.navBtn{display:block;width:90%;margin:4px 0;background:#363636;border:none;color:#fff;padding:12px;border-radius:6px;cursor:pointer;transition:.2s}
.navBtn:hover,.navBtn.active{background:#033f99;transform:scale(1.05);box-shadow:0 4px 12px #00000088}
#sairBtn{background:#770000}
#main{flex:1;margin-left:250px;display:flex;flex-direction:column}
header{height:60px;background:#000;display:none;align-items:center;justify-content:center}
#content{flex:1;display:flex;flex-wrap:wrap;align-content:flex-start;gap:8px;padding:8px;overflow-y:auto}
.card{position:relative;width:160px;cursor:pointer}
.card img{width:100%;border-radius:6px}
.card .info{font-size:12px;text-align:center;margin-top:2px}
#player{display:none;position:fixed;inset:0;z-index:10000}
video{width:100%;height:100%;background:#000}
#exitPlayer{position:absolute;top:10px;right:10px;background:#fff2;color:#fff;border:0;padding:6px 10px;border-radius:5px;display:none;pointer-events:auto}
.overlay{position:fixed;inset:0;background:#0008;display:none;flex-direction:column;justify-content:center;align-items:center}
.overlay img{height:240px;max-width:80vw}
.spinner{width:40px;height:40px;border:4px solid #fff3;border-top:#fff;border-radius:50%;animation:spin 1s linear infinite;margin-top:15px}
@keyframes spin{to{transform:rotate(360deg)}}
.scrollRow{display:flex;width:100%;overflow-x:auto;gap:8px;padding-bottom:8px;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}
.lineTitle{width:100%;font-weight:600;margin:6px 0 4px 4px}
.lineRow .card{flex:0 0 auto;max-width:220px}
/* Responsivo */
@media (max-width:600px){
 body{flex-direction:column}
 #sidebar{display:none}
 #main{margin-left:0}
 #main{height:100vh}
 #main{overflow:hidden}
 body.landscape #sidebar{display:flex}
}
</style>
</head>
<body>
<!-- Carregando -->
<div class="overlay" id="loading">
 <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="logo">
 <div class="spinner"></div>
</div>

<!-- Barra lateral -->
<div id="sidebar">
 <img id="logo" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="logo">
 <button id="sairBtn" class="navBtn">Sair</button>
 <div id="clock"></div>
 <input type="text" id="search" placeholder="Pesquisar...">
 <button class="navBtn" data-section="tv">üì∫ TV ao Vivo</button>
 <button class="navBtn" data-section="fav">‚ù§Ô∏è Favoritos</button>
 <button class="navBtn" data-section="cont">‚è≥ Continue Assistindo</button>
 <button class="navBtn" data-section="cinema">üé¨ Cinema</button>
 <button class="navBtn" data-section="series">üì∫ S√©ries</button>
 <button class="navBtn" data-section="tvkids">üß∏ Canais Kids</button>
 <button class="navBtn" data-section="filmeskids">üé• Filmes Kids</button>
 <button class="navBtn" data-section="serieskids">üì∫ S√©ries Kids</button>
</div>

<!-- Principal -->
<div id="main">
 <header></header>
 <div id="content"></div>
</div>

<!-- Player -->
<div id="player">
 <video id="videoEl" controls autoplay></video>
 <button id="exitPlayer">Sair</button>
</div>

<script>
// VARIAVEIS
const sources={
 tv:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u",
 fav:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/favoritos.json",
 cinema:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json",
 series:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json",
 tvkids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_kids_canais.m3u",
 filmeskids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json",
 serieskids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json"
}
const categorias=['A√ß√£o','Aventura','Com√©dia','Drama','Nacional','Romance','Religioso','Fic√ß√£o','Anime','Anima√ß√£o','Cl√°ssicos','Dorama','Suspense','Policial','Crime','Terror','Document√°rios','Faroeste','Musical','Adulto'];
let dataStore={};
let continueList=JSON.parse(localStorage.getItem("continue")||"[]");

// UTIL
function formatDate(){
 const d=new Date();
 return d.toLocaleDateString('pt-br',{weekday:'long',day:'2-digit',month:'2-digit',year:'2-digit'})+" | "+d.toLocaleTimeString('pt-br',{hour:'2-digit',minute:'2-digit'});
}
function m3uToJson(txt){
 const lines=txt.split('\n');
 let obj=[],item={};
 for(const i of lines){
  if(i.startsWith('#EXTINF')){
   item={title:i.split(',')[1],logo:((i.match(/tvg-logo="(.*?)"/)||[])[1]||""),url:""};
  }else if(item.title&&i.trim()&&!i.startsWith('#')){
   item.url=i.trim();
   item.type="live";
   obj.push(item);
   item={};
  }
 }
 return obj;
}
const nav=document.querySelectorAll(".navBtn");
const cont=document.getElementById("content");
const search=document.getElementById("search");
const player=document.getElementById("player");
const videoEl=document.getElementById("videoEl");
const exitBtn=document.getElementById("exitPlayer");

// SALVAR HIST√ìRICO
function saveHistory(item){
 item.timestamp=Date.now();
 const exists=continueList.findIndex(o=>o.url===item.url);
 if(exists>-1)continueList.splice(exists,1);
 continueList.unshift(item);
 continueList=continueList.filter(x=>Date.now()-x.timestamp<86400000);
 localStorage.setItem("continue",JSON.stringify(continueList));
}

// RENDER
function render(data,section){
 cont.innerHTML="";
 if(section==='tv'||section==='tvkids'){
  // GROUP BY GROUP-TITLE
  const map={};
  data.forEach(ch=>{
   const grp=ch.group||"Outros";
   if(!map[grp])map[grp]=[];
   map[grp].push(ch);
  });
  Object.keys(map).sort().forEach(cat=>{
   const line=document.createElement("div");
   line.className="lineRow";
   line.innerHTML=`<div class="lineTitle">${cat}</div><div class="scrollRow" data-cat="${cat}"></div>`;
   const inside=line.querySelector(".scrollRow");
   map[cat].forEach((c,i)=>{
    const card=makeCard(c,section);
    inside.appendChild(card);
   });
   cont.appendChild(line);
  });
  return;
 }
 if(['cinema','series','filmeskids','serieskids'].includes(section)){
  // CATEGORIAS
  const catBox=document.createElement("div");
  catBox.className="categBox";
  const overlay=document.createElement("div");
  overlay.style.position="fixed";overlay.style.inset="0";overlay.style.background="#000d";overlay.style.zIndex="10001";overlay.style.display="none";
  catBox.style.position="absolute";catBox.style.top="50px";catBox.style.left="50%";catBox.style.transform="translateX(-50%)";
  catBox.style.background="#C0C0C0";catBox.style.padding="20px";catBox.style.borderRadius="8px";catBox.style.display="none";
  catBox.style.flexWrap="wrap";catBox.style.justifyContent="center";catBox.style.gap="10px";
  overlay.appendChild(catBox);
  catBox.onclick=e=>e.stopPropagation();
  overlay.onclick=()=>{overlay.style.display="none";catBox.style.display="none"};
  categorias.forEach(c=>{
   const b=document.createElement("button");
   b.className="navBtn";
   b.textContent=c;
   b.onclick=()=>filterGenre(section,c);
   catBox.appendChild(b);
  });
  document.body.appendChild(overlay);

  const catBtn=document.createElement("button");
  catBtn.textContent="Categorias ‚ñº";
  catBtn.className="navBtn";
  catBtn.style.position="absolute";catBtn.style.top="10px";catBtn.style.right="10px";
  catBtn.onclick=()=>{
   overlay.style.display="flex";
   catBox.style.display="flex";
  };
  cont.appendChild(catBtn);
  data.forEach(d=>cont.appendChild(makeCard(d,section)));
  return;
 }
 if(section==='cont'){
  continueList.forEach(it=>cont.appendChild(makeCard(it,"cont")));
  return;
 }
 if(section==='fav'){ /* placeholder */ return; }
}

function makeCard(obj,sec){
 const d=document.createElement("div");
 d.className="card";
 const img=document.createElement("img");
 img.onerror=()=>img.src="https://i.imgur.com/7kMHXgL.png";
 img.src=obj.poster||obj.logo||obj.thumb||"";
 img.alt=obj.titulo;
 const info=document.createElement("div");
 info.className="info";
 info.innerHTML=`${obj.year||""} &nbsp; ‚≠ê ${obj.rating||""}`;
 d.appendChild(img);
 d.appendChild(info);
 d.onclick=()=>play(obj,sec);
 // AJUSTAR FOCO
 d.tabIndex=0;
 return d;
}

function filterGenre(sec,gen){
 // filtro simples
 const cat=document.querySelector(".categBox");
 cat.parentElement.style.display="none";
 const f=dataStore[sec].filter(x=>x.genero&&x.genero.split(/\s*,\s*/).includes(gen));
 render(f,sec);
}

function play(item,section){
 const hasHistory=continueList.find(o=>o.url===item.url);
 videoEl.src=item.url;
 const ask=document.createElement("div");
 ask.style.position="fixed";ask.style.inset="0";ask.style.background="#000b";ask.style.zIndex="10002";
 ask.style.display="flex";ask.style.justifyContent="center";ask.style.alignItems="center";ask.style.flexDirection="column";
 ask.innerHTML=`<div style="background:#000a;padding:30px;border-radius:10px;text-align:center;font-size:22px">
 <strong>${item.titulo}</strong><br><br>
 <button id="btn_cont" class="navBtn">Continuar Assistindo</button>
 <button id="btn_restart" class="navBtn">Recome√ßar</button>
 </div>`;
 document.body.appendChild(ask);
 if(hasHistory){
  ask.querySelector("#btn_cont").onclick=()=>{videoEl.currentTime=hasHistory.time||0;go();}
  ask.querySelector("#btn_restart").onclick=()=>{videoEl.currentTime=0;go();}
 }else{
  ask.remove();
  go();
 }
 function go(){
  if(!hasHistory)saveHistory(item);
  ask&&ask.remove();
  player.style.display="block";
  videoEl.focus();
  videoEl.play();
 }
}

// EVENTOS PLAYER
function hideExit(){exitBtn.style.display="none";}
function showExit(){exitBtn.style.display="block";}
videoEl.addEventListener("play",()=>setTimeout(hideExit,3000));
videoEl.addEventListener("click",showExit);
document.addEventListener("keydown",e=>{
 const active=document.activeElement;
 if(e.key==="ArrowRight") videoEl.currentTime+=10;
 else if(e.key==="ArrowLeft") videoEl.currentTime-=10;
 else if(e.key==="ArrowUp" && player.style.display==="block") chNext(-1);
 else if(e.key==="ArrowDown" && player.style.display==="block") chNext(1);
 else if(e.key==="Enter") showExit();
 else if(e.key==="Escape") exitBtn.click();
});
exitBtn.addEventListener("click",()=>{
 player.style.display="none";
 videoEl.pause();
});

// CH+ CH-
function chNext(dir){}
// CONTROLE REMOTO / TOUCH
window.addEventListener("touchstart",showExit);
exitBtn.addEventListener("touchstart",e=>e.stopPropagation());

// NAVEGA√á√ÉO SIDEBAR
nav.forEach(b=>b.onclick=async ()=>{
 const sec=b.dataset.section;
 loadSection(sec);
}));

async function loadSection(section){
 document.querySelectorAll(".navBtn").forEach(x=>x.classList.remove("active"));
 document.querySelector(`[data-section="${section}"]`)?.classList.add("active");
 if(continueList && section==="cont"){render(continueList,"cont");return;}
 if(!dataStore[section]){
  const raw=await fetchText(sources[section]);
  if(sources[section].endsWith(".json")){
   dataStore[section]=JSON.parse(raw);
  }else{
   dataStore[section]=m3uToJson(raw);
  }
  if(section.includes("kids")) dataStore[section].sort((a,b)=>a.titulo.localeCompare(b.titulo));
 }
 render(dataStore[section],section);
}
async function fetchText(url){
 return fetch(url).then(r=>r.text());
}

// SAIR
document.getElementById("sairBtn").onclick=()=>location.href="about:blank";
exitBtn.onclick=()=>{player.style.display="none";videoEl.pause();}

// PESQUISA GLOBAL (Filtro em tudo carregado)
search.addEventListener("input",()=>{
 const q=search.value.trim().toLowerCase();
 if(!q){cont.innerHTML="";document.activeElement.blur();return;}
 const list=[];
 Object.values(dataStore).forEach(arr=>arr.forEach(x=>{
  if(JSON.stringify(x).toLowerCase().includes(q))list.push(x);
 }));
 render(list,"search");
});

// CLOCK
setInterval(()=>document.getElementById("clock").textContent=formatDate(),1000);

// INICIA
(async ()=>{
 await loadSection("tv");
 document.getElementById("loading").style.display="none";
})();
</script>
</body>
</html>
