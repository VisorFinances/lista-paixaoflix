<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix – Web TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
:root { --primary: #e50914; --bg: #111; }
body{margin:0;background:#000;color:#fff;font-family:Poppins;display:flex;height:100vh;overflow:hidden}
* { scrollbar-width: none; -ms-overflow-style: none; box-sizing: border-box; }
*::-webkit-scrollbar { display: none; }

#side{width:340px;background:var(--bg);display:flex;flex-direction:column;z-index:10;border-right:1px solid #222;}
#top{padding:20px;}
#header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
#logo{max-width:180px;max-height:80px;object-fit:contain}
#clock-container{text-align:right;}
#clock{font-size:24px;font-weight:700;line-height:1;}

#search{width:100%;box-sizing:border-box;padding:12px;border-radius:8px;border:1px solid var(--primary);background:#000;color:#fff;outline:none;}
#now-playing-info{padding:10px 20px;background:rgba(255,255,255,0.05);border-bottom:1px solid #222;font-size:13px;}
#now-playing-info b{color:var(--primary);display:block;}

#buttons{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:10px}
#buttons button{padding:10px;border:0;border-radius:6px;background:#222;color:#fff;font-weight:700;cursor:pointer;font-size:11px;}
#buttons button.active{background:var(--primary)}

#list-container{flex:1;display:flex;flex-direction:column;overflow:hidden;}
#list{flex:1;overflow-y:auto;}
.item{padding:14px;border-bottom:1px solid #222;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-left:5px solid transparent;}
.item.focus{border-left-color:var(--primary);background:rgba(255,255,255,0.05)!important;outline:none;}
.item .fav-icon{color: #444; font-size: 18px;}
.item.is-fav .fav-icon{color: var(--primary);}

#player{flex:1;position:relative;background:#000;display:flex;align-items:center;justify-content:center;}
video{width:100%;height:100%;background:#000;cursor:pointer;}

#overlay-zap{position:absolute;bottom:60px;left:40px;background:rgba(15,15,15,0.9);padding:20px 40px;display:none;border-left:8px solid var(--primary);border-radius:4px;z-index:100;pointer-events:none;}
#zap-title{font-size:32px;font-weight:700;margin:0;}

#overlay-meta{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;display:none;flex-direction:column;justify-content:center;padding:40px;box-sizing:border-box;z-index:110;}

@media (max-width: 768px) {
    body { flex-direction: column; }
    #side { width: 100%; height: auto; border-right: none; }
    #clock-container { display: none; }
    #buttons { display: flex; overflow-x: auto; padding: 10px; gap: 8px; background: #111; }
    #buttons button { flex: 0 0 auto; padding: 8px 15px; }
    #player { width: 100%; height: 230px; flex: none; order: -1; }
    #list-container { height: auto; flex: 1; }
}
</style>
</head>

<body>

<div id="side">
  <div id="top">
    <div id="header-row">
        <img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logo.png?raw=true">
        <div id="clock-container"><div id="clock">00:00</div></div>
    </div>
    <input id="search" placeholder="Pesquisar...">
  </div>
  <div id="now-playing-info"><b>ASSISTINDO:</b> <span id="current-title">Selecione um canal</span></div>
  <div id="buttons">
    <button id="btnTV" class="active">TV</button>
    <button id="btnFilmes">FILMES</button>
    <button id="btnSeries">SÉRIES</button>
    <button id="btnKids" style="background:#0056b3">KIDS</button>
    <button id="btnFav">FAVORITOS</button>
    <button id="btnHist">HISTÓRICO</button>
  </div>
  <div id="list-container"><div id="list"></div></div>
</div>

<div id="player">
  <video id="video" autoplay playsinline controls style="width:100%; height:100%;"></video>
  <div id="overlay-zap"><div id="zap-title">Canal</div></div>
  <div id="overlay-meta">
      <h1 id="meta-title">Título</h1>
      <p id="meta-desc">Descrição...</p>
      <div style="display:flex;margin-top:20px;">
        <button onclick="document.getElementById('overlay-meta').style.display='none'" style="padding:15px 30px; background:var(--primary); color:#fff; border:none; border-radius:5px; font-weight:bold;">VOLTAR</button>
      </div>
  </div>
</div>

<script>
const video=document.getElementById('video');
const currentTitleDisplay = document.getElementById('current-title');
let hls=null, allItems=[], items=[];

function play(url, title, isZap=false){
    if(!url) return;
    console.log("Tentando reproduzir:", url);
    
    currentTitleDisplay.innerText = title;

    if (Hls.isSupported() && (url.includes(".m3u8") || url.includes("stream"))) {
        if (hls) hls.destroy();
        hls = new Hls({
            maxBufferSize: 0,
            maxBufferLength: 30,
            enableWorker: true
        });
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
            video.play().catch(e => console.log("Erro ao dar play:", e));
        });
        hls.on(Hls.Events.ERROR, function(event, data) {
            if (data.fatal) {
                switch(data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR: hls.startLoad(); break;
                    case Hls.ErrorTypes.MEDIA_ERROR: hls.recoverMediaError(); break;
                    default: hls.destroy(); break;
                }
            }
        });
    } else {
        video.src = url;
        video.play().catch(e => console.log("Erro ao dar play nativo:", e));
    }

    if(isZap){
        document.getElementById('zap-title').innerText = title;
        document.getElementById('overlay-zap').style.display='block';
        setTimeout(()=> document.getElementById('overlay-zap').style.display='none', 2000);
    }
}

async function loadTV(isKids=false){
    const path = isKids ? './data/kids_canais.m3u' : './data/canais.m3u';
    try {
        const r = await fetch(path);
        const txt = await r.text();
        let name=''; allItems=[];
        txt.split('\n').forEach(l=>{
            if(l.startsWith('#EXTINF')) name=l.split(',').pop();
            else if(l.startsWith('http')) allItems.push({title:name.trim(), url:l.trim()});
        });
        items=[...allItems];
        render();
    } catch(e) { console.log("Erro ao carregar lista:", e); }
}

function render(){
    const list = document.getElementById('list');
    list.innerHTML='';
    items.forEach((i) => {
        const d = document.createElement('div');
        d.className = 'item';
        d.innerHTML = `<span>${i.title}</span>`;
        d.onclick = () => play(i.url, i.title, true);
        list.appendChild(d);
    });
}

document.getElementById('btnTV').onclick=()=>loadTV(false);
document.getElementById('btnKids').onclick=()=>loadTV(true);

window.onload=()=>loadTV();
function updateClock(){ document.getElementById('clock').innerText=new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}); }
setInterval(updateClock,1000); updateClock();
</script>
</body>
</html>
