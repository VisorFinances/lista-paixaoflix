<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixãoFlix TV — FINAL ESTÁVEL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&family=Montserrat:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins','Montserrat',sans-serif}
body{background:#040714;color:#fff;overflow:hidden}

/* ====== FOCO ====== */
.focused{outline:none;border:3px solid #FFCE44!important;box-shadow:0 6px 0 rgba(0,0,0,.6),0 0 15px rgba(255,206,68,.8);transform:translateY(-2px)}

/* ====== BOTÕES 3D ====== */
.btn3d,.menu-item{
  background:#1b1f33;
  border-radius:14px;
  border-bottom:5px solid #0a0d1a;
}
.btn3d:active,.menu-item:active{transform:translateY(3px);border-bottom-width:2px}

/* ====== TOP BAR ====== */
#topBar{height:90px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;border-bottom:1px solid rgba(255,255,255,.1)}
#logoMain{height:70px;cursor:pointer}
#searchWrapper{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.1);padding:12px 20px;border-radius:40px}
#searchInput{background:none;border:none;color:#fff;font-size:18px}

/* ====== SIDE MENU ====== */
#sideMenu{position:fixed;top:90px;left:0;width:80px;height:calc(100vh - 90px);display:flex;flex-direction:column;align-items:center;padding-top:20px;transition:.25s}
#sideMenu.active{width:230px}
.menu-item{width:100%;height:60px;display:flex;align-items:center;gap:15px;padding-left:28px;color:#bbb;cursor:pointer}
.menu-item span{display:none}
#sideMenu.active span{display:block}

/* ====== MAIN ====== */
#mainScroll{position:absolute;top:90px;left:80px;width:calc(100% - 80px);height:calc(100% - 90px);overflow-y:auto}
#mainScroll::-webkit-scrollbar{display:none}

/* ====== HERO ====== */
.hero-banner{height:380px;margin:30px;border-radius:25px;display:flex;flex-direction:column;justify-content:flex-end;padding:40px;background-size:cover;background-position:center}

/* ====== CATEGORY ====== */
.category-block{margin:40px}
.cat-header{font-size:30px;font-weight:900;margin-bottom:25px;border-left:8px solid #FFCE44;padding-left:20px;color:#FFCE44}
.movie-grid-horizontal{display:flex;gap:20px}
.movie-card{width:300px;border-radius:16px;cursor:pointer}
.movie-poster{width:100%;aspect-ratio:2/3;border-radius:16px;object-fit:cover}

/* ====== DETAILS ====== */
.details-bg{position:absolute;inset:0;background-size:cover;background-position:center;filter:blur(6px);opacity:.25}
.details-wrap{position:relative;display:flex;gap:40px;padding:60px}
.details-poster{width:320px;border-radius:20px}
.details-info h1{font-size:46px;font-weight:900}
.details-info p{margin-top:15px;font-size:18px;max-width:800px}
.details-actions{display:flex;gap:11px;margin-top:25px}
.fav-icon{font-size:28px;color:#FFCE44;cursor:pointer}

/* ====== PLAYER ====== */
#videoContainer{position:fixed;inset:0;background:#000;display:none;z-index:9999}
#playerExit{position:absolute;top:30px;right:40px;background:#FFCE44;color:#000;padding:10px 25px;border-radius:20px;font-weight:900;cursor:pointer}

/* ====== PROFILE ====== */
#profileGate{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:radial-gradient(circle at top,#0b0f2a,#040714);z-index:10000}
.profile-wrapper{text-align:center}
.profile-grid{display:flex;gap:50px}
.profile-card{width:200px;cursor:pointer}
.profile-card img{width:100%;border-radius:20px}
.profile-card span{display:block;margin-top:15px;font-size:22px;font-weight:700}
</style>
</head>

<body onload="initSystem()">

<!-- PROFILE -->
<div id="profileGate">
  <div class="profile-wrapper">
    <h1>Quem está assistindo?</h1>
    <div class="profile-grid" id="profileGrid"></div>
    <div class="btn3d" tabindex="0" style="margin-top:40px;padding:15px 40px;display:inline-block" onclick="renderHome()">VOLTAR AO INÍCIO</div>
  </div>
</div>

<!-- TOP -->
<div id="topBar">
  <img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" tabindex="0" onclick="renderHome()">
  <div id="searchWrapper" tabindex="0">
    <i class="fas fa-search"></i>
    <input id="searchInput" placeholder="Pesquisar..." onkeyup="globalSearch(this.value)">
  </div>
</div>

<!-- SIDE -->
<div id="sideMenu">
  <div class="menu-item" tabindex="0" onclick="renderHome()"><i class="fas fa-home"></i><span>INÍCIO</span></div>
  <div class="menu-item" tabindex="0" onclick="renderCinema()"><i class="fas fa-film"></i><span>CINEMA</span></div>
  <div class="menu-item" tabindex="0" onclick="renderSeries()"><i class="fas fa-clapperboard"></i><span>SÉRIES</span></div>
  <div class="menu-item" tabindex="0" onclick="renderFavoritos()"><i class="fas fa-heart"></i><span>MINHA LISTA</span></div>
  <div class="menu-item" tabindex="0" onclick="logoutProfile()"><i class="fas fa-user-switch"></i><span>TROCAR PERFIL</span></div>
</div>

<div id="mainScroll"><div id="dynamicContent"></div></div>

<!-- PLAYER -->
<div id="videoContainer">
  <div id="playerExit" tabindex="0" onclick="exitPlayer()">SAIR</div>
  <div id="mainPlayer" style="width:100%;height:100%"></div>
</div>

<script>
/* ===== DB ===== */
let db={cinema:[],series:[],kids_filmes:[],kids_series:[],todos:[]};
let player=null,currentItem=null;

/* ===== PERFIS ===== */
const profiles=[
 {name:"Família",avatar:"https://i.imgur.com/9XqZ6zB.png"},
 {name:"Adulto",avatar:"https://i.imgur.com/3XKJqQO.png"},
 {name:"Kids",avatar:"https://i.imgur.com/9ZQZQZQ.png"}
];

async function initSystem(){
 await loadData();
 initProfiles();
 renderHome();
 wakeFocus();
}

/* ===== PERFIL ===== */
function initProfiles(){
 if(localStorage.getItem("paixaoflix_profile")) return;
 const g=document.getElementById("profileGrid");
 g.innerHTML="";
 document.getElementById("profileGate").style.display="flex";
 profiles.forEach(p=>{
   g.innerHTML+=`<div class="profile-card btn3d" tabindex="0" onclick="selectProfile('${p.name}')">
   <img src="${p.avatar}"><span>${p.name}</span></div>`;
 });
}
function selectProfile(p){
 localStorage.setItem("paixaoflix_profile",p);
 document.getElementById("profileGate").style.display="none";
}
function logoutProfile(){
 localStorage.removeItem("paixaoflix_profile");
 document.getElementById("profileGate").style.display="flex";
}

/* ===== DATA ===== */
async function loadData(){
 const files=["filmes.json","series.json","kids_filmes.json","kids_series.json"];
 const data=await Promise.all(files.map(f=>fetch("data/"+f).then(r=>r.json()).catch(()=>[])));
 db.cinema=data[0];db.series=data[1];
 db.kids_filmes=data[2];db.kids_series=data[3];
 db.todos=[...db.cinema,...db.series,...db.kids_filmes,...db.kids_series];
}

/* ===== HOME ===== */
function renderHome(){
 const c=document.getElementById("dynamicContent");
 const hero=db.todos[Math.floor(Math.random()*db.todos.length)];
 c.innerHTML=`
 <div class="hero-banner" style="background-image:linear-gradient(to bottom,transparent,#040714),url('${hero.banner||hero.poster}')">
   <h1>${hero.titulo}</h1>
 </div>
 <div style="text-align:center;margin-bottom:40px">
   <h2 style="color:#FFCE44;font-size:38px">Bem vindos ao <span style="color:#E50914">PaixãoFlix</span></h2>
   <p>Transformando momentos de lazer em lembranças felizes!</p>
 </div>`;
 renderTop4();
}

/* ===== TOP 4 (categorias diferentes) ===== */
function renderTop4(){
 const used=new Set(),top=[];
 for(const i of db.cinema){
   if(!used.has(i.genero)){top.push(i);used.add(i.genero)}
   if(top.length===4)break;
 }
 const c=document.getElementById("dynamicContent");
 c.innerHTML+=`<div class="category-block"><div class="cat-header">TOP 4</div><div class="movie-grid-horizontal" id="top4"></div></div>`;
 top.forEach(i=>document.getElementById("top4").innerHTML+=createCard(i));
}

/* ===== DETAILS ===== */
function openDetails(id){
 const item=db.todos.find(i=>btoa(i.titulo)===id);
 if(!item) return;
 currentItem=item;
 const c=document.getElementById("dynamicContent");
 c.innerHTML=`
 <div class="details-bg" style="background-image:url('${item.banner||item.poster}')"></div>
 <div class="details-wrap">
   <img class="details-poster" src="${item.poster}">
   <div class="details-info">
     <h1>${item.titulo}</h1>
     <p>${item.sinopse||""}</p>
     <div class="details-actions">
       <div class="btn3d" tabindex="0" onclick="playVideo('${item.url}',0)">ASSISTIR AGORA</div>
       <div class="btn3d" tabindex="0" onclick="renderHome()">VOLTAR</div>
       <i class="fas fa-star fav-icon" tabindex="0" onclick="toggleFavorito('${item.titulo}')"></i>
     </div>
   </div>
 </div>`;
}

/* ===== FAVORITOS ===== */
function toggleFavorito(t){
 let f=JSON.parse(localStorage.getItem("paixaoflix_favs")||"[]");
 f.includes(t)?f=f.filter(x=>x!==t):f.push(t);
 localStorage.setItem("paixaoflix_favs",JSON.stringify(f));
}
document.addEventListener("keydown",e=>{
 if(e.key==="f"||e.key==="F") if(currentItem) toggleFavorito(currentItem.titulo);
});

/* ===== CARDS ===== */
function createCard(i){
 return `<div class="movie-card btn3d" tabindex="0" onclick="openDetails('${btoa(i.titulo)}')">
 <img class="movie-poster" src="${i.poster}"></div>`;
}

/* ===== PLAYER ===== */
function playVideo(url,time){
 document.getElementById("videoContainer").style.display="block";
 if(player) player.destroy();
 player=new Clappr.Player({source:url,parentId:"#mainPlayer",autoPlay:true});
}
function exitPlayer(){
 if(player) player.stop();
 document.getElementById("videoContainer").style.display="none";
}

/* ===== SEARCH ===== */
function globalSearch(q){
 q=q.trim();
 if(!q){renderHome();return}
 const c=document.getElementById("dynamicContent");
 c.innerHTML=`<div class="category-block"><div class="cat-header">Busca</div><div class="movie-grid-horizontal" id="sg"></div></div>`;
 db.todos.filter(i=>i.titulo.toLowerCase().includes(q.toLowerCase()))
 .forEach(i=>document.getElementById("sg").innerHTML+=createCard(i));
}

/* ===== FOCUS ===== */
function wakeFocus(){
 setTimeout(()=>{
   const first=document.querySelector('[tabindex="0"]');
   if(first) first.focus();
 },300);
}
document.addEventListener("focusin",e=>{
 document.querySelectorAll(".focused").forEach(x=>x.classList.remove("focused"));
 if(e.target.tabIndex===0)e.target.classList.add("focused");
 if(e.target.closest("#sideMenu"))document.getElementById("sideMenu").classList.add("active");
 else document.getElementById("sideMenu").classList.remove("active");
});
</script>
</body>
</html>
