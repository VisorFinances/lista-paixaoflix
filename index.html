<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Poppins;
background:#000;
color:#fff;
overflow:hidden
}
::-webkit-scrollbar{display:none}

#app{display:flex;height:100vh}

/* SIDEBAR */
#side{
width:420px;
background:#111;
display:flex;
flex-direction:column;
border-right:1px solid #222
}

/* HEADER */
#header{
padding:16px;
display:flex;
align-items:center;
justify-content:space-between
}
#logo{width:160px}
#timebox{text-align:right}
#clock{font-size:20px}
#date{font-size:12px}

/* SEARCH */
#search{
margin:10px 16px;
padding:10px;
font-size:16px;
background:#000;
color:#fff;
border:2px solid #e50914;
border-radius:6px
}
#search.focus{outline:2px solid #fff}

/* NOW */
#now{
margin:4px 16px;
font-size:13px
}
#now span{font-size:14px}

/* MENU */
#menu{
margin:10px 16px;
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px
}
.btn{
padding:6px;
font-size:13px;
background:#222;
border-radius:6px;
text-align:center;
white-space:nowrap
}
.btn.focus{box-shadow:0 0 0 2px #fff inset}
.btn.active{background:#e50914}
.btn.kids{background:#0056b3}

/* LIST */
#list{
flex:1;
overflow-y:auto
}
.item{
padding:12px;
border-bottom:1px solid #222;
font-size:16px
}
.item.focus{
background:#222;
border-left:6px solid #e50914
}

/* DETAILS */
#details{
position:absolute;
top:0;
right:0;
width:420px;
height:100%;
background:#111;
border-left:1px solid #222;
display:none;
flex-direction:column;
padding:20px
}
#details h3{margin:0 0 10px 0}
#details p{font-size:13px;opacity:.9;flex:1}
.action{
padding:10px;
margin-top:10px;
font-size:16px;
text-align:center;
border-radius:6px
}
.action.play{background:#e50914}
.action.back{background:#555}
.action.focus{box-shadow:0 0 0 2px #fff inset}

/* PLAYER */
#player{flex:1;position:relative}
video{width:100%;height:100%}

/* OVERLAY */
#zap{
position:absolute;
bottom:40px;
left:40px;
background:rgba(0,0,0,.8);
padding:10px 20px;
font-size:20px;
border-left:6px solid #e50914;
display:none
}
</style>
</head>

<body>
<div id="app">

<div id="side">
<div id="header">
<img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<div id="timebox">
<div id="clock"></div>
<div id="date"></div>
</div>
</div>

<input id="search" placeholder="Pesquisar...">

<div id="now">Assistindo agora: <span>—</span></div>

<div id="menu">
<div class="btn active" data="tv">TV</div>
<div class="btn" data="filmes">Filmes</div>
<div class="btn" data="series">Séries</div>
<div class="btn kids" data="kids">Canal Kids</div>
<div class="btn kids" data="kidsconteudo">Filmes/Séries Kids</div>
<div class="btn" data="fav">Favoritos</div>
</div>

<div id="list"></div>
</div>

<div id="player">
<video id="video" autoplay></video>
<div id="zap"></div>
<div id="details">
<h3 id="dtitle"></h3>
<p id="dsinopse"></p>
<div class="action play" data-act="play">Assistir agora</div>
<div class="action back" data-act="back">Voltar</div>
</div>
</div>

</div>

<script>
/* CLOCK */
setInterval(()=>{
const d=new Date()
clock.textContent=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})
date.textContent=d.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'2-digit'})
},1000)

/* STATE */
let items=[],view=[],episodes=[]
let idx=0,menuIdx=0,epIdx=0,actIdx=0
let section='tv',focus='list'
let hls=null

const menuBtns=[...document.querySelectorAll('.btn')]
const actions=[...document.querySelectorAll('.action')]

/* LOADERS */
async function loadM3U(path){
const t=await fetch(path).then(r=>r.text())
items=[]
let name=''
t.split('\n').forEach(l=>{
if(l.startsWith('#EXTINF'))name=l.split(',').pop()
else if(l.startsWith('http'))items.push({title:name,url:l})
})
}
async function loadJSON(path){
items=await fetch(path).then(r=>r.json())
}

/* SECTION */
async function loadSection(s){
section=s
menuBtns.forEach(b=>b.classList.toggle('active',b.dataset===s))
details.style.display='none'
if(s==='tv') await loadM3U('data/canais.m3u')
if(s==='kids') await loadM3U('data/kids_canais.m3u')
if(s==='filmes') await loadJSON('data/filmes.json')
if(s==='series') await loadJSON('data/series.json')
if(s==='kidsconteudo'){
const a=await fetch('data/kids_filmes.json').then(r=>r.json())
const b=await fetch('data/kids_series.json').then(r=>r.json())
items=[...a,...b]
}
if(s==='fav') await loadJSON('data/favoritos.json')
view=[...items]
renderList()
idx=0
focus='list'
if(section==='tv') play(0)
updateFocus()
}

/* RENDER */
function renderList(){
list.innerHTML=''
view.forEach(v=>{
const d=document.createElement('div')
d.className='item'
d.textContent=v.nome||v.titulo||v.title
list.appendChild(d)
})
}

/* PLAYER */
function play(i){
const it=view[i]
if(!it||!it.url)return
if(hls){hls.destroy();hls=null}
if(it.url.includes('.m3u8')&&Hls.isSupported()){
hls=new Hls()
hls.loadSource(it.url)
hls.attachMedia(video)
}else video.src=it.url
video.play().catch(()=>{})
now.querySelector('span').textContent=it.nome||it.titulo||it.title
zap.textContent=it.nome||it.titulo||it.title
zap.style.display='block'
setTimeout(()=>zap.style.display='none',1200)
}

/* DETAILS */
function openDetails(item){
details.style.display='flex'
dtitle.textContent=item.titulo||item.title
dsinopse.textContent=item.sinopse||''
actIdx=0
focus='actions'
updateFocus()
}

/* FOCUS */
function updateFocus(){
document.querySelectorAll('.item').forEach((e,i)=>e.classList.toggle('focus',focus==='list'&&i===idx))
menuBtns.forEach((b,i)=>b.classList.toggle('focus',focus==='menu'&&i===menuIdx))
actions.forEach((a,i)=>a.classList.toggle('focus',focus==='actions'&&i===actIdx))
if(focus==='list') document.querySelectorAll('.item')[idx]?.scrollIntoView({block:'center'})
}

/* KEYS */
document.addEventListener('keydown',e=>{
if(e.key==='ArrowDown'){
if(focus==='list'){
idx=Math.min(idx+1,view.length-1)
if(section==='tv') play(idx)
}
if(focus==='menu'){focus='list'}
}
if(e.key==='ArrowUp'){
if(focus==='list'){
if(idx>0) idx--
else focus='menu'
}
}
if(e.key==='ArrowRight'){
if(focus==='list'&&(section==='filmes'||section==='series')){
openDetails(view[idx])
}
if(focus==='actions'){actIdx=Math.min(actIdx+1,actions.length-1)}
}
if(e.key==='ArrowLeft'){
if(focus==='actions'){
if(actIdx>0) actIdx--
else{details.style.display='none';focus='list'}
}
}
if(e.key==='Enter'){
if(focus==='menu') loadSection(menuBtns[menuIdx].dataset)
if(focus==='list'&&section==='tv') play(idx)
if(focus==='actions'){
if(actions[actIdx].dataset.act==='play') play(idx)
if(actions[actIdx].dataset.act==='back'){details.style.display='none';focus='list'}
}
}
updateFocus()
})

/* SEARCH */
search.addEventListener('input',()=>{
const q=search.value.toLowerCase()
view=items.filter(i=>(i.titulo||i.title||'').toLowerCase().includes(q))
idx=0
renderList()
updateFocus()
})

/* INIT */
loadSection('tv')
</script>

</body>
</html>
