<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>PaixãoFlix TV V.28.7.49</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;500;700;900&family=Open+Sans:ital,wght@1,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

    <style>
        /* CSS BASE */
        * { overflow: hidden !important; box-sizing: border-box; outline: none; -ms-overflow-style: none !important; scrollbar-width: none !important; }
        *::-webkit-scrollbar { display: none !important; }
        body { margin: 0; padding: 0; background: #000; color: #fff; height: 100vh; width: 100vw; font-family: 'Poppins', sans-serif; }

        .channel-category-title, #top6Title { 
            font-family: 'Open Sans', sans-serif !important; font-weight: 700 !important; font-style: italic !important; 
            color: #FFB400 !important; border-left: 6px solid #b20710; padding-left: 20px;
            font-size: var(--tamanho-titulo, 42px) !important; text-transform: uppercase; margin-bottom: 30px;
        }

        /* DETALHES PROFISSIONAIS */
        #detailsOverlay { position: fixed; inset: 0; background: #000; z-index: 8000; display: none; flex-direction: column; justify-content: center; }
        #detailsBg { position: absolute; inset: 0; background-size: cover; background-position: center top; z-index: -1; transition: background 0.8s ease-in-out; }
        #detailsOverlay::before { content: ""; position: absolute; inset: 0; background: linear-gradient(to right, #000 35%, transparent 100%), linear-gradient(to top, #000 15%, transparent 50%); z-index: 0; }
        #detailsContent { position: relative; z-index: 2; display: flex; align-items: center; padding: 0 80px; gap: 60px; }
        .details-poster-wrapper { flex: 0 0 380px; height: 550px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); overflow: hidden; border: 3px solid rgba(255,255,255,0.1); }
        .details-poster-wrapper img { width: 100%; height: 100%; object-fit: contain; background: #000; }
        #detTitle { font-size: 60px; font-weight: 900; margin-bottom: 10px; line-height: 1.1; text-transform: uppercase; }
        #detMeta { font-size: 24px; color: #FFCE44; font-weight: 600; margin-bottom: 25px; }
        #detDesc { font-size: 20px; color: #fff; line-height: 1.6; max-width: 800px; margin-bottom: 30px; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* BOTÕES */
        .btn-3d { padding: 18px 40px; font-size: 20px; border: none; border-radius: 12px; cursor: pointer; text-transform: uppercase; transition: 0.2s; color: #fff; font-weight: bold; }
        .btn-play-3d { background: #FFCE44 !important; color: #000 !important; }
        .btn-back-3d { background: #b20710 !important; }
        .btn-3d.focused { transform: scale(1.1); box-shadow: 0 0 30px rgba(255, 206, 68, 0.4); }

        /* NAVEGAÇÃO E GRIDS */
        #topBar { position: fixed; top: 0; left: 0; width: 100%; height: 75px; display: flex; align-items: center; justify-content: space-between; padding: 0 50px; z-index: 11000; background: #000; border-bottom: 1px solid rgba(255,255,255,0.05); }
        #menuBrands { position: fixed; left: 0; top: 75px; width: 80px; height: calc(100vh - 75px); z-index: 12000; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(15px); transition: width 0.4s ease; display: flex; flex-direction: column; padding: 20px 15px; border-right: 1px solid rgba(255, 255, 255, 0.05); }
        #menuBrands.expanded { width: 260px; }
        .brand-card { width: 100%; min-height: 55px; display: flex; align-items: center; gap: 20px; padding: 0 15px; border-radius: 12px; transition: 0.3s; color: #F5F5F5; }
        .brand-card i { font-size: 22px; min-width: 30px; text-align: center; }
        .brand-card span { font-size: 16px; opacity: 0; transition: opacity 0.3s; white-space: nowrap; }
        #menuBrands.expanded .brand-card span { opacity: 1; }
        .brand-card.focused { background: #FFCE44 !important; color: #000 !important; }

        #mainScroll { margin-top: 75px; margin-left: 80px; padding: 20px 0; height: calc(100vh - 75px); overflow-y: auto !important; }
        #carouselContainer { width: 100%; padding: 0 50px; margin-bottom: 40px; }
        #editorSlider { width: 100%; height: 400px; border-radius: 20px; background-size: cover; background-position: center; border: 2px solid rgba(255,255,255,0.1); display: flex; align-items: flex-end; padding: 40px; transition: 0.5s; }
        #editorSlider.focused { border: 4px solid #FFCE44; transform: scale(1.01); }

        /* TOP 6 */
        #top6Section { margin-left: 50px; padding: 40px 0; }
        .top6-grid { display: flex; gap: 50px; padding: 20px 60px; }
        .top6-item { position: relative; flex: 0 0 190px; height: 280px; transition: 0.4s; }
        .top6-number { position: absolute; left: -50px; bottom: -10px; font-size: 100px; font-weight: 900; color: rgba(0,0,0,0.5); -webkit-text-stroke: 2px #FFCE44; z-index: -1; }
        .top6-poster { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
        .top6-item.focused { transform: translateY(-20px) scale(1.1); }
        .top6-item.focused .top6-poster { border: 3px solid #fff; }

        /* CONTINUAR ASSISTINDO */
        .continue-row { display: flex; gap: 20px; padding: 20px 0; overflow-x: auto; }
        .continue-card { flex: 0 0 300px; transition: 0.3s; position: relative; }
        .continue-thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 8px; }
        .progress-container { position: absolute; bottom: 45px; left: 10px; right: 10px; height: 4px; background: rgba(255,255,255,0.3); }
        .progress-bar { height: 100%; background: #FFB400; }
        .continue-card.focused { transform: scale(1.05); }

        /* CARDS GERAIS */
        .category-container { margin-left: 50px; margin-bottom: 50px; }
        .channels-row { display: flex; gap: 20px; padding: 20px 0; overflow-x: auto; }
        .movie-card { flex: 0 0 200px; transition: 0.3s; position: relative; }
        .movie-poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 6px; }
        .movie-card.focused { transform: scale(1.1); z-index: 10; }
        .movie-card.focused .movie-poster { border: 3px solid #fff; }
        .badge-2026 { position: absolute; top: 10px; right: 10px; background: #b20710; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }

        #playerOverlay { position: fixed; inset: 0; background: #000; z-index: 20000; display: none; }
        #btnClosePlayer { position: absolute; top: 30px; right: 30px; z-index: 21000; background: #b20710; color: #fff; border: none; padding: 12px 25px; border-radius: 8px; }
    </style>
</head>
<body>

<div id="topBar">
    <img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" onclick="location.reload()">
    <div style="color: #FFCE44;">Explorando <span id="totalItems">0</span> Títulos</div>
    <div id="barDateTime">00:00</div>
</div>

<div id="menuBrands">
    <div class="brand-card" onclick="location.reload()"><i class="fas fa-home"></i><span>Início</span></div>
    <div class="brand-card"><i class="fas fa-tv"></i><span>Canais</span></div>
    <div class="brand-card"><i class="fas fa-film"></i><span>Cinema</span></div>
    <div class="brand-card"><i class="fas fa-heart"></i><span>Favoritos</span></div>
</div>

<div id="mainScroll">
    <div id="carouselContainer">
        <div id="editorSlider">
            <div id="editorInfo">
                <h1 id="editorTitle" style="margin:0; font-size: 40px;">...</h1>
                <p id="editorMeta">...</p>
                <div class="btn-play-3d" style="padding: 10px 20px; border-radius: 5px; display: inline-block;">ASSISTIR</div>
            </div>
        </div>
    </div>

    <div id="continueWatchingSection" style="display: none; margin-left: 50px;">
        <div class="channel-category-title">Continuar Assistindo</div>
        <div id="continueContainer" class="continue-row"></div>
    </div>

    <div id="top6Section">
        <div id="top6Title">Destaques PaixãoFlix</div>
        <div class="top6-grid" id="top6Container"></div>
    </div>

    <div id="homeRowsContainer"></div>
    <div style="height: 150px;"></div>
</div>

<div id="detailsOverlay">
    <div id="detailsBg"></div>
    <div id="detailsContent">
        <div class="details-poster-wrapper"><img id="detPoster" src=""></div>
        <div class="details-info">
            <div id="detTitle">...</div>
            <div id="detMeta">...</div>
            <div id="detDesc">...</div>
            <div class="details-btns">
                <button id="btnDetPlay" class="btn-3d btn-play-3d">Assistir Agora</button>
                <button class="btn-3d btn-back-3d" onclick="closeDetails()">Voltar</button>
            </div>
        </div>
    </div>
</div>

<div id="playerOverlay">
    <button id="btnClosePlayer" onclick="closePlayer()">FECHAR PLAYER</button>
    <div id="player" style="width:100%; height:100%;"></div>
</div>

<script>
    // ESTADO GLOBAL
    let movies = [], series = [], kidsMovies = [], kidsSeries = [];
    let top6Data = [], editorsChoice = [], edIdx = 0, itemAtual = null;
    let currentFocus = "editor", menuIdx = 0, gridIdx = 0, movieIdx = 0, catRowIdx = 0;
    let isDetailsOpen = false, isPlayerOpen = false, playerInstance = null;

    const TMDB_API_KEY = "b275ce8e1a6b3d5d879bb0907e4f56ad";
    const TMDB_IMG_PATH = "https://image.tmdb.org/t/p/original";
    const Keys = { UP: 38, DOWN: 40, LEFT: 37, RIGHT: 39, ENTER: 13, BACK: 8 };

    // CARREGAMENTO
    async function loadData() {
        const fetchJSON = async (url) => { try { const r = await fetch(url); return await r.json(); } catch(e) { return []; } };
        movies = await fetchJSON("data/filmes.json");
        series = await fetchJSON("data/series.json");
        
        document.getElementById("totalItems").innerText = movies.length + series.length;
        editorsChoice = [...movies, ...series].sort(() => 0.5 - Math.random()).slice(0, 5);
        top6Data = [...movies, ...series].slice(0, 6);
        
        startCarousel();
        renderTop6();
        renderContinueWatching();
        renderHomeCategories();
        startClock();
        updateFocus();
    }

    // RELÓGIO
    function startClock() {
        setInterval(() => {
            const now = new Date();
            document.getElementById("barDateTime").innerText = now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
        }, 1000);
    }

    // CARROSSEL
    function startCarousel() {
        const update = () => {
            const item = editorsChoice[edIdx];
            const slider = document.getElementById("editorSlider");
            slider.style.backgroundImage = `linear-gradient(transparent, rgba(0,0,0,0.9)), url(${item.poster})`;
            document.getElementById("editorTitle").innerText = item.titulo;
            document.getElementById("editorMeta").innerText = `${item.year || '2026'} • ★ ${item.rating || '9.5'}`;
            edIdx = (edIdx + 1) % editorsChoice.length;
        };
        update();
        setInterval(update, 8000);
    }

    // RENDERIZADORES
    function renderTop6() {
        const cont = document.getElementById("top6Container");
        top6Data.forEach((m, i) => {
            const div = document.createElement("div");
            div.className = "top6-item";
            div.innerHTML = `<div class="top6-number">${i+1}</div><img class="top6-poster" src="${m.poster}">`;
            div.onclick = () => openDetails(m);
            cont.appendChild(div);
        });
    }

    function renderHomeCategories() {
        const container = document.getElementById('homeRowsContainer');
        const lancamentos = [...movies, ...series].filter(m => m.year == "2026").slice(0, 15);
        if (lancamentos.length > 0) {
            const sec = document.createElement("div");
            sec.className = "category-container";
            sec.innerHTML = `<div class="channel-category-title">Lançamentos 2026</div><div class="channels-row"></div>`;
            const row = sec.querySelector(".channels-row");
            lancamentos.forEach(m => {
                const card = document.createElement("div");
                card.className = "movie-card";
                card.innerHTML = `<div class="badge-2026">NOVO</div><img class="movie-poster" src="${m.poster}">`;
                card.onclick = () => openDetails(m);
                row.appendChild(card);
            });
            container.appendChild(sec);
        }
    }

    function renderContinueWatching() {
        const storage = JSON.parse(localStorage.getItem('paixaoflix_progress') || '{}');
        const container = document.getElementById('continueContainer');
        const section = document.getElementById('continueWatchingSection');
        const items = Object.values(storage).sort((a,b) => b.timestamp - a.timestamp);
        if (items.length === 0) return;
        section.style.display = 'block';
        container.innerHTML = '';
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'continue-card';
            const percent = (item.currentTime / item.duration) * 100;
            div.innerHTML = `<img src="${item.poster}" class="continue-thumb"><div class="progress-container"><div class="progress-bar" style="width:${percent}%"></div></div><p>${item.titulo}</p>`;
            div.onclick = () => playChannel(item.url, item.titulo, item.poster);
            container.appendChild(div);
        });
    }

    // DETALHES E PLAYER
    async function openDetails(item) {
        isDetailsOpen = true;
        itemAtual = item;
        document.getElementById("detailsOverlay").style.display = "flex";
        document.getElementById("detTitle").innerText = item.titulo;
        document.getElementById("detPoster").src = item.poster;
        
        // TMDB Busca
        try {
            const s = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(item.titulo)}&language=pt-BR`);
            const data = await s.json();
            if(data.results[0]) {
                const res = data.results[0];
                document.getElementById("detailsBg").style.backgroundImage = `url(${TMDB_IMG_PATH + res.backdrop_path})`;
                document.getElementById("detDesc").innerText = res.overview;
                document.getElementById("detMeta").innerText = `${res.release_date || res.first_air_date} • ★ ${res.vote_average}`;
            }
        } catch(e) {}
        
        document.getElementById("btnDetPlay").onclick = () => playChannel(item.url, item.titulo, item.poster);
    }

    function closeDetails() { isDetailsOpen = false; document.getElementById("detailsOverlay").style.display = "none"; }

    function playChannel(url, titulo, poster) {
        isPlayerOpen = true;
        document.getElementById("playerOverlay").style.display = "block";
        playerInstance = new Clappr.Player({
            source: url, parentId: "#player", width: "100%", height: "100%", autoPlay: true,
            events: { onTimeUpdate: (t) => { if(t.duration > 10) saveProgress(t.current, t.duration, titulo, poster, url); } }
        });
    }

    function closePlayer() { isPlayerOpen = false; if(playerInstance) playerInstance.destroy(); document.getElementById("playerOverlay").style.display = "none"; location.reload(); }

    function saveProgress(cur, dur, tit, pos, url) {
        let s = JSON.parse(localStorage.getItem('paixaoflix_progress') || '{}');
        s[tit] = { titulo: tit, poster: pos, url: url, currentTime: cur, duration: dur, timestamp: Date.now() };
        localStorage.setItem('paixaoflix_progress', JSON.stringify(s));
    }

    // NAVEGAÇÃO
    function updateFocus() {
        document.querySelectorAll(".focused").forEach(el => el.classList.remove("focused"));
        const menu = document.getElementById("menuBrands");
        
        if(currentFocus === "menu") {
            menu.classList.add("expanded");
            document.querySelectorAll(".brand-card")[menuIdx]?.classList.add("focused");
        } else {
            menu.classList.remove("expanded");
            if(currentFocus === "editor") document.getElementById("editorSlider").classList.add("focused");
            if(currentFocus === "continue") document.querySelectorAll(".continue-card")[movieIdx]?.classList.add("focused");
            if(currentFocus === "grid") document.querySelectorAll(".top6-item")[gridIdx]?.classList.add("focused");
            if(currentFocus === "home_rows") {
                const row = document.querySelectorAll(".category-container")[catRowIdx];
                row?.querySelectorAll(".movie-card")[movieIdx]?.classList.add("focused");
                row?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    }

    document.addEventListener("keydown", e => {
        const k = e.keyCode;
        if(isPlayerOpen && k === Keys.BACK) { closePlayer(); return; }
        if(isDetailsOpen && k === Keys.BACK) { closeDetails(); return; }

        if(currentFocus === "menu") {
            if(k === Keys.DOWN && menuIdx < 3) menuIdx++;
            if(k === Keys.UP && menuIdx > 0) menuIdx--;
            if(k === Keys.RIGHT) currentFocus = "editor";
        } else if(currentFocus === "editor") {
            if(k === Keys.LEFT) currentFocus = "menu";
            if(k === Keys.DOWN) currentFocus = (document.getElementById('continueWatchingSection').style.display !== 'none') ? "continue" : "grid";
        } else if(currentFocus === "continue") {
            if(k === Keys.UP) currentFocus = "editor";
            if(k === Keys.DOWN) currentFocus = "grid";
            if(k === Keys.RIGHT) movieIdx++;
            if(k === Keys.LEFT) movieIdx > 0 ? movieIdx-- : currentFocus = "menu";
        } else if(currentFocus === "grid") {
            if(k === Keys.UP) currentFocus = "editor";
            if(k === Keys.DOWN) currentFocus = "home_rows";
            if(k === Keys.RIGHT && gridIdx < 5) gridIdx++;
            if(k === Keys.LEFT) gridIdx > 0 ? gridIdx-- : currentFocus = "menu";
        } else if(currentFocus === "home_rows") {
            if(k === Keys.UP) catRowIdx > 0 ? catRowIdx-- : currentFocus = "grid";
            if(k === Keys.RIGHT) movieIdx++;
            if(k === Keys.LEFT) movieIdx > 0 ? movieIdx-- : currentFocus = "menu";
        }

        if(k === Keys.ENTER) document.querySelector(".focused")?.click();
        updateFocus();
    });

    window.onload = loadData;
</script>
</body>
</html>
