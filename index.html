<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
@media screen and (orientation: portrait) {
    body { transform: rotate(90deg); transform-origin: left top; width: 100vh; height: 100vw; position: absolute; top: 0; left: 100%; overflow: hidden; }
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; height: 100vh; width: 100vw; overflow: hidden; }

#layout-principal { display: flex; height: 100%; width: 100%; }

/* MENUS LATERAIS - ROLAGEM INFINITA */
#barra-menu { width: 160px; background: #001a1a; border-right: 2px solid #003333; display: flex; flex-direction: column; flex-shrink: 0; }
#itens-menu { flex: 1; overflow-y: scroll; display: flex; flex-direction: column; gap: 5px; padding: 8px; scrollbar-width: none; }
#itens-menu::-webkit-scrollbar { display: none; }

#header-logo { padding: 10px; text-align: center; }
#header-logo img { width: 80%; height: auto; }
#relogio { font-size: 11px; color: #aaa; text-align: center; }

/* LISTA DE CONTEÚDO / CATEGORIAS */
#lista-canais { width: 300px; height: 100%; border-right: 1px solid #222; overflow-y: scroll; background: #000; flex-shrink: 0; scrollbar-width: none; }
#lista-canais::-webkit-scrollbar { display: none; }

.item-clicavel, .canal-item { padding: 15px; font-size: 13px; border-radius: 4px; background: #0080ff; border-bottom: 3px solid #004d99; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
.canal-item { background: transparent; border-bottom: 1px solid #111; border-radius: 0; font-size: 16px; }
.item-clicavel.selecionado, .canal-item.ativo { background: #fff !important; color: #000 !important; }

#area-player { flex: 1; position: relative; background: #000; }
#meu-video { width: 100%; height: 100%; object-fit: contain; }
#btn-sair-player { position: absolute; top: 20px; right: 20px; background: #ff0000; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; z-index: 1000; display: none; }

#painel-conteudo { position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 50; display: none; }
#container-capa { flex: 1; display: flex; align-items: center; justify-content: center; }
#imagem-capa { max-height: 90%; max-width: 90%; border: 4px solid #fff; display: none; cursor: pointer; }
</style>
</head>
<body onclick="document.documentElement.requestFullscreen();">

<div id="layout-principal">
    <div id="barra-menu">
        <div id="header-logo"><img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png"><div id="relogio"></div></div>
        <div id="itens-menu">
            <div class="item-clicavel" onclick="carregarSecao('fav')"><i class="fas fa-star"></i> FAVORITOS</div>
            <div class="item-clicavel" onclick="carregarSecao('tv')"><i class="fas fa-tv"></i> TV AO VIVO</div>
            <div class="item-clicavel" onclick="carregarSecao('filmes')"><i class="fas fa-film"></i> FILMES</div>
            <div class="item-clicavel" onclick="carregarSecao('series')"><i class="fas fa-play"></i> SÉRIES</div>
            <div class="item-clicavel" onclick="carregarSecao('kids')"><i class="fas fa-child"></i> KIDS</div>
        </div>
    </div>

    <div id="area-player">
        <video id="meu-video" playsinline></video>
        <button id="btn-sair-player" onclick="fecharPlayer()">SAIR</button>
        <div id="painel-conteudo">
            <div style="display:flex; height:100%;">
                <div id="lista-canais"></div>
                <div id="container-capa"><img id="imagem-capa"></div>
            </div>
        </div>
    </div>
</div>

<script>
const categoriasExigidas = ["Lançamento 2026","Lançamento 2025","Ação","Aventura","Comédia","Drama","Nacional","Romance","Religioso","Ficção","Anime","Animação","Clássicos","Dorama","Suspense","Policial","Terror","Documentários","Faroeste","Musical","Adulto"];
const video = document.getElementById("meu-video"), btnSair = document.getElementById("btn-sair-player"), painelConteudo = document.getElementById("painel-conteudo");
const listaCanaisDiv = document.getElementById("lista-canais"), imgCapa = document.getElementById("imagem-capa");
let hls = null, currentData = [], isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

async function carregarSecao(tipo) {
    painelConteudo.style.display = "block";
    listaCanaisDiv.innerHTML = "";
    if (tipo === 'filmes' || tipo === 'series') {
        // MOSTRA AS 21 CATEGORIAS NO PAINEL
        categoriasExigidas.forEach(cat => {
            const div = document.createElement('div');
            div.className = "canal-item";
            div.innerText = cat;
            div.onclick = () => carregarConteudoCategoria(tipo, cat);
            listaCanaisDiv.appendChild(div);
        });
    } else {
        // Lógica para TV, Fav e Kids simplificada
        const url = tipo === 'tv' ? "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u" : "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json";
        const res = await fetch(url);
        const data = url.endsWith('.m3u') ? parseM3U(await res.text()) : await res.json();
        renderConteudo(data.items || data);
    }
}

async function carregarConteudoCategoria(tipo, nomeCat) {
    const url = tipo === 'filmes' ? "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json" : "https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json";
    const res = await fetch(url);
    const data = await res.json();
    // Filtra o conteúdo que pertence à categoria clicada
    const filtrados = (data.categories?.find(c => c.name.includes(nomeCat))?.items) || data;
    renderConteudo(filtrados);
}

function renderConteudo(items) {
    listaCanaisDiv.innerHTML = '<div class="item-clicavel" onclick="location.reload()"> VOLTAR </div>';
    items.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = "canal-item";
        div.innerText = item.name || item.titulo;
        div.onclick = () => {
            document.querySelectorAll('.canal-item').forEach(c => c.classList.remove('ativo'));
            div.classList.add('ativo');
            imgCapa.src = item.poster || item.logo || "";
            imgCapa.style.display = "block";
            imgCapa.onclick = () => playMedia(item);
            if(!isMobile) { /* No PC/TV o play poderia ser no OK, mas mantivemos a regra do toque na capa */ }
        };
        listaCanaisDiv.appendChild(div);
    });
}

function playMedia(item) {
    const url = item.link || item.url;
    if (hls) hls.destroy();
    if (url.includes(".m3u8")) {
        hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else { video.src = url; video.play(); }
    painelConteudo.style.display = "none"; btnSair.style.display = "block";
}

function fecharPlayer() { video.pause(); video.src = ""; btnSair.style.display = "none"; painelConteudo.style.display = "block"; }

function parseM3U(text) {
    let items = [], temp = null;
    text.split('\n').forEach(line => {
        if (line.startsWith('#EXTINF')) temp = { name: line.split(',').pop().trim(), poster: line.match(/tvg-logo="([^"]+)"/)?.[1] };
        else if (line.startsWith('http') && temp) { temp.link = line.trim(); items.push(temp); temp = null; }
    });
    return items;
}

function updateClock() {
    const d = new Date();
    document.getElementById("relogio").innerText = `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}
setInterval(updateClock, 1000); updateClock();
</script>
</body>
</html>
