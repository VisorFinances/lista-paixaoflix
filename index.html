<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixãoFlix TV — VERSÃO FINAL INTEGRAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600;700;900&family=Montserrat:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;outline:none;font-family:'Poppins','Montserrat',sans-serif}
body{background:#040714;color:#fff;width:100vw;height:100vh;overflow:hidden}
.focused{border:3px solid #FFCE44!important;box-shadow:0 0 15px rgba(255,206,68,.9);transform:scale(1.05);z-index:9999}

/* TOP BAR */
#topBar{position:fixed;top:0;width:100%;height:90px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;background:#040714;border-bottom:1px solid rgba(255,255,255,.1);z-index:5000}
#logoMain{height:70px;border:3px solid transparent;cursor:pointer}
#searchWrapper{display:flex;align-items:center;background:rgba(255,255,255,.1);padding:10px 20px;border-radius:40px;width:420px;border:3px solid transparent}
#searchInput{background:none;border:none;color:#fff;font-size:18px;width:100%;margin-left:10px}
#jsonStatus{color:#FFCE44;font-weight:900}
#barDateTime{font-weight:500}

/* SIDE MENU */
#sideMenu{position:fixed;left:0;top:90px;width:80px;height:calc(100vh - 90px);background:#040714;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;align-items:center;padding-top:10px;transition:.3s;z-index:6000}
#sideMenu.active{width:230px}
.menu-item{width:100%;height:55px;display:flex;align-items:center;padding-left:28px;color:#a0a0a0;cursor:pointer;border:3px solid transparent;font-weight:700;outline:none}
.menu-item i{font-size:20px;min-width:40px}
.menu-item span{display:none;margin-left:15px;white-space:nowrap}
#sideMenu.active span{display:block}

/* MAIN CONTENT */
#mainScroll{position:absolute;top:90px;left:80px;width:calc(100% - 80px);height:calc(100% - 90px);overflow-y:auto;padding-bottom:100px;transition:left .3s, width .3s}
body:has(#sideMenu.active) #mainScroll{left:230px;width:calc(100% - 230px)}
#mainScroll::-webkit-scrollbar{display:none}

/* DETAILS PAGE */
.details-container{position:relative;width:100%;min-height:100%;padding:50px;display:flex;align-items:center;overflow:hidden}
.details-bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0.2;filter:blur(10px);z-index:-1}
.details-content{display:flex;gap:50px;align-items:flex-start;z-index:10}
.details-poster{width:350px;border-radius:20px;box-shadow:0 0 30px rgba(0,0,0,0.8);border:2px solid rgba(255,255,255,0.1)}
.details-info{flex:1}
.details-info h1{font-size:60px;font-weight:900;margin-bottom:10px}
.details-meta{font-size:24px;color:#FFCE44;margin-bottom:20px;font-weight:600}
.details-desc{font-size:20px;line-height:1.6;margin-bottom:40px;max-width:800px}
.details-btns{display:flex;gap:20px}

/* CATEGORIES & CARDS */
.category-block{margin:40px 50px}
.cat-header{font-size:28px;font-weight:900;margin-bottom:20px;border-left:8px solid #FFCE44;padding-left:20px}
.carousel-container{display:flex;align-items:center;position:relative}
.movie-grid-horizontal{display:grid;grid-template-columns:repeat(4, 300px);gap:20px;transition:.4s cubic-bezier(0.4, 0, 0.2, 1);width:max-content}
.movie-card{width:300px;background:#1a1d29;border-radius:14px;border:3px solid transparent;cursor:pointer;position:relative;outline:none}
.movie-poster{width:100%;aspect-ratio:2/3;border-radius:10px;object-fit:cover}
.meta-card{background:rgba(0,0,0,.85);display:flex;justify-content:center;gap:15px;color:#FFCE44;font-weight:900;padding:6px;border-radius:0 0 10px 10px}
.scroll-arrow{width:50px;height:50px;background:#FFCE44;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:24px;cursor:pointer;margin-left:20px;flex-shrink:0}

/* TOP 4 & RECS */
.top-container{display:grid;grid-template-columns:repeat(4,1fr);gap:50px;padding:0 50px;margin-bottom:100px}
.top-item{position:relative;border:3px solid transparent;cursor:pointer;outline:none}
.top-number{position:absolute;left:-50px;bottom:10px;font-size:200px;font-weight:900;color:#003399;-webkit-text-stroke:4px #FFCE44;line-height:.7;pointer-events:none}

/* PLAYER */
#videoContainer{position:fixed;inset:0;background:#000;display:none;z-index:99999}
#playerExit{position:absolute;top:30px;right:40px;background:#FFCE44;color:#000;padding:10px 25px;border-radius:20px;font-weight:900;cursor:pointer;z-index:100000}
</style>
</head>

<body onload="initSystem()">

<div id="topBar">
  <img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" tabindex="0" onclick="renderHome()">
  <div id="searchWrapper" tabindex="0"><i class="fas fa-search"></i><input id="searchInput" placeholder="Pesquisar..." tabindex="-1" onkeyup="globalSearch(this.value)"></div>
  <div id="jsonStatus">CARREGANDO...</div>
  <div id="barDateTime"></div>
</div>

<div id="sideMenu">
  <div class="menu-item" tabindex="0" onclick="renderHome()"><i class="fas fa-home"></i><span>INÍCIO</span></div>
  <div class="menu-item" tabindex="0" onclick="renderCinema()"><i class="fas fa-film"></i><span>CINEMA</span></div>
  <div class="menu-item" tabindex="0" onclick="renderSeries()"><i class="fas fa-clapperboard"></i><span>SÉRIES</span></div>
  <div class="menu-item" tabindex="0" onclick="renderCanais(canaisURL)"><i class="fas fa-tv"></i><span>CANAIS</span></div>
  <div class="menu-item" tabindex="0" onclick="renderCanais(canaisKidsURL)"><i class="fas fa-child"></i><span>CANAIS KIDS</span></div>
  <div class="menu-item" tabindex="0" onclick="renderKidsFilmes()"><i class="fas fa-baby"></i><span>FILMES KIDS</span></div>
  <div class="menu-item" tabindex="0" onclick="renderKidsSeries()"><i class="fas fa-robot"></i><span>SÉRIES KIDS</span></div>
  <div class="menu-item" tabindex="0" onclick="renderFavoritos()"><i class="fas fa-heart"></i><span>MINHA LISTA</span></div>
</div>

<div id="mainScroll"><div id="dynamicContent"></div></div>

<div id="videoContainer">
  <div id="playerExit" tabindex="0" onclick="exitPlayer()">SAIR</div>
  <div id="mainPlayer" style="width:100%;height:100%"></div>
</div>

<script>
const canaisURL="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/ativa_canais.m3u";
const canaisKidsURL="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/ativa_kids_canais.m3u";
const CATEGORY_ORDER = ["Lançamento 2026","Lançamento 2025","Ação","Aventura","Comédia","Drama","Musical","Nacional","Romance","Religioso","Ficção","Anime","Animação","Família","Clássicos","Dorama","Suspense","Policial","Crime","Terror","Documentários","Faroeste","Adulto"];

let db={cinema:[],series:[],kids_filmes:[],kids_series:[],todos:[]};
let player=null,currentItem=null;

async function initSystem(){
  updateClock(); setInterval(updateClock,1000);
  await loadData();
  renderHome();
  setupNavigation();
}

async function loadData(){
  const files=["filmes.json","series.json","kids_filmes.json","kids_series.json"];
  const data=await Promise.all(files.map(f=>fetch("data/"+f).then(r=>r.json()).catch(()=>[])));
  db.cinema=data[0]; db.series=data[1]; db.kids_filmes=data[2]; db.kids_series=data[3];
  db.todos=[...db.cinema,...db.series,...db.kids_filmes,...db.kids_series];
  document.getElementById("jsonStatus").innerText="TÍTULOS: "+db.todos.length;
}

function updateClock(){
  const d=new Date();
  document.getElementById("barDateTime").innerText= d.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})+" "+d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
}

function createCard(i){
  return `<div class="movie-card" tabindex="0" onclick="openDetails('${btoa(i.titulo)}')" onkeydown="if(event.key==='Enter')openDetails('${btoa(i.titulo)}')">
  <img class="movie-poster" src="${i.poster}">
  <div class="meta-card"><span>${i.year||""}</span><span>★ ${i.rating||"0.0"}</span></div>
  </div>`;
}

function openDetails(id){
  const item=db.todos.find(i=>btoa(i.titulo)===id);
  if(!item) return;
  currentItem=item;
  document.getElementById("dynamicContent").innerHTML=`
  <div class="details-container">
    <div class="details-bg" style="background-image:url('${item.banner||item.poster}')"></div>
    <div class="details-content">
      <img class="details-poster" src="${item.poster}">
      <div class="details-info">
        <h1>${item.titulo}</h1>
        <div class="details-meta">${item.year} • ★ ${item.rating} • ${item.genero}</div>
        <div class="details-desc">${item.sinopse||"Sem sinopse disponível."}</div>
        <div class="details-btns">
          <div class="menu-item focused" tabindex="0" onclick="playVideo('${item.url}',0)">ASSISTIR AGORA</div>
          <div class="menu-item" tabindex="0" onclick="renderHome()">VOLTAR</div>
        </div>
      </div>
    </div>
  </div>`;
}

function renderByCategories(type) {
  const cont = document.getElementById("dynamicContent");
  cont.innerHTML = "";
  CATEGORY_ORDER.forEach((cat, index) => {
    let items = [];
    if (cat.startsWith("Lançamento")) {
      const yr = cat.split(" ")[1];
      items = db[type].filter(i => String(i.year) === yr);
    } else {
      items = db[type].filter(i => (i.genero || "").split(',').map(g=>g.trim().toLowerCase()).includes(cat.toLowerCase()));
    }
    if (items.length === 0) return;
    const gridId = `grid-${type}-${index}`;
    cont.innerHTML += `
      <div class="category-block">
        <div class="cat-header">${cat}</div>
        <div class="carousel-container">
          <div class="movie-grid-horizontal" id="${gridId}" data-offset="0">
            ${items.map(item => createCard(item)).join('')}
          </div>
          <div class="scroll-arrow" tabindex="0" onclick="jumpNext('${gridId}', ${items.length})"><i class="fas fa-chevron-right"></i></div>
        </div>
      </div>`;
  });
}

function jumpNext(id, total){
  const g=document.getElementById(id);
  let o=parseInt(g.dataset.offset||0)+4;
  if(o >= total) o = 0;
  g.dataset.offset=o;
  g.style.transform=`translateX(-${o*320}px)`;
}

function renderHome(){
  const c=document.getElementById("dynamicContent");
  c.innerHTML=`
  <div class="hero-banner" style="width:95%; height:380px; margin:30px auto; border-radius:25px; background-size:cover; background-position:center; background-image:linear-gradient(to bottom,transparent,#040714),url('${db.todos[0]?.banner||db.todos[0]?.poster}')">
    <div style="padding:40px"><h1>${db.todos[0]?.titulo||""}</h1><p>${db.todos[0]?.genero||""}</p></div>
  </div>
  <div class="category-block"><div class="cat-header">Indicados para você</div><div class="movie-grid-horizontal" id="rec"></div></div>`;
  db.todos.sort(()=>.5-Math.random()).slice(0,3).forEach(i=>document.getElementById("rec").innerHTML+=createCard(i));
}

function renderCinema() { renderByCategories("cinema"); }
function renderSeries() { renderByCategories("series"); }
function renderKidsFilmes() { renderByCategories("kids_filmes"); }
function renderKidsSeries() { renderByCategories("kids_series"); }

async function renderCanais(url){
  const cont=document.getElementById("dynamicContent");
  cont.innerHTML=`<div class="category-block"><div class="cat-header">CANAIS</div><div class="kids-grid" id="cGrid"></div></div>`;
  const res=await fetch(url); const text=await res.text();
  const lines=text.split("\n");
  for(let i=0;i<lines.length;i++){
    if(lines[i].startsWith("#EXTINF")){
      const nome=lines[i].split(",")[1]; const logo=lines[i].match(/tvg-logo="([^"]+)"/)?.[1];
      const stream=lines[i+1];
      document.getElementById("cGrid").innerHTML+=`<div class="movie-card" tabindex="0" onclick="playVideo('${stream}',0)"><img class="movie-poster" src="${logo}" style="object-fit:contain;background:#fff"><div class="meta-card">${nome}</div></div>`;
    }
  }
}

function playVideo(url,time){
  document.getElementById("videoContainer").style.display="block";
  if(player) player.destroy();
  player=new Clappr.Player({source:url,parentId:"#mainPlayer",autoPlay:true});
}
function exitPlayer(){ if(player) player.stop(); document.getElementById("videoContainer").style.display="none"; }

function setupNavigation(){
  document.addEventListener("keydown",e=>{
    if(e.keyCode===27) exitPlayer();
    if(e.key === "Enter" && document.activeElement) document.activeElement.click();
  });
  document.addEventListener("focusin",e=>{
    document.querySelectorAll(".focused").forEach(f=>f.classList.remove("focused"));
    if(e.target.tabIndex===0 || e.target.classList.contains("menu-item")){
      e.target.classList.add("focused");
      if(e.target.closest("#sideMenu")) document.getElementById("sideMenu").classList.add("active");
      else document.getElementById("sideMenu").classList.remove("active");
    }
  });
}
</script>
</body>
</html>
