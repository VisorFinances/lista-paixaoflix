<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{overflow:hidden;-ms-overflow-style:none;scrollbar-width:none;touch-action:manipulation;box-sizing:border-box}
*::-webkit-scrollbar{display:none!important}
html,body{margin:0;padding:0;background:#000;color:#fff;font-family:'Poppins',sans-serif;height:100%}
#app{display:flex;height:100vh;width:100vw}
#menu{width:220px;background:#001a1a;display:flex;flex-direction:column;border-right:1px solid #003333}
#menuHeader{padding:10px;text-align:center}
#menuHeader img{height:60px;width:auto}
#clock{font-size:11px;color:#ccc;margin-top:6px}
#searchBox{padding:10px}
#searchInput{width:100%;padding:10px;border-radius:6px;border:1px solid #2a3642;background:#000;color:#fff;font-size:12px}
#menuItemsArea{flex:1;overflow-y:auto!important;padding:10px}
.menu-item{padding:12px;font-size:13px;margin-bottom:8px;border-radius:6px;background:#0a2a4a;cursor:pointer;white-space:nowrap}
.menu-item.active{background:#fff;color:#000;font-weight:bold}
#content{flex:1;position:relative}
#videoContainer{width:100%;height:100%}
video{width:100%;height:100%;object-fit:contain}
#channelList{position:absolute;left:0;top:0;height:100%;background:rgba(0,0,0,.95);min-width:200px;max-width:320px;overflow-y:auto!important;display:none}
.channel{padding:12px;font-size:13px;border-bottom:1px solid #222;white-space:nowrap}
.channel.active{background:#fff;color:#000;font-weight:bold}
#posterWrapper{position:absolute;right:20px;top:50%;transform:translateY(-50%);width:250px;display:none}
#posterPreview{width:100%;border-radius:10px}
</style>
</head>

<body>
<div id="app">
<div id="menu">
<div id="menuHeader">
<img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
<div id="clock"></div>
</div>

<div id="searchBox">
<input type="text" id="searchInput" placeholder="Pesquisar...">
</div>

<div id="menuItemsArea">
<div class="menu-item active" data-type="recent">Assistindo agora</div>
<div class="menu-item" data-type="channels">TV ao vivo</div>
<div class="menu-item" data-type="fav">Favoritos</div>
<div class="menu-item" data-type="categories">Cinema</div>
<div class="menu-item" data-type="series">Séries</div>
</div>
</div>

<div id="content">
<div id="videoContainer">
<video id="video" playsinline controls></video>
</div>
<div id="channelList"></div>
<div id="posterWrapper"><img id="posterPreview"></div>
</div>
</div>

<script>
const video=document.getElementById("video");
const channelList=document.getElementById("channelList");
const posterPreview=document.getElementById("posterPreview");
const posterWrapper=document.getElementById("posterWrapper");
const searchInput=document.getElementById("searchInput");
const menuItems=[...document.querySelectorAll(".menu-item")];

let channels=[],movies=[],series=[],recent=[];
let favorites=JSON.parse(localStorage.getItem("paixaoflix_favs")||"[]");
let filteredList=[],viewMode="recent";
let selectedIndex=0,menuIndex=0,menuFocused=true,hls=null;

const movieCats=["Lançamentos 2026","Lançamentos 2025","AÇÃO","COMÉDIA","DRAMA","TERROR"];

function clock(){
const d=new Date();
clockEl.innerText=d.toLocaleDateString()+" "+d.toLocaleTimeString().slice(0,5);
}
const clockEl=document.getElementById("clock");
setInterval(clock,1000);clock();

function normalize(t){return(t||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toUpperCase()}

function playMedia(item){
if(!item?.url)return;
if(hls){hls.destroy();hls=null}
if(item.url.includes(".m3u8")){
if(Hls.isSupported()){hls=new Hls();hls.loadSource(item.url);hls.attachMedia(video)}
else video.src=item.url;
}else video.src=item.url;

video.play().catch(()=>{});
localStorage.setItem("last_play",JSON.stringify(item));
}

video.addEventListener("timeupdate",()=>{
const cur=JSON.parse(localStorage.getItem("last_play")||"null");
if(cur){cur.time=video.currentTime;localStorage.setItem("last_play",JSON.stringify(cur))}
});

window.addEventListener("load",()=>{
const last=JSON.parse(localStorage.getItem("last_play")||"null");
if(last){playMedia(last);video.currentTime=last.time||0}
});

function renderList(){
channelList.innerHTML="";
let data=viewMode==="categories"?movieCats:viewMode==="recent"?recent:viewMode==="channels"?channels:viewMode==="fav"?favorites:filteredList;
data.forEach((it,i)=>{
const d=document.createElement("div");
d.className="channel"+(i===selectedIndex?" active":"");
d.textContent=it.titulo||it;
channelList.appendChild(d);
});
}

searchInput.addEventListener("input",()=>{
const q=normalize(searchInput.value);
filteredList=[...movies,...series,...channels].filter(i=>normalize(i.titulo).includes(q));
viewMode="search";selectedIndex=0;channelList.style.display="block";renderList();
});

document.addEventListener("keydown",e=>{
if(menuFocused){
if(e.key==="ArrowDown")menuIndex=Math.min(menuIndex+1,menuItems.length-1);
if(e.key==="ArrowUp")menuIndex=Math.max(menuIndex-1,0);
if(e.key==="Enter"){viewMode=menuItems[menuIndex].dataset.type;menuFocused=false;channelList.style.display="block";renderList()}
}else{
if(e.key==="ArrowDown")selectedIndex++;
if(e.key==="ArrowUp")selectedIndex--;
if(e.key==="ArrowLeft"){menuFocused=true;channelList.style.display="none"}
if(e.key==="Enter"){
const data=viewMode==="categories"?movieCats:filteredList;
if(typeof data[selectedIndex]==="string"){
filteredList=movies.filter(m=>normalize(m.genero)===normalize(data[selectedIndex]));
viewMode="movie_list";selectedIndex=0;renderList();
}else playMedia(data[selectedIndex]);
}
renderList();
}
menuItems.forEach((m,i)=>m.classList.toggle("active",i===menuIndex));
});

fetch("https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json").then(r=>r.json()).then(d=>movies=d);
fetch("https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json").then(r=>r.json()).then(d=>series=d);
fetch("https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u").then(r=>r.text()).then(t=>{
let temp=null;
t.split("\n").forEach(l=>{
if(l.startsWith("#EXTINF"))temp={titulo:l.split(",").pop()};
else if(l.startsWith("http")&&temp){temp.url=l.trim();channels.push(temp);temp=null}
});
});
</script>
</body>
</html>
