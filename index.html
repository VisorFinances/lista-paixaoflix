<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; height: 100vh; width: 100vw; overflow: hidden; }
#layout-principal { display: flex; height: 100%; width: 100%; }

/* BARRAS REDUZIDAS CONFORME ORDEM */
#barra-menu { width: 120px; background: #001a1a; border-right: 2px solid #003333; display: flex; flex-direction: column; z-index: 100; flex-shrink: 0; }
#lista-canais { width: 160px; height: 100%; border-right: 1px solid #222; overflow-y: auto; background: #000; flex-shrink: 0; }

#header-logo { padding: 8px; text-align: center; }
#header-logo img { height: 45px; width: auto; }
#relogio { font-size: 9px; color: #aaa; text-align: center; margin-bottom: 5px; }

#searchBox { padding: 5px; }
#searchInput { width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #003333; background: #000; color: #fff; font-size: 10px; outline: none; }

#itens-menu { flex: 1; padding: 5px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; }
.item-clicavel { padding: 8px; font-size: 9px; border-radius: 4px; background: #0080ff; border-bottom: 2px solid #004d99; display: flex; align-items: center; cursor: pointer; color: #fff; }
.item-clicavel.selecionado { background: #fff !important; color: #000 !important; font-weight: bold; border-bottom: 2px solid #ccc; }

#area-player { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
#meu-video { width: 100%; height: 100%; object-fit: contain; }
#btn-sair-player { position: absolute; top: 10px; right: 10px; background: #ff0000; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; font-weight: bold; z-index: 1000; display: none; }

#painel-conteudo { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 50; display: none; }
#flex-container { display: flex; height: 100%; width: 100%; }

/* LISTA COM ROLAGEM INFINITA E CATEGORIAS */
.canal-item { padding: 12px 10px; font-size: 11px; border-bottom: 1px solid #111; color: #fff; cursor: pointer; }
.canal-item.ativo { background: #222 !important; border-left: 3px solid #0080ff; }
.canal-item.categoria-header { background: #002222; font-weight: bold; color: #00ffff; cursor: default; position: sticky; top: 0; z-index: 5; }

/* CAPA PRÓXIMA À BARRA */
#container-capa { flex: 1; display: flex; align-items: center; justify-content: flex-start; padding-left: 20px; background: #000; }
#imagem-capa { max-height: 85%; width: auto; border: 2px solid #fff; border-radius: 4px; cursor: pointer; display: none; }

@media (max-width: 850px) {
    #barra-menu { width: 90px; }
    #lista-canais { width: 120px; }
}
</style>
</head>
<body>

<div id="layout-principal">
    <div id="barra-menu">
        <div id="header-logo"><img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png"><div id="relogio"></div></div>
        <div id="searchBox"><input type="text" id="searchInput" placeholder="BUSCAR..."></div>
        <div id="itens-menu">
            <div class="item-clicavel selecionado" data-type="m3u" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u">Canais</div>
            <div class="item-clicavel" data-type="fav">Favoritos</div>
            <div class="item-clicavel" data-type="json" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json">Cinema</div>
            <div class="item-clicavel" data-type="json" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json">Séries</div>
            <div class="item-clicavel" data-type="m3u" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_kids_canais.m3u">Kids TV</div>
            <div class="item-clicavel" data-type="json" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json">Kids Cine</div>
            <div class="item-clicavel" data-type="json" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_series.json">Kids Séries</div>
        </div>
    </div>
    <div id="area-player">
        <video id="meu-video" playsinline></video>
        <button id="btn-sair-player" onclick="fecharPlayer()">Sair</button>
        <div id="painel-conteudo"><div id="flex-container"><div id="lista-canais"></div><div id="container-capa"><img id="imagem-capa"></div></div></div>
    </div>
</div>

<script>
const video = document.getElementById("meu-video"), btnSair = document.getElementById("btn-sair-player"), painelConteudo = document.getElementById("painel-conteudo");
const listaCanaisDiv = document.getElementById("lista-canais"), imgCapa = document.getElementById("imagem-capa"), menuItems = document.querySelectorAll('.item-clicavel');
let rawData = [], currentDisplayData = [], globalDB = [], hls = null, menuIndex = 0, itemIndex = -1, emMenu = true;

document.addEventListener('click', () => { document.documentElement.requestFullscreen(); screen.orientation.lock("landscape").catch(()=>{}); }, { once: true });

async function initGlobalDB() {
    for (let item of menuItems) {
        if (!item.dataset.url) continue;
        const res = await fetch(item.dataset.url);
        if (item.dataset.type === "m3u") {
            const text = await res.text(); let temp = null;
            text.split('\n').forEach(line => {
                if (line.startsWith('#EXTINF')) temp = { titulo: line.split(',').pop().trim() };
                else if (line.startsWith('http') && temp) { temp.url = line.trim(); globalDB.push(temp); temp = null; }
            });
        } else {
            const json = await res.json();
            const items = json.categories ? json.categories.flatMap(c => c.items) : json;
            items.forEach(i => globalDB.push(i));
        }
    }
}
initGlobalDB();

document.getElementById("searchInput").oninput = (e) => {
    const v = e.target.value.toLowerCase();
    currentDisplayData = globalDB.filter(i => (i.titulo || i.name || "").toLowerCase().includes(v));
    renderLista(); painelConteudo.style.display = "block"; emMenu = false;
};

async function carregarDados(btn) {
    if (btn.dataset.type === "fav") { rawData = JSON.parse(localStorage.getItem('paixaoflix_favs')) || []; }
    else {
        const res = await fetch(btn.dataset.url);
        rawData = btn.dataset.type === "m3u" ? parseM3U(await res.text()) : await res.json();
    }
    processarCategorias();
}

function parseM3U(text) {
    let items = [], temp = null;
    text.split('\n').forEach(line => {
        if (line.startsWith('#EXTINF')) temp = { titulo: line.split(',').pop().trim() };
        else if (line.startsWith('http') && temp) { temp.url = line.trim(); items.push(temp); temp = null; }
    });
    return items;
}

function processarCategorias() {
    currentDisplayData = [];
    if (rawData.categories) {
        rawData.categories.forEach(cat => {
            currentDisplayData.push({ isHeader: true, titulo: cat.name });
            cat.items.forEach(i => currentDisplayData.push(i));
        });
    } else { currentDisplayData = rawData; }
    itemIndex = -1; renderLista();
}

function renderLista() {
    listaCanaisDiv.innerHTML = "";
    currentDisplayData.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = `canal-item ${item.isHeader ? 'categoria-header' : ''} ${i === itemIndex ? 'ativo' : ''}`;
        div.innerHTML = item.titulo || item.name;
        if (!item.isHeader) {
            div.onclick = () => { 
                itemIndex = i; 
                Array.from(listaCanaisDiv.children).forEach(c => c.classList.remove('ativo'));
                div.classList.add('ativo');
                imgCapa.src = item.poster || item.logo || "";
                imgCapa.style.display = "block";
                imgCapa.onclick = () => playMedia(item);
            };
        }
        listaCanaisDiv.appendChild(div);
    });
}

function playMedia(item) {
    const url = item.url || item.link;
    if (hls) hls.destroy();
    if (url.includes(".m3u8")) {
        hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else { video.src = url; video.play(); }
    painelConteudo.style.display = "none"; btnSair.style.display = "block";
}

function fecharPlayer() { video.pause(); video.src = ""; btnSair.style.display = "none"; painelConteudo.style.display = "block"; }

// CONTROLE REMOTO / TECLADO
document.onkeydown = (e) => {
    if (emMenu) {
        if (e.key === "ArrowDown") menuIndex = (menuIndex + 1) % menuItems.length;
        if (e.key === "ArrowUp") menuIndex = (menuIndex - 1 + menuItems.length) % menuItems.length;
        if (e.key === "Enter" || e.key === "ArrowRight") { emMenu = false; carregarDados(menuItems[menuIndex]); painelConteudo.style.display = "block"; }
        menuItems.forEach((m, i) => m.classList.toggle('selecionado', i === menuIndex));
    } else {
        if (e.key === "ArrowDown") { itemIndex = (itemIndex + 1) % currentDisplayData.length; renderLista(); }
        if (e.key === "ArrowUp") { itemIndex = (itemIndex - 1 + currentDisplayData.length) % currentDisplayData.length; renderLista(); }
        if (e.key === "ArrowLeft") { emMenu = true; painelConteudo.style.display = "none"; }
        if (e.key === "Enter" && itemIndex > -1) {
            const it = currentDisplayData[itemIndex];
            if (!it.isHeader) {
                imgCapa.src = it.poster || it.logo || ""; imgCapa.style.display = "block";
                listaCanaisDiv.children[itemIndex].click();
                if(e.key === "Enter" && imgCapa.style.display === "block") playMedia(it);
            }
        }
        if (itemIndex > -1) listaCanaisDiv.children[itemIndex].scrollIntoView({ block: "center" });
    }
};

menuItems.forEach((btn, i) => btn.onclick = () => { menuIndex = i; emMenu = false; carregarDados(btn); painelConteudo.style.display = "block"; });
</script>
</body>
</html>
