<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

#app {
    display: flex;
    height: 100%;
}

/* MENU */
#menu {
    width: 220px;
    background: #1a1a1a;
    display: flex;
    flex-direction: column;
}

#menuHeader {
    padding: 16px;
    border-bottom: 1px solid #222;
}

#menuHeader img {
    height: 72px;
}

#clock {
    margin-top: 8px;
    font-size: 15px;
}

.menu-item {
    padding: 18px 20px;
    font-size: 18px;
}

.menu-item.active {
    background: #222;
    border-left: 5px solid #ff9800;
    font-weight: bold;
}

.menu-item.kids {
    color: #ff9800;
}

/* CONTENT */
#content {
    flex: 1;
    position: relative;
    background: black;
}

video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: black;
}

/* CHANNEL/CATEGORY LIST */
#channelList {
    position: absolute;
    top: 0;
    left: 0;
    width: 180px; 
    height: 100%;
    background: rgba(20,20,20,0.96);
    display: none;
    overflow-y: auto;
    scrollbar-width: none; 
    -ms-overflow-style: none;
}

#channelList::-webkit-scrollbar {
    display: none;
}

.channel {
    padding: 14px 16px;
    font-size: 16px; 
    border-bottom: 1px solid #222;
}

.channel.active {
    background: #ff9800;
    color: #000;
    font-weight: bold;
}
</style>
</head>

<body>
<div id="app">
    <div id="menu">
        <div id="menuHeader">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
            <div id="clock"></div>
        </div>

        <div class="menu-item active">TV ao vivo</div>
        <div class="menu-item">Cinema</div>
        <div class="menu-item">Séries</div>
        <div class="menu-item kids">Canal Kids</div>
        <div class="menu-item kids">Filmes Kids</div>
        <div class="menu-item kids">Séries Kids</div>
    </div>

    <div id="content">
        <video id="video" autoplay></video>
        <div id="channelList"></div>
    </div>
</div>

<script>
const video = document.getElementById("video");
const channelList = document.getElementById("channelList");
const menuItems = document.querySelectorAll(".menu-item");

let channels = [];
let movies = []; 
let kidsMovies = []; 
let filteredMovies = []; 
let viewMode = "channels"; 

const movieCategories = ["Lançamentos","AÇÃO", "AVENTURA", "ANIME", "ANIMAÇÃO", "COMÉDIA", "DRAMA", "DORAMA", "SUSPENSE", "POLICIAL", "TERROR", "DOCUMENTÁRIOS", "FICÇÃO CIENTÍFICA", "CLÁSSICOS", "FAROESTE", "NACIONAL", "ROMANCE", "RELIGIOSO", "ADULTO"];

let selectedIndex = 0;
let menuIndex = 0; 
let listOpen = false;
let menuFocused = true; 
let hls = null;

/* CLOCK */
function updateClock() {
    const d = new Date();
    const dias = ["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];
    const meses = ["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov"];
    document.getElementById("clock").innerText =
        `${dias[d.getDay()]}, ${String(d.getDate()).padStart(2,"0")} ${meses[d.getMonth()]} ${d.getFullYear()} | ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
}
setInterval(updateClock, 1000);
updateClock();

/* LOAD DATA */
fetch("data/canais.m3u")
.then(r => r.text())
.then(text => {
    const lines = text.split("\n");
    let temp = null;
    lines.forEach(l => {
        l = l.trim();
        if (l.startsWith("#EXTINF")) {
            temp = { name: l.split(",").pop(), url: "" };
        } else if (l.startsWith("http") && temp) {
            temp.url = l;
            channels.push(temp);
            temp = null;
        }
    });
    playMedia(channels[0]?.url); 
});

fetch("data/filmes.json").then(r => r.json()).then(data => { movies = data; });
fetch("data/kids_filmes.json").then(r => r.json()).then(data => { kidsMovies = data; });

function renderList() {
    channelList.innerHTML = "";
    let currentData = [];
    
    if (viewMode === "channels") currentData = channels;
    else if (viewMode === "categories") currentData = movieCategories;
    else if (viewMode === "movies") currentData = filteredMovies;

    currentData.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "channel" + (i === selectedIndex ? " active" : "");
        div.innerText = item.titulo || item.name || item;
        channelList.appendChild(div);
    });
    
    const activeItem = channelList.querySelector(".active");
    if (activeItem) activeItem.scrollIntoView({ block: "center" });
}

function renderMenu() {
    menuItems.forEach((item, i) => {
        item.classList.toggle("active", i === menuIndex);
    });
}

function playMedia(url) {
    if (!url) return;
    if (hls) { hls.destroy(); hls = null; }
    if (Hls.isSupported() && (url.includes(".m3u8") || url.includes("archive.org"))) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { video.play().catch(()=>{}); });
    } else {
        video.src = url;
        video.play().catch(()=>{});
    }
}

function toggleList() {
    listOpen = !listOpen;
    channelList.style.display = listOpen ? "block" : "none";
    if (listOpen) {
        selectedIndex = 0;
        menuFocused = false;
        
        if (menuIndex === 1) {
            viewMode = "categories"; // Menu Cinema: Abre Categorias
        } else if (menuIndex === 4) {
            viewMode = "movies";     // Menu Filmes Kids: Abre direto os Filmes
            filteredMovies = kidsMovies;
        } else {
            viewMode = "channels";   // Outros: Abre Canais
        }
        renderList();
    } else {
        menuFocused = true;
    }
}

document.addEventListener("keydown", e => {
    let count = 0;
    if (viewMode === "channels") count = channels.length;
    else if (viewMode === "categories") count = movieCategories.length;
    else if (viewMode === "movies") count = filteredMovies.length;

    switch (e.key) {
        case "ArrowRight": if (menuFocused && !listOpen) toggleList(); break;
        case "ArrowLeft": 
            if (listOpen) {
                if (viewMode === "movies" && menuIndex === 1) { // Só volta para categorias se for no Cinema
                    viewMode = "categories";
                    selectedIndex = 0;
                    renderList();
                } else {
                    toggleList();
                }
            }
            break;
        case "ArrowUp":
            if (listOpen) { selectedIndex = (selectedIndex - 1 + count) % count; renderList(); }
            else if (menuFocused) { menuIndex = (menuIndex - 1 + menuItems.length) % menuItems.length; renderMenu(); }
            break;
        case "ArrowDown":
            if (listOpen) { selectedIndex = (selectedIndex + 1) % count; renderList(); }
            else if (menuFocused) { menuIndex = (menuIndex + 1) % menuItems.length; renderMenu(); }
            break;
        case "Enter":
            if (menuFocused) {
                toggleList(); 
            } else if (listOpen) {
                if (viewMode === "channels") {
                    playMedia(channels[selectedIndex].url);
                    toggleList();
                } else if (viewMode === "categories") {
                    const cat = movieCategories[selectedIndex];
                    filteredMovies = movies.filter(f => f.genero === cat || cat === "Lançamentos");
                    viewMode = "movies";
                    selectedIndex = 0;
                    renderList();
                } else if (viewMode === "movies") {
                    playMedia(filteredMovies[selectedIndex].link);
                    toggleList();
                }
            }
            break;
    }
});
</script>
</body>
</html>
