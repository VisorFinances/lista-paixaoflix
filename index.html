<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

#app {
    display: flex;
    height: 100%;
}

/* MENU */
#menu {
    width: 240px;
    background: #1a1a1a;
    display: flex;
    flex-direction: column;
    z-index: 30;
    padding: 12px;
    box-sizing: border-box;
    border-right: 1px solid #333;
}

#menuHeader {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #222;
    margin-bottom: 15px;
}

#menuHeader img {
    height: 50px;
}

#clock {
    margin-top: 8px;
    font-size: 12px;
    color: #aaa;
}

/* BOTÕES 3D AJUSTADOS */
.menu-item {
    padding: 12px 12px; 
    font-size: 15px;    
    margin-bottom: 10px;
    border-radius: 8px;
    background: #222;
    border: 1px solid #333;
    transition: all 0.2s ease-in-out;
    display: flex;
    align-items: center;
    color: #ccc;
    box-shadow: 0 3px 0 #000;
    box-sizing: border-box;
    width: 100%; 
}

.menu-item i {
    margin-right: 12px;
    width: 18px;
    text-align: center;
}

/* ESTADO SELECIONADO */
.menu-item.active {
    background: #333;
    color: #fff;
    transform: scale(1.02); 
    border: 1px solid #ff9800;
    box-shadow: 0 0 10px rgba(255, 152, 0, 0.4), 0 3px 0 #b36b00;
    font-weight: bold;
}

/* ESTILO KIDS */
.menu-item.kids {
    border-left: 3px solid #ffeb3b;
    color: #ffeb3b;
}

.menu-item.kids.active {
    background: linear-gradient(145deg, #ff9800, #f44336);
    color: #fff;
    border: 1px solid #fff;
    box-shadow: 0 0 15px rgba(255, 152, 0, 0.6), 0 3px 0 #9e5d00;
    animation: pulseKids 1.5s infinite;
}

@keyframes pulseKids {
    0% { transform: scale(1.02); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1.02); }
}

/* CONTENT */
#content {
    flex: 1;
    position: relative;
    background: black;
}

video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: black;
}

#channelList {
    position: absolute;
    top: 0;
    left: 0;
    width: 200px; 
    height: 100%;
    background: rgba(10,10,10,0.98);
    display: none;
    z-index: 10;
    overflow-y: auto;
    /* REMOÇÃO DA BARRA DE ROLAGEM */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
}

#channelList::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

.channel {
    padding: 14px 16px;
    font-size: 16px; 
    border-bottom: 1px solid #222;
}

.channel.active {
    background: #ff9800;
    color: #000;
    font-weight: bold;
}

#posterPreview {
    position: absolute;
    top: 50%;
    left: 220px; 
    transform: translateY(-50%);
    width: 280px;
    height: 400px;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(0,0,0,0.9);
    display: none; 
    z-index: 20;
    background: #222;
    object-fit: cover;
    border: 3px solid #ff9800;
}
</style>
</head>

<body>
<div id="app">
    <div id="menu">
        <div id="menuHeader">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
            <div id="clock"></div>
        </div>

        <div class="menu-item active"><i class="fas fa-tv"></i> TV ao vivo</div>
        <div class="menu-item"><i class="fas fa-film"></i> Cinema</div>
        <div class="menu-item"><i class="fas fa-clapperboard"></i> Séries</div>
        <div class="menu-item kids"><i class="fas fa-child"></i> Canal Kids</div>
        <div class="menu-item kids"><i class="fas fa-icons"></i> Filmes Kids</div>
        <div class="menu-item kids"><i class="fas fa-robot"></i> Séries Kids</div>
    </div>

    <div id="content">
        <video id="video" autoplay></video>
        <img id="posterPreview" src="" alt="Poster">
        <div id="channelList"></div>
    </div>
</div>

<script>
const video = document.getElementById("video");
const channelList = document.getElementById("channelList");
const posterPreview = document.getElementById("posterPreview");
const menuItems = document.querySelectorAll(".menu-item");

let channels = [];
let kidsChannels = []; 
let movies = []; 
let series = []; 
let kidsMovies = []; 
let kidsSeries = []; 
let episodes = []; // Lista temporária para episódios do archive
let filteredMovies = []; 
let viewMode = "channels"; 

const movieCategories = ["Lançamentos 2026","Lançamentos 2025","AÇÃO", "AVENTURA", "ANIME", "ANIMAÇÃO", "COMÉDIA", "DRAMA", "DORAMA", "SUSPENSE", "POLICIAL", "TERROR", "DOCUMENTÁRIOS", "FICÇÃO CIENTÍFICA", "CLÁSSICOS", "FAROESTE", "NACIONAL", "ROMANCE", "RELIGIOSO", "ADULTO"];

let selectedIndex = 0;
let menuIndex = 0; 
let listOpen = false;
let menuFocused = true; 
let hls = null;

function updateClock() {
    const d = new Date();
    const dias = ["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];
    const meses = ["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov"];
    document.getElementById("clock").innerText =
        `${dias[d.getDay()]}, ${String(d.getDate()).padStart(2,"0")} ${meses[d.getMonth()]} ${d.getFullYear()} | ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
}
setInterval(updateClock, 1000);
updateClock();

/* CARGA DE DADOS */
function loadM3U(path, targetArray) {
    fetch(path).then(r => r.text()).then(text => {
        const lines = text.split("\n");
        let temp = null;
        lines.forEach(l => {
            l = l.trim();
            if (l.startsWith("#EXTINF")) {
                temp = { name: l.split(",").pop(), url: "" };
            } else if (l.startsWith("http") && temp) {
                temp.url = l;
                targetArray.push(temp);
                temp = null;
            }
        });
        if(channels.length > 0 && targetArray === channels) playMedia(channels[0].url); 
    });
}

loadM3U("data/canais.m3u", channels);
loadM3U("data/kids_canais.m3u", kidsChannels);

fetch("data/filmes.json").then(r => r.json()).then(data => { movies = data; });
fetch("data/series.json").then(r => r.json()).then(data => { series = data; }); 
fetch("data/kids_filmes.json").then(r => r.json()).then(data => { kidsMovies = data; });
fetch("data/kids_series.json").then(r => r.json()).then(data => { kidsSeries = data; });

/* FUNÇÃO PARA BUSCAR EPISÓDIOS NO ARCHIVE */
async function fetchArchiveEpisodes(identifier) {
    try {
        const response = await fetch(`https://archive.org/metadata/${identifier}`);
        const data = await response.json();
        const videoExtensions = ['.mp4', '.mkv', '.avi', '.mov'];
        
        episodes = data.files
            .filter(f => videoExtensions.some(ext => f.name.toLowerCase().endsWith(ext)))
            .map(f => ({
                name: f.title || f.name,
                url: `https://archive.org/download/${identifier}/${f.name}`
            }));

        if (episodes.length > 0) {
            viewMode = "episodes";
            selectedIndex = 0;
            renderList();
        }
    } catch (e) {
        console.error("Erro ao buscar metadados do Archive", e);
    }
}

function renderList() {
    channelList.innerHTML = "";
    let currentData = [];
    
    if (viewMode === "channels") currentData = channels;
    else if (viewMode === "kids_channels") currentData = kidsChannels;
    else if (viewMode === "categories") currentData = movieCategories;
    else if (viewMode === "movies") currentData = filteredMovies;
    else if (viewMode === "episodes") currentData = episodes;

    currentData.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "channel" + (i === selectedIndex ? " active" : "");
        div.innerText = item.titulo || item.name || item;
        channelList.appendChild(div);
    });
    
    if (listOpen && (viewMode === "movies") && filteredMovies[selectedIndex]) {
        posterPreview.src = filteredMovies[selectedIndex].poster;
        posterPreview.style.display = "block";
    } else {
        posterPreview.style.display = "none";
    }
    
    const activeItem = channelList.querySelector(".active");
    if (activeItem) activeItem.scrollIntoView({ block: "center" });
}

function renderMenu() {
    menuItems.forEach((item, i) => {
        item.classList.toggle("active", i === menuIndex);
    });
}

function playMedia(url) {
    if (!url) return;
    if (hls) { hls.destroy(); hls = null; }
    
    if (Hls.isSupported() && url.includes(".m3u8")) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { video.play().catch(()=>{}); });
    } else {
        video.src = url;
        video.play().catch(()=>{});
    }
}

function toggleList() {
    listOpen = !listOpen;
    channelList.style.display = listOpen ? "block" : "none";
    if (listOpen) {
        selectedIndex = 0;
        menuFocused = false;
        if (menuIndex === 0) viewMode = "channels";
        else if (menuIndex === 1) viewMode = "categories";
        else if (menuIndex === 2) { viewMode = "movies"; filteredMovies = series; }
        else if (menuIndex === 3) viewMode = "kids_channels"; 
        else if (menuIndex === 4) { viewMode = "movies"; filteredMovies = kidsMovies; }
        else if (menuIndex === 5) { viewMode = "movies"; filteredMovies = kidsSeries; }
        renderList();
    } else {
        menuFocused = true;
        posterPreview.style.display = "none";
    }
}

document.addEventListener("keydown", e => {
    let count = (viewMode === "channels") ? channels.length : 
                (viewMode === "kids_channels") ? kidsChannels.length :
                (viewMode === "categories") ? movieCategories.length : 
                (viewMode === "episodes") ? episodes.length : filteredMovies.length;

    switch (e.key) {
        case "ArrowRight": 
            if (menuFocused && !listOpen) toggleList(); 
            break;
        case "ArrowLeft": 
            if (listOpen) {
                if (viewMode === "episodes") {
                    viewMode = "movies";
                    selectedIndex = 0;
                    renderList();
                } else if (viewMode === "movies" && menuIndex === 1) { 
                    viewMode = "categories";
                    selectedIndex = 0;
                    renderList();
                } else {
                    toggleList(); 
                }
            }
            break;
        case "ArrowUp":
            if (listOpen) { selectedIndex = (selectedIndex - 1 + count) % count; renderList(); }
            else if (menuFocused) { menuIndex = (menuIndex - 1 + menuItems.length) % menuItems.length; renderMenu(); }
            break;
        case "ArrowDown":
            if (listOpen) { selectedIndex = (selectedIndex + 1) % count; renderList(); }
            else if (menuFocused) { menuIndex = (menuIndex + 1) % menuItems.length; renderMenu(); }
            break;
        case "Enter":
            if (menuFocused) {
                toggleList(); 
            } else if (listOpen) {
                if (viewMode === "channels") {
                    playMedia(channels[selectedIndex].url);
                    toggleList(); 
                } else if (viewMode === "kids_channels") {
                    playMedia(kidsChannels[selectedIndex].url);
                    toggleList(); 
                } else if (viewMode === "categories") {
                    const cat = movieCategories[selectedIndex];
                    filteredMovies = movies.filter(f => f.genero === cat || cat === "Lançamentos");
                    viewMode = "movies";
                    selectedIndex = 0;
                    renderList();
                } else if (viewMode === "movies") {
                    const item = filteredMovies[selectedIndex];
                    if (item.identificador_archive) {
                        fetchArchiveEpisodes(item.identificador_archive);
                    } else {
                        playMedia(item.url || item.link);
                        toggleList();
                    }
                } else if (viewMode === "episodes") {
                    playMedia(episodes[selectedIndex].url);
                    toggleList();
                }
            }
            break;
    }
});
</script>
</body>
</html>
