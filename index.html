<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaixãoFlix 2026</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --azul-escuro: #001a33;
            --bg-total: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg-total); color: white; overflow: hidden; display: flex; }

        /* BARRA LATERAL */
        #sidebar {
            width: 90px; height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 100;
        }
        .logo { width: 60px; cursor: pointer; margin-bottom: 20px; transition: 0.3s; }
        .logo:focus { transform: scale(1.1); }
        .nav-icons { display: flex; flex-direction: column; gap: 15px; }
        .icon-btn { 
            width: 50px; height: 50px; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn svg { width: 28px; fill: #555; }
        .icon-btn:focus { background: var(--amarelo-pipoca); outline: none; }
        .icon-btn:focus svg { fill: #000; }

        /* BARRA SUPERIOR */
        #topbar {
            position: fixed; top: 0; left: 90px; right: 0; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: linear-gradient(to bottom, #000, transparent); z-index: 90;
        }
        #contador { color: var(--amarelo-pipoca); font-weight: bold; font-size: 18px; }

        /* CONTEÚDO */
        main { margin-left: 0; width: calc(100% - 90px); height: 100vh; overflow-y: auto; padding: 90px 40px 40px; }
        
        /* BOTÕES 3D */
        .btn-3d {
            background: var(--amarelo-pipoca); border: none; padding: 12px 25px;
            font-weight: bold; border-radius: 8px; box-shadow: var(--sombra-3d);
            cursor: pointer; transition: 0.1s; color: black;
        }
        .btn-3d:active { transform: translateY(3px); box-shadow: 0 2px 0 #b38f00; }

        /* CARROSSEL E CAPAS */
        .row { margin-bottom: 30px; position: relative; }
        .cards-container { display: flex; gap: 15px; overflow-x: hidden; scroll-behavior: smooth; padding: 10px 0; }
        .capa { min-width: 210px; position: relative; cursor: pointer; }
        .capa:focus { transform: scale(1.05); border: 3px solid white; border-radius: 8px; }
        .capa img { width: 100%; border-radius: 8px; }
        
        .top-num {
            position: absolute; left: -10px; bottom: 20px; font-size: 90px;
            font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 2px var(--amarelo-pipoca);
        }
        .capa-info { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; margin-top: 5px; }

        /* PÁGINA DETALHES */
        #details {
            position: fixed; inset: 0; background: #000; z-index: 200; display: none;
            background-size: cover; background-position: center;
        }
        .details-content { 
            width: 100%; height: 100%; background: linear-gradient(to right, #000 40%, transparent);
            padding: 60px; display: flex; align-items: center;
        }

        /* PLAYER */
        #player-ui { position: fixed; inset: 0; background: #000; z-index: 300; display: none; }
        video { width: 100%; height: 100%; }
        .exit-player { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px; cursor: pointer; border-radius: 5px; }

        /* CANAIS */
        .canal-item { display: flex; align-items: center; padding: 10px; gap: 15px; cursor: pointer; }
        .canal-item:focus { background: var(--amarelo-pipoca); color: #000; }
        .canal-logo { width: 40px; height: 40px; object-fit: contain; }
    </style>
</head>
<body>

<nav id="sidebar">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" class="logo" onclick="location.reload()" tabindex="0">
    <div class="nav-icons">
        <div class="icon-btn" tabindex="0" onclick="showSearch()"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderPagina('movie')"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderPagina('serie')"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderCanais()"><svg viewBox="0 0 24 24"><path d="M21 10H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm-10 7H8v-3h3v3zm5 0h-3v-3h3v3zM21 3H3c-1.1 0-2 .9-2 2v3h22V5c0-1.1-.9-2-2-2z"/></svg></div>
    </div>
</nav>

<header id="topbar">
    <div id="contador">Estamos evoluindo: <span id="num-count">0</span></div>
    <div id="relogio"></div>
</header>

<main id="content"></main>

<div id="details"></div>

<div id="player-ui">
    <button class="exit-player btn-3d" onclick="closePlayer()">SAIR</button>
    <video id="main-player" controls autoplay></video>
</div>

<script>
    let db = { filmes: [], series: [], kids_filmes: [], kids_series: [], canais: [] };

    // --- RELÓGIO ---
    function updateClock() {
        const now = new Date();
        document.getElementById('relogio').innerText = now.toLocaleString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }).toUpperCase();
    }
    setInterval(updateClock, 1000);

    // --- CARREGAMENTO DE DADOS ---
    async function loadApp() {
        const paths = ['data/filmes.json', 'data/series.json', 'data/kids_filmes.json', 'data/kids_series.json'];
        const results = await Promise.all(paths.map(p => fetch(p).then(r => r.json()).catch(() => [])));
        
        db.filmes = results[0];
        db.series = results[1];
        db.kids_filmes = results[2];
        db.kids_series = results[3];

        document.getElementById('num-count').innerText = db.filmes.length + db.series.length + db.kids_filmes.length + db.kids_series.length;
        renderHome();
    }

    // --- HOME (TOP 4 DIÁRIO) ---
    function renderHome() {
        const content = document.getElementById('content');
        content.innerHTML = `<h2 style="margin-bottom:20px">PaixãoFlix indica hoje</h2><div class="cards-container" id="top4"></div>`;
        
        const all = [...db.filmes, ...db.series, ...db.kids_filmes, ...db.kids_series];
        // Seleção pseudo-aleatória por data
        const day = new Date().getDate();
        const top4 = all.slice(day % all.length, (day % all.length) + 4);

        top4.forEach((item, i) => {
            document.getElementById('top4').innerHTML += `
                <div class="capa" tabindex="0" onclick='openDetails(${JSON.stringify(item)})'>
                    <span class="top-num">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="capa-info"><span>${item.year}</span><span>★${item.rating}</span><span>${item.genero}</span></div>
                </div>`;
        });
    }

    // --- DETALHES E ARCHIVE.ORG ---
    async function openDetails(item) {
        const det = document.getElementById('details');
        det.style.display = 'block';
        det.style.backgroundImage = `url(${item.poster})`;

        let actionHtml = `<button class="btn-3d" onclick="playContent('${item.url}', '${item.titulo}')">ASSISTIR AGORA</button>`;
        
        if(item.type === 'serie') {
            actionHtml = `<div id="episodes-list">Carregando episódios...</div>`;
            fetchEpisodes(item.identificador_archive);
        }

        det.innerHTML = `
            <div class="details-content">
                <img src="${item.poster}" style="width:300px; border-radius:15px; margin-right:40px">
                <div style="max-width:600px">
                    <h1 style="font-size:48px">${item.titulo}</h1>
                    <p style="margin:10px 0; color:var(--amarelo-pipoca)">${item.year} • ★ ${item.rating}</p>
                    <p style="margin-bottom:30px; line-height:1.6">${item.desc}</p>
                    ${actionHtml}
                    <button class="btn-3d" style="background:#444; color:white; margin-left:10px" onclick="document.getElementById('details').style.display='none'">VOLTAR</button>
                </div>
            </div>`;
    }

    async function fetchEpisodes(id) {
        try {
            const res = await fetch(`https://archive.org/metadata/${id}`);
            const data = await res.json();
            const files = data.files.filter(f => f.name.endsWith('.mp4') || f.name.endsWith('.mkv'));
            
            let html = '<div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; margin-top:20px">';
            files.forEach((file, idx) => {
                const videoUrl = `https://archive.org/download/${id}/${file.name}`;
                html += `<button class="btn-3d" style="font-size:10px" onclick="playContent('${videoUrl}', 'EP ${idx+1}')">EP ${idx+1}</button>`;
            });
            html += '</div>';
            document.getElementById('episodes-list').innerHTML = html;
        } catch (e) {
            document.getElementById('episodes-list').innerHTML = "Erro ao carregar episódios.";
        }
    }

    // --- PLAYER ---
    function playContent(url, title) {
        const p = document.getElementById('player-ui');
        const v = document.getElementById('main-player');
        p.style.display = 'block';
        v.src = url;
        v.play();
    }

    function closePlayer() {
        document.getElementById('main-player').pause();
        document.getElementById('player-ui').style.display = 'none';
    }

    window.onload = loadApp;
</script>
</body>
</html>
