<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaixãoFlix 2026</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --vermelho-logo: #ff0000;
            --azul-escuro: #001a33;
            --bg-body: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
            --capa-w: 160px; 
            --capa-h: 240px;
            --sidebar-w: 85px;
        }

        /* REMOVER BARRA DE ROLAGEM DE TUDO */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Segoe UI', sans-serif; outline: none; 
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        *::-webkit-scrollbar { display: none; }

        body { background: var(--bg-body); color: white; overflow: hidden; display: flex; }

        /* BARRA LATERAL */
        #sidebar {
            width: var(--sidebar-w); height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 1000;
        }
        .logo { width: 55px; cursor: pointer; margin-bottom: 25px; transition: 0.3s; }
        .logo:focus { transform: scale(1.1); }
        .nav-icons { display: flex; flex-direction: column; gap: 15px; }
        .icon-btn { 
            width: 50px; height: 50px; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn svg { width: 26px; fill: #666; }
        .icon-btn:focus { background: var(--amarelo-pipoca); box-shadow: 0 0 15px var(--amarelo-pipoca); }
        .icon-btn:focus svg { fill: #000; }

        /* BARRA SUPERIOR */
        #topbar {
            position: fixed; top: 00; left: var(--sidebar-w); right: 0; height: 65px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 35px; background: rgba(0,0,0,0.9); z-index: 900;
        }
        #contador { color: var(--amarelo-pipoca); font-weight: bold; font-size: 16px; text-transform: uppercase; }

        /* CONTEÚDO PRINCIPAL */
        main {
            margin-left: 0;
            width: calc(100% - var(--sidebar-w));
            height: 100vh;
            overflow: hidden;
            scroll-behavior: smooth;
            padding: 90px 35px 50px;
        }

        /* BOTÕES 3D */
        .btn-3d {
            background: var(--amarelo-pipoca); border: nenhum; padding: 12px 24px;
            font-weight: bold; border-radius: 8px; box-shadow: var(--sombra-3d);
            cursor: pointer; transition: 0.1s; color: black; font-size: 13px;
        }
        .btn-3d:focus { transform: translateY(3px); box-shadow: 0 2px 0 #b38f00; border: 2px solid white; }

        /* TITULO PERSONALIZADO */
        .titulo-custom {
            font-size: 38px;
            font-weight: 900;
            margin-bottom: 25px;
            text-transform: uppercase;
        }
        .vermelho { color: var(--vermelho-logo); }
        .amarelo { color: var(--amarelo-pipoca); }

        /* CONFIGURAR 4 CAPAS POR LINHA NAS CATEGORIAS */
        .row-section {
            margin-bottom: 40px;
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            outline: nenhum;
        }

        .carousel {
            display: flex;
            flex-direction: row;
            gap: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-behavior: smooth;
            padding: 10px 0;
            align-items: center;
            height: 100%;
            width: 100%;
            position: relative;
        }

        .carousel::after {
            content: "➤";
            font-size: 40px;
            color: var(--amarelo-pipoca);
            position: sticky;
            right: 10px;
            top: 50%;
;
            pointer-events: nenhum;
            z-index: 5;
        }

        .capa {
            flex: 0 0 calc(25% - 15px);
            height: var(--capa-h);
            position: relative;
            cursor: pointer;
            transition: 0.3s;
            border-radius: 8px;
            overflow: hidden;
            outline: nenhum;
        }

        .capa:focus {
            transform: scale(1.03);
            border: 4px solid white;
    box-shadow: 0 0 20px var(--amarelo-pipoca);
            z-index: 10;
        }

        .capa img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
        }

        .num-top {
            position: absolute; left: -15px; bottom: 5px; font-size: 85px;
            font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 2px var(--amarelo-pipoca); z-index: 5;
            line-height: 1;
        }

        .capa-meta {
            display: flex;
            justify-content: center;
            gap: 15px;
            font-size: 14px;
            color: var(--amarelo-pipoca) !important;
            margin-top: 8px;
            font-weight: bold;
        }

        /* TOP 4 */
        #top4 {
            display: flex;
            gap: 15px;
            height: 60vh;
            margin-bottom: 50px;
        }

        #top4 .capa {
            flex: 1;
            height: 100%;
        }

        /* PLAYER E TELAS */
        #player-layer, #details-layer { position: fixed; inset: 0 background: #000; z-index: 2000; display: nenhum; }
        video { width: 100%; height: 100%; }
        .overlay-det { width: 100%; height: 100%; background: linear-gradient(to right, #000 40%, transparent); display: flex; align-items: center; padding: 60px; }

        /* BUSCA */
        #search-layer { position: fixed; inset: 70px 0 0 var(--sidebar-w); background: var(--bg-body); z-index: 850; display: nenhum; padding: 40px; }
        #q { width: 100%; background: nenhum; border: nenhum; border-bottom: 3px solid var(--amarelo-pipoca); color: #fff; font-size: 35px; margin-bottom: 30px; }
    </style>
</head>
<body>

<nav id="sidebar">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" class="logo" onclick="location.reload()" tabindex="0">
    <div class="nav-icons">
        <div class="icon-btn" tabindex="0" onclick="toggleSearch()" title="Pesquisa"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('movie', 'data/filmes.json')" title="Cinema"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('serie', 'data/series.json')" title="Séries"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="alert('Carregando M3U...')"><svg viewBox="0 0 24 24"><path d="M21 10H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm-10 7H8v-3h3v3zm5 0h-3v-3h3v3zM21 3H3c-1.1 0-2 .9-2 2v3h22V5c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('kids_movie', 'data/kids_filmes.json')" title="Kids Filmes"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('kids_serie', 'data/kids_series.json')" title="Kids Séries"><svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('fav', 'data/favoritos.json')" title="Minha Lista"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
    </div>
</nav>

<header id="topbar">
    <div id="contador">Estamos evoluindo: <span id="num-val">0</span></div>
    <div id="relogio" style="font-size: 13px; opacity: 0.8;"></div>
</header>

<main id="main-view"></main>

<div id="details-layer"></div>

<div id="player-layer">
    <button class="btn-3d" style="position:absolute; top:30px; left:30px; z-index:3000" onclick="closePlayer()">VOLTAR</button>
    <video id="main-video" controls autoplay></video>
</div>

<div id="search-layer">
    <input type="text" id="q" placeholder="Digite para buscar..." oninput="doSearch(this.value)">
    <div id="search-results" class="carousel"></div>
</div>

<script>
    let globalDB = [];
    const CATEGORIAS = ["Lançamento 2026", "Lançamento 2025", "Ação", "Aventura", "Comédia", "Drama", "Nacional", "Romance", "Religioso", "Ficção", "Anime", "Animação", "Família", "Clássicos", "Dorama", "Suspense", "Policial", "Crime", "Terror", "Documentários", "Faroeste", "Musical", "Adulto"];

    setInterval(() => {
        const n = new Date();
        document.getElementById('relogio').innerText = n.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).toUpperCase();
    }, 1000);

    async function startApp() {
        const files = ['data/filmes.json', 'data/series.json', 'data/kids_filmes.json', 'data/kids_series.json'];
        const results = await Promise.all(files.map(f => fetch(f).then(r => r.json()).catch(() => [])));
        globalDB = results.flat();
        document.getElementById('num-val').innerText = globalDB.length;
        renderHome();
    }

    function renderHome() {
        const view = document.getElementById('main-view');
        view.innerHTML = `
            <h2 class="titulo-custom">
                <span class="vermelho">PaixãoFlix</span> <span class="amarelo">indica hoje</span>
            </h2>
            <div id="top4"></div>
            
            <h2 class="titulo-custom" style="font-size: 24px; margin-top:40px">
                <span class="amarelo">Continuar Assistindo</span>
            </h2>
            <div class="carousel" id="history"></div>
        `;
        
        const seed = new Date().getDate();
        const top4 = globalDB.slice(seed % globalDB.length, (seed % globalDB.length) + 4);
        
        const topContainer = document.getElementById('top4');
        top4.forEach((item, i) => {
            topContainer.innerHTML += `
                <div class="capa" tabindex="0" onclick='openDetails(${JSON.stringify(item)})'>
                    <span class="num-top">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="capa-meta">
                        <span>${item.year}</span>
                        <span>★ ${item.rating}</span>
                    </div>
                </div>`;
        });
    }

    async function loadData(type, file) {
        document.getElementById('search-layer').style.display = 'nenhum';
        const view = document.getElementById('main-view');
        view.innerHTML = '<h2 class="titulo-custom" style="font-size:24px"><span class="amarelo">Carregando conteúdo...</span></h2>';
        const data = await fetch(file).then(r => r.json());

        if(type.includes('kids')) {
            data.sort((a,b) => a.titulo.localeCompare(b.titulo));
            view.innerHTML = `<h2 class="titulo-custom" style="font-size:24px"><span class="amarelo">Kids</span></h2><div class="carousel">${drawCapas(data)}</div>`;
        } else {
            view.innerHTML = '';
            CATEGORIAS.forEach(cat => {
                const list = data.filter(i => i.genero === cat);
                if(list.length > 0) {
                    view.innerHTML += `
                        <div class="row-section" tabindex="0">
                            <h2 class="titulo-custom" style="font-size:24px"><span class="amarelo">${cat}</span></h2>
                            <div class="carousel">${drawCapas(list)}</div>
                        </div>`;
                }
            });
        }
    }

    function drawCapas(list) {
        return list.map(item => `
            <div class="capa" tabindex="0" onclick='openDetails(${JSON.stringify(item)})'>
                <img src="${item.poster}">
                <div class="capa-meta">
                    <span>${item.year}</span>
                    <span>★ ${item.rating}</span>
                </div>
            </div>`).join('');
    }

    async function openDetails(item) {
        const layer = document.getElementById('details-layer');
        layer.style.display = 'block';
        layer.style.backgroundImage = `url(${item.poster})`;
        
        let playBtn = `<button class="btn-3d" onclick="playVideo('${item.url}', '${item.titulo}')">ASSISTIR AGORA</button>`;
        
        if(item.type === 'serie') {
            playBtn = `<div id="ep-list">Buscando episódios...</div>`;
            const res = await fetch(`https://archive.org/metadata/metadata/${item.identificador_archive}`);
            const meta = await res.json();
            const videos = meta.files.filter(f => f.name.endsWith('.mp4') || f.name.endsWith('.mkv'));
            let epHtml = '<div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; margin-top:20px">';
            videos.forEach((v, i) => {
                const epUrl = `https://archive.download/${item.identificador_archive}/${v.name}`;
                epHtml += `<button class="btn-3d" style="font-size:10px" onclick="playVideo('${epUrl}', '${v.name}')">EPISÓDIO ${i+1}</button>`;
            });
            playBtn = epHtml + '</div>';
        }

        layer.innerHTML = `
            <div class="overlay-det">
                <img src="${item.poster}" style="width:240px; border-radius:10px; box-shadow: 0 0 30px #000; margin-right:50px">
                <div style="max-width:700px">
                    <h1 style="font-size:55px; color:var(--amarelo-pipoca); line-height:1">${item.titulo}</h1>
                    <p style="margin:20px 0; font-size:18px">${item.year} | ★ ${item.rating} | ${item.genero}</p>
                    <p style="opacity:0.8; line-height:1.5; margin-bottom:40px">${item.desc}</p>
                    ${playBtn}
                    <button class="btn-3d" style="background:#444; color:#fff; margin-left:15px" onclick="document.getElementById('details-layer').style.display='nenhum'">VOLTAR</button>
                </div>
            </div>`;
    }

    function playVideo(url, title) {
        document.getElementById('player-layer').style.display = 'block';
        document.getElementById('main-video').src = url;
    }

    function closePlayer() {
        document.getElementById('main-video').pause();
        document.getElementById('player-layer').style.display = 'nenhum';
    }

    function toggleSearch() {
        const s = document.getElementById('search-layer');
        s.style.display = s.style.display === 'block' ? 'nenhum' : 'block';
        if(s.style.display === 'block') document.getElementById('q').focus();
    }

    function doSearch(txt) {
        const r = document.getElementById('search-results');
        r.innerHTML = '';
        if(txt.length < 2) return;
        const filtered = globalDB.filter(i => i.titulo.toLowerCase().includes(txt.toLowerCase()));
        r.innerHTML = drawCapas(filtered);
    }

    // NAVEGAÇÃO COM SETAS / CONTROLE REMOTO / TOQUE
    document.addEventListener('keydown', e => {
        const focado = document.activeElement;
        if (!focado) return;

        let proximo = nulo;

        if (focado.classList.contains('capa')) {
            if (e.key === 'ArrowRight') proximo = focado.nextElementSibling;
            if (e.key === 'ArrowLeft')  proximo = focado.previousElementSibling;
        }

        if (focado.classList.contains('row-section')) {
            if (e.key === 'ArrowDown') proximo = focado.nextElementSibling;
            if (e.key === 'ArrowUp')    proximo = focado.previousElementSibling;
        }

        if (proximo) {
            proximo.focus();
            proximo.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
    });

    // CLICA NA PRIMEIRA CAPA AO ENTRAR NA CATEGORIA
    document.addEventListener('focus', e => {
        if (e.target.classList.contains('row-section')) {
            const primeiraCapa = e.target.querySelector('.capa');
            if (primeiraCapa) {
                setTimeout(() => primeiraCapa.focus(), 50);
            }
        }
    }, true);

    window.onload = startApp;
</script>
</body>
</html>
