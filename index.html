<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Web TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins}
body{margin:0;background:#000;color:#fff}
#app{display:flex;height:100vh}

/* SIDEBAR */
aside{
  width:260px;
  background:#C0C0C0;
  padding:10px;
}
aside img{width:180px;display:block;margin:auto}
button{
  width:100%;
  margin:6px 0;
  padding:10px;
  background:#363636;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:focus{outline:3px solid #033f99}

/* MAIN */
main{flex:1;overflow:auto;padding:15px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:12px;
}
.card{cursor:pointer}
.card img{width:100%;border-radius:8px}
.info{font-size:13px;display:flex;justify-content:space-between}

/* PLAYER */
#playerBox{
  position:fixed;inset:0;
  background:#000;
  display:none;
}
#playerBox video{width:100%;height:100%}
#exit{
  position:absolute;top:10px;right:10px;
  background:#363636;
  padding:10px;
  border-radius:50%;
  display:none;
}
</style>
</head>

<body>

<div id="app">
<aside>
  <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
  <button onclick="loadMovies()">üé¨ Cinema</button>
  <button onclick="loadSeries()">üì∫ S√©ries</button>
</aside>

<main id="content"></main>
</div>

<div id="playerBox">
  <video id="player" controls controlsList="nodownload"></video>
  <div id="exit" onclick="closePlayer()">‚úñ</div>
</div>

<script>
const content=document.getElementById('content');
const player=document.getElementById('player');
const box=document.getElementById('playerBox');
const exitBtn=document.getElementById('exit');

/* PLAYER */
function openPlayer(url){
  player.src=url;
  box.style.display='block';
  player.play();
  showExit();
}
function closePlayer(){
  player.pause();
  box.style.display='none';
}
function showExit(){
  exitBtn.style.display='block';
  clearTimeout(exitBtn.timer);
  exitBtn.timer=setTimeout(()=>exitBtn.style.display='none',3000);
}
['mousemove','keydown','touchstart'].forEach(e=>{
  document.addEventListener(e,showExit)
});

/* CONTINUE ASSISTINDO */
player.addEventListener('timeupdate',()=>{
  localStorage.setItem(
    'lastWatch',
    JSON.stringify({url:player.src,time:player.currentTime,ts:Date.now()})
  );
});

/* MOVIES */
async function loadMovies(){
  const r=await fetch(
    'https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json'
  );
  const data=await r.json();
  render(data.filter(i=>i.type==='movie'));
}

/* SERIES */
async function loadSeries(){
  const r=await fetch(
    'https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json'
  );
  const data=await r.json();
  render(data.filter(i=>i.type==='serie'));
}

/* RENDER */
function render(items){
  content.innerHTML='<div class="grid"></div>';
  const g=document.querySelector('.grid');
  items.forEach(i=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`
      <img src="${i.poster}">
      <div class="info">
        <span>${i.year}</span>
        <span>‚≠ê${i.rating}</span>
      </div>
      <div style="font-size:12px">
        Continuar assistindo ou recome√ßar
      </div>
    `;
    c.onclick=()=>openPlayer(i.url);
    g.appendChild(c);
  });
}

/* OFFLINE */
if('serviceWorker'in navigator){
  navigator.serviceWorker.register(
    URL.createObjectURL(
      new Blob([`
        self.addEventListener('fetch',e=>{
          e.respondWith(caches.open('tv').then(c=>
            c.match(e.request).then(r=>r||fetch(e.request))
          ))
        })
      `],{type:'text/javascript'})
    )
  );
}
</script>

</body>
</html>
