<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>PaixãoFlix – Web TV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="referrer" content="no-referrer">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

    <style>
        :root { --primary: #e50914; --bg: #111; }
        body{margin:0;background:#000;color:#fff;font-family:'Poppins', sans-serif;display:flex;height:100vh;overflow:hidden}
        * { scrollbar-width: none; -ms-overflow-style: none; box-sizing: border-box; }
        *::-webkit-scrollbar { display: none; }

        #side{width:340px;background:var(--bg);display:flex;flex-direction:column;z-index:10;border-right:1px solid #222;}
        #top{padding:20px;}
        #header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
        #logo{max-width:180px;max-height:80px;object-fit:contain}
        #clock{font-size:24px;font-weight:700;}

        #search{width:100%;padding:12px;border-radius:8px;border:1px solid var(--primary);background:#000;color:#fff;outline:none;}
        #now-playing-info{padding:10px 20px;background:rgba(255,255,255,0.05);border-bottom:1px solid #222;font-size:13px;}
        #now-playing-info b{color:var(--primary);display:block;}

        #buttons{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:10px}
        #buttons button{padding:10px;border:0;border-radius:6px;background:#222;color:#fff;font-weight:700;cursor:pointer;font-size:11px;}
        #buttons button.active{background:var(--primary)}

        #list-container{flex:1;display:flex;flex-direction:column;overflow:hidden;}
        #list{flex:1;overflow-y:auto;}
        .item{padding:14px;border-bottom:1px solid #222;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
        .item:hover{background:rgba(255,255,255,0.05);}

        #player{flex:1;position:relative;background:#000;display:flex;align-items:center;justify-content:center;}
        video{width:100%;height:100%;background:#000;}

        @media (max-width: 768px) {
            body { flex-direction: column; }
            #side { width: 100%; height: auto; border-right: none; }
            #player { width: 100%; height: 230px; flex: none; order: -1; }
            #list-container { height: auto; flex: 1; }
        }
    </style>
</head>
<body>

<div id="side">
  <div id="top">
    <div id="header-row">
        <img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logo.png?raw=true">
        <div id="clock">00:00</div>
    </div>
    <input id="search" placeholder="Pesquisar...">
  </div>
  <div id="now-playing-info"><b>ASSISTINDO:</b> <span id="current-title">Selecione um canal</span></div>
  <div id="buttons">
    <button id="btnTV" class="active">TV</button>
    <button id="btnFilmes">FILMES</button>
    <button id="btnSeries">SÉRIES</button>
    <button id="btnKids" style="background:#0056b3">KIDS</button>
    <button id="btnFav">FAVORITOS</button>
    <button id="btnHist">HISTÓRICO</button>
  </div>
  <div id="list-container"><div id="list"></div></div>
</div>

<div id="player">
  <video id="video" autoplay playsinline controls></video>
</div>

<script>
const video = document.getElementById('video');
const currentTitleDisplay = document.getElementById('current-title');
let hls = null;
let items = [];

function play(url, title){
    if(!url) return;
    currentTitleDisplay.innerText = title;

    if (hls) { hls.destroy(); hls = null; }

    if (Hls.isSupported()) {
        hls = new Hls({
            xhrSetup: function(xhr) { xhr.withCredentials = false; }
        });
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else {
        video.src = url;
        video.play();
    }
}

async function loadList(mode){
    let path = './data/canais.m3u';
    if(mode === 'kids') path = './data/kids_canais.m3u';
    
    try {
        const r = await fetch(path);
        const txt = await r.text();
        let name=''; let listItems=[];
        txt.split('\n').forEach(l=>{
            if(l.startsWith('#EXTINF')) name=l.split(',').pop();
            else if(l.startsWith('http')) listItems.push({title:name.trim(), url:l.trim()});
        });
        items = listItems;
        render();
    } catch(e) { console.error("Erro ao carregar lista."); }
}

function render(){
    const list = document.getElementById('list');
    list.innerHTML='';
    items.forEach((i) => {
        const d = document.createElement('div');
        d.className = 'item';
        d.innerHTML = `<span>${i.title}</span>`;
        d.onclick = () => play(i.url, i.title);
        list.appendChild(d);
    });
}

document.getElementById('btnTV').onclick=()=>{
    document.getElementById('btnTV').classList.add('active');
    document.getElementById('btnKids').classList.remove('active');
    loadList('tv');
};
document.getElementById('btnKids').onclick=()=>{
    document.getElementById('btnKids').classList.add('active');
    document.getElementById('btnTV').classList.remove('active');
    loadList('kids');
};

document.getElementById('search').oninput = (e) => {
    const term = e.target.value.toLowerCase();
    const filtered = items.filter(i => i.title.toLowerCase().includes(term));
    const list = document.getElementById('list');
    list.innerHTML='';
    filtered.forEach(i => {
        const d = document.createElement('div');
        d.className = 'item';
        d.innerHTML = `<span>${i.title}</span>`;
        d.onclick = () => play(i.url, i.title);
        list.appendChild(d);
    });
};

window.onload=()=>loadList('tv');
function updateClock(){ document.getElementById('clock').innerText=new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}); }
setInterval(updateClock,1000); updateClock();
</script>
</body>
</html>
