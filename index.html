<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV V.28.7.50</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;500;700;900&family=Open+Sans:ital,wght@1,700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

<style>
    * { 
        overflow: hidden !important; 
        touch-action: auto; 
        box-sizing: border-box; 
        outline: none; 
        -ms-overflow-style: none !important; 
        scrollbar-width: none !important; 
    }
    *::-webkit-scrollbar { display: none !important; width: 0 !important; height: 0 !important; }
    
    body { 
        margin: 0; padding: 0; 
        background: #000; 
        color: #fff; height: 100vh; width: 100vw;
        font-family: 'Poppins', sans-serif;
    }

    /* TÍTULOS - 42PX CONFORME SOLICITADO */
    .channel-category-title, #top6Title { 
        font-family: 'Open Sans', sans-serif !important; 
        font-weight: 700 !important; 
        font-style: italic !important; 
        color: #FFB400 !important; /* Amarelo Pipoca mais escuro */
        border-left: 8px solid #b20710; 
        padding-left: 20px;
        font-size: 42px;
        text-transform: uppercase;
        margin-left: 10px;
    }

    /* PÁGINA DE DETALHES - AJUSTE DE 50PX */
    #detailsOverlay {
        position: fixed; inset: 0; background: #000; z-index: 20000;
        display: none; flex-direction: column; justify-content: center;
        padding-top: 50px;
    }
    #detailsBg { position: absolute; inset: 0; background-size: cover; filter: blur(25px) brightness(0.2); z-index: -1; }
    #detailsContent { display: flex; align-items: center; padding: 0 80px; gap: 60px; z-index: 1; }
    .details-poster-wrapper { flex: 0 0 350px; height: 500px; border-radius: 15px; border: 2px solid #FFB400; overflow: hidden; }
    .details-poster-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    #detTitle { font-size: 55px; font-weight: 900; margin-bottom: 5px; color: #fff; }
    #detDesc { font-size: 22px; color: #ccc; line-height: 1.4; max-width: 800px; margin: 20px 0; display: block !important; }

    /* BOTÕES ESPECÍFICOS */
    .btn-play-3d { background: #FFB400 !important; color: #fff !important; font-family: 'Avenir-Roman', sans-serif !important; font-weight: 400; font-style: italic; border: none; padding: 15px 35px; border-radius: 8px; cursor: pointer; }
    .btn-back-3d { background: #b20710 !important; color: #fff !important; font-family: 'Avenir-Roman', sans-serif !important; font-weight: 300; font-style: italic; border: none; padding: 15px 35px; border-radius: 8px; cursor: pointer; }

    #topBar { position: fixed; top: 0; left: 0; width: 100%; height: 75px; display: flex; align-items: center; justify-content: space-between; padding: 0 50px; z-index: 11000; background: #000; }
    
    #menuBrands {
        position: fixed; left: 0; top: 75px; width: 80px; height: calc(100vh - 75px);
        z-index: 12000; background: #000; transition: 0.3s; display: flex; flex-direction: column; padding: 20px 10px;
    }
    #menuBrands.expanded { width: 260px; }
    .brand-card { width: 100%; min-height: 60px; display: flex; align-items: center; gap: 20px; padding: 0 15px; border-radius: 10px; cursor: pointer; color: #F5F5F5; }
    .brand-card.focused { background: #FFB400 !important; color: #000 !important; }

    #mainScroll { margin-top: 75px; margin-left: 90px; height: calc(100vh - 75px); overflow-y: auto !important; padding-bottom: 100px; }

    /* SLIDE INICIAL */
    #editorSlider { width: 95%; height: 420px; margin: 20px auto; border-radius: 20px; background-size: cover; background-position: center; display: flex; align-items: flex-end; padding: 50px; border: 3px solid rgba(255,255,255,0.1); }
    #editorMeta { font-size: 24px; color: #FFB400; font-weight: bold; }

    /* PREFERIDOS - ESPAÇAMENTO */
    #top6Section { margin: 80px 0 40px 20px; overflow: visible !important; }
    .top6-grid { display: flex; gap: 55px; padding: 20px 40px; overflow: visible !important; }
    .top6-item { position: relative; flex: 0 0 180px; height: 260px; transition: 0.4s; }
    .top6-number { position: absolute; left: -45px; bottom: -10px; font-size: 100px; font-weight: 900; color: rgba(0,0,0,0.5); -webkit-text-stroke: 2px #FFB400; z-index: -1; }
    .top6-item.focused { transform: scale(1.15); z-index: 10; }

    /* GRIDS E CAPAS */
    .category-container { margin-bottom: 60px; padding-left: 20px; }
    .channels-row { display: flex; gap: 25px; padding: 20px 0; overflow-x: auto; scroll-behavior: smooth; }
    
    /* KIDS VERTICAL 4 COLUNAS */
    .kids-vertical-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; padding: 40px; }

    .movie-card { flex: 0 0 200px; cursor: pointer; transition: 0.3s; text-align: center; }
    .movie-poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 8px; border: 2px solid transparent; }
    .movie-card.focused .movie-poster { border-color: #fff; transform: scale(1.05); }
    
    /* META ABAIXO DAS CAPAS */
    .movie-info-wrap { margin-top: 10px; font-size: 14px; font-weight: 600; color: #fff; text-align: center; }
    .movie-info-wrap span { display: inline-block; margin: 0 5px; }
    .rating-color { color: #FFB400; }

    #channelsOverlay, #moviesOverlay { position: fixed; inset: 75px 0 0 80px; background: #000; z-index: 10000; display: none; overflow-y: auto; }
    .live-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 20px; padding: 40px; }
    .live-card { cursor: pointer; transition: 0.3s; text-align: center; }
    .live-card img { width: 100%; aspect-ratio: 16/9; object-fit: contain; }
    .live-card.focused { transform: scale(1.2); }

    #playerOverlay { position: fixed; inset: 0; background: #000; z-index: 30000; display: none; }
</style>
</head>
<body>

<div id="topBar">
    <img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" onclick="location.reload()">
    <div id="barDateTime" style="font-weight: bold; color: #FFB400;"></div>
</div>

<div id="menuBrands">
    <div class="brand-card" onclick="location.reload()"><i class="fas fa-home"></i><span>Início</span></div>
    <div class="brand-card" onclick="openLive('canais')"><i class="fas fa-tv"></i><span>Canais Ao Vivo</span></div>
    <div class="brand-card" onclick="renderCategoryPage(movies, 'Cinema')"><i class="fas fa-film"></i><span>Cinema</span></div>
    <div class="brand-card" onclick="renderCategoryPage(series, 'Séries')"><i class="fas fa-clapperboard"></i><span>Séries</span></div>
    <div class="brand-card" onclick="openLive('kids')"><i class="fas fa-mickey-mouse"></i><span>Canais Kids</span></div>
    <div class="brand-card" onclick="renderKidsGrid(kidsMovies, 'Kids Filmes')"><i class="fas fa-ice-cream"></i><span>Filmes Kids</span></div>
    <div class="brand-card" onclick="renderKidsGrid(kidsSeries, 'Kids Séries')"><i class="fas fa-rocket"></i><span>Séries Kids</span></div>
</div>

<div id="mainScroll">
    <div id="editorSlider" onclick="openDetails(editorsChoice[edIdx])">
        <div id="editorInfo">
            <div id="editorTitle" style="font-size: 45px; font-weight: 900;">...</div>
            <div id="editorMeta">ANO • ★ 0.0 • CATEGORIA</div>
        </div>
    </div>
    <div id="top6Section">
        <div id="top6Title">Preferidos do momento</div>
        <div class="top6-grid" id="top6Container"></div>
    </div>
    <div id="homeRows"></div>
</div>

<div id="detailsOverlay">
    <div id="detailsBg"></div>
    <div id="detailsContent">
        <div class="details-poster-wrapper"><img id="detPoster" src=""></div>
        <div class="details-info">
            <div id="detTitle">...</div>
            <div id="detMeta" style="color:#FFB400; font-size: 24px;">...</div>
            <div id="detDesc">...</div>
            <div class="details-btns">
                <button id="btnDetPlay" class="btn-play-3d">Assistir Agora</button>
                <button class="btn-back-3d" onclick="closeDetails()">Voltar</button>
            </div>
        </div>
    </div>
</div>

<div id="channelsOverlay"></div>
<div id="moviesOverlay"></div>
<div id="playerOverlay"><div id="player" style="width:100%;height:100%"></div></div>

<script>
let movies = [], series = [], kidsMovies = [], kidsSeries = [], channels = [], kidsChannels = [];
let editorsChoice = [], top6Data = [], edIdx = 0;
let currentFocus = "editor", menuIdx = 0, movieIdx = 0, catRowIdx = 0, gridIdx = 0;
let isMoviesOpen = false, isLiveOpen = false, isDetailsOpen = false;

const CATEGORIAS = ["Lançamentos 2026", "Lançamentos 2025", "Ação", "Aventura", "Comédia", "Drama", "Nacional", "Romance", "Religioso", "Ficção", "Anime", "Animação", "Clássicos", "Dorama", "Suspense", "Policial", "Crime", "Terror", "Documentários", "Faroeste", "Musical", "Adulto"];

async function loadData() {
    const getJ = async (u) => { try { const r = await fetch(u); return await r.json(); } catch { return []; } };
    movies = (await getJ("data/filmes.json")).sort((a,b)=>a.titulo.localeCompare(b.titulo));
    series = (await getJ("data/series.json")).sort((a,b)=>a.titulo.localeCompare(b.titulo));
    kidsMovies = (await getJ("data/kids_filmes.json")).sort((a,b)=>a.titulo.localeCompare(b.titulo));
    kidsSeries = (await getJ("data/kids_series.json")).sort((a,b)=>a.titulo.localeCompare(b.titulo));
    
    // M3U Loading
    const loadM3U = async (u) => { try { const r = await fetch(u); return await r.text(); } catch { return ""; } };
    const m1 = await loadM3U("data/ativa_canais.m3u"); channels = parseM3U(m1);
    const m2 = await loadM3U("data/canais_kids.m3u"); kidsChannels = parseM3U(m2);

    editorsChoice = [...movies, ...series].sort(()=>0.5-Math.random()).slice(0,10);
    top6Data = [...movies, ...series].slice(0,6);
    
    renderHomeRows();
    renderTop6();
    startCarousel();
    updateFocus();
    setInterval(()=> { document.getElementById("barDateTime").innerText = new Date().toLocaleString(); }, 1000);
}

function parseM3U(t) {
    return t.split("#EXTINF").slice(1).map(x => ({
        name: x.split(",")[1].split("\n")[0].trim(),
        logo: x.match(/tvg-logo="([^"]+)"/)?.[1] || "",
        url: x.split("\n")[1].trim()
    }));
}

function renderHomeRows() {
    const h = document.getElementById("homeRows");
    CATEGORIAS.forEach(c => {
        const filtered = [...movies, ...series].filter(m => (m.categoria||"").includes(c));
        if(filtered.length > 0) {
            const row = document.createElement("div"); row.className = "category-container";
            row.innerHTML = `<div class="channel-category-title">${c}</div><div class="channels-row"></div>`;
            const inner = row.querySelector(".channels-row");
            filtered.forEach(m => inner.appendChild(createCard(m)));
            h.appendChild(row);
        }
    });
}

function createCard(m) {
    const div = document.createElement("div"); div.className = "movie-card";
    div.innerHTML = `
        <img class="movie-poster" src="${m.poster}">
        <div class="movie-info-wrap">
            <span>${m.year||'2026'}</span> | <span class="rating-color">★ ${m.rating||'9.5'}</span><br>
            <span style="font-size:10px; opacity:0.7">${m.categoria||'Geral'}</span>
        </div>
    `;
    div.onclick = () => openDetails(m);
    return div;
}

function renderKidsGrid(list, title) {
    isMoviesOpen = true; const m = document.getElementById("moviesOverlay");
    m.style.display = "block"; m.innerHTML = `<div class="channel-category-title">${title}</div><div class="kids-vertical-grid"></div>`;
    const g = m.querySelector(".kids-vertical-grid");
    list.forEach(item => g.appendChild(createCard(item)));
    currentFocus = "movie_grid"; movieIdx = 0; updateFocus();
}

function openLive(type) {
    isLiveOpen = true; const o = document.getElementById("channelsOverlay");
    o.style.display = "block"; o.innerHTML = `<div class="live-grid"></div>`;
    const g = o.querySelector(".live-grid");
    const list = type === 'kids' ? kidsChannels : channels;
    list.forEach(c => {
        const d = document.createElement("div"); d.className = "live-card";
        d.innerHTML = `<img src="${c.logo}"><div style="font-size:12px">${c.name}</div>`;
        d.onclick = () => playUrl(c.url);
        g.appendChild(d);
    });
    currentFocus = "live_grid"; chanIdx = 0; updateFocus();
}

function openDetails(m) {
    isDetailsOpen = true;
    document.getElementById("detPoster").src = m.poster;
    document.getElementById("detailsBg").style.backgroundImage = `url(${m.poster})`;
    document.getElementById("detTitle").innerText = m.titulo;
    document.getElementById("detMeta").innerText = `${m.year} • ★ ${m.rating} • ${m.categoria}`;
    document.getElementById("detDesc").innerText = m.descricao || "Sinopse não disponível para este conteúdo.";
    document.getElementById("detailsOverlay").style.display = "flex";
    document.getElementById("btnDetPlay").onclick = () => playUrl(m.url);
}

function closeDetails() { isDetailsOpen = false; document.getElementById("detailsOverlay").style.display = "none"; }

function updateFocus() {
    document.querySelectorAll(".focused").forEach(e => e.classList.remove("focused"));
    const menu = document.getElementById("menuBrands");
    if(currentFocus === "menu") {
        menu.classList.add("expanded");
        document.querySelectorAll(".brand-card")[menuIdx]?.classList.add("focused");
    } else {
        menu.classList.remove("expanded");
        if(currentFocus === "editor") document.getElementById("editorSlider").classList.add("focused");
        if(currentFocus === "grid") document.querySelectorAll(".top6-item")[gridIdx]?.classList.add("focused");
        if(currentFocus === "movie_grid") {
            const cards = document.querySelectorAll(".movie-card");
            cards[movieIdx]?.classList.add("focused");
            cards[movieIdx]?.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
        }
    }
}

// NAVEGAÇÃO E TOQUE
document.addEventListener("keydown", e => {
    const k = e.keyCode;
    if(currentFocus === "menu") {
        if(k === 40) menuIdx = (menuIdx + 1) % 7;
        if(k === 38) menuIdx = (menuIdx - 1 + 7) % 7;
        if(k === 39) currentFocus = "editor";
    } else if(currentFocus === "movie_grid") {
        const row = document.querySelectorAll(".channels-row")[catRowIdx];
        const cards = row ? row.querySelectorAll(".movie-card") : document.querySelectorAll(".movie-card");
        if(k === 39) movieIdx = (movieIdx + 1) % cards.length; // Horizontal Infinita
        if(k === 37) movieIdx = (movieIdx - 1 + cards.length) % cards.length;
        if(k === 40) { catRowIdx++; movieIdx = 0; } // Vertical
        if(k === 38 && catRowIdx > 0) catRowIdx--; 
    }
    if(k === 13) document.querySelector(".focused")?.click();
    updateFocus();
});

function playUrl(url) {
    document.getElementById("playerOverlay").style.display = "block";
    new Clappr.Player({ source: url, parentId: "#player", width: "100%", height: "100%", autoPlay: true });
}

function startCarousel() {
    setInterval(() => {
        edIdx = (edIdx + 1) % editorsChoice.length;
        const m = editorsChoice[edIdx];
        const s = document.getElementById("editorSlider");
        s.style.backgroundImage = `url(${m.poster})`;
        document.getElementById("editorTitle").innerText = m.titulo;
        document.getElementById("editorMeta").innerText = `${m.year} • ★ ${m.rating} • ${m.categoria}`;
    }, 8000);
}

function renderTop6() {
    const c = document.getElementById("top6Container");
    top6Data.forEach((m, i) => {
        const d = document.createElement("div"); d.className = "top6-item";
        d.innerHTML = `<span class="top6-number">${i+1}</span><img class="top6-poster" src="${m.poster}">`;
        d.onclick = () => openDetails(m);
        c.appendChild(d);
    });
}

window.onload = loadData;
</script>
</body>
</html>
