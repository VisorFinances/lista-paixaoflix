<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PaixãoFlix</title>
<style>
/* ================= RESET ================= */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#0b0b0f;
  color:#ffd84d;
  overflow:hidden;
}
:root{
  --card:#1b1b25;
  --border:rgba(255,255,255,.08);
  --focus:#e50914;
}
img{width:100%;display:block}
.hidden{display:none}
</style>

<!-- ================= SIDEBAR ================= -->
<style>
#sidebar{
  position:fixed;
  left:0;top:0;bottom:0;
  width:150px;
  background:#111118;
  border-right:1px solid var(--border);
  padding:1rem .5rem
}
#logo{display:flex;justify-content:center;margin-bottom:2rem}
#logo img{width:140px}
.menu a{
  display:block;
  text-align:center;
  padding:.8rem;
  border-radius:10px;
  margin-bottom:.3rem;
  color:#ffd84d;
  cursor:pointer;
}
.menu a:focus{
  outline:none;
  background:var(--card);
  box-shadow:0 0 0 3px var(--focus)
}
</style>

<!-- ================= HOME ================= -->
<style>
#home{margin-left:150px;padding:1.2rem;overflow-y:auto;height:100vh;scroll-behavior:smooth;}
.section{margin-bottom:2.6rem}
.section h2{margin-bottom:1rem;font-size:1.5rem;}
.row{display:flex;gap:1rem;overflow-x:auto;scroll-behavior:smooth;}
.row::-webkit-scrollbar{display:none}
.card{background:var(--card);border-radius:14px;overflow:hidden;flex:0 0 23%;}
.card:focus{outline:none;box-shadow:0 0 0 4px var(--focus)}
.card img{height:200px;object-fit:cover}
.card span{display:block;padding:.6rem;text-align:center;}
.continuation{position:absolute;right:5px;top:50%;transform:translateY(-50%);width:20px;height:50px;background:linear-gradient(to left,#0b0b0f,transparent);}
</style>

<!-- ================= DETALHES ================= -->
<style>
#details{display:none;height:100vh;margin-left:150px;background-size:cover;background-position:center;}
.details-overlay{background:rgba(0,0,0,.8);height:100%;padding:3rem;display:flex}
.details-poster{width:260px;margin-right:2rem}
.details-info h1{font-size:calc(2rem + 2px);font-weight:500;font-style:italic;}
.details-info p{margin-top:3px;color:#fff;}
</style>

</head>
<body>

<!-- ================= MENU ================= -->
<nav id="sidebar">
  <div id="logo">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
  </div>
  <div class="menu">
    <a tabindex="1">Início</a>
    <a tabindex="2">TV ao Vivo</a>
    <a tabindex="3">Cinema</a>
    <a tabindex="4">Séries</a>
    <a tabindex="5">Minha Lista</a>
    <a tabindex="6">Filmes Kids</a>
    <a tabindex="7">Séries Kids</a>
    <a tabindex="8">Canais Kids</a>
  </div>
</nav>

<!-- ================= HOME ================= -->
<div id="home">
  <section class="section"><h2>Em Alta</h2><div class="row" id="emAlta"></div></section>
  <section class="section"><h2>Novos</h2><div class="row" id="novos"></div></section>
  <section class="section"><h2>Continuar Assistindo</h2><div class="row" id="continuar"></div></section>
  <section class="section"><h2>Recomendados</h2><div class="row" id="recomendados"></div></section>
</div>

<!-- ================= DETALHES ================= -->
<div id="details">
  <div class="details-overlay">
    <div class="details-poster"><img id="detailsPoster"></div>
    <div class="details-info">
      <h1 id="detailsTitle"></h1>
      <p id="detailsMeta"></p>
      <p id="detailsDesc"></p>
    </div>
  </div>
</div>

<!-- ================= CANAIS ================= -->
<div id="catalogo" style="display:none;">
  <h2 id="catalogo-title"></h2>
  <div id="canais-grid" class="row"></div>
</div>

<script>
let focusables=[],currentIndex=0;

// ================= FUNÇÕES =================
function setFoco(index){
  if(!focusables[index]) return;
  focusables.forEach(e=>e.classList.remove('focused'));
  currentIndex=index;
  const el=focusables[currentIndex];
  el.classList.add('focused');
  el.focus({preventScroll:true});
  el.scrollIntoView({block:'nearest',inline:'nearest'});
}

function moverFoco(dir){
  let cols=4; let next=currentIndex;
  if(focusables[currentIndex]?.classList.contains('canal-card')) cols=7;
  switch(dir){case 'left': next--;break;case 'right': next++;break;case 'up': next-=cols;break;case 'down': next+=cols;break;}
  if(next<0) next=0;if(next>=focusables.length) next=focusables.length-1;
  setFoco(next);
}

document.addEventListener('keydown',e=>{
  switch(e.key){
    case 'ArrowLeft': e.preventDefault();moverFoco('left');break;
    case 'ArrowRight': e.preventDefault();moverFoco('right');break;
    case 'ArrowUp': e.preventDefault();moverFoco('up');break;
    case 'ArrowDown': e.preventDefault();moverFoco('down');break;
    case 'Enter': case 'OK': e.preventDefault(); focusables[currentIndex]?.click(); break;
  }
});

function collectFocusables(){
  focusables=[...document.querySelectorAll('a,button,.card,.continuar,.canal-card,[tabindex]')].filter(e=>e.offsetParent!==null);
  focusables.forEach((el,i)=>{el.dataset.focusIndex=i;el.tabIndex=-1;el.classList.remove('focused');});
}

// ================= INIT =================
window.addEventListener('load',()=>{
  collectFocusables();
  document.querySelector('.menu a')?.focus();
  setFoco(0);
});

// ================= HOME FUNCTIONS =================
function openDetails(item){
  document.getElementById('home').style.display='none';
  document.getElementById('details').style.display='block';
  document.getElementById('detailsPoster').src=item.poster;
  document.getElementById('detailsTitle').textContent=item.titulo;
  document.getElementById('detailsMeta').textContent=`⭐ ${item.rating} • ${item.year}`;
  document.getElementById('detailsDesc').textContent=item.desc;
}

function goHome(){
  document.getElementById('details').style.display='none';
  document.getElementById('catalogo').style.display='none';
  document.getElementById('home').style.display='block';
  setFoco(0);
}

function renderCard(item,container){
  const div=document.createElement('div');div.className='card';div.tabIndex=0;
  div.innerHTML=`<img src="${item.poster}"><span>${item.titulo}</span>`;
  div.onclick=()=>openDetails(item);container.appendChild(div);
}

function renderCategory(title,data,container){
  const sec=document.createElement('section');sec.className='section';
  sec.innerHTML=`<h2>${title}</h2>`;
  const row=document.createElement('div');row.className='row';sec.appendChild(row);
  data.forEach(i=>renderCard(i,row));
  container.appendChild(sec);
}

// ================= CARREGAR CANAIS =================
function loadCanais(path,title){
  document.getElementById('home').style.display='none';
  document.getElementById('details').style.display='none';
  const cat=document.getElementById('catalogo');cat.style.display='block';
  document.getElementById('catalogo-title').textContent=title;
  const grid=document.getElementById('canais-grid');grid.innerHTML='';
  fetch(path).then(r=>r.json()).then(data=>{
    data.forEach(c=>{
      const div=document.createElement('div');div.className='canal-card';div.tabIndex=0;
      div.innerHTML=`<img src="${c.logo}"><span>${c.nome}</span>`;
      div.onclick=()=>openDetails(c);grid.appendChild(div);
    });
    collectFocusables();setFoco(0);
  });
}

// ================= MENU =================
document.querySelectorAll('.menu a').forEach(btn=>{
  const txt=btn.textContent.trim();
  if(txt==='Início') btn.onclick=()=>goHome();
  if(txt==='TV ao Vivo') btn.onclick=()=>loadCanais('data/ativa_canais.json','TV ao Vivo');
  if(txt==='Canais Kids') btn.onclick=()=>loadCanais('data/ativa_kids_canais.json','Canais Kids');
});

// ================= CARREGAR HOME =================
fetch('data/filmes.json').then(r=>r.json()).then(d=>{d.forEach(i=>renderCard(i,document.getElementById('emAlta')));collectFocusables();});

// ================= EXEMPLO CATEGORIAS CINEMA =================
const categorias=['Lançamento 2026','Lançamento 2025','Ação','Aventura','Comédia','Drama','Nacional','Romance','Religioso','Ficção','Anime','Animação','Família','Clássicos','Dorama','Suspense','Policial','Crime','Terror','Documentários','Faroeste','Musical','Adulto'];

categorias.forEach(cat=>{
  fetch('data/filmes.json').then(r=>r.json()).then(d=>{renderCategory(cat,d,document.getElementById('home'));collectFocusables();});
});
</script>
</body>
</html>
