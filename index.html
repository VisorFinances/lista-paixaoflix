<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaixãoFlix 2026</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --vermelho-logo: #ff0000;
            --azul-escuro: #001a33;
            --bg-body: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
            --sidebar-w: 85px;
            /* Cálculo para 4 capas exatas considerando o gap */
            --gap-size: 15px;
        }

        /* REMOVER BARRA DE ROLAGEM */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Segoe UI', sans-serif; outline: none; 
            scrollbar-width: none;
        }
        *::-webkit-scrollbar { display: none; }

        body { background: var(--bg-body); color: white; overflow: hidden; display: flex; }

        /* BARRA LATERAL */
        #sidebar {
            width: var(--sidebar-w); height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 1000;
        }
        .logo { width: 55px; cursor: pointer; margin-bottom: 25px; transition: 0.3s; }
        .nav-icons { display: flex; flex-direction: column; gap: 15px; }
        .icon-btn { width: 50px; height: 50px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .icon-btn svg { width: 26px; fill: #666; }
        .icon-btn:focus { background: var(--amarelo-pipoca); }
        .icon-btn:focus svg { fill: #000; }

        /* CONTEÚDO PRINCIPAL */
        main { margin-left: 0; width: calc(100% - var(--sidebar-w)); height: 100vh; overflow-y: auto; padding: 90px 35px 50px; scroll-behavior: smooth; }

        /* TITULO PERSONALIZADO */
        .titulo-custom { font-size: 32px; font-weight: 900; margin-bottom: 12px; text-transform: uppercase; }
        .vermelho { color: var(--vermelho-logo); }
        .amarelo { color: var(--amarelo-pipoca); }

        /* PATCH: CATEGORIAS COM ESPAÇAMENTO DE 12PX E ROLAGEM INFINITA */
        .row-section { margin-bottom: 12px; position: relative; } /* Espaçamento entre categorias fixado em 12px */
        
        .carousel-wrapper { position: relative; display: flex; align-items: center; }
        
        .carousel { 
            display: flex; 
            gap: var(--gap-size); 
            width: 100%; 
            overflow-x: hidden; /* Oculta o excesso para o scroll infinito via JS */
            scroll-behavior: smooth;
            padding: 10px 0;
        }

        /* CAPAS: 4 POR LINHA (100% da largura / 4 - gaps) */
        .capa { 
            min-width: calc((100% / 4) - (var(--gap-size) * 0.75));
            position: relative; cursor: pointer; transition: 0.3s; 
        }
        .capa:focus { transform: scale(1.05); border: 3px solid white; z-index: 10; border-radius: 8px; }
        .capa img { width: 100%; height: auto; border-radius: 6px; aspect-ratio: 2/3; object-fit: cover; }

        /* SETA DE CONTINUAÇÃO (DIREITA) */
        .seta-indicadora {
            position: absolute; right: 0; background: linear-gradient(to left, rgba(0,0,0,0.8), transparent);
            height: 100%; width: 50px; display: flex; align-items: center; justify-content: center;
            color: var(--amarelo-pipoca); font-size: 30px; font-weight: bold; pointer-events: none; z-index: 5;
        }

        /* TOP 4 INDICA HOJE */
        #top4 { display: flex; gap: 15px; height: 55vh; margin-bottom: 40px; }
        #top4 .capa { flex: 1; height: 100%; min-width: 0; }
        .num-top { position: absolute; left: -10px; bottom: 5px; font-size: 80px; font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 2px var(--amarelo-pipoca); z-index: 5; }

        .capa-meta { display: flex; justify-content: center; gap: 15px; font-size: 14px; color: var(--amarelo-pipoca) !important; margin-top: 8px; font-weight: bold; }

        /* OUTROS */
        #topbar { position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 65px; display: flex; align-items: center; justify-content: space-between; padding: 0 35px; background: rgba(0,0,0,0.9); z-index: 900; }
        #player-layer, #details-layer { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; }
        .btn-3d { background: var(--amarelo-pipoca); border: none; padding: 12px 24px; font-weight: bold; border-radius: 8px; box-shadow: var(--sombra-3d); cursor: pointer; color: black; }
    </style>
</head>
<body>

<nav id="sidebar">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" class="logo" onclick="location.reload()" tabindex="0">
    <div class="nav-icons">
        <div class="icon-btn" tabindex="0" onclick="toggleSearch()"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('movie', 'data/filmes.json')"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('serie', 'data/series.json')"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('kids_movie', 'data/kids_filmes.json')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadData('fav', 'data/favoritos.json')"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
    </div>
</nav>

<header id="topbar">
    <div id="contador">PaixãoFlix: <span id="num-val">0</span></div>
    <div id="relogio" style="font-size: 13px; opacity: 0.8;"></div>
</header>

<main id="main-view"></main>

<div id="details-layer"></div>
<div id="player-layer">
    <button class="btn-3d" style="position:absolute; top:30px; left:30px; z-index:3000" onclick="closePlayer()">VOLTAR</button>
    <video id="main-video" controls autoplay></video>
</div>

<script>
    let globalDB = [];
    const CATEGORIAS = ["Lançamento 2026", "Lançamento 2025", "Ação", "Aventura", "Comédia", "Drama", "Nacional", "Romance", "Religioso", "Ficção", "Anime", "Animação", "Família", "Clássicos", "Dorama", "Suspense", "Policial", "Crime", "Terror", "Documentários", "Faroeste", "Musical", "Adulto"];

    // RELOGIO
    setInterval(() => {
        const n = new Date();
        document.getElementById('relogio').innerText = n.toLocaleDateString('pt-BR', { weekday: 'long', hour: '2-digit', minute: '2-digit' }).toUpperCase();
    }, 1000);

    // INICIAR
    async function startApp() {
        const files = ['data/filmes.json', 'data/series.json', 'data/kids_filmes.json', 'data/kids_series.json'];
        const results = await Promise.all(files.map(f => fetch(f).then(r => r.json()).catch(() => [])));
        globalDB = results.flat();
        document.getElementById('num-val').innerText = globalDB.length;
        renderHome();
    }

    function renderHome() {
        const view = document.getElementById('main-view');
        view.innerHTML = `
            <h2 class="titulo-custom"><span class="vermelho">PaixãoFlix</span> <span class="amarelo">indica hoje</span></h2>
            <div id="top4"></div>
            <h2 class="titulo-custom" style="font-size: 24px; margin-top:10px"><span class="amarelo">Filmes e Séries</span></h2>
            <div id="categorias-home"></div>
        `;
        
        const seed = new Date().getDate();
        const top4Items = globalDB.slice(seed % globalDB.length, (seed % globalDB.length) + 4);
        const topContainer = document.getElementById('top4');
        top4Items.forEach((item, i) => {
            topContainer.innerHTML += `
                <div class="capa" tabindex="0" onclick='openDetails(${JSON.stringify(item)})'>
                    <span class="num-top">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="capa-meta"><span>${item.year}</span><span>★ ${item.rating}</span></div>
                </div>`;
        });
        // Carrega categorias na home por padrão
        loadData('movie', 'data/filmes.json', true);
    }

    // PATCH: CARREGAR COM ROLAGEM INFINITA E SETA
    async function loadData(type, file, isHome = false) {
        const view = isHome ? document.getElementById('categorias-home') : document.getElementById('main-view');
        if(!isHome) view.innerHTML = '';
        
        const data = await fetch(file).then(r => r.json());

        CATEGORIAS.forEach(cat => {
            const list = data.filter(i => i.genero === cat);
            if(list.length > 0) {
                const rowId = `row-${cat.replace(/\s/g, '')}`;
                view.innerHTML += `
                    <div class="row-section">
                        <h2 class="titulo-custom" style="font-size:22px"><span class="amarelo">${cat}</span></h2>
                        <div class="carousel-wrapper">
                            <div class="carousel" id="${rowId}" onkeydown="handleNav(event, '${rowId}')">
                                ${drawCapas(list)}
                            </div>
                            <div class="seta-indicadora">➤</div>
                        </div>
                    </div>`;
            }
        });
    }

    function drawCapas(list) {
        return list.map(item => `
            <div class="capa" tabindex="0" onclick='openDetails(${JSON.stringify(item)})'>
                <img src="${item.poster}">
                <div class="capa-meta"><span>${item.year}</span><span>★ ${item.rating}</span></div>
            </div>`).join('');
    }

    // PATCH: LOGICA DE ROLAGEM INFINITA
    function handleNav(e, id) {
        const el = document.getElementById(id);
        const step = el.offsetWidth; // Rola uma "página" de 4 itens
        if (e.key === 'ArrowRight') {
            if (el.scrollLeft + el.offsetWidth >= el.scrollWidth - 10) {
                el.scrollLeft = 0; // Volta ao início (Infinito)
            } else {
                el.scrollLeft += step;
            }
        } else if (e.key === 'ArrowLeft') {
            if (el.scrollLeft <= 0) {
                el.scrollLeft = el.scrollWidth; // Vai ao fim
            } else {
                el.scrollLeft -= step;
            }
        }
    }

    async function openDetails(item) {
        const layer = document.getElementById('details-layer');
        layer.style.display = 'block';
        layer.style.backgroundImage = `linear-gradient(to right, #000 40%, transparent), url(${item.poster})`;
        layer.style.backgroundSize = 'cover';
        
        let playBtn = `<button class="btn-3d" onclick="playVideo('${item.url}')">ASSISTIR AGORA</button>`;
        if(item.type === 'serie') {
            playBtn = `<button class="btn-3d" onclick="alert('Carregando lista do Archive...')">VER EPISÓDIOS</button>`;
        }

        layer.innerHTML = `
            <div class="overlay-det">
                <img src="${item.poster}" style="width:280px; border-radius:10px; box-shadow: 0 0 30px #000; margin-right:50px">
                <div style="max-width:600px">
                    <h1 style="font-size:48px; color:var(--amarelo-pipoca);">${item.titulo}</h1>
                    <p style="margin:15px 0; font-size:18px">${item.year} | ★ ${item.rating}</p>
                    <p style="opacity:0.8; line-height:1.6; margin-bottom:30px">${item.desc || 'Sem descrição disponível.'}</p>
                    ${playBtn}
                    <button class="btn-3d" style="background:#444; color:#fff; margin-left:15px" onclick="document.getElementById('details-layer').style.display='none'">VOLTAR</button>
                </div>
            </div>`;
    }

    function playVideo(url) {
        document.getElementById('player-layer').style.display = 'block';
        document.getElementById('main-video').src = url;
    }

    function closePlayer() {
        document.getElementById('main-video').pause();
        document.getElementById('player-layer').style.display = 'none';
    }

    window.onload = startApp;
</script>
</body>
</html>
