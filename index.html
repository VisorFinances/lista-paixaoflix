<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paix√£oFlix - Sistema Oficial 2026</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --azul-escuro: #001a33;
            --bg-body: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
            --sidebar-w: 90px;
        }

        /* ESTILOS GLOBAIS E PADR√ïES DO SISTEMA */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Open Sans', 'Segoe UI', Roboto, sans-serif; 
            outline: none; 
        }
        
        /* CLASSES DE SISTEMA */
        .skeleton {
            animation: skeletonPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes skeletonPulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .scrim-gradient {
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
        }
        
        .focus-glow {
            box-shadow: 0 0 20px rgba(255, 206, 68, 0.6);
        }
        
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        /* MARGENS DE SEGURAN√áA (SAFE AREA) */
        .safe-area-left {
            margin-left: 60px;
        }
        
        .safe-area-top {
            margin-top: 50px;
        }
        
        /* ESPA√áAMENTO PADR√ÉO */
        .horizontal-gap {
            gap: 15px;
        }
        
        .vertical-gap {
            margin-bottom: 49px;
        }
        
        .card-spacing {
            margin-bottom: 71px;
        }
        
        /* SCROLL BEHAVIOR */
        html {
            scroll-behavior: smooth;
        }
        
        /* REMOVER BARRAS DE ROLAGEM (EXCETO EPIS√ìDIOS) */
        ::-webkit-scrollbar {
            display: none;
        }
        
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .episodes-container::-webkit-scrollbar,
        .episodes-container *::-webkit-scrollbar {
            display: block;
            width: 8px;
            height: 8px;
        }
        
        .episodes-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        
        .episodes-container::-webkit-scrollbar-thumb {
            background: var(--amarelo-pipoca);
            border-radius: 4px;
        }

        body { 
            background: var(--bg-body); 
            color: white; 
            overflow: hidden; 
            display: flex; 
        }
        
        /* Importar Open Sans */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');
        
        /* Customiza√ß√£o da Skin City para Paix√£oFlix */
        .vjs-city-skin {
            font-family: 'Open Sans', sans-serif;
        }
        
        .vjs-city-skin .vjs-big-play-button {
            background-color: var(--amarelo-pipoca);
            border-color: var(--amarelo-pipoca);
            color: var(--bg-body);
            font-size: 3em;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            line-height: 80px;
            margin-top: -40px;
            margin-left: -40px;
        }
        
        .vjs-city-skin .vjs-big-play-button:hover {
            background-color: #FFD700;
            border-color: #FFD700;
            transform: scale(1.1);
        }
        
        .vjs-city-skin .vjs-control-bar {
            background: linear-gradient(to bottom, rgba(5, 7, 10, 0.9), rgba(5, 7, 10, 0.95));
            backdrop-filter: blur(10px);
        }
        
        .vjs-city-skin .vjs-play-progress,
        .vjs-city-skin .vjs-load-progress {
            background: var(--amarelo-pipoca);
        }
        
        .vjs-city-skin .vjs-slider {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .vjs-city-skin .vjs-played-progress {
            background: var(--amarelo-pipoca);
        }
        
        .vjs-city-skin .vjs-volume-level {
            background: var(--amarelo-pipoca);
        }
        
        .vjs-city-skin .vjs-button:hover {
            color: var(--amarelo-pipoca);
        }
        
        .vjs-city-skin .vjs-menu {
            background: rgba(5, 7, 10, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 206, 68, 0.3);
        }
        
        .vjs-city-skin .vjs-menu-item {
            color: white;
            font-size: 14px;
        }
        
        .vjs-city-skin .vjs-menu-item:hover {
            background: var(--amarelo-pipoca);
            color: var(--bg-body);
        }
        
        .vjs-city-skin .vjs-overlay {
            background: rgba(5, 7, 10, 0.8);
            backdrop-filter: blur(5px);
        }
        
        /* Responsive para skin City */
        @media (max-width: 768px) {
            .vjs-city-skin .vjs-big-play-button {
                width: 60px;
                height: 60px;
                line-height: 60px;
                margin-top: -30px;
                margin-left: -30px;
                font-size: 2em;
            }
            
            .vjs-city-skin .vjs-control-bar {
                font-size: 12px;
            }
        }
        
        /* Estilos universais para t√≠tulos */
        .universal-title {
            font-family: 'Open Sans', sans-serif;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
        }
        
        .vertical-line {
            width: 100%;
            height: 2px;
            background: #ff6b6b;
            margin: 15px 0;
            font-weight: 200;
        }

        /* --- BARRA LATERAL (ESTILO DISNEY+) --- */
        #sidebar {
            width: var(--sidebar-w); height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 1000;
            transition: all 0.3s ease;
        }
        #sidebar:hover {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
        }
        .logo { width: 60px; cursor: pointer; margin-bottom: 25px; transition: 0.3s; }
        .logo:focus { transform: scale(1.1); }
        
        .nav-icons { display: flex; flex-direction: column; gap: 15px; }
        .icon-btn { 
            width: 55px; height: 55px; border-radius: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            font-size: 24px;
            font-weight: 500;
            color: #666;
        }
        .icon-btn svg { width: 30px; fill: #666; }
        .icon-btn:focus { 
            background: var(--amarelo-pipoca); 
            box-shadow: 0 0 15px var(--amarelo-pipoca); 
            font-size: 28px;
            font-weight: 500;
        }
        .icon-btn:focus svg { fill: #000; }

        /* --- BARRA SUPERIOR --- */
        #topbar {
            position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: linear-gradient(to bottom, #000, transparent); z-index: 900;
        }
        /* --- SISTEMA DE REL√ìGIO --- */
        #relogio-txt { 
            font-size: 14px; 
            opacity: 0.8; 
            font-family: 'Open Sans', sans-serif;
        }
        #contador-global { 
            color: var(--amarelo-pipoca); 
            font-weight: bold; 
            font-size: 18px; 
            text-transform: uppercase; 
            font-family: 'Open Sans', sans-serif;
        }

        /* --- CONTE√öDO PRINCIPAL --- */
        main { 
            margin-left: 0; 
            width: calc(100% - var(--sidebar-w)); 
            height: 100vh; 
            overflow-y: auto; 
            padding: 90px 40px 40px; 
            scroll-behavior: smooth;
        }
        
        /* Suporte para navega√ß√£o por teclado e controle remoto */
        .capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn {
            -webkit-tap-highlight-color: transparent;
            -webkit-focus-ring-color: transparent;
            outline: none;
        }
        
        .capa-item:focus, .icon-btn:focus, .btn-3d:focus, .btn-voltar:focus, .btn-assistir-dark:focus, .episode-btn:focus, .exit-btn:focus {
            outline: 2px solid var(--amarelo-pipoca);
            outline-offset: 2px;
        }
        
        /* Melhorar toque em dispositivos m√≥veis */
        @media (hover: none) and (pointer: coarse) {
            .capa-item {
                transform: scale(1);
                transition: transform 0.2s ease;
            }
        }
        
        /* RESPONSIVO SMART TV */
        @media (max-width: 1920px) {
            /* Desktop / Laptop */
            .main-content {
                padding-left: 60px;
                padding-top: 50px;
            }
            
            .capa-item {
                width: 200px;
                height: 300px;
            }
            
            .row-container {
                gap: 15px;
            }
        }
        
        @media (max-width: 1366px) {
            /* Tablet */
            .main-content {
                padding-left: 40px;
                padding-top: 40px;
            }
            
            .capa-item {
                width: 180px;
                height: 270px;
            }
            
            .row-container {
                gap: 12px;
            }
            
            .section-title {
                font-size: 38px;
            }
            
            .hero-title {
                font-size: 60px;
            }
        }
        
        @media (max-width: 768px) {
            /* Smartphone */
            .main-content {
                padding-left: 20px;
                padding-top: 30px;
            }
            
            .capa-item {
                width: 150px;
                height: 225px;
            }
            
            .row-container {
                gap: 10px;
            }
            
            .section-title {
                font-size: 32px;
            }
            
            .hero-title {
                font-size: 50px;
            }
            
            .sidebar {
                width: 200px;
            }
            
            .icon-btn {
                font-size: 20px;
                padding: 12px;
            }
            
            .details-content {
                flex-direction: column;
                max-width: 100%;
            }
            
            .details-poster {
                width: 200px;
                height: 300px;
            }
        }
        
        /* FOR√áAR ORIENTA√á√ÉO HORIZONTAL EM DISPOSITIVOS M√ìVEIS */
        @media (max-width: 1024px) and (orientation: portrait) {
            body {
                transform: rotate(90deg);
                transform-origin: top left;
                width: 100vh;
                height: 100vw;
                overflow-x: hidden;
            }
            
            .main-content {
                width: 100vh;
                height: 100vw;
                padding-left: 30px;
                padding-top: 30px;
                transform: rotate(-90deg);
                transform-origin: top left;
            }
            
            .sidebar {
                width: 150px;
            }
            
            .hero-content {
                padding: 30px;
            }
        }
        
        @media (max-width: 768px) and (orientation: portrait) {
            .main-content {
                padding-left: 15px;
                padding-top: 20px;
            }
            
            .capa-item {
                width: 120px;
                height: 180px;
            }
            
            .row-container {
                gap: 8px;
            }
        }
        
        /* AJUSTES PARA TELAS PEQUENAS */
        @media (max-width: 480px) {
            .main-content {
                padding-left: 10px;
                padding-top: 15px;
            }
            
            .capa-item {
                width: 100px;
                height: 150px;
            }
            
            .row-container {
                gap: 6px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .hero-title {
                font-size: 36px;
            }
            
            .sidebar {
                width: 120px;
            }
            
            .icon-btn {
                font-size: 16px;
                padding: 8px;
            }
            
            .details-info {
                padding: 15px;
            }
            
            .details-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-assistir-dark, .btn-voltar {
                width: 100%;
                max-width: 200px;
            }
        }
        
        /* Suporte para scroll por mouse e touch */
        .row-container {
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Prevenir sele√ß√£o de texto durante navega√ß√£o */
        .capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* BOT√ïES 3D PADRONIZADOS */
        .btn-3d {
            background: #FFCE44; border: none; padding: 12px 25px;
            font-weight: bold; border-radius: 8px; box-shadow: var(--sombra-3d);
            cursor: pointer; transition: 0.1s; color: black; text-transform: uppercase;
        }
        .btn-3d:active, .btn-3d:focus { transform: translateY(3px); box-shadow: 0 2px 0 #b38f00; border: 2px solid white; }
        
        .btn-assistir-dark {
            background: #FFCE44;
            color: black;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-size: 16px;
        }
        
        .btn-assistir-dark:hover {
            background: #ffd54f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 206, 68, 0.3);
        }
        
        .btn-assistir-dark:focus {
            outline: 2px solid white;
            outline-offset: 2px;
            transform: translateY(-2px);
        }
        
        .btn-voltar {
            background: #E50914;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-size: 16px;
        }
        
        .btn-voltar:hover {
            background: #ff0a16;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.3);
        }
        
        .btn-voltar:focus {
            outline: 2px solid white;
            outline-offset: 2px;
            transform: translateY(-2px);
        }
        
        /* BANNER CINEM√ÅTICO NETFLIX */
        .hero-banner {
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 400px;
            margin-bottom: 49px;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1;
        }
        
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            z-index: 2;
        }
        
        .hero-content {
            position: relative;
            z-index: 3;
            display: flex;
            height: 100%;
            padding: 0 60px;
        }
        
        .hero-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-width: 50%;
            padding-right: 40px;
        }
        
        .hero-title {
            font-size: 70px;
            font-weight: 900;
            color: white;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.1;
        }
        
        .hero-meta {
            font-size: 24px;
            font-weight: 400;
            color: #ccc;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .hero-genres {
            font-size: 18px;
            color: #aaa;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .hero-synopsis {
            font-size: 26px;
            font-weight: 400;
            color: white;
            gap: 19px;
            align-items: center;
        }
        
        .hero-poster {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            height: 450px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 3;
        }
        
        /* REFLEXO DIN√ÇMICO NO FUNDO (AMBIENT MODE) */
        .ambient-reflection {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            z-index: -1;
            filter: blur(80px) brightness(0.3);
            transition: all 0.5s ease;
            opacity: 0.7;
        }

        /* SE√á√ïES E CARROSSEL */
        .section-title { 
            margin: 20px 0; 
            font-size: 42px; 
            font-weight: 700; 
            font-family: 'Open Sans', sans-serif;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        .row-container { 
            display: flex; 
            gap: 15px; 
            overflow-x: auto; 
            overflow-y: hidden; 
            padding: 15px 0; 
            position: relative;
            scroll-behavior: smooth;
            scrollbar-width: none; /* Esconder scrollbar */
            -ms-overflow-style: none;
            scroll-snap-type: x mandatory;
        }
        .row-container::-webkit-scrollbar {
            display: none; /* Esconder scrollbar no Chrome/Safari */
        }
        .row-container::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50px;
            background: linear-gradient(to right, transparent, var(--bg-body));
            pointer-events: none;
            z-index: 1;
        }
        .capa-item {
            scroll-snap-align: start;
            flex-shrink: 0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .capa-item:focus {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 206, 68, 0.6);
            z-index: 10;
        }
        
        .capa-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .capa-item img.error {
            content: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4=');
        }
        
        /* Sess√µes com at√© 5 capas - ocupam tela inteira */
        .row-container.full-screen {
            gap: calc((100vw - 1000px) / 4); /* Distribuir 5 capas pela tela inteira */
            padding: 15px 40px; /* Mesmo padding do main */
            margin: 0 -40px; /* Compensar padding */
        }
        .row-container.full-screen .capa-item {
            width: calc((100vw - 160px) / 5); /* 5 capas por tela */
            height: calc((100vw - 160px) / 5 * 1.5); /* Propor√ß√£o 2:3 */
        }
        .row-container.full-screen .capa-item img {
            width: 100%;
            height: 100%;
        }
        
        /* Continuar Assistindo mant√©m padr√£o normal */
        .row-container.history .capa-item {
            width: 280px;
            height: 157.5px; /* 16:9 exact proportion */
            aspect-ratio: 16/9;
        }
        
        /* CAPAS */
        .capa-item { 
            width: 200px; 
            height: 300px; 
            position: relative; 
            cursor: pointer; 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0; /* Evitar encolhimento */
            scroll-snap-align: start;
        }
        .capa-item:focus { 
            transform: scale(1.08); 
            z-index: 10; 
            border: 3px solid white; 
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .capa-item img { 
            width: 100%; 
            height: 100%; 
            border-radius: 8px; 
            display: block; 
            object-fit: cover;
        }
        
        /* Rolagem vertical infinita para categorias */
        .category-page {
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            padding: 90px 40px 40px;
        }
        .category-page::-webkit-scrollbar {
            width: 8px;
        }
        .category-page::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .category-page::-webkit-scrollbar-thumb {
            background: var(--amarelo-pipoca);
            border-radius: 4px;
        }
        
        /* Capas 16:9 para Continuar Assistindo (mant√©m diferente) */
        .capa-item.history {
            width: 280px;
            height: 157.5px; /* 16:9 exact proportion */
            aspect-ratio: 16/9;
        }
        .capa-item.history img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        /* Barra de progresso externa */
        .progress-bar-external {
            position: absolute;
            bottom: 35px; /* Acima do footer */
            left: 8px;
            right: 8px;
            height: 6px;
            background: rgba(0,0,0,0.5);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar-internal {
            height: 100%;
            background: var(--amarelo-pipoca);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* NUMERA√á√ÉO TOP 4 */
        .num-top {
            position: absolute; left: -15px; bottom: 15px; font-size: 100px;
            font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 2px var(--amarelo-pipoca); z-index: 5;
        }

        .capa-footer { display: flex; justify-content: center; font-size: 13px; color: #ccc; margin-top: 8px; font-weight: bold; gap: 15px; }
        
        /* Badge NOVO para lan√ßamentos */
        .novo-badge {
            position: absolute; top: 10px; right: 10px; background: var(--amarelo-pipoca);
            color: black; font-weight: bold; font-size: 12px; padding: 5px 10px;
            border-radius: 5px; z-index: 10; text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* P√ÅGINA DE DETALHES */
        #page-details {
            position: fixed; 
            inset: 0; 
            background: #000; 
            z-index: 2000; 
            display: none;
            background-size: cover; 
            background-position: center;
        }
        .details-overlay { 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(to right, rgba(5, 7, 10, 0.95) 30%, rgba(5, 7, 10, 0.8) 60%, rgba(5, 7, 10, 0.6) 100%);
            display: flex; 
            align-items: center; 
            padding: 0;
            margin: 0;
        }
        .details-content {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            gap: 60px;
        }
        .details-poster {
            flex-shrink: 0;
            width: 400px;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .details-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .details-info {
            flex: 1;
            color: white;
        }
        .details-title {
            font-size: 48px;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
            margin-bottom: 20px;
            line-height: 1.1;
            font-family: 'Open Sans', sans-serif;
        }
        .details-meta {
            font-size: 18px;
            color: #ccc;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .details-description {
            font-size: 16px;
            line-height: 1.6;
            color: #ddd;
            margin-bottom: 40px;
            max-height: 200px;
            overflow-y: auto;
        }
        .details-actions {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-direction: column;
        }
        .episodes-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .episodes-container::-webkit-scrollbar {
            width: 6px;
        }
        .episodes-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        .episodes-container::-webkit-scrollbar-thumb {
            background: var(--amarelo-pipoca);
            border-radius: 3px;
        }
        .episode-btn {
            background: var(--amarelo-pipoca);
            border: none;
            padding: 8px 12px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
            color: black;
            font-size: 12px;
            text-transform: uppercase;
        }
        .episode-btn:hover {
            background: #b38f00;
            transform: translateY(-2px);
        }
        .episode-btn.active {
            background: #fff;
            color: black;
        }
        
        /* MENSAGEM DE PR√ìXIMO EPIS√ìDIO */
        .next-episode-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 40px 60px;
            border-radius: 12px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 2px solid #FFCE44;
            animation: slideInUp 0.5s ease-out;
        }
        
        .next-episode-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .next-episode-content img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #FFCE44;
        }
        
        .next-episode-text {
            text-align: center;
        }
        
        .next-episode-title {
            font-size: 32px;
            font-weight: bold;
            color: #FFCE44;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .next-episode-info {
            font-size: 24px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        
        .btn-voltar {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }
        .btn-voltar:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        .btn-assistir-dark {
            background: #b38f00;
            color: white;
            border: none;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }
        .btn-assistir-dark:hover {
            background: #997500;
            transform: translateY(-2px);
        }

        /* PLAYER */
        #player-screen { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; }
        video { width: 100%; height: 100%; }
        .exit-btn { 
            position: absolute; top: 30px; left: 30px; background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px); color: white; border: 1px solid white; padding: 10px 20px; 
            cursor: pointer; z-index: 3100; border-radius: 5px;
        }
        
        /* Footer de recomenda√ß√µes durante reprodu√ß√£o */
        .recommendations-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            padding: 20px;
            z-index: 3001;
            display: none;
        }
        .recommendations-content {
            display: flex;
            gap: 15px;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        .recommendation-item {
            width: 120px;
            height: 180px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }
        .recommendation-item:hover {
            transform: scale(1.05);
        }
        .recommendation-item img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
        }
        .recommendation-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
        }
        .recommendation-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.3);
        }
        .recommendation-progress-fill {
            height: 100%;
            background: var(--amarelo-pipoca);
            width: 0%;
            transition: width 1s linear;
        }

        /* Aclamado pela M√≠dia */
        .award-item {
            width: 200px;
            height: 300px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0;
        }
        .award-item:focus {
            transform: scale(1.08);
            z-index: 10;
            border: 3px solid white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .award-item img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: block;
            object-fit: cover;
        }
        .award-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 0 0 8px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .award-trophy {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .award-trophy::before {
            content: 'üèÜ';
            font-size: 16px;
        }
        .award-footer-text {
            font-size: 11px;
            color: white;
            text-align: center;
        }
        
        /* SISTEMA DE LIKE/DISLIKE */
        .like-dislike-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            z-index: 4000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 10px;
        }
        .like-dislike-content {
            background: var(--bg-body);
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            max-width: 400px;
        }
        .like-dislike-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        .like-dislike-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .like-dislike-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .like-btn {
            background: #4CAF50;
            color: white;
        }
        .like-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .dislike-btn {
            background: #f44336;
            color: white;
        }
        .dislike-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        .like-dislike-vote-info {
            font-size: 14px;
            color: #ccc;
            margin-top: 15px;
        }
        .vote-count {
            font-size: 24px;
            font-weight: bold;
            color: var(--amarelo-pipoca);
            margin-bottom: 10px;
        }
        .thank-you-message {
            font-size: 20px;
            color: #4CAF50;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            animation: fadeInScale 0.5s ease-out;
        }
        .smiley-happy {
            font-size: 48px;
            margin: 10px 0;
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80% { transform: translateY(0); }
            10% { transform: translateY(-10px); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(0); }
        }
        .channels-page {
            padding: 90px 40px 40px;
            height: 100vh;
            overflow-y: auto;
        }
        .channels-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .channel-category {
            margin-bottom: 40px;
        }
        .category-title {
            font-size: 28px;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        .channel-item {
            aspect-ratio: 16/9;
            background: #1a1a1a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .channel-item:focus {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.4);
            outline: 2px solid var(--amarelo-pipoca);
            outline-offset: 2px;
            z-index: 10;
        }
        .channel-item:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }
        .channel-logo {
            max-width: 80%;
            max-height: 60%;
            object-fit: contain;
        }
        .channel-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        .channel-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            text-align: center;
        }
        .channel-playing {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff4444;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        #search-box {
            position: fixed; top: 70px; left: var(--sidebar-w); right: 0; bottom: 0;
            background: var(--bg-body); z-index: 850; display: none; padding: 50px;
        }
        #input-busca {
            width: 100%; background: none; border: none; border-bottom: 3px solid var(--amarelo-pipoca);
            color: white; font-size: 40px; margin-bottom: 40px;
        }
        .search-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        .search-card {
            width: 200px;
            height: 300px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0;
        }
        .search-card:focus {
            transform: scale(1.08);
            z-index: 10;
            border: 3px solid white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .search-card img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: block;
            object-fit: cover;
        }
        .search-card-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 0 0 8px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-card-footer span {
            font-size: 12px;
            color: white;
        }
        
        /* Notifica√ß√µes e Lista */
        .notification-toast {
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .remove-from-list {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .remove-from-list:hover {
            background: rgba(255, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        /* Badges para se√ß√µes especiais */
        .mais-visto-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
        }
        .recomendacao-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
        }
        .recomendacoes-title {
            color: var(--amarelo-pipoca);
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        .capa-item.recomendacao {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .capa-item.recomendacao:hover {
            border-color: var(--amarelo-pipoca);
            transform: scale(1.05);
        }
        
        /* Bot√µes de salvar na lista */
        .save-to-list {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .save-to-list:hover {
            background: var(--amarelo-pipoca);
            transform: scale(1.1);
        }
        .save-to-list.in-list {
            background: rgba(255, 68, 68, 0.9);
        }
        .save-to-list.in-list:hover {
            background: rgba(255, 0, 0, 0.9);
        }
        
        /* Badges adicionais */
        .num-top {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--amarelo-pipoca);
            color: var(--bg-body);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            z-index: 10;
        }
        .novo-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
        }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<aside id="sidebar">
    <div class="logo">
        <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
            <rect width="60" height="60" rx="8" fill="#FFCE44"/>
            <path d="M15 20C15 18.9 15.9 18 17 18H43C44.1 18 45 18.9 45 20V25C45 26.1 44.1 27 43 27H17C15.9 27 15 26.1 15 25V20Z" fill="#05070A"/>
            <path d="M15 35C15 33.9 15.9 33 17 33H43C44.1 33 45 33.9 45 35V40C45 41.1 44.1 42 43 42H17C15.9 42 15 41.1 15 40V35Z" fill="#05070A"/>
            <circle cx="30" cy="30" r="8" fill="#05070A"/>
        </svg>
    </div>
    <nav class="nav-icons">
        <button class="icon-btn" onclick="renderHome()" tabindex="0" title="Home">
            <i class="fa-regular fa-house"></i>
        </button>
        <button class="icon-btn" onclick="loadChannels()" tabindex="0" title="Canais ao Vivo">
            <i class="fa-thin fa-tv-retro"></i>
        </button>
        <button class="icon-btn" onclick="loadLive('kids')" tabindex="0" title="Canais Kids">
            <i class="fa-light fa-tv-retro"></i>
        </button>
        <button class="icon-btn" onclick="loadContent('cinema', 'data/filmes.json')" tabindex="0" title="Cinema">
            <i class="fa-regular fa-projector"></i>
        </button>
        <button class="icon-btn" onclick="loadContent('filmes-kids', 'data/kids_filmes.json')" tabindex="0" title="Filmes Kids">
            <i class="fa-sharp fa-regular fa-projector"></i>
        </button>
        <button class="icon-btn" onclick="loadContent('series', 'data/series.json')" tabindex="0" title="S√©ries">
            <i class="fa-sharp fa-regular fa-clapperboard-play"></i>
        </button>
        <button class="icon-btn" onclick="loadContent('series-kids', 'data/kids_series.json')" tabindex="0" title="S√©ries Kids">
            <i class="fa-regular fa-clapperboard-play"></i>
        </button>
        <button class="icon-btn" onclick="loadMyList()" tabindex="0" title="Minha Lista">
            <i class="fa-solid fa-heart"></i>
        </button>
    </nav>
</aside>

<header id="topbar">
    <div id="contador-global">Estamos evoluindo: <span id="val-total">0</span></div>
    <div id="relogio-txt" style="font-size: 14px; opacity: 0.8;"></div>
</header>

<main id="main-app"></main>

<div id="search-box">
    <input type="text" id="input-busca" placeholder="O que vamos assistir?" oninput="searchRealTime(this.value)" onblur="handleSearchBlur()">
    <div id="search-results" class="search-results"></div>
</div>

<div id="page-details"></div>

<div id="player-screen">
    <button class="exit-btn" onclick="stopPlayer()">SAIR DO PLAYER</button>
    <video id="html5-video" controls autoplay></video>
    <div class="recommendations-footer" id="recommendations-footer">
        <div class="recommendations-content" id="recommendations-content">
            <!-- Recommendations will be inserted here -->
        </div>
    </div>
    <div class="like-dislike-overlay" id="like-dislike-overlay">
        <div class="like-dislike-content">
            <div class="like-dislike-title" id="like-dislike-title">Voc√™ gosta de sua escolha de hoje?</div>
            <div class="like-dislike-buttons">
                <button class="like-dislike-btn like-btn" onclick="submitLike(true)">üëç GOSTEI</button>
                <button class="like-dislike-btn dislike-btn" onclick="submitLike(false)">üëé N√ÉO GOSTEI</button>
            </div>
            <div class="like-dislike-vote-info">
                <div class="vote-count" id="vote-count">0 votos</div>
            </div>
            <div class="thank-you-message" id="thank-you-message" style="display: none;">
                <div class="smiley-happy">üòä</div>
                <div>Obrigado pelo seu voto!</div>
            </div>
        </div>
    </div>
</div>

<!-- Video.js e Plugins Essenciais -->
    <link href="https://vjs.zencdn.net/8.12.0/video-js.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/videojs-seek-buttons@2.2.1/dist/videojs-seek-buttons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/videojs-markers@0.5.0/dist/videojs-markers.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/videojs-text-track-settings@5.4.1/dist/videojs-text-track-settings.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/videojs-chromecast@1.0.0/dist/videojs-chromecast.css" rel="stylesheet">
    
    <script src="https://vjs.zencdn.net/8.12.0/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-hls@5.15.0/dist/videojs-contrib-hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-http-streaming@2.16.2/dist/videojs-http-streaming.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-vtt-thumbnails@0.0.13/dist/videojs-vtt-thumbnails.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-persist-volume@1.0.0/dist/videojs-persist-volume.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-seek-buttons@2.2.1/dist/videojs-seek-buttons.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-markers@0.5.0/dist/videojs-markers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-text-track-settings@5.4.1/dist/videojs-text-track-settings.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-chromecast@1.0.0/dist/videojs-chromecast.min.js"></script>
    <script src="https://togetherjs.com/togetherjs-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/annyang@2.6.1/dist/annyang.min.js"></script>

    <script>
    let masterData = [];
    let currentPlayer = null;
    let groupWatchSession = null;
    let voiceCommandsEnabled = false;

    // Sistema completo de Video.js com todos os plugins
    function initVideoJSPlayer(videoElement, source, options = {}) {
        // Destruir player anterior se existir
        if (currentPlayer) {
            currentPlayer.dispose();
        }

        // Configura√ß√µes padr√£o do Video.js
        const defaultOptions = {
            controls: true,
            responsive: true,
            fluid: true,
            autoplay: options.autoplay || false,
            preload: 'auto',
            poster: options.poster || '',
            html5: {
                hlsjsConfig: {
                    liveSyncDurationCount: 3,
                    liveMaxLatencyDurationCount: 10,
                    lowLatencyMode: true,
                    backBufferLength: 90
                }
            },
            plugins: {
                seekButtons: {
                    forward: 10,
                    back: 10
                },
                markers: {
                    markerTip: {
                        text: function(marker) {
                            return marker.text;
                        }
                    }
                },
                hotkeys: {
                    volumeStep: 0.1,
                    seekStep: 5,
                    enableModifiersForNumbers: false
                },
                chromecast: {
                    chromecastAppId: 'DEFAULT',
                    preloadWebComponents: true
                }
            }
        };

        // Mesclar op√ß√µes
        const playerOptions = Object.assign({}, defaultOptions, options);

        // Inicializar Video.js
        currentPlayer = videojs(videoElement, playerOptions);

        // Configurar LL-HLS para baixa lat√™ncia
        if (source.includes('.m3u8')) {
            currentPlayer.src({
                src: source,
                type: 'application/x-mpegURL',
                withCredentials: false
            });

            // Configurar HLS.js para low latency
            currentPlayer.ready(() => {
                const tech = currentPlayer.tech({ IWillNotUseThisInPlugins: true });
                if (tech && tech.vhs) {
                    tech.vhs.xhr.beforeRequest = function(options) {
                        // Adicionar headers CORS se necess√°rio
                        options.headers = options.headers || {};
                        options.headers['Access-Control-Allow-Origin'] = '*';
                        return options;
                    };
                }
            });
        } else {
            currentPlayer.src(source);
        }

        // Configurar multi-√°udio e legendas
        currentPlayer.ready(() => {
            // Adicionar faixas de √°udio se dispon√≠veis
            if (options.audioTracks) {
                options.audioTracks.forEach((track, index) => {
                    currentPlayer.audioTracks().addTrack(track);
                });
            }

            // Adicionar legendas se dispon√≠veis
            if (options.textTracks) {
                options.textTracks.forEach((track) => {
                    currentPlayer.addRemoteTextTrack(track, false);
                });
            }

            // Configurar thumbnails VTT
            if (options.vttThumbnails) {
                currentPlayer.vttThumbnails({
                    src: options.vttThumbnails
                });
            }

            // Configurar marcadores (Skip Intro/Recap)
            if (options.markers) {
                currentPlayer.markers(options.markers);
            }

            // Configurar GroupWatch (Together.js)
            if (options.groupWatch) {
                setupGroupWatch(options.groupWatch);
            }

            // Configurar comandos de voz
            if (options.voiceCommands) {
                setupVoiceCommands();
            }
        });

        // Event listeners
        currentPlayer.on('loadedmetadata', () => {
            console.log('Video carregado com sucesso');
        });

        currentPlayer.on('error', (error) => {
            console.error('Erro no v√≠deo:', error);
            handleVideoError(error);
        });

        currentPlayer.on('ended', () => {
            handleVideoEnded();
        });

        return currentPlayer;
    }

    // Configurar GroupWatch com Together.js
    function setupGroupWatch(sessionId) {
        if (typeof TogetherJS !== 'undefined') {
            TogetherJS.config_autoStart = false;
            TogetherJS.config_suppressJoinConfirmation = true;
            TogetherJS.config_siteName = "Paix√£oFlix GroupWatch";
            
            TogetherJS.on("ready", function () {
                groupWatchSession = sessionId;
                console.log('GroupWatch iniciado:', sessionId);
                
                // Sincronizar eventos do player
                setupGroupWatchSync();
            });
            
            TogetherJS.start();
        }
    }

    // Sincroniza√ß√£o GroupWatch
    function setupGroupWatchSync() {
        if (!currentPlayer) return;

        // Enviar eventos para outros usu√°rios
        currentPlayer.on('play', () => {
            TogetherJS.send({
                type: 'video-play',
                currentTime: currentPlayer.currentTime()
            });
        });

        currentPlayer.on('pause', () => {
            TogetherJS.send({
                type: 'video-pause',
                currentTime: currentPlayer.currentTime()
            });
        });

        currentPlayer.on('seeked', () => {
            TogetherJS.send({
                type: 'video-seek',
                currentTime: currentPlayer.currentTime()
            });
        });

        // Receber eventos de outros usu√°rios
        TogetherJS.on("message", function (msg) {
            if (!msg.sameUrl) return;
            
            switch (msg.type) {
                case 'video-play':
                    currentPlayer.currentTime(msg.currentTime);
                    currentPlayer.play();
                    break;
                case 'video-pause':
                    currentPlayer.currentTime(msg.currentTime);
                    currentPlayer.pause();
                    break;
                case 'video-seek':
                    currentPlayer.currentTime(msg.currentTime);
                    break;
            }
        });
    }

    // Configurar comandos de voz
    function setupVoiceCommands() {
        if (typeof annyang !== 'undefined') {
            const commands = {
                'play': () => currentPlayer && currentPlayer.play(),
                'pause': () => currentPlayer && currentPlayer.pause(),
                'stop': () => currentPlayer && currentPlayer.pause(),
                'mute': () => currentPlayer && currentPlayer.muted(true),
                'unmute': () => currentPlayer && currentPlayer.muted(false),
                'fullscreen': () => currentPlayer && currentPlayer.requestFullscreen(),
                'volume :level': (level) => {
                    if (currentPlayer) {
                        const volume = Math.max(0, Math.min(1, level / 100));
                        currentPlayer.volume(volume);
                    }
                },
                'seek :time': (time) => {
                    if (currentPlayer) {
                        const seconds = parseInt(time);
                        currentPlayer.currentTime(seconds);
                    }
                },
                'forward :seconds': (seconds) => {
                    if (currentPlayer) {
                        currentPlayer.currentTime(currentPlayer.currentTime() + parseInt(seconds));
                    }
                },
                'rewind :seconds': (seconds) => {
                    if (currentPlayer) {
                        currentPlayer.currentTime(currentPlayer.currentTime() - parseInt(seconds));
                    }
                }
            };

            annyang.addCommands(commands);
            annyang.setLanguage('pt-BR');
            
            // Iniciar comandos de voz
            annyang.start({
                autoRestart: true,
                continuous: false
            });
            
            voiceCommandsEnabled = true;
            console.log('Comandos de voz ativados');
        }
    }

    // Tratamento de erros de v√≠deo
    function handleVideoError(error) {
        const errorCode = currentPlayer.error().code;
        let errorMessage = 'Ocorreu um erro ao reproduzir o v√≠deo.';
        
        switch (errorCode) {
            case 1:
                errorMessage = 'Reprodu√ß√£o de v√≠deo interrompida.';
                break;
            case 2:
                errorMessage = 'Erro de rede ao carregar o v√≠deo.';
                break;
            case 3:
                errorMessage = 'V√≠deo corrompido ou formato n√£o suportado.';
                break;
            case 4:
                errorMessage = 'V√≠deo n√£o suportado ou formato inv√°lido.';
                break;
        }
        
        console.error(errorMessage, error);
        
        // Mostrar mensagem de erro amig√°vel
        if (currentPlayer) {
            const errorOverlay = currentPlayer.el().querySelector('.vjs-error-display');
            if (errorOverlay) {
                errorOverlay.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="color: #FFCE44;">${errorMessage}</h3>
                        <p style="margin-top: 10px;">Tente novamente mais tarde.</p>
                        <button onclick="location.reload()" style="
                            background: #FFCE44;
                            color: black;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            margin-top: 10px;
                        ">Recarregar</button>
                    </div>
                `;
            }
        }
    }

    // Lidar com fim do v√≠deo
    function handleVideoEnded() {
        console.log('V√≠deo finalizado');
        
        // Mostrar recomenda√ß√µes
        showRecommendations();
        
        // Salvar progresso
        saveWatchProgress();
        
        // Verificar pr√≥ximo epis√≥dio
        checkNextEpisode();
    }

    // Mostrar recomenda√ß√µes
    function showRecommendations() {
        // Implementar l√≥gica de recomenda√ß√µes
        console.log('Mostrando recomenda√ß√µes...');
    }

    // Salvar progresso
    function saveWatchProgress() {
        if (currentPlayer && currentContentId) {
            const progress = {
                contentId: currentContentId,
                currentTime: currentPlayer.currentTime(),
                duration: currentPlayer.duration(),
                timestamp: Date.now()
            };
            
            let history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
            const existingIndex = history.findIndex(item => item.contentId === currentContentId);
            
            if (existingIndex >= 0) {
                history[existingIndex] = progress;
            } else {
                history.unshift(progress);
            }
            
            localStorage.setItem('paixaoflix_history', JSON.stringify(history));
        }
    }

    // Verificar pr√≥ximo epis√≥dio
    function checkNextEpisode() {
        // Implementar l√≥gica de pr√≥ximo epis√≥dio
        console.log('Verificando pr√≥ximo epis√≥dio...');
    }

    // Configurar suporte para m√∫ltiplos m√©todos de entrada
    function setupInputHandlers() {
        // Prevenir comportamento padr√£o em touch events
        document.addEventListener('touchstart', function(e) {
            if (e.target.closest('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.closest('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn')) {
                e.preventDefault();
                // Disparar click programaticamente
                e.target.click();
            }
        }, { passive: false });
        
        // Suporte para controle remoto e teclado
        // --- EVENTOS DE NAVEGA√á√ÉO ---
        document.addEventListener('keydown', function(e) {
            const focusedElement = document.activeElement;
            const isFocusable = focusedElement && (
                focusedElement.classList.contains('capa-item') ||
                focusedElement.classList.contains('icon-btn') ||
                focusedElement.classList.contains('btn-3d') ||
                focusedElement.classList.contains('btn-voltar') ||
                focusedElement.classList.contains('btn-assistir-dark') ||
                focusedElement.classList.contains('episode-btn') ||
                focusedElement.classList.contains('exit-btn')
            );
            
            if (isFocusable) {
                // Prevenir comportamento padr√£o
                e.preventDefault();
                
                // Usar navega√ß√£o aprimorada
                if (e.key.startsWith('Arrow')) {
                    handleNavigationKey(e.key, focusedElement);
                } else if (e.key === 'Enter') {
                    focusedElement.click();
                } else if (e.key === 'Backspace') {
                    handleBackButton();
                }
            }
        });    
        // Melhorar scroll com mouse wheel em containers horizontais
        document.querySelectorAll('.row-container').forEach(container => {
            container.addEventListener('wheel', function(e) {
                if (e.deltaY !== 0) {
                    e.preventDefault();
                    container.scrollLeft += e.deltaY;
                }
            }, { passive: false });
        });
    }
    
    function navigateToElement(direction, currentElement) {
        if (!currentElement) {
            // Focar primeiro elemento naveg√°vel
            const firstElement = document.querySelector('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn');
            if (firstElement) firstElement.focus();
            return;
        }
        
        const allNavigableElements = Array.from(document.querySelectorAll('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn'));
        const currentIndex = allNavigableElements.indexOf(currentElement);
        
        if (currentIndex === -1) return;
        
        let nextIndex;
        if (direction === 'next') {
            nextIndex = (currentIndex + 1) % allNavigableElements.length;
        } else {
            nextIndex = currentIndex === 0 ? allNavigableElements.length - 1 : currentIndex - 1;
        }
        
        allNavigableElements[nextIndex].focus();
        
        // Garantir que o elemento esteja vis√≠vel
        allNavigableElements[nextIndex].scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'nearest'
        });
    }
    
    function handleBackButton() {
        const playerScreen = document.getElementById('player-screen');
        const detailsPage = document.getElementById('page-details');
        
        if (playerScreen.style.display === 'block') {
            stopPlayer();
        } else if (detailsPage.style.display === 'block') {
            detailsPage.style.display = 'none';
        } else {
            // Voltar para home se estiver em outra p√°gina
            renderHome();
        }
    }
    
    // Inicializar handlers quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', setupInputHandlers);

    // --- SISTEMA DE REL√ìGIO ---
    function clock() {
        const d = new Date();
        const fmt = d.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
        document.getElementById('relogio-txt').innerText = fmt.toUpperCase();
    }
    setInterval(clock, 1000);

    // --- CARREGAMENTO INICIAL ---
    const TMDB_API_KEY = 'b275ce8e1a6b3d5d879bb0907e4f56ad';
    const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
    const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w600_and_h900_face';
    
    async function loadData() {
        try {
            const res = await Promise.all([
                fetch('data/filmes.json').then(r => r.json()),
                fetch('data/series.json').then(r => r.json()),
                fetch('data/kids_filmes.json').then(r => r.json()),
                fetch('data/kids_series.json').then(r => r.json())
            ]);
            masterData = res.flat();
            document.getElementById('val-total').innerText = masterData.length;
            renderHome();
        } catch(e) { 
            console.error("Erro ao carregar banco de dados", e); 
            // Fallback para dados de exemplo se necess√°rio
            masterData = [
                // Filmes
                {
                    "titulo": "Oppenheimer",
                    "type": "filme",
                    "year": "2023",
                    "rating": "4.8",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/8Gxv8gSFCU0XGDykEGv7zR1n2uT.jpg",
                    "desc": "A hist√≥ria do cientista J. Robert Oppenheimer e seu papel no desenvolvimento da bomba at√¥mica.",
                    "genero": ["Drama", "Hist√≥ria"],
                    "url": "https://example.com/oppenheimer.mp4"
                },
                {
                    "titulo": "Barbie",
                    "type": "filme", 
                    "year": "2023",
                    "rating": "4.2",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/iuFYVIIxg9J8VlDJdLJP2qeu6yl.jpg",
                    "desc": "Barbie vive em Barbiel√¢ndia, mas √© expulsa por n√£o ser uma Barbie perfeita.",
                    "genero": ["Com√©dia", "Aventura"],
                    "url": "https://example.com/barbie.mp4"
                },
                {
                    "titulo": "Guardi√µes da Gal√°xia Vol. 3",
                    "type": "filme",
                    "year": "2023",
                    "rating": "4.5",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/r2J04Z24QFPObAl3YWHxQ2pT3Fo.jpg",
                    "desc": "Peter Quill e sua equipe devem proteger o universo.",
                    "genero": ["A√ß√£o", "Fic√ß√£o Cient√≠fica"],
                    "url": "https://example.com/guardians3.mp4"
                },
                {
                    "titulo": "Fast X",
                    "type": "filme",
                    "year": "2023",
                    "rating": "4.0",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/1iTT1hS1GyR75hl4H3JL7RqY4Ih.jpg",
                    "desc": "Dom Toretto e sua fam√≠lia enfrentam um novo inimigo.",
                    "genero": ["A√ß√£o", "Thriller"],
                    "url": "https://example.com/fastx.mp4"
                },
                {
                    "titulo": "Avatar: O Caminho da √Ågua",
                    "type": "filme",
                    "year": "2022",
                    "rating": "4.6",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/t6HI2RAzDclkgcAdrc5VDhVkH1W.jpg",
                    "desc": "Jake Sully e Ney'tiri protegem sua fam√≠lia e Pandora.",
                    "genero": ["A√ß√£o", "Fic√ß√£o Cient√≠fica"],
                    "url": "https://example.com/avatar2.mp4"
                },
                {
                    "titulo": "John Wick 4",
                    "type": "filme",
                    "year": "2023",
                    "rating": "4.4",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/vZloFAK7NmvMGKE7VkF4kAyJCJf.jpg",
                    "desc": "John Wick enfrenta sua maior batalha.",
                    "genero": ["A√ß√£o", "Crime"],
                    "url": "https://example.com/johnwick4.mp4"
                },
                // S√©ries
                {
                    "titulo": "The Last of Us",
                    "type": "serie",
                    "year": "2023",
                    "rating": "4.7",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/kdPMUMJzyMVP6RzrLgT2c8in4GQ.jpg",
                    "desc": "Em um mundo p√≥s-apocal√≠ptico, Joel e Ellie lutam para sobreviver.",
                    "genero": ["Drama", "A√ß√£o"],
                    "url": "https://example.com/lastofus.mp4"
                },
                {
                    "titulo": "Stranger Things",
                    "type": "serie",
                    "year": "2022",
                    "rating": "4.5",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/49WJfeN0t4a0N9yL6k9t267hAie.jpg",
                    "desc": "Os amigos de Hawkins enfrentam o Mundo Invertido.",
                    "genero": ["Fic√ß√£o Cient√≠fica", "Terror"],
                    "url": "https://example.com/strangerthings.mp4"
                },
                {
                    "titulo": "The Mandalorian",
                    "type": "serie",
                    "year": "2023",
                    "rating": "4.6",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/9yEFqGwcAFVwMzaxxl7qk8DPn9b.jpg",
                    "desc": "Um mandaloriano viaja pelos confins da gal√°xia.",
                    "genero": ["Aventura", "Fic√ß√£o Cient√≠fica"],
                    "url": "https://example.com/mandalorian.mp4"
                },
                // Kids
                {
                    "titulo": "Super Mario Bros",
                    "type": "filme",
                    "year": "2023",
                    "rating": "4.1",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/16DmUee2J2Q3Wb0uhVUaIXnLbxa.jpg",
                    "desc": "Mario e Luigi s√£o transportados para um mundo m√°gico.",
                    "genero": ["Anima√ß√£o", "Aventura"],
                    "url": "https://example.com/mario.mp4"
                },
                {
                    "titulo": "Minions",
                    "type": "filme",
                    "year": "2022",
                    "rating": "3.8",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/wKiOkZtu9dkhVlPW9pSUzsTnRky.jpg",
                    "desc": "Os minions procuram um novo mestre.",
                    "genero": ["Anima√ß√£o", "Com√©dia"],
                    "url": "https://example.com/minions.mp4"
                },
                {
                    "titulo": "Paw Patrol",
                    "type": "serie",
                    "year": "2023",
                    "rating": "4.0",
                    "poster": "https://image.tmdb.org/t/p/w600_and_h900_face/gPuLTuskbvyrvbUIpBl0qoa0c5G.jpg",
                    "desc": "Os filhotes resgatam Adventure Bay.",
                    "genero": ["Anima√ß√£o", "Aventura"],
                    "url": "https://example.com/pawpatrol.mp4"
                }
            ];
            renderHome();
        }
    }
    
    // Fun√ß√£o auxiliar para renderizar item com bot√£o de salvar
    function renderCapaItem(item, additionalClasses = '', additionalButtons = '') {
        const myList = JSON.parse(localStorage.getItem('paixaoflix_mylist') || '[]');
        const isInList = myList.find(listItem => listItem.titulo === item.titulo);
        
        return `
            <div class="capa-item ${additionalClasses}" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjIwIiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                <div class="capa-footer">
                    <span>${item.year}</span>
                    <span>‚òÖ${item.rating}</span>
                    <button class="save-to-list ${isInList ? 'in-list' : ''}" 
                            onclick='event.stopPropagation(); ${isInList ? 'removeFromList' : 'addToMyList'}(${JSON.stringify(item)})' 
                            title="${isInList ? 'Remover da lista' : 'Adicionar √† Minha Lista'}">
                        <i class="fa-solid ${isInList ? 'fa-heart' : 'fa-heart'}"></i>
                    </button>
                    ${additionalButtons}
                </div>
            </div>`;
    }
    
    // --- P√ÅGINA INICIAL COMPLETA ---
    function renderHome() {
        const app = document.getElementById('main-app');
        app.innerHTML = `
            <h2 class="section-title">Os queridinhos de agora</h2><div class="row-container full-screen" id="row-top4"></div>
            <h2 class="section-title">Continuar Assistindo</h2><div class="row-container history" id="row-history"></div>
            <h2 class="section-title">Paix√µes da Semana</h2><div class="row-container full-screen" id="row-lancamentos"></div>
            <h2 class="section-title">Cl√°ssicos</h2><div class="row-container full-screen" id="row-classicos"></div>
            <h2 class="section-title">Premiados pela M√≠dia</h2><div class="row-container full-screen" id="row-aclamados"></div>
            <h2 class="section-title">Mais Vistos em 2025</h2><div class="row-container full-screen" id="row-mais-vistos-2025"></div>
            <h2 class="section-title">Porque voc√™ assistiu</h2><div class="row-container full-screen" id="row-recomendacoes"></div>
        `;
        
        // Renderizar todas as se√ß√µes
        renderTop4();
        loadHistory();
        renderLancamentos();
        renderMaratonar();
        renderClassicos();
        renderAwardWinners();
        renderSabadoNoite();
        renderMaisVistos2025();
        renderRecomendacoesPersonalizadas();
    }
    
    function renderTop4() {
        const topContainer = document.getElementById('row-top4');
        if (!topContainer) return;
        
        // Pegar os 4 melhores conte√∫dos
        const top4 = masterData
            .sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating))
            .slice(0, 4);
        
        top4.forEach((item, i) => {
            topContainer.innerHTML += renderCapaItem(item, '', `<span class="num-top">${i+1}</span>`);
        });
    }
    
    function renderLancamentos() {
        const container = document.getElementById('row-lancamentos');
        if (!container) return;
        
        // Filtrar conte√∫dos mais recentes
        const lancamentos = masterData
            .filter(item => item.year >= "2022")
            .sort((a, b) => b.year - a.year)
            .slice(0, 10);
        
        lancamentos.forEach(item => {
            container.innerHTML += renderCapaItem(item, '', '<span class="novo-badge">NOVO</span>');
        });
    }
    
    function renderClassicos() {
        const container = document.getElementById('row-classicos');
        if (!container) return;
        
        // Filtrar cl√°ssicos (antes de 2020)
        const classicos = masterData
            .filter(item => item.year <= "2020")
            .slice(0, 10);
        
        classicos.forEach(item => {
            container.innerHTML += renderCapaItem(item);
        });
    }
    
    function renderAwardWinners() {
        const container = document.getElementById('row-aclamados');
        if (!container) return;
        
        // Filtrar conte√∫dos com rating alto
        const awardWinners = masterData
            .filter(item => parseFloat(item.rating) >= 4.5)
            .slice(0, 10);
        
        awardWinners.forEach(item => {
            container.innerHTML += renderCapaItem(item);
        });
    }
    
    function renderMaratonar() {
        const container = document.getElementById('row-maratonar');
        if (!container) return;
        
        // S√©ries para maratona
        const series = masterData
            .filter(item => item.type === 'serie')
            .slice(0, 10);
        
        series.forEach(item => {
            container.innerHTML += renderCapaItem(item);
        });
    }
    
    function renderSabadoNoite() {
        const container = document.getElementById('row-sabado');
        if (!container) return;
        
        // Conte√∫do leve para s√°bado
        const sabadoContent = masterData
            .filter(item => item.genero && item.genero.some(g => 
                g.includes('Com√©dia') || g.includes('Aventura') || g.includes('Anima√ß√£o')
            ))
            .slice(0, 10);
        
        sabadoContent.forEach(item => {
            container.innerHTML += renderCapaItem(item);
        });
    }
    
    async function initPaixaoFlix() {
        await loadData();
        setupInputHandlers();
        loadHeroContent();
        setTimeout(() => {
            setupNavigationGrid();
        }, 1000);
    }
    
    async function enrichWithTMDBData() {
        for(let item of masterData) {
            try {
                // Buscar por t√≠tulo no TMDB
                const searchType = item.type === 'serie' ? 'tv' : 'movie';
                const searchResponse = await fetch(`${TMDB_BASE_URL}/search/${searchType}?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(item.titulo)}&language=pt-BR`);
                const searchData = await searchResponse.json();
                
                if(searchData.results && searchData.results.length > 0) {
                    const result = searchData.results[0];
                    
                    // Atualizar poster se n√£o existir ou se o TMDB tiver melhor qualidade
                    if(!item.poster || item.poster.includes('placeholder')) {
                        item.poster = `${TMDB_IMAGE_BASE}${result.poster_path}`;
                    }
                    
                    // Atualizar descri√ß√£o se n√£o existir
                    if(!item.desc || item.desc.length < 50) {
                        item.desc = result.overview || item.desc;
                    }
                    
                    // Atualizar rating se n√£o existir
                    if(!item.rating || item.rating === '0') {
                        item.rating = (result.vote_average / 2).toFixed(1); // Converter de 10 para 5
                    }
                    
                    // Adicionar g√™neros do TMDB se n√£o existirem
                    if(!item.genero || item.genero.length === 0) {
                        const genresResponse = await fetch(`${TMDB_BASE_URL}/genre/${searchType}/list?api_key=${TMDB_API_KEY}&language=pt-BR`);
                        const genresData = await genresResponse.json();
                        
                        if(genresData.genres && result.genre_ids && result.genre_ids.length > 0) {
                            item.genero = result.genre_ids.map(id => {
                                const genre = genresData.genres.find(g => g.id === id);
                                return genre ? genre.name : 'Geral';
                            });
                        }
                    }
                    
                    // Adicionar dados adicionais do TMDB
                    item.tmdb_id = result.id;
                    item.backdrop = result.backdrop_path ? `https://image.tmdb.org/t/p/w1280${result.backdrop_path}` : item.poster;
                    
                    // Pequeno delay para n√£o sobrecarregar a API
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
        renderAwardWinners();
        renderSabadoNoite();
        renderMaisVistos2025();
        renderRecomendacoesPersonalizadas();
    }
    
    function renderMaisVistos2025() {
        const container = document.getElementById('row-mais-vistos-2025');
        if (!container) return;
        
        // Lista simulada dos mais vistos em 2025 (em um sistema real viria de analytics)
        const maisVistos2025 = [
            "Oppenheimer", "Barbie", "Guardi√µes da Gal√°xia Vol. 3", 
            "Fast X", "Super Mario Bros", "Avatar: O Caminho da √Ågua",
            "A Pequena Sereia", "John Wick 4", "Miss√£o Imposs√≠vel: Mortal Confiss√£o",
            "Five Nights at Freddy's", "The Last of Us"
        ];
        
        // Filtrar conte√∫dos que est√£o na lista dos mais vistos
        const filteredContent = masterData.filter(item => 
            maisVistos2025.some(title => 
                item.titulo.toLowerCase().includes(title.toLowerCase()) ||
                title.toLowerCase().includes(item.titulo.toLowerCase())
            )
        ).slice(0, 10); // Limitar a 10 itens
        
        if (filteredContent.length === 0) {
            container.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum conte√∫do encontrado</p>';
            return;
        }
        
        filteredContent.forEach(item => {
            container.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjIwIiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                    <div class="capa-footer">
                        <span>${item.year}</span>
                        <span>‚òÖ${item.rating}</span>
                        <span class="mais-visto-badge">üî• Mais Visto 2025</span>
                    </div>
                </div>`;
        });
    }
    
    function renderRecomendacoesPersonalizadas() {
        const container = document.getElementById('row-recomendacoes');
        if (!container) return;
        
        // Obter √∫ltimo conte√∫do assistido do hist√≥rico
        const history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        if (history.length === 0) {
            container.innerHTML = '<p style="color:#666; font-style:italic;">Assista a algo para receber recomenda√ß√µes personalizadas!</p>';
            return;
        }
        
        const lastWatched = history[0]; // Mais recente
        const lastWatchedItem = masterData.find(item => item.titulo === lastWatched.title);
        
        if (!lastWatchedItem) {
            container.innerHTML = '<p style="color:#666; font-style:italic;">Nenhuma recomenda√ß√£o dispon√≠vel</p>';
            return;
        }
        
        // Simular recomenda√ß√µes baseadas no √∫ltimo conte√∫do
        const recommendations = masterData.filter(item => {
            if (item.titulo === lastWatched.title) return false;
            
            // Recomendar baseado em g√™nero, tipo e rating similar
            const sameGenre = item.genero && lastWatchedItem.genero && 
                item.genero.some(g => lastWatchedItem.genero.includes(g));
            const sameType = item.type === lastWatchedItem.type;
            const similarRating = Math.abs(item.rating - lastWatchedItem.rating) <= 1.5;
            
            return (sameGenre || sameType) && similarRating;
        }).slice(0, 3); // Limitar a 3 recomenda√ß√µes
        
        if (recommendations.length === 0) {
            container.innerHTML = '<p style="color:#666; font-style:italic;">Nenhuma recomenda√ß√£o dispon√≠vel</p>';
            return;
        }
        
        // T√≠tulo da se√ß√£o
        container.innerHTML = `<h3 class="recomendacoes-title">Porque voc√™ assistiu "${lastWatched.title}"</h3>`;
        
        recommendations.forEach(item => {
            container.innerHTML += `
                <div class="capa-item recomendacao" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjIwIiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                    <div class="capa-footer">
                        <span>${item.year}</span>
                        <span>‚òÖ${item.rating}</span>
                        <span class="recomendacao-badge">‚ú® Recomendado</span>
                    </div>
                </div>`;
        });
    }
    
    function renderAwardWinners() {
        const container = document.getElementById('row-award-winners');
        if (!container) return;
        
        // Obter data atual para calcular rota√ß√£o
        const now = new Date();
        const dayOfMonth = now.getDate();
        const currentYear = now.getFullYear();
        
        // Calcular qual conte√∫do mostrar hoje (baseado no dia do m√™s)
        const rotationIndex = Math.floor((dayOfMonth - 1) / 7) % 10; // Rota√ß√£o de 10 conte√∫dos, 1 por dia
        
        // Filtrar conte√∫dos que ganharam pr√™mios (simulado - em um sistema real viria de uma API de pr√™mios)
        const awardWinners = masterData.filter(item => {
            // Simular que estes conte√∫dos ganharam pr√™mios
            const hasAward = item.titulo.includes('Oscar') || 
                           item.titulo.includes('Globo de Ouro') || 
                           item.titulo.includes('Emmy') || 
                           item.rating >= 9.0 ||
                           item.year >= 2020;
            return hasAward;
        });
        
        // Embaralhar e selecionar at√© 10 conte√∫dos
        const shuffled = [...awardWinners].sort(() => 0.5 - Math.random());
        const selectedWinners = shuffled.slice(0, 10);
        
        container.innerHTML = '';
        selectedWinners.forEach((item, index) => {
            const awardType = getAwardType(item);
            const awardYear = getAwardYear(item);
            
            container.innerHTML += `
                <div class="award-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" alt="${item.titulo}">
                    <div class="award-info">
                        <div class="award-trophy"></div>
                        <div class="award-footer-text">
                            <div>${awardType} ${awardYear}</div>
                            <div>${item.titulo}</div>
                        </div>
                    </div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal
        setupAwardWinnersInfiniteScroll();
    }
    
    function getAwardType(item) {
        if (item.titulo.includes('Oscar')) return 'Oscar';
        if (item.titulo.includes('Globo de Ouro')) return 'Globo de Ouro';
        if (item.titulo.includes('Emmy')) return 'Emmy';
        if (item.rating >= 9.0) return 'Nota 10';
        return 'Premiado';
    }
    
    function getAwardYear(item) {
        // Simular ano do pr√™mio baseado no ano do conte√∫do
        if (item.titulo.includes('2024')) return '2024';
        if (item.titulo.includes('2023')) return '2023';
        if (item.titulo.includes('2022')) return '2022';
        if (item.titulo.includes('2021')) return '2021';
        if (item.titulo.includes('2020')) return '2020';
        return item.year || '2024';
    }
    
    function setupAwardWinnersInfiniteScroll() {
        const container = document.getElementById('row-award-winners');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }

    function renderClassicos() {
        const classicosContainer = document.getElementById('row-classicos');
        classicosContainer.innerHTML = '';
        
        // Filtrar apenas conte√∫do da categoria "Cl√°ssicos"
        const classicos = masterData.filter(item => {
            const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
            return itemGenres.some(genre => genre.toLowerCase() === 'cl√°ssicos');
        });
        
        // Embaralhar e pegar 5 itens aleat√≥rios
        const shuffled = [...classicos].sort(() => 0.5 - Math.random());
        const selectedClassicos = shuffled.slice(0, 5);
        
        // Exibir os 5 cl√°ssicos selecionados
        selectedClassicos.forEach((item, i) => {
            classicosContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupClassicosInfiniteScroll();
    }
    
    function setupClassicosInfiniteScroll() {
        const container = document.getElementById('row-classicos');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function renderSabadoNoite() {
        const now = new Date();
        const dayOfWeek = now.getDay(); // 0 = Domingo, 6 = S√°bado
        const hour = now.getHours();
        const minute = now.getMinutes();
        const currentTime = hour * 60 + minute;
        
        // Verificar se √© s√°bado ap√≥s 17:55 ou domingo antes de 06:00
        const isSaturdayNight = (dayOfWeek === 6 && currentTime >= 17 * 60 + 55) || 
                               (dayOfWeek === 0 && currentTime < 6 * 60);
        
        if (!isSaturdayNight) {
            return; // N√£o mostrar a sess√£o
        }
        
        const container = document.getElementById('sabado-noite-container');
        container.innerHTML = `<h2 class="section-title">S√°bado a Noite Merece</h2><div class="row-container" id="row-sabado-noite"></div>`;
        
        const sabadoContainer = document.getElementById('row-sabado-noite');
        
        // Categorias espec√≠ficas para esta sess√£o
        const sabadoCategories = ['Romance', 'Com√©dia', 'Anima√ß√£o', 'Terror', 'Cl√°ssicos', 'Nacional', 'Kids', 'Suspense', 'S√©ries', 'Adulto'];
        const selectedContent = [];
        
        // Pegar um item de cada categoria
        sabadoCategories.forEach(category => {
            const categoryItems = masterData.filter(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                return itemGenres.some(genre => genre.toLowerCase() === category.toLowerCase());
            });
            
            if (categoryItems.length > 0) {
                // Selecionar item aleat√≥rio da categoria
                const randomIndex = Math.floor(Math.random() * categoryItems.length);
                selectedContent.push(categoryItems[randomIndex]);
            }
        });
        
        // Exibir os 10 itens selecionados
        selectedContent.forEach((item, i) => {
            sabadoContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupSabadoNoiteInfiniteScroll();
        
        // Configurar verifica√ß√£o peri√≥dica para esconder/mostrar a sess√£o
        setupSabadoNoiteTimer();
    }
    
    function setupSabadoNoiteInfiniteScroll() {
        const container = document.getElementById('row-sabado-noite');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function setupSabadoNoiteTimer() {
        // Verificar a cada minuto se deve mostrar ou esconder a sess√£o
        setInterval(() => {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = hour * 60 + minute;
            
            const isSaturdayNight = (dayOfWeek === 6 && currentTime >= 17 * 60 + 55) || 
                                   (dayOfWeek === 0 && currentTime < 6 * 60);
            
            const container = document.getElementById('sabado-noite-container');
            
            if (isSaturdayNight && !container.innerHTML) {
                renderSabadoNoite();
            } else if (!isSaturdayNight && container.innerHTML) {
                container.innerHTML = '';
            }
        }, 60000); // Verificar a cada minuto
    }
    
    function renderMaratonar() {
        const maratonarContainer = document.getElementById('row-maratonar');
        maratonarContainer.innerHTML = '';
        
        // Filtrar apenas s√©ries
        const allSeries = masterData.filter(item => item.type === 'serie');
        const kidsSeries = allSeries.filter(item => item.titulo.includes('kids') || item.genero.includes('Fam√≠lia') || item.genero.includes('Anima√ß√£o'));
        
        if(allSeries.length === 0) {
            maratonarContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhuma s√©rie encontrada</p>';
            return;
        }
        
        // Selecionar 2 s√©ries kids aleat√≥rias
        const selectedKidsSeries = [];
        const availableKidsSeries = [...kidsSeries];
        for(let i = 0; i < Math.min(2, availableKidsSeries.length); i++) {
            const randomIndex = Math.floor(Math.random() * availableKidsSeries.length);
            selectedKidsSeries.push(availableKidsSeries[randomIndex]);
            availableKidsSeries.splice(randomIndex, 1);
        }
        
        // Selecionar 3 s√©ries regulares aleat√≥rias
        const regularSeries = allSeries.filter(item => !selectedKidsSeries.includes(item));
        const selectedRegularSeries = [];
        const availableRegularSeries = [...regularSeries];
        for(let i = 0; i < Math.min(3, availableRegularSeries.length); i++) {
            const randomIndex = Math.floor(Math.random() * availableRegularSeries.length);
            selectedRegularSeries.push(availableRegularSeries[randomIndex]);
            availableRegularSeries.splice(randomIndex, 1);
        }
        
        // Combinar e exibir
        const selectedSeries = [...selectedKidsSeries, ...selectedRegularSeries];
        
        selectedSeries.forEach(item => {
            const generoText = Array.isArray(item.genero) ? item.genero[0] : (item.genero || 'Geral');
            
            maratonarContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupMaratonarInfiniteScroll();
    }
    
    function setupMaratonarInfiniteScroll() {
        const container = document.getElementById('row-maratonar');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function renderLancamentos() {
        const lancamentosContainer = document.getElementById('row-lancamentos');
        lancamentosContainer.innerHTML = '';
        
        // Filtrar conte√∫dos recentes (√∫ltimos 2 anos) ou com g√™nero "Lan√ßamento"
        const recentContent = masterData.filter(item => {
            const itemYear = parseInt(item.year);
            const currentYear = new Date().getFullYear();
            const isRecent = itemYear >= currentYear - 2;
            const isLancamentoGenre = Array.isArray(item.genero) ? 
                item.genero.some(g => g.includes('Lan√ßamento')) : 
                (item.genero || '').includes('Lan√ßamento');
            return isRecent || isLancamentoGenre;
        }).sort((a, b) => {
            // Ordenar por ano (mais recente primeiro)
            const yearA = parseInt(a.year) || 0;
            const yearB = parseInt(b.year) || 0;
            return yearB - yearA;
        });
        
        if(recentContent.length === 0) {
            lancamentosContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum lan√ßamento encontrado</p>';
            return;
        }
        
        // Embaralhar e pegar 5 itens aleat√≥rios
        const shuffled = [...recentContent].sort(() => 0.5 - Math.random());
        const selectedLancamentos = shuffled.slice(0, 5);
        
        // Exibir os 5 lan√ßamentos selecionados
        selectedLancamentos.forEach((item, i) => {
            lancamentosContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <span class="novo-badge">NOVO</span>
                    <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupLancamentosInfiniteScroll();
    }
    
    function setupLancamentosInfiniteScroll() {
        const container = document.getElementById('row-lancamentos');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }

    // --- CARREGAR CONTE√öDO (CINEMA/S√âRIES) ---
    async function loadContent(type, file) {
        toggleSearch(true);
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="category-page"><h2 class="section-title">Carregando...</h2></div>';
        const res = await fetch(file);
        const data = await res.json();

        if(type.includes('kids')) data.sort((a,b) => a.titulo.localeCompare(b.titulo));

        // Ordem fixa das categorias
        const categoryOrder = [
            'Lan√ßamento 2026', 'Lan√ßamento 2025', 'A√ß√£o', 'Aventura', 'Com√©dia', 
            'Drama', 'Nacional', 'Romance', 'Religioso', 'Fic√ß√£o', 'Anime', 
            'Anima√ß√£o', 'Fam√≠lia', 'Cl√°ssicos', 'Dorama', 'Suspense', 'Policial', 
            'Crime', 'Terror', 'Document√°rios', 'Faroeste', 'Musical', 'Adulto'
        ];

        // Organizar por g√™neros para filmes
        if(type.includes('movie')) {
            const genres = {};
            data.forEach(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                itemGenres.forEach(genre => {
                    // Excluir categoria Adulto para conte√∫do kids
                    if(type.includes('kids') && genre === 'Adulto') return;
                    
                    if(!genres[genre]) genres[genre] = [];
                    genres[genre].push(item);
                });
            });

            let html = '';
            // Usar ordem fixa, mostrar apenas categorias que existem
            categoryOrder.forEach(genre => {
                if(genres[genre]) {
                    html += `<h2 class="section-title">${genre.toUpperCase()}</h2><div class="row-container" id="grid-${genre.replace(/\s+/g, '-')}"></div>`;
                }
            });
            
            // Adicionar categorias n√£o mapeadas no final
            const unmappedGenres = Object.keys(genres).filter(genre => !categoryOrder.includes(genre));
            unmappedGenres.sort().forEach(genre => {
                html += `<h2 class="section-title">${genre.toUpperCase()}</h2><div class="row-container" id="grid-${genre.replace(/\s+/g, '-')}"></div>`;
            });
            
            app.innerHTML = `<div class="category-page">${html}</div>`;

            // Preencher os grids e configurar rolagem infinita
            setupInfiniteScroll(genres, categoryOrder, unmappedGenres);
        } else {
            // Para s√©ries, manter o grid √∫nico com rolagem vertical infinita
            app.innerHTML = `<div class="category-page"><h2 class="section-title">${type.toUpperCase()}</h2><div class="row-container" id="grid-view" style="flex-wrap: wrap; overflow-y: auto; overflow-x: hidden;"></div></div>`;
            const grid = document.getElementById('grid-view');
            data.forEach(item => {
                grid.innerHTML += `
                    <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                        <img src="${item.poster}">
                        <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                    </div>`;
            });
        }
    }
    
    function setupInfiniteScroll(genres, categoryOrder, unmappedGenres) {
        // Configurar rolagem infinita horizontal para cada categoria
        const allCategories = [...categoryOrder.filter(g => genres[g]), ...unmappedGenres];
        
        allCategories.forEach(genre => {
            const container = document.getElementById(`grid-${genre.replace(/\s+/g, '-')}`);
            if(container) {
                // Lazy loading: renderizar apenas 10 itens inicialmente
                const items = genres[genre];
                let currentIndex = 0;
                const itemsPerBatch = 10;
                
                function renderBatch() {
                    const batch = items.slice(currentIndex, currentIndex + itemsPerBatch);
                    batch.forEach(item => {
                        container.innerHTML += `
                            <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                                <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                                <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                            </div>`;
                    });
                    currentIndex += itemsPerBatch;
                    
                    // Adicionar indicador de p√°gina
                    updatePageIndicator(genre, Math.ceil(currentIndex / itemsPerBatch), Math.ceil(items.length / itemsPerBatch));
                }
                
                // Renderizar primeiro batch
                renderBatch();
                
                let isScrolling = false;
                
                // Rolagem infinita horizontal
                container.addEventListener('scroll', () => {
                    if(!isScrolling) {
                        const scrollLeft = container.scrollLeft;
                        const scrollWidth = container.scrollWidth;
                        const clientWidth = container.clientWidth;
                        
                        // Se chegou no final e ainda h√° itens para carregar
                        if(scrollLeft + clientWidth >= scrollWidth - 50 && currentIndex < items.length) {
                            isScrolling = true;
                            renderBatch();
                            
                            setTimeout(() => {
                                isScrolling = false;
                            }, 500);
                        } else if(scrollLeft + clientWidth >= scrollWidth - 50) {
                            // Se chegou no final, voltar ao in√≠cio suavemente
                            isScrolling = true;
                            container.scrollTo({
                                left: 0,
                                behavior: 'smooth'
                            });
                            
                            setTimeout(() => {
                                isScrolling = false;
                            }, 1000);
                        }
                    }
                });
            }
        });
    }
    
    function updatePageIndicator(genre, currentPage, totalPages) {
        // Remover indicador anterior se existir
        const existingIndicator = document.getElementById(`page-indicator-${genre}`);
        if (existingIndicator) {
            existingIndicator.remove();
        }
        
        // Adicionar novo indicador
        const container = document.getElementById(`grid-${genre.replace(/\s+/g, '-')}`);
        if (container && totalPages > 1) {
            const indicator = document.createElement('div');
            indicator.id = `page-indicator-${genre}`;
            indicator.className = 'page-indicator';
            indicator.textContent = `${currentPage} / ${totalPages}`;
            indicator.style.cssText = `
                position: absolute;
                bottom: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.8);
                color: #FFCE44;
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                z-index: 1000;
            `;
            container.parentElement.style.position = 'relative';
            container.parentElement.appendChild(indicator);
        }
    }

    // --- P√ÅGINA DE DETALHES (ARCHIVE INTEGRADO) ---
    async function openInfo(item) {
        const p = document.getElementById('page-details');
        p.style.display = 'block';
        // Usar backdrop do TMDB se dispon√≠vel, sen√£o usar poster
        p.style.backgroundImage = `url(${item.backdrop || item.poster})`;
        
        let actions = `<button class="btn-assistir-dark" onclick="startPlay('${item.url || ''}', '${item.titulo}')">ASSISTIR AGORA</button>`;
        
        if(item.type === 'serie' && item.identificador_archive) {
            actions = `<div id="eps-box">Buscando epis√≥dios no Archive.org...</div>`;
            getArchiveEps(item.identificador_archive);
        } else if(item.type === 'serie' && !item.identificador_archive) {
            actions = `<p style="color:#ff6b6b;">Identificador do Archive.org n√£o encontrado</p>`;
        }
        
        // Formatar g√™neros para exibi√ß√£o
        const generoText = Array.isArray(item.genero) ? item.genero.join(' | ') : (item.genero || 'Geral');

        // Gerar ID √∫nico para o conte√∫do
        const contentId = item.titulo.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();

        p.innerHTML = `
            <div class="details-overlay">
                <div class="details-content">
                    <div class="details-poster">
                        <img src="${item.poster}" alt="${item.titulo}">
                    </div>
                    <div class="details-info">
                        <h1 class="details-title">${item.titulo}</h1>
                        <div class="vertical-line"></div>
                        <div class="details-meta">
                            <span>${item.year}</span>
                            <span>‚òÖ ${item.rating}</span>
                            <span>${generoText}</span>
                        </div>
                        <div class="details-description">${item.desc || 'Sem descri√ß√£o dispon√≠vel'}</div>
                        <div class="details-actions">
                            ${actions}
                            <button class="btn-voltar" onclick="document.getElementById('page-details').style.display='none'">VOLTAR</button>
                        </div>
                        <div class="vote-info">üëç 0 | üéé 0</div>
                    </div>
                </div>
            </div>`;
        
        // Adicionar ID do conte√∫do ao elemento
        const detailsContent = p.querySelector('.details-content');
        if (detailsContent) {
            detailsContent.dataset.contentId = contentId;
        }
        
        // Mostrar sistema de like/dislike se n√£o for canal ao vivo
        if (item.type !== 'live_channel') {
            showLikeDislikeOverlay(contentId, item.titulo);
        }
        
        // Atualizar informa√ß√µes de votos
        updateVoteDisplay();
    }

    async function getArchiveEps(id) {
        try {
            const res = await fetch(`https://archive.org/metadata/${id}`);
            const data = await res.json();
            
            if(data.files && data.files.length > 0) {
                const vids = data.files.filter(f => f.name.endsWith('.mp4') || f.name.endsWith('.mkv')).sort((a, b) => a.name.localeCompare(b.name));
                
                if(vids.length > 0) {
                    let h = '<div class="episodes-container">';
                    vids.forEach((v, i) => {
                        const url = `https://archive.org/download/${id}/${v.name}`;
                        const epNumber = String(i + 1).padStart(2, '0');
                        h += `<button class="episode-btn" onclick="playEpisode('${url}', '${v.name}', ${i})">EP. ${epNumber}</button>`;
                    });
                    h += '</div>';
                    document.getElementById('eps-box').innerHTML = h;
                    
                    // Configurar auto-pr√≥ximo epis√≥dio
                    setupAutoNextEpisode(vids, id);
                } else {
                    document.getElementById('eps-box').innerHTML = '<p style="color:#ccc;">Nenhum epis√≥dio encontrado no Archive.org</p>';
                }
            } else {
                document.getElementById('eps-box').innerHTML = '<p style="color:#ccc;">S√©rie n√£o encontrada no Archive.org</p>';
            }
        } catch(e) {
            console.error("Erro ao buscar epis√≥dios:", e);
            document.getElementById('eps-box').innerHTML = '<p style="color:#ff6b6b;">Erro ao carregar epis√≥dios do Archive.org</p>';
        }
    }
    
    function setupAutoNextEpisode(episodes, seriesId) {
        let currentEpisodeIndex = -1;
        
        // Adicionar evento de tempo para mostrar mensagem de pr√≥ximo epis√≥dio
        const video = document.getElementById('html5-video');
        
        video.addEventListener('timeupdate', () => {
            const duration = video.duration;
            const currentTime = video.currentTime;
            const timeRemaining = duration - currentTime;
            
            // Mostrar mensagem quando faltar 30 segundos
            if(timeRemaining <= 30 && timeRemaining > 0) {
                showNextEpisodeMessage(episodes, currentEpisodeIndex);
            } else {
                hideNextEpisodeMessage();
            }
        });
        
        video.addEventListener('ended', () => {
            // Tocar pr√≥ximo epis√≥dio automaticamente
            if(currentEpisodeIndex < episodes.length - 1) {
                const nextEpisode = episodes[currentEpisodeIndex + 1];
                const nextUrl = `https://archive.org/download/${seriesId}/${nextEpisode.name}`;
                const nextEpNumber = String(currentEpisodeIndex + 2).padStart(2, '0');
                
                // Mostrar mensagem de transi√ß√£o
                showTransitionMessage(`Iniciando Ep. ${nextEpNumber} automaticamente...`);
                
                setTimeout(() => {
                    playEpisode(nextUrl, nextEpisode.name, currentEpisodeIndex + 1);
                }, 2000);
            }
        });
        
        // Atualizar √≠ndice do epis√≥dio atual
        window.playEpisode = function(url, episodeName, index) {
            currentEpisodeIndex = index;
            startPlay(url, episodeName);
            
            // Marcar bot√£o atual
            document.querySelectorAll('.episode-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // Rolar para o epis√≥dio atual na lista
            const activeBtn = document.querySelector('.episode-btn.active');
            if(activeBtn) {
                activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        };
    }
    
    function showNextEpisodeMessage(episodes, currentIndex) {
        if(currentIndex < episodes.length - 1) {
            const nextEpNumber = String(currentIndex + 2).padStart(2, '0');
            const message = document.getElementById('next-episode-message') || createNextEpisodeMessage();
            
            // Countdown regressivo de 30 segundos
            let countdown = 30;
            
            function updateCountdown() {
                if (countdown > 0) {
                    message.innerHTML = `
                        <div class="next-episode-content">
                            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="Pr√≥ximo">
                            <div class="next-episode-text">
                                <div class="next-episode-title">PR√ìXIMO EPIS√ìDIO</div>
                                <div class="next-episode-info">Ep. ${nextEpNumber} em ${countdown}s</div>
                            </div>
                        </div>
                    `;
                    countdown--;
                } else {
                    message.style.display = 'none';
                }
            }
            
            // Iniciar countdown
            updateCountdown();
            const countdownInterval = setInterval(() => {
                updateCountdown();
            }, 1000);
            
            // Limpar interval quando a mensagem for escondida
            message.dataset.countdownInterval = countdownInterval;
            
            message.style.display = 'flex';
        }
    }
    
    function hideNextEpisodeMessage() {
        const message = document.getElementById('next-episode-message');
        if(message) {
            message.style.display = 'none';
            // Limpar interval de countdown se existir
            if (message.dataset.countdownInterval) {
                clearInterval(message.dataset.countdownInterval);
                delete message.dataset.countdownInterval;
            }
        }
    }
    
    function showTransitionMessage(text) {
        const message = document.getElementById('next-episode-message') || createNextEpisodeMessage();
        message.innerHTML = `<span>${text}</span>`;
        message.style.display = 'flex';
        
        setTimeout(() => {
            message.style.display = 'none';
        }, 3000);
    }
    
    function createNextEpisodeMessage() {
        const message = document.createElement('div');
        message.id = 'next-episode-message';
        message.className = 'next-episode-message';
        document.body.appendChild(message);
        return message;
    }

    // --- SISTEMA DE LIKE/DISLIKE ---
            feedbackElement.textContent = feedback;
            feedbackElement.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 48px; color: ' + (liked ? '#4CAF50' : '#f44336') + '; z-index: 5000;';
            document.querySelector('.like-dislike-content').appendChild(feedbackElement);
            
            setTimeout(() => {
                feedbackElement.remove();
            }, 1000);
            
        } else if (currentVoteStep === 2) {
            // Segunda pergunta - sobre a experi√™ncia
            const experienceVote = liked;
            
            // Verificar se usu√°rio j√° votou (limite de 2 votos por conte√∫do)
            const hasVoted = userVotes[currentContentId] && 
                               (userVotes[currentContentId].likes > 0 || userVotes[currentContentId].dislikes > 0);
            
            if (!hasVoted) {
                // Atualizar votos
                if (!userVotes[currentContentId]) {
                    userVotes[currentContentId] = { 
                        likes: 0, 
                        dislikes: 0,
                        choiceVote: firstVoteAnswer,
                        experienceVote: experienceVote
                    };
                }
                
                if (firstVoteAnswer) {
                    userVotes[currentContentId].likes++;
                } else {
                    userVotes[currentContentId].dislikes++;
                }
                
                // Salvar no localStorage
                localStorage.setItem('paixaoflix_votes', JSON.stringify(userVotes));
                
                // Atualizar interface
                updateVoteDisplay();
                
                // Mostrar mensagem de agradecimento
                showThankYouMessage();
                
                // Prevenir m√∫ltiplos votos
                setTimeout(() => {
                    const overlay = document.getElementById('like-dislike-overlay');
                    overlay.style.display = 'none';
                }, 2000);
            } else {
                // Usu√°rio j√° votou, mostrar mensagem
                showThankYouMessage();
                setTimeout(() => {
                    const overlay = document.getElementById('like-dislike-overlay');
                    overlay.style.display = 'none';
                }, 2000);
            }
        }
    }
    
    function showThankYouMessage() {
        const thankYouMessage = document.getElementById('thank-you-message');
        if (thankYouMessage) {
            thankYouMessage.style.display = 'block';
            
            // Esconder ap√≥s 3 segundos
            setTimeout(() => {
                thankYouMessage.style.display = 'none';
            }, 3000);
        }
    }
    
    function updateVoteDisplay() {
        if (!currentContentId) return;
        
        const votes = userVotes[currentContentId] || { likes: 0, dislikes: 0 };
        const voteCount = document.getElementById('vote-count');
        const totalVotes = votes.likes + votes.dislikes;
        
        voteCount.textContent = `${totalVotes} votos`;
        
        // Atualizar detalhes do conte√∫do com votos
        const contentElement = document.querySelector(`[data-content-id="${currentContentId}"]`);
        if (contentElement) {
            const voteInfo = contentElement.querySelector('.vote-info');
            if (voteInfo) {
                // Mostrar ambos os votos se dispon√≠veis
                let voteText = `üëç ${votes.likes} | üéé ${votes.dislikes}`;
                
                // Adicionar informa√ß√µes detalhadas se dispon√≠veis
                if (votes.choiceVote !== undefined && votes.experienceVote !== undefined) {
                    const choiceText = votes.choiceVote ? 'Gostou' : 'N√£o gostou';
                    const experienceText = votes.experienceVote ? 'Boa experi√™ncia' : 'Experi√™ncia ruim';
                    voteText += ` (${choiceText} | ${experienceText})`;
                }
                
                voteInfo.textContent = voteText;
            }
        }
    }
    
    function addVoteInfoToContent() {
        // Adicionar informa√ß√£o de votos na p√°gina de detalhes
        const allContentElements = document.querySelectorAll('[data-content-id]');
        
        allContentElements.forEach(element => {
            const contentId = element.dataset.contentId;
            const votes = userVotes[contentId] || { likes: 0, dislikes: 0 };
            const voteInfo = element.querySelector('.vote-info');
            
            if (!voteInfo) {
                const voteInfoDiv = document.createElement('div');
                voteInfoDiv.className = 'vote-info';
                
                // Mostrar ambos os votos se dispon√≠veis
                let voteText = `üëç ${votes.likes} | üéé ${votes.dislikes}`;
                
                // Adicionar informa√ß√µes detalhadas se dispon√≠veis
                if (votes.choiceVote !== undefined && votes.experienceVote !== undefined) {
                    const choiceText = votes.choiceVote ? 'Gostou' : 'N√£o gostou';
                    const experienceText = votes.experienceVote ? 'Boa experi√™ncia' : 'Experi√™ncia ruim';
                    voteText += ` (${choiceText} | ${experienceText})`;
                }
                
                voteInfoDiv.textContent = voteText;
                voteInfoDiv.style.cssText = 'position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px;';
                element.appendChild(voteInfoDiv);
            }
        });
    }
    let currentVideoTitle = '';
    let progressInterval;
    let recommendationsTimer;
    let currentRecommendations = [];
    
    function startPlay(url, poster, title, isLive = false, episodes = [], currentIndex = 0) {
        currentContentId = title;
        currentEpisodes = episodes;
        currentEpisodeIndex = currentIndex;
        
        // Esconder voting overlay se estiver vis√≠vel
        const overlay = document.getElementById('like-dislike-overlay');
        if(overlay) overlay.style.display = 'none';
        
        // Esconder mensagem de pr√≥ximo epis√≥dio
        hideNextEpisodeMessage();
        
        // Mostrar player
        const playerScreen = document.getElementById('player-screen');
        playerScreen.style.display = 'flex';
        
        // Criar elemento de v√≠deo com classe Video.js padr√£o
        playerScreen.innerHTML = `
            <video 
                id="paixaoflix-player" 
                class="video-js vjs-default-skin vjs-big-play-centered" 
                controls 
                preload="auto" 
                poster="${poster}"
                data-setup='{"fluid": true, "responsive": true}'>
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a web browser that
                    <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                </p>
            </video>
            <button class="exit-btn" onclick="stopPlayer()">‚úï SAIR</button>
        `;
        
        // Configurar op√ß√µes do player
        const playerOptions = {
            autoplay: true,
            poster: poster,
            controls: true,
            responsive: true,
            fluid: true,
            playbackRates: [0.5, 1, 1.25, 1.5, 2],
            plugins: {
                hotkeys: {
                    volumeStep: 0.1,
                    seekStep: 5,
                    enableModifiersForNumbers: false
                }
            }
        };
        
        // Adicionar configura√ß√µes espec√≠ficas para conte√∫do ao vivo
        if (isLive) {
            playerOptions.liveui = true;
            playerOptions.plugins.liveTracker = true;
        } else {
            // Adicionar marcadores para Skip Intro/Recap em conte√∫do n√£o ao vivo
            playerOptions.plugins.markers = {
                markers: [
                    { time: 0, text: "In√≠cio" },
                    // Adicionar marcadores din√¢micos baseados no conte√∫do
                    ...(episodes && episodes[currentIndex] ? [
                        { time: 90, text: "Skip Intro" },
                        { time: episodes[currentIndex].duration - 60, text: "Pr√≥ximo Epis√≥dio" }
                    ] : [])
                ]
            };
            
            // Adicionar comandos de voz
            playerOptions.voiceCommands = true;
            
            // Adicionar GroupWatch se dispon√≠vel
            if (window.location.hash.includes('groupwatch')) {
                playerOptions.groupWatch = window.location.hash.replace('#groupwatch=', '');
            }
        }
        
        // Inicializar player Video.js completo com skin City
        const player = initVideoJSPlayer('paixaoflix-player', url, playerOptions);
        
        // Configurar eventos espec√≠ficos
        if (!isLive && episodes && episodes.length > 1) {
            // Configurar navega√ß√£o entre epis√≥dios
            setupEpisodeNavigation(player, episodes, currentIndex);
        }
        
        // Salvar no hist√≥rico
        saveHistory(title, url, poster);
        
        // Focar no player
        setTimeout(() => {
            player.focus();
        }, 100);
        
        // Configurar navega√ß√£o por teclado no player
        setupPlayerKeyboardControls(player);
    }

    function stopPlayer() {
        const v = document.getElementById('html5-video');
        if(v.currentTime > 0) {
            updateWatchTime(currentVideoTitle, v.currentTime);
        }
        v.pause();
        document.getElementById('player-screen').style.display = 'none';
        document.getElementById('recommendations-footer').style.display = 'none';
        clearInterval(progressInterval);
        
        // Limpar timer de recomenda√ß√µes
        if(recommendationsTimer) {
            clearInterval(recommendationsTimer);
        }
    }
    
    function updateWatchTime(title, currentTime) {
        let history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const itemIndex = history.findIndex(item => item.title === title);
        
        if(itemIndex !== -1) {
            history[itemIndex].watchedTime = Math.floor(currentTime);
            localStorage.setItem('paixaoflix_history', JSON.stringify(history));
        }
    }
    
    function startRecommendationsSystem() {
        // Mostrar recomenda√ß√µes ap√≥s 30 segundos
        setTimeout(() => {
            showRecommendations();
        }, 30000);
        
        // Atualizar timer a cada segundo
        recommendationsTimer = setInterval(() => {
            updateRecommendationsTimer();
        }, 1000);
    }
    
    function showRecommendations() {
        const footer = document.getElementById('recommendations-footer');
        const content = document.getElementById('recommendations-content');
        
        // Obter conte√∫do mais assistido
        const mostWatched = getMostWatchedContent();
        currentRecommendations = getRecommendationsForUser(mostWatched);
        
        if(currentRecommendations.length === 0) return;
        
        // Mostrar apenas 3 recomenda√ß√µes
        const top3 = currentRecommendations.slice(0, 3);
        
        content.innerHTML = '';
        top3.forEach((item, index) => {
            content.innerHTML += `
                <div class="recommendation-item" onclick="playRecommendation('${item.url}', '${item.titulo}')">
                    <img src="${item.poster}" alt="${item.titulo}">
                    <div class="recommendation-progress">
                        <div class="recommendation-progress-fill" id="progress-${index}"></div>
                    </div>
                    ${index === 0 ? `<div class="recommendation-timer" id="recommendation-timer">Faltam 3:00</div>` : ''}
                </div>`;
        });
        
        footer.style.display = 'block';
        updateRecommendationsTimer();
    }
    
    function getMostWatchedContent() {
        const history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const watchCount = {};
        
        history.forEach(item => {
            watchCount[item.title] = (watchCount[item.title] || 0) + 1;
        });
        
        // Retornar conte√∫do mais assistido
        const sorted = Object.entries(watchCount)
            .sort(([,a], [,b]) => b - a)
            .map(([title]) => title);
        
        return sorted[0] || '';
    }
    
    function getRecommendationsForUser(mostWatchedTitle) {
        if(!mostWatchedTitle) {
            // Se n√£o h√° hist√≥rico, recomendar conte√∫do popular
            return [...masterData]
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
        }
        
        // Encontrar conte√∫do mais assistido
        const mostWatchedItem = masterData.find(item => item.titulo === mostWatchedTitle);
        if(!mostWatchedItem) return [];
        
        // Obter g√™neros do conte√∫do mais assistido
        const preferredGenres = Array.isArray(mostWatchedItem.genero) ? 
            mostWatchedItem.genero : 
            [mostWatchedItem.genero || 'Geral'];
        
        // Filtrar conte√∫do similar
        const similar = masterData
            .filter(item => item.titulo !== mostWatchedTitle)
            .filter(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                return itemGenres.some(genre => preferredGenres.includes(genre));
            })
            .sort(() => 0.5 - Math.random());
        
        return similar.slice(0, 3);
    }
    
    function playRecommendation(url, title) {
        const v = document.getElementById('html5-video');
        v.pause();
        startPlay(url, title);
    }
    
    function updateRecommendationsTimer() {
        const v = document.getElementById('html5-video');
        if(!v.duration) return;
        
        const timeRemaining = v.duration - v.currentTime;
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = Math.floor(timeRemaining % 60);
        
        // Atualizar timer na primeira recomenda√ß√£o
        const timerElement = document.querySelector('.recommendation-timer');
        if(timerElement && minutes < 3) {
            timerElement.textContent = `Faltam ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Atualizar barras de progresso
        currentRecommendations.forEach((item, index) => {
            const progressBar = document.getElementById(`progress-${index}`);
            if(progressBar) {
                const progress = ((v.duration - timeRemaining) / v.duration) * 100;
                progressBar.style.width = `${progress}%`;
            }
        });
    }

    // --- CANAIS AO VIVO ---
    let currentChannel = null;
    let currentChannelIndex = 0;
    
    function loadMyList() {
        toggleSearch(true);
        
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="category-page"><h2 class="section-title">Minha Lista</h2><div class="row-container full-screen" id="row-minha-lista"></div></div>';
        
        // Carregar itens salvos na lista
        const myList = JSON.parse(localStorage.getItem('paixaoflix_mylist') || '[]');
        const container = document.getElementById('row-minha-lista');
        
        if (myList.length === 0) {
            container.innerHTML = '<p style="color:#666; font-style:italic; text-align:center; margin-top:50px;">Sua lista est√° vazia. Adicione conte√∫dos para assistir mais tarde!</p>';
            return;
        }
        
        myList.forEach(item => {
            container.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjIwIiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                    <div class="capa-footer">
                        <span>${item.year}</span>
                        <span>‚òÖ${item.rating}</span>
                        <button class="remove-from-list" onclick='removeFromList("${item.titulo}")' title="Remover da lista">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>`;
        });
    }
    
    function removeFromList(title) {
        let myList = JSON.parse(localStorage.getItem('paixaoflix_mylist') || '[]');
        myList = myList.filter(item => item.titulo !== title);
        localStorage.setItem('paixaoflix_mylist', JSON.stringify(myList));
        loadMyList(); // Recarregar a lista
    }
    
    function addToMyList(item) {
        let myList = JSON.parse(localStorage.getItem('paixaoflix_mylist') || '[]');
        
        // Verificar se item j√° est√° na lista
        if (myList.find(listItem => listItem.titulo === item.titulo)) {
            showNotification('Item j√° est√° na sua lista!');
            return;
        }
        
        myList.push(item);
        localStorage.setItem('paixaoflix_mylist', JSON.stringify(myList));
        showNotification('Adicionado √† Minha Lista!');
    }
    
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification-toast';
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed; top: 20px; right: 20px; background: var(--amarelo-pipoca); 
            color: var(--bg-body); padding: 15px 20px; border-radius: 8px; 
            font-weight: bold; z-index: 10000; animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
    
    function loadChannels() {
        toggleSearch(true); // Fechar busca se estiver aberta
        
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="channels-page" id="channels-container"></div>';
        
        // Carregar canais do arquivo M3U
        loadChannelsFromM3U('data/ativa_canais.m3u');
        setupChannelsNavigation();
    }
    
    function loadLive(categoryFile) {
        toggleSearch(true);
        
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="channels-page" id="channels-container"></div>';
        
        // Carregar canais kids do arquivo M3U
        loadChannelsFromM3U('data/ativa_kids_canais.m3u', true); // true para canais kids
        setupChannelsNavigation();
    }
    
    function loadChannelsFromM3U(m3uFile, isKids = false) {
        fetch(m3uFile)
            .then(response => response.text())
            .then(data => {
                const channels = parseM3U(data);
                renderChannelsList(channels);
            })
            .catch(error => {
                console.error('Erro ao carregar canais:', error);
                // Fallback para canais de exemplo
                let exampleChannels;
                
                if (isKids) {
                    // Canais kids espec√≠ficos
                    exampleChannels = [
                        {name: "Cartoon Network", url: "https://example.com/cartoon.m3u8", logo: "https://via.placeholder.com/150x150/ff6600/ffffff?text=CARTOON"},
                        {name: "Nickelodeon", url: "https://example.com/nick.m3u8", logo: "https://via.placeholder.com/150x150/ff6600/ffffff?text=NICK"},
                        {name: "Discovery Kids", url: "https://example.com/discoverykids.m3u8", logo: "https://via.placeholder.com/150x150/00cccc/ffffff?text=DKIDS"},
                        {name: "Disney Channel", url: "https://example.com/disneychannel.m3u8", logo: "https://via.placeholder.com/150x150/0066ff/ffffff?text=DISNEY"},
                        {name: "Gloob", url: "https://example.com/gloob.m3u8", logo: "https://via.placeholder.com/150x150/ff6600/ffffff?text=GLOOB"},
                        {name: "Baby TV", url: "https://example.com/babytv.m3u8", logo: "https://via.placeholder.com/150x150/ffcc00/000000?text=BABY"},
                        {name: "Pajamas", url: "https://example.com/pajamas.m3u8", logo: "https://via.placeholder.com/150x150/ff9900/ffffff?text=PAJAMAS"},
                        {name: "ZooMoo", url: "https://example.com/zoomoo.m3u8", logo: "https://via.placeholder.com/150x150/00cc66/ffffff?text=ZOO"}
                    ];
                } else {
                    // Canais gerais
                    exampleChannels = [
                        {name: "Globo News", url: "https://example.com/globonews.m3u8", logo: "https://via.placeholder.com/150x150/ff0000/ffffff?text=GLOBO"},
                        {name: "CNN Brasil", url: "https://example.com/cnnbrasil.m3u8", logo: "https://via.placeholder.com/150x150/000000/ffffff?text=CNN"},
                        {name: "Record TV", url: "https://example.com/recordtv.m3u8", logo: "https://via.placeholder.com/150x150/ff0000/ffffff?text=RECORD"},
                        {name: "SBT", url: "https://example.com/sbt.m3u8", logo: "https://via.placeholder.com/150x150/ff6600/ffffff?text=SBT"},
                        {name: "Band", url: "https://example.com/band.m3u8", logo: "https://via.placeholder.com/150x150/0066ff/ffffff?text=BAND"},
                        {name: "ESPN", url: "https://example.com/espn.m3u8", logo: "https://via.placeholder.com/150x150/cc0000/ffffff?text=ESPN"},
                        {name: "Sportv", url: "https://example.com/sportv.m3u8", logo: "https://via.placeholder.com/150x150/006600/ffffff?text=SPORTV"},
                        {name: "Discovery Channel", url: "https://example.com/discovery.m3u8", logo: "https://via.placeholder.com/150x150/00cccc/ffffff?text=DISC"},
                        {name: "National Geographic", url: "https://example.com/natgeo.m3u8", logo: "https://via.placeholder.com/150x150/ffff00/000000?text=NATGEO"},
                        {name: "HBO", url: "https://example.com/hbo.m3u8", logo: "https://via.placeholder.com/150x150/000000/ffffff?text=HBO"},
                        {name: "Telecine", url: "https://example.com/telecine.m3u8", logo: "https://via.placeholder.com/150x150/ff6600/ffffff?text=TELECINE"},
                        {name: "Prime Video", url: "https://example.com/prime.m3u8", logo: "https://via.placeholder.com/150x150/0066ff/ffffff?text=PRIME"},
                        {name: "Netflix", url: "https://example.com/netflix.m3u8", logo: "https://via.placeholder.com/150x000/000000/ffffff?text=NETFLIX"},
                        {name: "Disney+", url: "https://example.com/disney.m3u8", logo: "https://via.placeholder.com/150x150/0066ff/ffffff?text=DISNEY"},
                        {name: "Paramount+", url: "https://example.com/paramount.m3u8", logo: "https://via.placeholder.com/150x150/000000/ffffff?text=PARAMOUNT"}
                    ];
                }
                
                renderChannelsList(exampleChannels);
            });
    }
    
    function parseM3U(m3uData) {
        const lines = m3uData.split('\n');
        const channels = [];
        let currentChannel = {};
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            if (line.startsWith('#EXTINF:')) {
                // Extrair informa√ß√µes do canal
                const nameMatch = line.match(/,(.+)$/);
                if (nameMatch) {
                    currentChannel.name = nameMatch[1];
                }
                
                const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                if (logoMatch) {
                    currentChannel.logo = logoMatch[1];
                }
            } else if (line && !line.startsWith('#') && currentChannel.name) {
                // URL do canal
                currentChannel.url = line;
                channels.push({...currentChannel});
                currentChannel = {};
            }
        }
        
        return channels;
    }
    
    function renderChannelsList(channels) {
        const container = document.getElementById('channels-container');
        container.innerHTML = '<div class="channels-grid"></div>';
        const grid = container.querySelector('.channels-grid');
        
        channels.forEach((channel, index) => {
            const channelElement = document.createElement('div');
            channelElement.className = 'channel-item';
            channelElement.tabIndex = 0;
            channelElement.innerHTML = `
                <div class="channel-number">${index + 1}</div>
                <img src="${channel.logo || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iYm9sZCI+VFY8L3RleHQ+Cjwvc3ZnPgo='}" alt="${channel.name}" class="channel-logo">
                <div class="channel-info">${channel.name}</div>
            `;
            
            channelElement.addEventListener('click', () => playChannel(channel));
            grid.appendChild(channelElement);
        });
    }
    
    function playChannel(channel) {
        startPlay(channel.url, channel.logo || '', channel.name, true);
    }
    
    function renderChannels() {
        const container = document.getElementById('channels-container');
        if (!container) return;
        
        // Canais de exemplo (em um sistema real, viria de uma API)
        const channels = [
            // NOT√çCIAS
            { id: 1, name: 'Globo News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GLOBO', category: 'Not√≠cias', url: 'https://globoplay.globo.com/' },
            { id: 2, name: 'Record News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=RECORD', category: 'Not√≠cias', url: 'https://play.r7.com/' },
            { id: 3, name: 'Band News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Not√≠cias', url: 'https://play.band.uol.com.br/' },
            { id: 4, name: 'SBT News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SBT', category: 'Not√≠cias', url: 'https://sbtplay.sbt.com.br/' },
            { id: 5, name: 'CNN Brasil', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=CNN', category: 'Not√≠cias', url: 'https://www.cnnbrasil.com.br/' },
            { id: 6, name: 'BBC News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BBC', category: 'Not√≠cias', url: 'https://www.bbc.com/portuguese/' },
            { id: 7, name: 'Al Jazeera', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=ALJ', category: 'Not√≠cias', url: 'https://www.aljazeera.com/' },
            
            // ENTRETENIMENTO
            { id: 8, name: 'Globo', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GLOBO', category: 'Entretenimento', url: 'https://globoplay.globo.com/' },
            { id: 9, name: 'Record', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=RECORD', category: 'Entretenimento', url: 'https://play.r7.com/' },
            { id: 10, name: 'SBT', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SBT', category: 'Entretenimento', url: 'https://sbtplay.sbt.com.br/' },
            { id: 11, name: 'Band', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Entretenimento', url: 'https://play.band.uol.com.br/' },
            { id: 12, name: 'RedeTV!', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=REDETV', category: 'Entretenimento', url: 'https://redetv.globo.com/' },
            { id: 13, name: 'TV Cultura', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=CULTURA', category: 'Cultura', url: 'https://tvculturabrasil.sbt.com.br/' },
            { id: 14, name: 'TV Gazeta', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GAZETA', category: 'Variedades', url: 'https://tvgazeta.globo.com/' },
            
            // ESPORTES
            { id: 15, name: 'ESPN Brasil', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=ESPN', category: 'Esportes', url: 'https://espn.com.br/' },
            { id: 16, name: 'Sportv', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SPORTV', category: 'Esportes', url: 'https://sportv.globo.com/' },
            { id: 17, name: 'Fox Sports', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=FOX', category: 'Esportes', url: 'https://www.foxsports.com.br/' },
            { id: 18, name: 'Premiere', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=PREMIERE', category: 'Esportes', url: 'https://www.premiere.com.br/' },
            { id: 19, name: 'SporTV', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SPORTV', category: 'Esportes', url: 'https://www.sporthtv.com.br/' },
            { id: 20, name: 'Combate', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=COMBATE', category: 'Esportes', url: 'https://www.combate.com.br/' },
            { id: 21, name: 'BandSports', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Esportes', url: 'https://play.band.uol.com.br/' }
        ];
        
        // Agrupar por categoria
        const categories = {};
        channels.forEach(channel => {
            if (!categories[channel.category]) {
                categories[channel.category] = [];
            }
            categories[channel.category].push(channel);
        });
        
        // Renderizar categorias e canais
        let html = '';
        Object.keys(categories).forEach(category => {
            html += `<div class="channel-category">
                <h2 class="category-title">${category.toUpperCase()}</h2>
                <div class="channels-grid">`;
            
            categories[category].forEach((channel, index) => {
                const isPlaying = currentChannel && currentChannel.id === channel.id;
                html += `
                    <div class="channel-item" tabindex="0" onclick="playChannel(${channel.id}, '${channel.name}', '${channel.url}')" data-channel-id="${channel.id}">
                        <div class="channel-number">${channel.id}</div>
                        <img src="${channel.logo}" alt="${channel.name}" class="channel-logo">
                        <div class="channel-info">${channel.name}</div>
                        ${isPlaying ? '<div class="channel-playing">AO VIVO</div>' : ''}
                    </div>`;
            });
            
            html += '</div></div>';
        });
        
        container.innerHTML = html;
    }
    
    function renderChannelsByCategory(categoryFile) {
        // Implementar l√≥gica para carregar canais de arquivo espec√≠fico
        renderChannels(); // Por enquanto, usa a mesma l√≥gica
    }
    
    function playChannel(channelId, channelName, channelUrl) {
        // Parar canal atual
        if (currentChannel) {
            // Limpar indicador de canal anterior
            document.querySelectorAll('.channel-playing').forEach(el => el.remove());
        }
        
        // Atualizar canal atual
        currentChannel = { id: channelId, name: channelName, url: channelUrl };
        currentChannelIndex = channelId;
        
        // Adicionar indicador de canal atual
        const currentChannelElement = document.querySelector(`[data-channel-id="${channelId}"]`);
        if (currentChannelElement) {
            currentChannelElement.classList.add('playing');
        }
        
        // Abrir player (em um sistema real, abriria o stream)
        const playerScreen = document.getElementById('player-screen');
        playerScreen.style.display = 'block';
        
        // Esconder sistema de like/dislike para canais ao vivo
        const likeOverlay = document.getElementById('like-dislike-overlay');
        if (likeOverlay) {
            likeOverlay.style.display = 'none';
        }
        
        // Simular reprodu√ß√£o (em um sistema real, conectaria com o stream)
        const video = document.getElementById('html5-video');
        video.src = channelUrl; // URL do stream
        video.play();
    }
    
    function setupChannelsNavigation() {
        // Navega√ß√£o por teclado e controle remoto
        document.addEventListener('keydown', function(e) {
            const focusedElement = document.activeElement;
            const allChannels = Array.from(document.querySelectorAll('.channel-item'));
            const currentIndex = allChannels.findIndex(el => el.dataset.channelId == currentChannelIndex);
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    navigateChannel('previous', currentIndex, allChannels);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    navigateChannel('next', currentIndex, allChannels);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    navigateChannel('up', currentIndex, allChannels);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    navigateChannel('down', currentIndex, allChannels);
                    break;
                case 'Enter':
                case ' ':
                    e.preventDefault();
                    if (focusedElement && focusedElement.classList.contains('channel-item')) {
                        const channelId = parseInt(focusedElement.dataset.channelId);
                        const channelData = findChannelById(channelId);
                        if (channelData) {
                            playChannel(channelData.id, channelData.name, channelData.url);
                        }
                    }
                    break;
                case 'Escape':
                case 'Back':
                    e.preventDefault();
                    // Voltar para home
                    location.reload();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                    e.preventDefault();
                    const channelNumber = parseInt(e.key);
                    const channelData = findChannelById(channelNumber);
                    if (channelData) {
                        playChannel(channelData.id, channelData.name, channelData.url);
                    }
                    break;
            }
        });
        
        // Suporte para navega√ß√£o por toque
        document.querySelectorAll('.channel-item').forEach(item => {
            item.addEventListener('touchend', function(e) {
                e.preventDefault();
                const channelId = parseInt(this.dataset.channelId);
                const channelData = findChannelById(channelId);
                if (channelData) {
                    playChannel(channelData.id, channelData.name, channelData.url);
                }
            });
        });
        
        // Suporte para clique do mouse
        document.querySelectorAll('.channel-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const channelId = parseInt(this.dataset.channelId);
                const channelData = findChannelById(channelId);
                if (channelData) {
                    playChannel(channelData.id, channelData.name, channelData.url);
                }
            });
        });
    }
    
    function navigateChannel(direction, currentIndex, allChannels) {
        if (currentIndex === -1) return;
        
        let nextIndex;
        const gridCols = 7; // 7 canais por linha
        
        switch(direction) {
            case 'previous':
                nextIndex = currentIndex > 0 ? currentIndex - 1 : allChannels.length - 1;
                break;
            case 'next':
                nextIndex = currentIndex < allChannels.length - 1 ? currentIndex + 1 : 0;
                break;
            case 'up':
                nextIndex = currentIndex >= gridCols ? currentIndex - gridCols : currentIndex;
                break;
            case 'down':
                nextIndex = currentIndex + gridCols < allChannels.length ? currentIndex + gridCols : currentIndex;
                break;
        }
        
        if (nextIndex >= 0 && nextIndex < allChannels.length) {
            allChannels[nextIndex].focus();
            allChannels[nextIndex].scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }
    }
    
    function findChannelById(channelId) {
        // Em um sistema real, buscaria na lista de canais carregados
        const allChannels = document.querySelectorAll('.channel-item');
        for (let channel of allChannels) {
            if (parseInt(channel.dataset.channelId) === channelId) {
                const id = parseInt(channel.dataset.channelId);
                const name = channel.querySelector('.channel-info').textContent;
                const logo = channel.querySelector('.channel-logo').src;
                return { id, name, url: `https://example-stream.com/channel/${id}` }; // URL simulada
            }
        }
        return null;
    }

    // --- BANNER CINEM√ÅTICO NETFLIX ---
    let heroContent = [];
    let currentHeroIndex = 0;
    
    function loadHeroContent() {
        // Carregar 20 conte√∫dos aleat√≥rios de todos os g√™neros
        if (masterData.length > 0) {
            heroContent = [...masterData]
                .sort(() => Math.random() - 0.5)
                .slice(0, 20);
            displayHeroContent();
        }
    }
    
    function displayHeroContent() {
        if (heroContent.length === 0) return;
        
        const hero = heroContent[currentHeroIndex];
        const heroBackground = document.getElementById('hero-background');
        const heroTitle = document.getElementById('hero-title');
        const heroMeta = document.getElementById('hero-meta');
        const heroGenres = document.getElementById('hero-genres');
        const heroSynopsis = document.getElementById('hero-synopsis');
        const heroPoster = document.getElementById('hero-poster');
        const heroPlayBtn = document.getElementById('hero-play-btn');
        const ambientReflection = document.getElementById('ambient-reflection');
        
        // Atualizar conte√∫do do banner
        heroBackground.style.backgroundImage = `url(${hero.backdrop || hero.poster})`;
        heroTitle.textContent = hero.titulo;
        heroMeta.textContent = `${hero.year} ‚Ä¢ ‚òÖ ${hero.rating}`;
        
        const genres = Array.isArray(hero.genero) ? hero.genero.join(' | ') : (hero.genero || 'Geral');
        heroGenres.textContent = genres;
        
        heroSynopsis.textContent = hero.desc || 'Uma experi√™ncia incr√≠vel que vai te prender do in√≠cio ao fim...';
        heroPoster.src = hero.poster;
        heroPoster.alt = hero.titulo;
        
        // Configurar bot√£o de play
        heroPlayBtn.onclick = () => startPlay(hero.url || '', hero.titulo);
        
        // Atualizar reflexo din√¢mico
        if (ambientReflection) {
            ambientReflection.style.backgroundImage = `url(${hero.backdrop || hero.poster})`;
        }
        
        // Adicionar tratamento de erro para imagens
        heroPoster.onerror = function() {
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4=';
        };
    }
    
    function playHeroContent() {
        if (heroContent.length > 0) {
            const hero = heroContent[currentHeroIndex];
            startPlay(hero.url || '', hero.titulo);
        }
    }
    
    function showHeroDetails() {
        if (heroContent.length > 0) {
            const hero = heroContent[currentHeroIndex];
            openInfo(hero);
        }
    }
    
    function rotateHeroContent() {
        currentHeroIndex = (currentHeroIndex + 1) % heroContent.length;
        displayHeroContent();
    }
    
    // Rotacionar banner a cada 30 segundos
    setInterval(rotateHeroContent, 30000);
    
    // --- NAVEGA√á√ÉO APRIMORADA ---
    let currentFocusElement = null;
    let navigationGrid = [];
    
    function setupNavigationGrid() {
        // Construir grade de navega√ß√£o para todas as capas
        navigationGrid = [];
        const allContainers = document.querySelectorAll('.row-container');
        
        allContainers.forEach((container, containerIndex) => {
            const items = container.querySelectorAll('.capa-item');
            const containerGrid = [];
            
            items.forEach((item, itemIndex) => {
                containerGrid.push({
                    element: item,
                    containerIndex: containerIndex,
                    itemIndex: itemIndex,
                    row: Math.floor(itemIndex / 6), // 6 itens por linha visual
                    col: itemIndex % 6
                });
            });
            
            navigationGrid.push(containerGrid);
        });
    }
    
    function navigateToElement(element) {
        if (element) {
            element.focus();
            currentFocusElement = element;
            
            // Scroll suave para o elemento
            element.scrollIntoView({
                behavior: 'smooth',
                block: 'center',
                inline: 'center'
            });
            
            // Atualizar reflexo din√¢mico se for uma capa
            if (element.querySelector('img')) {
                const img = element.querySelector('img');
                const ambientReflection = document.getElementById('ambient-reflection');
                if (ambientReflection && img.src) {
                    ambientReflection.style.backgroundImage = `url(${img.src})`;
                }
            }
        }
    }
    
    function handleNavigationKey(key, currentElement) {
        if (!currentElement) return;
        
        const allFocusable = Array.from(document.querySelectorAll('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn'));
        const currentIndex = allFocusable.indexOf(currentElement);
        
        if (currentIndex === -1) return;
        
        let nextIndex = currentIndex;
        
        switch(key) {
            case 'ArrowRight':
                if (currentElement.classList.contains('capa-item')) {
                    // Navega√ß√£o horizontal dentro da mesma linha
                    const container = currentElement.closest('.row-container');
                    const items = Array.from(container.querySelectorAll('.capa-item'));
                    const itemIndex = items.indexOf(currentElement);
                    
                    if (itemIndex < items.length - 1) {
                        nextIndex = allFocusable.indexOf(items[itemIndex + 1]);
                    } else {
                        // Ir para a primeira capa da pr√≥xima linha
                        const nextContainer = getNextContainer(container);
                        if (nextContainer) {
                            const nextItems = nextContainer.querySelectorAll('.capa-item');
                            if (nextItems.length > 0) {
                                nextIndex = allFocusable.indexOf(nextItems[0]);
                            }
                        }
                    }
                } else {
                    // Para outros elementos, ir para o pr√≥ximo foc√°vel
                    nextIndex = (currentIndex + 1) % allFocusable.length;
                }
                break;
                
            case 'ArrowLeft':
                if (currentElement.classList.contains('capa-item')) {
                    // Navega√ß√£o horizontal dentro da mesma linha
                    const container = currentElement.closest('.row-container');
                    const items = Array.from(container.querySelectorAll('.capa-item'));
                    const itemIndex = items.indexOf(currentElement);
                    
                    if (itemIndex > 0) {
                        nextIndex = allFocusable.indexOf(items[itemIndex - 1]);
                    } else {
                        // Ir para a √∫ltima capa da linha anterior
                        const prevContainer = getPreviousContainer(container);
                        if (prevContainer) {
                            const prevItems = prevContainer.querySelectorAll('.capa-item');
                            if (prevItems.length > 0) {
                                nextIndex = allFocusable.indexOf(prevItems[prevItems.length - 1]);
                            }
                        }
                    }
                } else {
                    // Para outros elementos, ir para o foc√°vel anterior
                    nextIndex = (currentIndex - 1 + allFocusable.length) % allFocusable.length;
                }
                break;
                
            case 'ArrowDown':
                if (currentElement.classList.contains('capa-item')) {
                    // Descer para a mesma coluna na pr√≥xima linha
                    const container = currentElement.closest('.row-container');
                    const items = Array.from(container.querySelectorAll('.capa-item'));
                    const itemIndex = items.indexOf(currentElement);
                    const itemsPerRow = 6; // Ajustar conforme necess√°rio
                    
                    const targetIndex = itemIndex + itemsPerRow;
                    if (targetIndex < items.length) {
                        nextIndex = allFocusable.indexOf(items[targetIndex]);
                    } else {
                        // Ir para a primeira capa do pr√≥ximo container
                        const nextContainer = getNextContainer(container);
                        if (nextContainer) {
                            const nextItems = nextContainer.querySelectorAll('.capa-item');
                            if (nextItems.length > 0) {
                                nextIndex = allFocusable.indexOf(nextItems[0]);
                            }
                        }
                    }
                } else {
                    // Para bot√µes do menu lateral, ir para a primeira capa da home
                    const firstCapa = document.querySelector('.capa-item');
                    if (firstCapa) {
                        nextIndex = allFocusable.indexOf(firstCapa);
                    }
                }
                break;
                
            case 'ArrowUp':
                if (currentElement.classList.contains('capa-item')) {
                    // Subir para a mesma coluna na linha anterior
                    const container = currentElement.closest('.row-container');
                    const items = Array.from(container.querySelectorAll('.capa-item'));
                    const itemIndex = items.indexOf(currentElement);
                    const itemsPerRow = 6; // Ajustar conforme necess√°rio
                    
                    const targetIndex = itemIndex - itemsPerRow;
                    if (targetIndex >= 0) {
                        nextIndex = allFocusable.indexOf(items[targetIndex]);
                    } else {
                        // Ir para a √∫ltima capa do container anterior
                        const prevContainer = getPreviousContainer(container);
                        if (prevContainer) {
                            const prevItems = prevContainer.querySelectorAll('.capa-item');
                            if (prevItems.length > 0) {
                                nextIndex = allFocusable.indexOf(prevItems[prevItems.length - 1]);
                            }
                        }
                    }
                }
                break;
        }
        
        if (nextIndex !== currentIndex && nextIndex >= 0 && nextIndex < allFocusable.length) {
            navigateToElement(allFocusable[nextIndex]);
        }
    }
    
    function getNextContainer(currentContainer) {
        const allContainers = Array.from(document.querySelectorAll('.row-container'));
        const currentIndex = allContainers.indexOf(currentContainer);
        return currentIndex < allContainers.length - 1 ? allContainers[currentIndex + 1] : null;
    }
    
    function getPreviousContainer(currentContainer) {
        const allContainers = Array.from(document.querySelectorAll('.row-container'));
        const currentIndex = allContainers.indexOf(currentContainer);
        return currentIndex > 0 ? allContainers[currentIndex - 1] : null;
    }
    let searchTimeout;
    let lastSearchQuery = '';
    
    function toggleSearch(forceClose = false) {
        const b = document.getElementById('search-box');
        const input = document.getElementById('input-busca');
        
        if (forceClose || b.style.display === 'block') {
            b.style.display = 'none';
            clearSearch();
            renderHome(); // Voltar para home
        } else {
            b.style.display = 'block';
            input.focus();
        }
    }
    
    function handleSearchBlur() {
        setTimeout(() => {
            const input = document.getElementById('input-busca');
            const searchBox = document.getElementById('search-box');
            
            // Se n√£o h√° foco em nenhum elemento da pesquisa, limpar e voltar para home
            if (document.activeElement !== input && document.activeElement !== searchBox) {
                clearSearch();
                searchBox.style.display = 'none';
                renderHome();
            }
        }, 200);
    }
    
    function clearSearch() {
        const input = document.getElementById('input-busca');
        const results = document.getElementById('search-results');
        
        input.value = '';
        results.innerHTML = '';
        lastSearchQuery = '';
        
        // Limpar timeout anterior
        if (searchTimeout) {
            clearTimeout(searchTimeout);
        }
    }
    
    function searchRealTime(q) {
        const results = document.getElementById('search-results');
        
        // Limpar timeout anterior
        if (searchTimeout) {
            clearTimeout(searchTimeout);
        }
        
        // Se a busca est√° vazia, limpar resultados
        if (q.length < 2) {
            results.innerHTML = '';
            lastSearchQuery = '';
            return;
        }
        
        // Aguardar um pouco antes de buscar (debounce)
        searchTimeout = setTimeout(() => {
            // Se a consulta n√£o mudou, n√£o buscar novamente
            if (q === lastSearchQuery) return;
            
            lastSearchQuery = q;
            const filtered = masterData.filter(item => 
                item.titulo.toLowerCase().includes(q.toLowerCase())
            );
            
            results.innerHTML = '';
            filtered.forEach(item => {
                results.innerHTML += `
                    <div class="search-card" tabindex="0" onclick='openSearchResult(${JSON.stringify(item)})'>
                        <img src="${item.poster}" alt="${item.titulo}">
                        <div class="search-card-footer">
                            <span>${item.year}</span>
                            <span>‚òÖ${item.rating}</span>
                        </div>
                    </div>`;
            });
        }, 300); // Debounce de 300ms
    }
    
    function openSearchResult(item) {
        // Ir para p√°gina de detalhes antes de come√ßar a exibi√ß√£o
        openInfo(item);
    }

    function saveHistory(t, u) {
        // Salvar hist√≥rico com tempo de reprodu√ß√£o
        let history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        
        // Remover entrada existente do mesmo conte√∫do
        history = history.filter(item => item.title !== t);
        
        // Adicionar nova entrada no in√≠cio
        history.unshift({
            title: t,
            url: u,
            timestamp: Date.now(),
            watchedTime: 0 // Ser√° atualizado durante a reprodu√ß√£o
        });
        
        // Manter apenas os 3 mais recentes
        history = history.slice(0, 3);
        
        localStorage.setItem('paixaoflix_history', JSON.stringify(history));
    }
    
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const historyContainer = document.getElementById('row-history');
        
        // Filtrar hist√≥rico dos √∫ltimos 7 dias e excluir conte√∫do ao vivo
        const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
        const filteredHistory = history.filter(item => {
            const isRecent = item.timestamp > sevenDaysAgo;
            // Verificar se n√£o √© conte√∫do ao vivo
            const fullItem = masterData.find(masterItem => masterItem.titulo === item.title);
            const isNotLive = fullItem ? fullItem.type !== 'live_channel' : true;
            return isRecent && isNotLive;
        });
        
        // Limitar a 3 itens mais recentes
        const recentHistory = filteredHistory.slice(0, 3);
        
        if(recentHistory.length === 0) {
            historyContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum conte√∫do assistido recentemente</p>';
            return;
        }
        
        recentHistory.forEach(historyItem => {
            // Encontrar o item completo no masterData
            const fullItem = masterData.find(item => item.titulo === historyItem.title);
            if(fullItem) {
                // Calcular progresso baseado no tempo total estimado (120 min para filmes, 45 min para epis√≥dios)
                const estimatedDuration = fullItem.type === 'serie' ? 2700 : 7200; // 45min ou 120min em segundos
                const progressPercent = historyItem.watchedTime ? Math.min((historyItem.watchedTime / estimatedDuration) * 100, 100) : 0;
                
                historyContainer.innerHTML += `
                    <div class="capa-item history" tabindex="0" onclick='resumeFromHistory("${historyItem.title}", "${historyItem.url}", ${historyItem.watchedTime || 0})'>
                        <img src="${fullItem.poster}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMDUwNzBhIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjRkZDRTQ0IiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCI+UGFpeMOjby1GbGl4PC90ZXh0Pgo8L3N2Zz4='">
                        <div class="progress-bar-external">
                            <div class="progress-bar-internal" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="capa-footer"><span>${fullItem.year}</span><span>‚òÖ${fullItem.rating}</span></div>
                    </div>`;
            }
        });
    }
    
    function resumeFromHistory(title, url, currentTime) {
        startPlay(url, title, currentTime);
    }

    window.onload = initPaixaoFlix;
</script>
</body>
</html>
