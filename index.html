<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{overflow:-moz-scrollbars-none;-ms-overflow-style:none;scrollbar-width:none;touch-action:manipulation}
*::-webkit-scrollbar{display:none!important}
html,body{margin:0;padding:0;background:#000;color:#fff;font-family:Arial,sans-serif;height:100%;overflow:hidden;width:100%}
#app{display:flex;height:100%;width:100%;position:relative}
#menu{width:280px;background:#1a1a1a;display:flex;flex-direction:column;z-index:100;padding:12px;box-sizing:border-box;border-right:1px solid #333;height:100%}
#menuHeader{padding:15px 10px;text-align:center;border-bottom:1px solid #222;margin-bottom:15px}
#menuHeader img{height:95px}
#clock{margin-top:10px;font-size:13px;color:#aaa}
#nowPlaying{margin:15px 0;text-align:center}
#nowPlaying span{display:block;font-size:13px;font-weight:700}
#currentTitle{display:inline-block;padding:4px 10px;font-family:'Poppins',sans-serif;font-size:15px;background:rgba(0,0,0,.6);border-radius:4px;max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
#searchBox{margin-bottom:15px}
#searchInput{width:100%;padding:12px;border-radius:8px;border:2px solid #333;background:#000;color:#fff;font-size:14px}
#searchInput.focused{border-color:#ff9800;background:#222}
.menu-item{padding:12px 15px;font-size:15px;margin-bottom:8px;border-radius:8px;background:#222;border:1px solid #333;display:flex;align-items:center;color:#ccc;cursor:pointer}
.menu-item.active{background:#333;color:#fff;border:1px solid #ff9800;font-weight:bold}
.menu-item.kids{border-left:3px solid #ffeb3b;color:#ffeb3b}
#content{position:absolute;top:0;left:280px;width:calc(100% - 280px);height:100%;display:flex;justify-content:center;align-items:center}
#videoContainer{width:100%;height:56.25vw;max-height:100vh;background:#000}
video{width:100%;height:100%;object-fit:contain;background:#000}
#channelList{position:absolute;top:0;left:0;width:340px;height:100%;background:rgba(0,0,0,.98);display:none;z-index:110;overflow-y:auto;border-right:1px solid #ff9800}
.channel{padding:15px 20px;font-size:16px;border-bottom:1px solid #222;cursor:pointer}
.channel.active{background:#ff9800;color:#000;font-weight:bold}
#posterPreview{position:absolute;top:50%;left:360px;transform:translateY(-50%);width:300px;height:450px;display:none;border:3px solid #ff9800}
</style>
</head>

<body>
<div id="app">
<div id="menu">
<div id="menuHeader">
<img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
<div id="clock"></div>
<div id="nowPlaying"><span>Assistindo agora</span><div id="currentTitle">...</div></div>
</div>
<div id="searchBox"><input id="searchInput" placeholder="Pesquisar..."></div>
<div class="menu-item active" data-type="channels">TV ao vivo</div>
<div class="menu-item" data-type="fav">Favoritos</div>
<div class="menu-item" data-type="categories">Cinema</div>
<div class="menu-item" data-type="series">Séries</div>
</div>

<div id="content">
<div id="videoContainer"><video id="video" autoplay playsinline></video></div>
<div id="channelList"></div>
<img id="posterPreview">
</div>
</div>

<script>
const video=document.getElementById("video");
const channelList=document.getElementById("channelList");
const posterPreview=document.getElementById("posterPreview");
const searchInput=document.getElementById("searchInput");
const menuItems=document.querySelectorAll(".menu-item");
const currentTitleDisplay=document.getElementById("currentTitle");

let channels=[],movies=[],series=[],filteredList=[],viewMode="channels";
let selectedIndex=0,menuIndex=0,listOpen=false,menuFocused=true,hls=null;

function updateClock(){
const d=new Date(),m=["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"];
clock.innerText=`${d.getDate()} ${m[d.getMonth()]} ${d.getFullYear()} | ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
}
setInterval(updateClock,1000);updateClock();

/* ===== PLAYMEDIA CORRIGIDO ===== */
function playMedia(item){
if(!item||!item.url)return;
currentTitleDisplay.innerText=item.titulo;
if(hls){hls.destroy();hls=null}
video.pause();video.removeAttribute("src");video.load();

let started=false,tries=0;
function tryPlay(){
video.play().then(()=>started=true).catch(()=>{
if(tries++<3)setTimeout(tryPlay,400);
});
}

setTimeout(()=>{
if(item.url.includes(".m3u8")&&Hls.isSupported()){
hls=new Hls();hls.loadSource(item.url);hls.attachMedia(video);
hls.on(Hls.Events.MANIFEST_PARSED,tryPlay);
}else{
video.src=item.url;
video.oncanplay=()=>!started&&tryPlay();
video.onloadeddata=()=>!started&&tryPlay();
}
},300);
}

/* ===== LISTA / NAVEGAÇÃO ===== */
function renderList(){
channelList.innerHTML="";
filteredList.forEach((c,i)=>{
const d=document.createElement("div");
d.className="channel"+(i===selectedIndex?" active":"");
d.textContent=c.titulo;
d.onclick=()=>{selectedIndex=i;playMedia(c)};
channelList.appendChild(d);
});
}

document.addEventListener("keydown",e=>{
if(e.key==="ArrowDown"){selectedIndex=(selectedIndex+1)%filteredList.length;renderList()}
if(e.key==="ArrowUp"){selectedIndex=(selectedIndex-1+filteredList.length)%filteredList.length;renderList()}
if(e.key==="Enter"){playMedia(filteredList[selectedIndex])}
});

/* ===== LOAD M3U ===== */
function loadM3U(path){
fetch(path).then(r=>r.text()).then(t=>{
t.split("\n").forEach(l=>{
if(l.startsWith("#EXTINF"))temp={titulo:l.split(",").pop()};
else if(l.startsWith("http")&&temp){temp.url=l;channels.push(temp);temp=null}
});
filteredList=channels;renderList();playMedia(channels[0]);
});
}

window.onload=()=>loadM3U("data/canais.m3u");
</script>
</body>
</html>
