<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaixãoFlix - Oficial</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --azul-escuro: #001a33;
            --bg-body: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
            /* TAMANHO PADRÃO DA CAPA */
            --capa-w: 165px; 
            --capa-h: 245px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; outline: none; }
        body { background: var(--bg-body); color: white; overflow: hidden; display: flex; }

        /* BARRA LATERAL */
        #sidebar {
            width: 80px; height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 1000;
        }
        .logo { width: 50px; cursor: pointer; margin-bottom: 20px; }
        .nav-icons { display: flex; flex-direction: column; gap: 12px; }
        .icon-btn { 
            width: 45px; height: 45px; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn svg { width: 24px; fill: #666; }
        .icon-btn:focus { background: var(--amarelo-pipoca); }
        .icon-btn:focus svg { fill: #000; }

        /* BARRA SUPERIOR */
        #topbar {
            position: fixed; top: 0; left: 80px; right: 0; height: 60px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; background: rgba(0,0,0,0.8); z-index: 900;
        }
        #contador { color: var(--amarelo-pipoca); font-weight: bold; font-size: 14px; }

        /* CONTEÚDO */
        main { margin-left: 0; width: calc(100% - 80px); height: 100vh; overflow-y: auto; padding: 80px 30px 40px; }
        
        /* BOTÕES 3D */
        .btn-3d {
            background: var(--amarelo-pipoca); border: none; padding: 10px 20px;
            font-weight: bold; border-radius: 6px; box-shadow: var(--sombra-3d);
            cursor: pointer; color: black; text-transform: uppercase; font-size: 12px;
        }
        .btn-3d:focus { transform: translateY(2px); box-shadow: 0 2px 0 #b38f00; border: 2px solid white; }

        /* CATEGORIAS E SCROLL */
        .categoria-row { margin-bottom: 30px; position: relative; }
        .section-title { font-size: 18px; margin-bottom: 15px; color: #eee; }
        
        .carousel-wrapper { position: relative; display: flex; align-items: center; }
        .carousel { 
            display: flex; gap: 15px; overflow-x: hidden; scroll-behavior: smooth; 
            padding: 10px 0; width: 100%;
        }

        /* CAPAS PADRONIZADAS */
        .capa { 
            min-width: var(--capa-w); width: var(--capa-w); height: var(--capa-h);
            position: relative; cursor: pointer; transition: 0.3s; 
        }
        .capa:focus { transform: scale(1.05); border: 3px solid white; border-radius: 8px; }
        .capa img { width: 100%; height: 100%; border-radius: 6px; object-fit: cover; }
        
        /* TOP 4 NÚMEROS */
        .num-top {
            position: absolute; left: -10px; bottom: 10px; font-size: 70px;
            font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 1.5px var(--amarelo-pipoca); z-index: 5;
        }

        .capa-footer { 
            display: flex; justify-content: space-between; font-size: 10px; 
            color: #bbb; margin-top: 5px; padding: 0 2px;
        }

        /* SETAS */
        .seta {
            position: absolute; right: -20px; z-index: 10; background: rgba(0,0,0,0.6);
            border: none; color: white; padding: 20px 10px; cursor: pointer; display: none;
        }
        .categoria-row:hover .seta { display: block; }

        /* PLAYER */
        #player-ui { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; }
        video { width: 100%; height: 100%; }
    </style>
</head>
<body>

<nav id="sidebar">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" class="logo" onclick="location.reload()" tabindex="0">
    <div class="nav-icons">
        <div class="icon-btn" tabindex="0" onclick="abrirBusca()"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarPagina('movie', 'data/filmes.json')"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarPagina('serie', 'data/series.json')"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarCanais('data/ativa_canais.m3u')"><svg viewBox="0 0 24 24"><path d="M21 10H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm-10 7H8v-3h3v3zm5 0h-3v-3h3v3zM21 3H3c-1.1 0-2 .9-2 2v3h22V5c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarPagina('kids_movie', 'data/kids_filmes.json')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarPagina('kids_serie', 'data/kids_series.json')"><svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarCanais('data/ativa_kids_canais.m3u')"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="renderizarPagina('fav', 'data/favoritos.json')"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
    </div>
</nav>

<header id="topbar">
    <div id="contador">Estamos evoluindo: <span id="num-count">0</span></div>
    <div id="relogio" style="font-size: 12px; opacity: 0.7;"></div>
</header>

<main id="app-main"></main>

<div id="player-ui">
    <button class="btn-3d" style="position:absolute; top:20px; right:20px; z-index:4000" onclick="fecharPlayer()">VOLTAR</button>
    <video id="v-player" controls autoplay></video>
</div>

<script>
    let bandoDados = [];
    const cats = ["Lançamento 2026", "Lançamento 2025", "Ação", "Aventura", "Comédia", "Drama", "Nacional", "Romance", "Religioso", "Ficção", "Anime", "Animação", "Família", "Clássicos", "Dorama", "Suspense", "Policial", "Crime", "Terror", "Documentários", "Faroeste", "Musical", "Adulto"];

    // RELOGIO
    setInterval(() => {
        const d = new Date();
        document.getElementById('relogio').innerText = d.toLocaleString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }).toUpperCase();
    }, 1000);

    // CARGA INICIAL
    async function start() {
        const res = await Promise.all(['data/filmes.json', 'data/series.json', 'data/kids_filmes.json', 'data/kids_series.json'].map(f => fetch(f).then(r => r.json()).catch(() => [])));
        bandoDados = res.flat();
        document.getElementById('num-count').innerText = bandoDados.length;
        renderHome();
    }

    function renderHome() {
        const app = document.getElementById('app-main');
        app.innerHTML = `<h2 class="section-title">PaixãoFlix indica hoje</h2><div class="carousel" id="top4"></div><h2 class="section-title">Continuar Assistindo</h2><div class="carousel" id="history"></div>`;
        
        const hoje = new Date().getDate();
        const top4 = bandoDados.slice(hoje % bandoDados.length, (hoje % bandoDados.length) + 4);
        
        top4.forEach((item, i) => {
            document.getElementById('top4').innerHTML += `
                <div class="capa" tabindex="0" onclick='abrirInfo(${JSON.stringify(item)})'>
                    <span class="num-top">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>★${item.rating}</span><span>${item.genero || 'Geral'}</span></div>
                </div>`;
        });
    }

    async function renderizarPagina(tipo, arquivo) {
        const app = document.getElementById('app-main');
        app.innerHTML = '';
        const res = await fetch(arquivo);
        let dados = await res.json();

        // Lógica Kids: Ordem Alfabética
        if(tipo.includes('kids')) {
            dados.sort((a,b) => a.titulo.localeCompare(b.titulo));
            app.innerHTML = `<h2 class="section-title">Kids</h2><div class="carousel" style="flex-wrap:wrap">${gerarCapas(dados)}</div>`;
        } else {
            // Lógica Cinema/Séries: Por Categorias com Scroll de 4 em 4
            cats.forEach(c => {
                const filtrados = dados.filter(i => i.genero === c);
                if(filtrados.length > 0) {
                    const id = `cat-${c.replace(/\s/g, '')}`;
                    app.innerHTML += `
                        <div class="categoria-row">
                            <h2 class="section-title">${c}</h2>
                            <div class="carousel-wrapper">
                                <div class="carousel" id="${id}">${gerarCapas(filtrados)}</div>
                                ${filtrados.length > 4 ? `<button class="seta" onclick="scroll4('${id}')">▶</button>` : ''}
                            </div>
                        </div>`;
                }
            });
        }
    }

    function gerarCapas(lista) {
        return lista.map(item => `
            <div class="capa" tabindex="0" onclick='abrirInfo(${JSON.stringify(item)})'>
                <img src="${item.poster}">
                <div class="capa-footer"><span>${item.year}</span><span>★${item.rating}</span></div>
            </div>`).join('');
    }

    function scroll4(id) {
        const el = document.getElementById(id);
        const step = (var(--capa-w) + 15) * 4; 
        if (el.scrollLeft + el.offsetWidth >= el.scrollWidth) {
            el.scrollLeft = 0; // Infinite loop
        } else {
            el.scrollLeft += step;
        }
    }

    function abrirInfo(item) { /* Mesma lógica anterior de detalhes com Archive */ }

    window.onload = start;
</script>
</body>
</html>
