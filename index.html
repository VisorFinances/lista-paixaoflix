<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
html,body{margin:0;padding:0;background:#000;color:#fff;font-family:Arial;height:100%;overflow:hidden}
#app{display:flex;height:100%}
#menu{width:280px;background:#111;padding:15px}
.menu-item{padding:14px;margin-bottom:10px;background:#222;border-radius:8px}
.menu-item.active{background:#ff9800;color:#000;font-weight:bold}
#content{flex:1;position:relative}
video{width:100%;height:100%;object-fit:contain;background:#000}
#list{position:absolute;top:0;left:0;width:360px;height:100%;background:rgba(0,0,0,.96);display:none;overflow-y:auto}
.item{padding:18px;border-bottom:1px solid #222}
.item.active{background:#ff9800;color:#000;font-weight:bold}
#overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-size:24px;background:rgba(0,0,0,.6)}
</style>
</head>

<body>
<div id="app">
  <div id="menu">
    <div class="menu-item active">TV AO VIVO</div>
    <div class="menu-item">CINEMA</div>
  </div>

  <div id="content">
    <video id="video" autoplay playsinline></video>
    <div id="list"></div>
    <div id="overlay">Carregando…</div>
  </div>
</div>

<script>
/* ================= PLAYER ================= */
const video=document.getElementById("video");
const overlay=document.getElementById("overlay");
let hls=null;

function playURL(url){
  overlay.style.display="flex";

  if(hls){hls.destroy();hls=null}
  video.pause();
  video.removeAttribute("src");
  video.load();

  setTimeout(()=>{
    if(url.includes(".m3u8") && Hls.isSupported()){
      hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED,()=>{
        video.play();
        overlay.style.display="none";
      });
    }else{
      video.src=url;
      video.oncanplay=()=>{
        video.play();
        overlay.style.display="none";
      };
    }
  },300);
}

/* ================= LISTA ================= */
const list=document.getElementById("list");
let items=[];
let selected=0;
let listOpen=false;

function render(){
  list.innerHTML="";
  items.forEach((i,idx)=>{
    const d=document.createElement("div");
    d.className="item"+(idx===selected?" active":"");
    d.textContent=i.titulo;
    list.appendChild(d);
  });
}

/* ================= CONTROLE ================= */
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowDown"){
    if(listOpen){
      selected=(selected+1)%items.length;
      render();
    }
  }

  if(e.key==="ArrowUp"){
    if(listOpen){
      selected=(selected-1+items.length)%items.length;
      render();
    }
  }

  if(e.key==="Enter"){
    if(!listOpen){
      listOpen=true;
      list.style.display="block";
      render();
    }else{
      playURL(items[selected].url);
      listOpen=false;
      list.style.display="none";
    }
  }
});

/* ================= LOAD M3U ================= */
fetch("data/canais.m3u")
.then(r=>r.text())
.then(t=>{
  let temp=null;
  t.split("\n").forEach(l=>{
    if(l.startsWith("#EXTINF")) temp={titulo:l.split(",").pop()};
    else if(l.startsWith("http") && temp){
      temp.url=l;
      items.push(temp);
      temp=null;
    }
  });

  render();
  playURL(items[0].url); // inicia no primeiro canal
});
</script>
</body>
</html>
