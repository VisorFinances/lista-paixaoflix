<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    * { box-sizing: border-box; overflow: hidden; }
    body { margin: 0; background: #000; color: #fff; font-family: 'Poppins', sans-serif; display: flex; height: 100vh; }
    
    /* Menu Lateral */
    #menu { width: 280px; background: #111; padding: 20px; border-right: 1px solid #333; display: flex; flex-direction: column; }
    #menu img { width: 100%; margin-bottom: 20px; }
    .menu-item { padding: 15px; margin-bottom: 10px; background: #222; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
    .menu-item.active { border-color: #ff9800; background: #333; font-weight: bold; }
    
    /* Área de Conteúdo */
    #content { flex-grow: 1; position: relative; background: #000; }
    #channelList { position: absolute; top: 0; left: 0; width: 350px; height: 100%; background: rgba(0,0,0,0.95); z-index: 10; display: none; overflow-y: auto; border-right: 2px solid #ff9800; }
    .channel { padding: 20px; border-bottom: 1px solid #222; cursor: pointer; display: flex; justify-content: space-between; }
    .channel.active { background: #ff9800; color: #000; font-weight: bold; }
    
    /* Player e Preview */
    video { width: 100%; height: 100%; object-fit: contain; }
    #posterPreview { position: absolute; right: 50px; top: 50%; transform: translateY(-50%); width: 300px; height: 450px; border-radius: 15px; border: 4px solid #ff9800; display: none; z-index: 20; }
    #statusInfo { position: absolute; bottom: 10px; right: 10px; font-size: 10px; color: #444; }
</style>
</head>
<body>

<div id="menu">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
    <div class="menu-item active" data-type="channels">Canais ao Vivo</div>
    <div class="menu-item" data-type="categories">Cinema (Filmes)</div>
    <div class="menu-item" data-type="series">Séries</div>
</div>

<div id="content">
    <video id="mainVideo" controls autoplay></video>
    <div id="channelList"></div>
    <img id="posterPreview">
    <div id="statusInfo" id="debug">Aguardando dados...</div>
</div>

<script>
    const movieCats = ["Lançamentos 2025", "AÇÃO", "AVENTURA", "ANIME", "TERROR", "DRAMA", "DOCUMENTÁRIOS", "FICÇÃO CIENTÍFICA"];
    let movies = [], channels = [], filteredList = [];
    let viewMode = "channels", menuIndex = 0, selectedIndex = 0, menuFocused = true;

    const menuItems = document.querySelectorAll('.menu-item');
    const listEl = document.getElementById('channelList');
    const videoEl = document.getElementById('mainVideo');
    const posterEl = document.getElementById('posterPreview');

    // CARREGAR FILMES
    async function loadMovies() {
        try {
            const r = await fetch('data/filmes.json');
            if (!r.ok) throw new Error();
            movies = await r.json();
            document.getElementById('statusInfo').innerText = "Filmes carregados: " + movies.length;
        } catch (e) {
            document.getElementById('statusInfo').innerText = "ERRO: Arquivo filmes.json não encontrado ou inválido.";
            console.error(e);
        }
    }

    function render() {
        listEl.innerHTML = "";
        let data = viewMode === "categories" ? movieCats : (viewMode === "channels" ? channels : filteredList);
        
        if (data.length === 0 && !menuFocused) {
            listEl.innerHTML = "<div class='channel'>Nenhum conteúdo encontrado</div>";
        }

        data.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = `channel ${i === selectedIndex ? 'active' : ''}`;
            div.innerHTML = `<span>${item.titulo || item.name || item}</span>`;
            listEl.appendChild(div);
        });

        // Preview do Poster
        const current = data[selectedIndex];
        if (!menuFocused && current && current.poster) {
            posterEl.src = current.poster;
            posterEl.style.display = "block";
        } else {
            posterEl.style.display = "none";
        }
    }

    function handleSelection() {
        const data = viewMode === "categories" ? movieCats : (viewMode === "channels" ? channels : filteredList);
        const item = data[selectedIndex];

        if (viewMode === "categories") {
            const catBusca = item.toUpperCase();
            filteredList = movies.filter(m => {
                const mGen = (m.genero || "").toUpperCase();
                // Se clicar em Lançamentos 2025, filtra pelo ano. Se não, pelo gênero.
                if (catBusca.includes("2025")) return m.year === "2025";
                return mGen.includes(catBusca) || catBusca.includes(mGen);
            });
            viewMode = "list";
            selectedIndex = 0;
            render();
        } else if (item.url) {
            videoEl.src = item.url;
            videoEl.play();
            listEl.style.display = "none";
            menuFocused = true;
        }
    }

    // CONTROLES DE TECLADO
    document.addEventListener('keydown', (e) => {
        if (e.key === "ArrowRight" && menuFocused) {
            menuFocused = false;
            viewMode = menuItems[menuIndex].getAttribute('data-type');
            listEl.style.display = "block";
            selectedIndex = 0;
        } else if (e.key === "ArrowLeft" && !menuFocused) {
            if (viewMode === "list") { viewMode = "categories"; } 
            else { menuFocused = true; listEl.style.display = "none"; }
        } else if (e.key === "ArrowUp") {
            if (menuFocused) menuIndex = Math.max(0, menuIndex - 1);
            else selectedIndex = Math.max(0, selectedIndex - 1);
        } else if (e.key === "ArrowDown") {
            if (menuFocused) menuIndex = Math.min(menuItems.length - 1, menuIndex + 1);
            else {
                let limit = viewMode === "categories" ? movieCats.length : (viewMode === "channels" ? channels.length : filteredList.length);
                selectedIndex = Math.min(limit - 1, selectedIndex + 1);
            }
        } else if (e.key === "Enter") {
            if (!menuFocused) handleSelection();
        }

        menuItems.forEach((m, i) => m.classList.toggle('active', i === menuIndex));
        render();
    });

    window.onload = loadMovies;
</script>
</body>
</html>
