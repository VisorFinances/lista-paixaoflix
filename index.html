<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix – Web TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logo512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
:root{--primary:#e50914;--bg:#111}
body{margin:0;background:#000;color:#fff;font-family:Poppins;display:flex;height:100vh;overflow:hidden}
*{scrollbar-width:none}*::-webkit-scrollbar{display:none}

#side{width:340px;background:var(--bg);display:flex;flex-direction:column;border-right:1px solid #222}
#top{padding:20px}
#header-row{display:flex;justify-content:space-between;align-items:center}
#logo{max-width:150px}
#clock{font-size:22px;font-weight:700}
#date{font-size:12px;opacity:.8}

#search{width:100%;padding:14px;border-radius:8px;border:1px solid var(--primary);background:#000;color:#fff}
#search.focus{outline:3px solid #fff}

#now-playing-bar{padding:10px 20px;font-size:13px;color:#aaa;display:flex;gap:8px}
.play-icon-small{width:12px;height:12px;fill:var(--primary)}

#buttons{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:10px}
#buttons button{padding:10px;border-radius:6px;background:#222;color:#fff;font-weight:700;border:0}
#buttons button.active{background:var(--primary)}
#buttons button.focus{outline:3px solid #fff}

#list{flex:1;overflow-y:auto}
.item{padding:14px;border-bottom:1px solid #222;border-left:5px solid transparent}
.item.focus{border-left-color:var(--primary);background:rgba(255,255,255,.05)}

#player{flex:1;position:relative}
video{width:100%;height:100%}

#overlay-zap{position:absolute;bottom:60px;left:40px;background:rgba(0,0,0,.8);padding:15px 30px;border-left:8px solid var(--primary);display:none}
#zap-title{font-size:28px;font-weight:700}
</style>
</head>

<body>

<div id="side">
  <div id="top">
    <div id="header-row">
      <img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logo.png?raw=true">
      <div>
        <div id="clock"></div>
        <div id="date"></div>
      </div>
    </div>
    <input id="search" placeholder="Pesquisar...">
  </div>

  <div id="now-playing-bar">
    <svg class="play-icon-small" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    <span>Assistindo agora: <b id="current-title">Nenhum conteúdo</b></span>
  </div>

  <div id="buttons">
    <button id="btnTV">TV</button>
    <button id="btnFilmes">FILMES</button>
    <button id="btnSeries">SÉRIES</button>
    <button id="btnKidsCanais" style="background:#0056b3">CANAIS KIDS</button>
    <button id="btnKidsConteudo" style="background:#0056b3">FILMES/SÉRIES KIDS</button>
    <button id="btnFav">FAVORITOS</button>
  </div>

  <div id="list"></div>
</div>

<div id="player">
  <video id="video" autoplay playsinline></video>
  <div id="overlay-zap"><div id="zap-title"></div></div>
</div>

<script>
const video=document.getElementById('video');
const list=document.getElementById('list');
const search=document.getElementById('search');
const currentTitle=document.getElementById('current-title');

let items=[],focusables=[],focusIndex=0,mode='tv',hls=null,zapTimer=null;

/* ===== DATA / HORA ===== */
function updateClock(){
  const d=new Date();
  clock.innerText=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
  date.innerText=d.toLocaleDateString('pt-BR');
}
setInterval(updateClock,1000);updateClock();

/* ===== PLAYER ===== */
function playItem(item,zap=false){
  currentTitle.innerText=item.nome;
  if(hls){hls.destroy();hls=null}
  if(item.url.includes('.m3u8') && Hls.isSupported()){
    hls=new Hls();hls.loadSource(item.url);hls.attachMedia(video);
  }else video.src=item.url;
  video.play().catch(()=>{});

  if(zap){
    zap-title.innerText=item.nome;
    overlay-zap.style.display='block';
    clearTimeout(zapTimer);
    zapTimer=setTimeout(()=>overlay-zap.style.display='none',2000);
  }
}

/* ===== RENDER ===== */
function render(listData=items){
  list.innerHTML='';
  listData.forEach(i=>{
    const d=document.createElement('div');
    d.className='item';
    d.tabIndex=0;
    d.innerText=i.nome;
    d.onclick=()=>playItem(i,true);
    list.appendChild(d);
  });
  refreshFocus();
}

/* ===== FOCO ===== */
function refreshFocus(){
  focusables=[
    search,
    ...document.querySelectorAll('#buttons button'),
    ...document.querySelectorAll('.item')
  ];
}
function updateFocus(){
  focusables.forEach((e,i)=>e.classList.toggle('focus',i===focusIndex));
  focusables[focusIndex]?.focus();
}

/* ===== ZAP ===== */
function zap(dir){
  if(!items.length)return;
  focusIndex=(focusIndex+dir+items.length)%items.length;
  playItem(items[focusIndex],true);
  updateFocus();
}

/* ===== TECLAS (LG / SAMSUNG / ANDROID) ===== */
document.addEventListener('keydown',e=>{
  const k=e.keyCode;
  if(k===38||k===37)focusIndex--;
  if(k===40||k===39)focusIndex++;
  if(k===13)focusables[focusIndex]?.click();
  if(k===427)zap(1);
  if(k===428)zap(-1);
  focusIndex=(focusIndex+focusables.length)%focusables.length;
  updateFocus();
});

/* ===== PESQUISA ===== */
search.addEventListener('input',()=>{
  const q=search.value.toLowerCase();
  render(items.filter(i=>i.nome.toLowerCase().includes(q)));
});

/* ===== TV ===== */
async function loadTV(){
  mode='tv';items=[];
  const txt=await fetch('canais.m3u').then(r=>r.text());
  let name='';
  txt.split('\n').forEach(l=>{
    if(l.startsWith('#EXTINF'))name=l.split(',').pop();
    if(l.startsWith('http'))items.push({nome:name.trim(),url:l.trim()});
  });
  render();
  if(items.length)playItem(items[0],true);
}

btnTV.onclick=loadTV;
window.onload=loadTV;
</script>

</body>
</html>
