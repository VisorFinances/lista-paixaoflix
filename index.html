<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins;}
body{background:#000;color:#fff;overflow:hidden;height:100vh;}
::-webkit-scrollbar{display:none;}
#app{display:flex;height:100%;}

/* SIDEBAR */
#side{width:420px;background:#111;display:flex;flex-direction:column;border-right:1px solid #222;}
#header{display:flex;align-items:center;gap:12px;padding:16px;}
#header img{width:160px;}
#timebox{margin-left:auto;text-align:right;}
#clock{font-size:20px;color:#fff;}
#date{font-size:12px;color:#fff;opacity:.9;}

/* SEARCH */
#search{margin:10px 16px;padding:10px;font-size:16px;background:#000;color:#fff;border:2px solid #e50914;border-radius:6px;outline:none;}
#search.focus{outline:3px solid #fff;}

/* NOW PLAYING */
#now{margin:0 16px;font-size:13px;color:#fff;margin-bottom:10px;}
#now span{font-size:14px;color:#fff;font-weight:400;}

/* MENU */
#menu{margin:0 16px;display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:10px;}
.btn{padding:6px;font-size:14px;background:#222;border-radius:6px;text-align:center;cursor:pointer;user-select:none;outline:none;}
.btn.active{background:#e50914;}
.btn.kids{background:#0056b3;}
.btn.focus{outline:3px solid #fff;}

/* LIST */
#list{flex:1;overflow-y:auto;}
.item{padding:12px;border-bottom:1px solid #222;display:flex;justify-content:space-between;font-size:16px;cursor:pointer;}
.item.focus{background:#222;border-left:6px solid #e50914;}
.fav-icon{opacity:0.3;cursor:pointer;}
.item.is-fav .fav-icon{opacity:1;color:#e50914;}

/* PLAYER */
#player{flex:1;position:relative;}
video{width:100%;height:100%;}

/* OVERLAY */
#zap{position:absolute;bottom:40px;left:40px;background:rgba(0,0,0,.8);padding:10px 20px;font-size:20px;border-left:6px solid #e50914;display:none;}
#overlay-meta{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;display:none;flex-direction:column;justify-content:center;padding:60px;box-sizing:border-box;}
#overlay-meta::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,#000 45%,transparent 100%);z-index:1;}
#overlay-meta *{z-index:2;position:relative;}
#overlay-meta h1{font-size:50px;margin:0;}
.meta-extra{color:#e50914;font-weight:bold;font-size:20px;margin:10px 0;}
#overlay-meta p{font-size:18px;color:#ccc;line-height:1.4;max-width:550px;}
.btn-meta{padding:16px;font-weight:bold;border-radius:6px;border:none;cursor:pointer;font-size:16px;outline:none;}
.btn-play{background:#e50914;color:#fff;margin-right:10px;}
.btn-back{background:#333;color:#fff;}
</style>
</head>
<body>
<div id="app">
<div id="side">
<div id="header">
<img src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<div id="timebox">
<div id="clock"></div>
<div id="date"></div>
</div>
</div>

<input id="search" placeholder="Pesquisar...">
<div id="now">Assistindo agora: <span>—</span></div>

<div id="menu">
<div class="btn active" data-session="tv">TV</div>
<div class="btn" data-session="filmes">Filmes</div>
<div class="btn" data-session="series">Séries</div>
<div class="btn kids" data-session="kids">Canal Kids</div>
<div class="btn kids" data-session="kidsconteudo">Filmes/Séries Kids</div>
<div class="btn" data-session="fav">Favoritos</div>
</div>

<div id="list"></div>
</div>

<div id="player">
<video id="video" autoplay></video>
<div id="zap"></div>
<div id="overlay-meta">
<h1 id="meta-title"></h1>
<div class="meta-extra">★ <span id="meta-rating">--</span> | <span id="meta-year">----</span></div>
<p id="meta-desc"></p>
<div style="display:flex;margin-top:20px;">
<button class="btn-meta btn-play" id="btn-start">ASSISTIR AGORA</button>
<button class="btn-meta btn-back" id="btn-close">VOLTAR</button>
</div>
</div>
</div>
</div>

<script>
const video=document.getElementById('video'),
list=document.getElementById('list'),
zap=document.getElementById('zap'),
overlayMeta=document.getElementById('overlay-meta'),
nowTitle=document.querySelector('#now span'),
searchInput=document.getElementById('search');

let session='tv',items=[],view=[],idx=0,hls=null,favs=[],focusable=[],currentSerie=null;

/* ===== CLOCK ===== */
function updateClock(){
const d=new Date();
document.getElementById('clock').innerText=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
document.getElementById('date').innerText=d.toLocaleDateString('pt-BR');
}
setInterval(updateClock,1000); updateClock();

/* ===== FAVS ===== */
function loadFavs(){return JSON.parse(localStorage.getItem('flix_favs')||'[]');}
function toggleFav(item){
let f=loadFavs();
const idx=f.findIndex(x=>x.titulo===item.titulo);
if(idx>-1)f.splice(idx,1); else f.push(item);
localStorage.setItem('flix_favs',JSON.stringify(f));
render();
}

/* ===== FETCH JSON/M3U ===== */
async function loadSessionData(sess){
session=sess;items=[];view=[];
let url='';
if(sess==='tv') url='data/canais.m3u';
else if(sess==='filmes') url='data/filmes.json';
else if(sess==='series') url='data/series.json';
else if(sess==='kids') url='data/kids_canais.m3u';
else if(sess==='kidsconteudo'){
const f=await fetch('data/kids_filmes.json').then(r=>r.json());
const s=await fetch('data/kids_series.json').then(r=>r.json());
items=[...f,...s]; render(); return;
}else if(sess==='fav'){items=loadFavs(); render(); return;}

if(url.endsWith('.m3u')){
const txt=await fetch(url).then(r=>r.text());
let n='';
txt.split('\n').forEach(l=>{
if(l.startsWith('#EXTINF')) n=l.split(',').pop();
else if(l.startsWith('http')) items.push({titulo:n,url:l,type:'tv'});
});
}else{
items=await fetch(url).then(r=>r.json());
}
render();
if(items.length>0) play(0);
}

/* ===== RENDER LIST ===== */
function render(){
list.innerHTML='';
view=items.slice();
view.forEach((i,n)=>{
const d=document.createElement('div');
const fav=loadFavs().some(f=>f.titulo===i.titulo);
d.className='item'+(fav?' is-fav':'');
d.innerHTML=`<span>${i.titulo||i.nome}</span><span class="fav-icon">★</span>`;
d.querySelector('.fav-icon').onclick=e=>{e.stopPropagation(); toggleFav(i);}
d.onclick=()=>{if(i.type==='tv')play(n);else showMeta(i);}
list.appendChild(d);
});
updateFocusables();
focusIndex=0; refreshFocus();
}

/* ===== PLAY TV ===== */
function play(i){
idx=i; const it=view[i]; if(!it)return;
if(hls){hls.destroy();hls=null;}
if(it.url?.includes('.m3u8')&&Hls.isSupported()){hls=new Hls();hls.loadSource(it.url);hls.attachMedia(video);}
else video.src=it.url;
video.play().catch(()=>{});
nowTitle.innerText=it.titulo||it.nome;
zap.innerText=it.titulo||it.nome;
zap.style.display='block';
setTimeout(()=>zap.style.display='none',1200);
}

/* ===== META PLAYER ===== */
function showMeta(i){
document.getElementById('meta-title').innerText=i.titulo||i.nome;
document.getElementById('meta-desc').innerText=i.desc||'Sem descrição';
document.getElementById('meta-year').innerText=i.year||'----';
document.getElementById('meta-rating').innerText=i.rating||'--';
overlayMeta.style.display='flex';
document.getElementById('btn-start').onclick=()=>{if(i.url)play(view.indexOf(i));}
document.getElementById('btn-close').onclick=()=>overlayMeta.style.display='none';
}

/* ===== NAVIGATION ===== */
let focusIndex=0;
function updateFocusables(){
focusable=[searchInput,...document.querySelectorAll('#menu .btn'),...document.querySelectorAll('#list .item'),document.getElementById('btn-start'),document.getElementById('btn-close')];
}
function refreshFocus(){
focusable.forEach((e,i)=>e.classList.toggle('focus',i===focusIndex));
const el=focusable[focusIndex];if(el?.scrollIntoView)el.scrollIntoView({block:'center'});
}
document.addEventListener('keydown',e=>{
if(e.key==='ArrowDown'){focusIndex=Math.min(focusIndex+1,focusable.length-1);refreshFocus();}
if(e.key==='ArrowUp'){focusIndex=Math.max(focusIndex-1,0);refreshFocus();}
if(e.key==='ArrowLeft'){if(focusable[focusIndex].id==='btn-start'||focusable[focusIndex].id==='btn-close')focusIndex=focusable.indexOf(document.querySelector('#list .item.focus'));refreshFocus();}
if(e.key==='ArrowRight'){if(focusable[focusIndex].id==='btn-start'||focusable[focusIndex].id==='btn-close')focusIndex=focusable.indexOf(document.querySelector('#list .item.focus'));refreshFocus();}
if(e.key==='Enter'){focusable[focusIndex]?.click();}
});

/* ===== MENU BUTTONS ===== */
document.querySelectorAll('#menu .btn').forEach(b=>b.onclick=()=>loadSessionData(b.dataset.session));

/* ===== SEARCH ===== */
searchInput.addEventListener('input',()=>{
const q=searchInput.value.toLowerCase();
view=items.filter(i=>(i.titulo||i.nome).toLowerCase().includes(q));
render();
});

/* ===== INIT ===== */
loadSessionData('tv');
</script>
</body>
</html>
