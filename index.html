<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixãoFlix TV – PROJETO FINAL COMPLETO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;outline:none}
body{background:#040714;color:#fff;width:100vw;height:100vh;overflow:hidden}
.focused{border:5px solid #FFCE44!important;box-shadow:0 0 25px rgba(255,206,68,1);transform:scale(1.05);z-index:9999}
#topBar{position:fixed;top:0;width:100%;height:90px;display:flex;align-items:center;justify-content:space-between;padding:0 50px;background:#040714;border-bottom:1px solid rgba(255,255,255,.1);z-index:5000}
#logoMain{height:70px;cursor:pointer;border:5px solid transparent}
#searchWrapper{display:flex;align-items:center;background:rgba(255,255,255,.1);padding:10px 20px;border-radius:50px;width:400px;border:3px solid transparent}
#searchInput{background:none;border:none;color:#fff;font-size:18px;width:100%;margin-left:10px}
#jsonStatus{color:#FFCE44;font-weight:900}
#barDateTime{font-weight:500}
#sideMenu{position:fixed;left:0;top:90px;width:80px;height:calc(100vh - 90px);background:#040714;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;align-items:center;padding-top:20px;transition:.3s;z-index:6000}
#sideMenu.active{width:220px}
.menu-item{width:100%;height:60px;display:flex;align-items:center;padding-left:28px;color:#a0a0a0;cursor:pointer;border:4px solid transparent}
.menu-item i{font-size:24px;min-width:40px}
.menu-item span{display:none;margin-left:15px;font-weight:600}
#sideMenu.active span{display:block}
#mainScroll{position:absolute;top:90px;left:80px;width:calc(100% - 80px);height:calc(100% - 90px);overflow-y:auto;padding-bottom:300px}
#mainScroll::-webkit-scrollbar{display:none}
.hero-banner{width:95%;height:380px;margin:30px auto;border-radius:25px;display:flex;flex-direction:column;justify-content:flex-end;padding:40px;background-size:cover;background-position:center;border:4px solid transparent}
.hero-banner h1{font-size:60px;font-weight:900;text-shadow:0 0 30px #000}
.hero-banner p{font-size:22px;font-weight:500}
.top-container{display:grid;grid-template-columns:repeat(4,1fr);gap:50px;padding:0 50px;margin-bottom:120px}
.top-item{position:relative;border:4px solid transparent;cursor:pointer}
.top-number{position:absolute;left:-50px;bottom:10px;font-size:210px;font-weight:900;color:#003399;-webkit-text-stroke:4px #FFCE44;line-height:.7;pointer-events:none}
.category-block{margin:0 50px 80px}
.cat-header{font-size:30px;font-weight:900;margin-bottom:30px;border-left:8px solid #FFCE44;padding-left:20px}
.carousel-container{display:flex;gap:20px;align-items:center;overflow:hidden}
.movie-grid-horizontal{display:flex;gap:20px;transition:.5s;width:max-content}
.movie-card{width:300px;background:#1a1d29;border-radius:12px;border:4px solid transparent;cursor:pointer;position:relative}
.movie-poster{width:100%;aspect-ratio:2/3;border-radius:8px;object-fit:cover}
.meta-card{background:rgba(0,0,0,.85);display:flex;justify-content:center;gap:15px;color:#FFCE44;font-weight:900;padding:6px;border-radius:0 0 8px 8px}
.progress-bar{height:6px;background:#333}
.progress-bar span{display:block;height:100%;background:#FFCE44}
.nav-arrow{min-width:80px;height:150px;border-radius:15px;border:4px solid #FFCE44;color:#FFCE44;font-size:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.kids-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:25px}
#videoContainer{position:fixed;inset:0;background:#000;display:none;z-index:99999}
#profileGate{position:fixed;inset:0;background:radial-gradient(circle at top,#0b0f2a,#040714);display:flex;align-items:center;justify-content:center;z-index:100000}
.profile-wrapper{text-align:center}
.profile-wrapper h1{font-size:48px;margin-bottom:50px}
.profile-grid{display:flex;gap:50px}
.profile-card{width:200px;border:4px solid transparent;cursor:pointer}
.profile-card img{width:100%;border-radius:20px}
.profile-card span{display:block;margin-top:15px;font-size:22px;font-weight:700}
</style>
</head>

<body onload="initSystem()">

<div id="profileGate" style="display:none">
<div class="profile-wrapper">
<h1>Quem está assistindo?</h1>
<div class="profile-grid" id="profileGrid"></div>
</div>
</div>

<div id="topBar">
<img id="logoMain" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" tabindex="0" onclick="renderHome()">
<div id="searchWrapper" tabindex="0">
<i class="fas fa-search"></i>
<input id="searchInput" placeholder="Pesquisar..." tabindex="-1" oninput="globalSearch(this.value)">
</div>
<div id="jsonStatus">CARREGANDO...</div>
<div id="barDateTime"></div>
</div>

<div id="sideMenu">
<div class="menu-item" tabindex="0" onclick="renderHome()"><i class="fas fa-home"></i><span>INÍCIO</span></div>
<div class="menu-item" tabindex="0" onclick="renderCategoryList('cinema')"><i class="fas fa-film"></i><span>CINEMA</span></div>
<div class="menu-item" tabindex="0" onclick="renderCategoryList('series')"><i class="fas fa-clapperboard"></i><span>SÉRIES</span></div>
<div class="menu-item" tabindex="0" onclick="renderFavoritos()"><i class="fas fa-heart"></i><span>MINHA LISTA</span></div>
</div>

<div id="mainScroll"><div id="dynamicContent"></div></div>
<div id="videoContainer"><div id="mainPlayer" style="width:100%;height:100%"></div></div>

<script>
let db={cinema:[],series:[],kids_filmes:[],kids_series:[],todos:[]};
let player=null,currentItem=null;

const profiles=[
{name:"Família",avatar:"https://i.imgur.com/9XqZ6zB.png"},
{name:"Adulto",avatar:"https://i.imgur.com/3XKJqQO.png"},
{name:"Kids",avatar:"https://i.imgur.com/9ZQZQZQ.png"}
];

async function initSystem(){
updateClock();setInterval(updateClock,1000);
await loadData();initProfiles();renderHome();setupNavigation();
document.getElementById("logoMain").focus();
}

function initProfiles(){
if(localStorage.getItem("paixaoflix_profile"))return;
const g=document.getElementById("profileGrid");
document.getElementById("profileGate").style.display="flex";
profiles.forEach(p=>{
g.innerHTML+=`<div class="profile-card" tabindex="0" onclick="selectProfile('${p.name}')">
<img src="${p.avatar}"><span>${p.name}</span></div>`;
});
}

function selectProfile(p){
localStorage.setItem("paixaoflix_profile",p);
document.getElementById("profileGate").style.display="none";
}

async function loadData(){
const files=["filmes.json","series.json","kids_filmes.json","kids_series.json"];
const data=await Promise.all(files.map(f=>fetch("data/"+f).then(r=>r.json()).catch(()=>[])));
db.cinema=data[0];db.series=data[1];db.kids_filmes=data[2];db.kids_series=data[3];
db.todos=[...db.cinema,...db.series,...db.kids_filmes,...db.kids_series];
document.getElementById("jsonStatus").innerText="TÍTULOS: "+db.todos.length;
}

function updateClock(){
const d=new Date();
document.getElementById("barDateTime").innerText=
d.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})
+" "+d.toLocaleTimeString("pt-BR");
}

function renderHero(){
const d=db.todos[Math.floor(Math.random()*db.todos.length)];
return `<div class="hero-banner" tabindex="0"
onclick="handleSelect('${btoa(d.titulo)}')"
style="background-image:linear-gradient(to bottom,transparent,#040714),url('${d.banner||d.poster}')">
<h1>${d.titulo}</h1><p>${d.genero||""}</p></div>`;
}

function renderHome(){
const c=document.getElementById("dynamicContent");
c.innerHTML=`${renderHero()}
<div class="top-container" id="top4"></div>
<div class="category-block"><div class="cat-header">Indicados</div>
<div class="movie-grid-horizontal" id="rec"></div></div>
<div class="category-block" id="cont" style="display:none">
<div class="cat-header">Continuar Assistindo</div>
<div class="movie-grid-horizontal" id="contGrid"></div></div>`;

const top=document.getElementById("top4");
[db.cinema[0],db.series[0],db.kids_filmes[0],db.kids_series[0]].forEach((p,i)=>{
if(p)top.innerHTML+=createCard(p,"top-item",i+1);
});

db.todos.sort(()=>.5-Math.random()).slice(0,6)
.forEach(i=>document.getElementById("rec").innerHTML+=createCard(i,"movie-card"));

const hist=JSON.parse(localStorage.getItem("paixaoflix_history")||"[]");
if(hist.length){
document.getElementById("cont").style.display="block";
hist.filter(h=>h.percent<95).slice(-6).reverse().forEach(h=>{
const it=db.todos.find(t=>t.titulo===h.titulo);
if(it)document.getElementById("contGrid").innerHTML+=createCard(it,"movie-card",null,h.percent);
});
}
}

function renderCategoryList(type){
const c=document.getElementById("dynamicContent");
c.innerHTML="";
const cats=[...new Set(db[type].map(i=>i.genero||"Outros"))];
cats.forEach(cat=>{
const list=db[type].filter(i=>(i.genero||"Outros")==cat);
if(list.length){
const id="g"+Math.random();
c.innerHTML+=`<div class="category-block">
<div class="cat-header">${cat}</div>
<div class="carousel-container">
<div class="movie-grid-horizontal" id="${id}" data-offset="0"></div>
<div class="nav-arrow" tabindex="0" onclick="jumpNext('${id}')"><i class="fas fa-chevron-right"></i></div>
</div></div>`;
list.forEach(i=>document.getElementById(id).innerHTML+=createCard(i,"movie-card"));
}
});
}

function jumpNext(id){
const g=document.getElementById(id);
const o=parseInt(g.dataset.offset||0)+4;
g.dataset.offset=o;
g.style.transform=`translateX(-${o*320}px)`;
}

function createCard(i,cls,num=null,prog=null){
return `<div class="${cls}" tabindex="0" onclick="handleSelect('${btoa(i.titulo)}')">
${num?`<span class="top-number">${num}</span>`:""}
<img class="movie-poster" src="${i.poster}">
${prog?`<div class="progress-bar"><span style="width:${prog}%"></span></div>`:""}
<div class="meta-card"><span>${i.year||""}</span><span>★ ${i.rating||"0.0"}</span></div>
</div>`;
}

function handleSelect(id){
const it=db.todos.find(i=>btoa(i.titulo)==id);
if(!it)return;currentItem=it;
const hist=JSON.parse(localStorage.getItem("paixaoflix_history")||"[]");
const s=hist.find(h=>h.titulo===it.titulo);
playVideo(it.url,s?s.time:0);
}

function playVideo(url,time){
document.getElementById("videoContainer").style.display="block";
if(player)player.destroy();
player=new Clappr.Player({
source:url,parentId:"#mainPlayer",autoPlay:true,
events:{
onReady(){if(time)this.seek(time)},
onTimeUpdate(e){
let h=JSON.parse(localStorage.getItem("paixaoflix_history")||"[]");
h=h.filter(x=>x.titulo!==currentItem.titulo);
h.push({titulo:currentItem.titulo,time:e.current,percent:(e.current/e.total)*100});
localStorage.setItem("paixaoflix_history",JSON.stringify(h.slice(-30)));
}}
});
}

function globalSearch(q){
if(!q){renderHome();return;}
const c=document.getElementById("dynamicContent");
c.innerHTML=`<div class="category-block"><div class="cat-header">Busca</div>
<div class="kids-grid" id="sg"></div></div>`;
db.todos.filter(i=>i.titulo.toLowerCase().includes(q.toLowerCase()))
.forEach(i=>document.getElementById("sg").innerHTML+=createCard(i,"movie-card"));
}

function renderFavoritos(){
const favs=JSON.parse(localStorage.getItem("paixaoflix_favs")||"[]");
const c=document.getElementById("dynamicContent");
c.innerHTML=`<div class="category-block"><div class="cat-header">Minha Lista</div>
<div class="kids-grid" id="fg"></div></div>`;
favs.forEach(t=>{
const it=db.todos.find(i=>i.titulo===t);
if(it)document.getElementById("fg").innerHTML+=createCard(it,"movie-card");
});
}

function setupNavigation(){
document.addEventListener("keydown",e=>{
if(e.keyCode===27||e.keyCode===8){
if(document.getElementById("videoContainer").style.display==="block"){
document.getElementById("videoContainer").style.display="none";
player.stop();renderHome();
}}
});
document.addEventListener("focusin",e=>{
document.querySelectorAll(".focused").forEach(f=>f.classList.remove("focused"));
if(e.target.tabIndex===0||e.target.classList.contains("menu-item")){
e.target.classList.add("focused");
if(e.target.closest("#sideMenu"))document.getElementById("sideMenu").classList.add("active");
else document.getElementById("sideMenu").classList.remove("active");
}});
}
</script>
</body>
</html>
