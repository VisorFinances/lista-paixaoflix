<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAIXÃOFLIX - Web TV</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary: #e50914; --bg: #141414; --card-bg: #2f2f2f; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; overflow-x: hidden; }
        header { padding: 20px 5%; background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 100%); display: flex; align-items: center; justify-content: space-between; position: fixed; width: 90%; z-index: 100; }
        .logo { color: var(--primary); font-size: 28px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
        
        #player-container { width: 100%; height: 56.25vw; max-height: 80vh; background: black; display: flex; align-items: center; justify-content: center; position: relative; padding-top: 60px; }
        video { width: 100%; height: 100%; outline: none; }

        .category-title { padding: 20px 5% 10px; font-size: 20px; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 0 5% 40px; }
        .card { background: var(--card-bg); border-radius: 4px; overflow: hidden; cursor: pointer; transition: transform 0.3s; position: relative; }
        .card:hover { transform: scale(1.05); z-index: 10; }
        .card img { width: 100%; height: 230px; object-fit: cover; }
        .card-info { padding: 10px; font-size: 14px; text-align: center; }
        
        .loading { position: absolute; font-size: 18px; color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="logo">PaixãoFlix</div>
</header>

<div id="player-container">
    <div class="loading" id="status">Selecione um canal ou série</div>
    <video id="video" controls></video>
</div>

<div id="content">
    </div>

<script>
    // URL da sua lista M3U (vinda do Cloudflare Worker ou Direta)
    const m3uUrl = 'https://tv.paixaoflix.vip/online.m3u';
    const video = document.getElementById('video');
    const status = document.getElementById('status');

    async function loadM3U() {
        try {
            const response = await fetch(m3uUrl);
            const data = await response.text();
            parseM3U(data);
        } catch (err) {
            status.innerText = "Erro ao carregar lista. Verifique o CORS.";
        }
    }

    function parseM3U(content) {
        const lines = content.split('\n');
        let currentCategory = "";
        let categories = {};

        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF')) {
                const info = lines[i];
                const url = lines[i + 1]?.trim();
                const title = info.split(',')[1];
                const groupMatch = info.match(/group-title="([^"]+)"/);
                const category = groupMatch ? groupMatch[1] : "OUTROS";

                if (!categories[category]) categories[category] = [];
                categories[category].push({ title, url });
            }
        }
        renderGrid(categories);
    }

    function renderGrid(categories) {
        const container = document.getElementById('content');
        container.innerHTML = '';

        for (let cat in categories) {
            const section = document.createElement('div');
            section.innerHTML = `<div class="category-title">${cat}</div>`;
            const grid = document.createElement('div');
            grid.className = 'grid';

            categories[cat].forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                // Lógica de Capa: Se for série "EPC", usa capa fixa, senão usa logo genérica
                const poster = item.title.includes("E.P.C") ? 
                    "https://www.themoviedb.org/t/p/w600_and_h900_bestv2/75pW83Fv9M9L5q7G6Y6F3NqfXhB.jpg" : 
                    "https://via.placeholder.com/300x450/2f2f2f/ffffff?text=" + item.title;

                card.innerHTML = `
                    <img src="${poster}" alt="Poster">
                    <div class="card-info">${item.title}</div>
                `;
                card.onclick = () => playVideo(item.url, item.title);
                grid.appendChild(card);
            });
            section.appendChild(grid);
            container.appendChild(section);
        }
    }

    function playVideo(url, title) {
        status.style.display = 'none';
        if (Hls.isSupported() && url.includes('m3u8')) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = url;
            video.play().catch(() => {
                alert("Erro: Este navegador bloqueou o conteúdo HTTP. Tente usar o player via App ou configurar o Proxy HTTPS no Worker.");
            });
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    loadM3U();
</script>

</body>
</html>
