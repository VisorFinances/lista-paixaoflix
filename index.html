<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

#app {
    display: flex;
    height: 100%;
}

/* MENU LATERAL FIXO */
#menu {
    width: 260px;
    background: #1a1a1a;
    display: flex;
    flex-direction: column;
    z-index: 30;
    padding: 12px;
    box-sizing: border-box;
    border-right: 1px solid #333;
}

#menuHeader {
    padding: 15px 10px;
    text-align: center;
    border-bottom: 1px solid #222;
    margin-bottom: 15px;
}

#menuHeader img {
    height: 70px;
    object-fit: contain;
}

#clock {
    margin-top: 10px;
    font-size: 13px;
    color: #aaa;
}

.menu-item {
    padding: 12px 15px; 
    font-size: 15px;    
    margin-bottom: 8px;
    border-radius: 8px;
    background: #222;
    border: 1px solid #333;
    transition: all 0.2s ease-in-out;
    display: flex;
    align-items: center;
    color: #ccc;
    box-shadow: 0 3px 0 #000;
}

.menu-item i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

.menu-item.active {
    background: #333;
    color: #fff;
    border: 1px solid #ff9800;
    box-shadow: 0 0 10px rgba(255, 152, 0, 0.4), 0 3px 0 #b36b00;
    font-weight: bold;
    transform: scale(1.02);
}

#content {
    flex: 1;
    position: relative;
    background: black;
}

#videoContainer {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #000;
    z-index: 5;
}

video {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

#channelList {
    position: absolute;
    top: 0;
    left: 0;
    width: 320px; 
    height: 100%;
    background: rgba(0, 0, 0, 0.92);
    display: none;
    z-index: 40;
    overflow-y: auto;
    border-right: 1px solid #ff9800;
}

.channel {
    padding: 15px 20px;
    font-size: 16px;
    border-bottom: 1px solid #222;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.channel.active {
    background: #ff9800;
    color: #000;
    font-weight: bold;
}

.fav-icon {
    color: #888;
    font-size: 14px;
}

.active .fav-icon { color: #000; }

#posterPreview {
    position: absolute;
    top: 50%;
    left: 340px; 
    transform: translateY(-50%);
    width: 300px;
    height: 450px;
    border-radius: 12px;
    z-index: 45;
    display: none;
    object-fit: cover;
    border: 3px solid #ff9800;
}

.menu-item.kids { border-left: 3px solid #ffeb3b; color: #ffeb3b; }
.menu-item.kids.active { background: linear-gradient(145deg, #ff9800, #f44336); color: #fff; }
</style>
</head>

<body>
<div id="app">
    <div id="menu">
        <div id="menuHeader">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="Logo">
            <div id="clock"></div>
        </div>
        <div class="menu-item active" data-type="channels"><i class="fas fa-tv"></i> TV ao vivo</div>
        <div class="menu-item" data-type="fav"><i class="fas fa-star" style="color: #ffeb3b;"></i> Favoritos</div>
        <div class="menu-item" data-type="categories"><i class="fas fa-film"></i> Cinema</div>
        <div class="menu-item" data-type="series"><i class="fas fa-clapperboard"></i> Séries</div>
        <div class="menu-item kids" data-type="kids_channels"><i class="fas fa-child"></i> Canal Kids</div>
        <div class="menu-item kids" data-type="kids_movies"><i class="fas fa-icons"></i> Filmes Kids</div>
        <div class="menu-item kids" data-type="kids_series"><i class="fas fa-robot"></i> Séries Kids</div>
    </div>

    <div id="content">
        <div id="videoContainer">
            <video id="video" autoplay playsinline></video>
        </div>
        <img id="posterPreview" src="" alt="Poster">
        <div id="channelList"></div>
    </div>
</div>

<script>
const video = document.getElementById("video");
const channelList = document.getElementById("channelList");
const posterPreview = document.getElementById("posterPreview");
const menuItems = document.querySelectorAll(".menu-item");

let channels = [], kidsChannels = [], movies = [], series = [], kidsMovies = [], kidsSeries = [], episodes = [], favorites = [];
let filteredList = []; 
let viewMode = "channels"; 
let selectedIndex = 0;
let menuIndex = 0; 
let listOpen = false;
let menuFocused = true; 
let hls = null;

const movieCategories = ["Lançamentos 2026","Lançamentos 2025","AÇÃO", "AVENTURA", "ANIME", "ANIMAÇÃO", "COMÉDIA", "DRAMA", "DORAMA", "SUSPENSE", "POLICIAL", "TERROR", "DOCUMENTÁRIOS", "FICÇÃO CIENTÍFICA", "CLÁSSICOS", "FAROESTE", "NACIONAL", "ROMANCE", "RELIGIOSO", "ADULTO"];

function updateClock() {
    const d = new Date();
    const meses = ["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"];
    document.getElementById("clock").innerText = `${d.getDate()} ${meses[d.getMonth()]} ${d.getFullYear()} | ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
}
setInterval(updateClock, 1000); updateClock();

function playMedia(url) {
    if (!url) return;
    if (hls) { hls.destroy(); hls = null; }
    if (Hls.isSupported() && (url.includes(".m3u8") || url.includes("stream"))) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(() => {}));
    } else {
        video.src = url;
        video.load();
        video.play().catch(() => {});
    }
}

function loadM3U(path, targetArray, isMain) {
    fetch(path).then(r => r.text()).then(text => {
        const lines = text.split("\n");
        let temp = null;
        lines.forEach(l => {
            l = l.trim();
            if (l.startsWith("#EXTINF")) {
                temp = { titulo: l.split(",").pop(), url: "" };
            } else if (l.startsWith("http") && temp) {
                temp.url = l;
                targetArray.push(temp);
                temp = null;
            }
        });
        // Iniciar primeiro canal automaticamente
        if (isMain && targetArray.length > 0) playMedia(targetArray[0].url);
    });
}

// Carregamento de dados
loadM3U("data/canais.m3u", channels, true);
loadM3U("data/kids_canais.m3u", kidsChannels, false);
fetch("data/filmes.json").then(r => r.json()).then(data => movies = data);
fetch("data/series.json").then(r => r.json()).then(data => series = data);
fetch("data/kids_filmes.json").then(r => r.json()).then(data => kidsMovies = data);
fetch("data/kids_series.json").then(r => r.json()).then(data => kidsSeries = data);
fetch("data/favoritos.json").then(r => r.json()).then(data => favorites = data).catch(() => favorites = []);

function renderList() {
    channelList.innerHTML = "";
    let currentData = [];
    if (viewMode === "channels") currentData = channels;
    else if (viewMode === "kids_channels") currentData = kidsChannels;
    else if (viewMode === "categories") currentData = movieCategories;
    else if (viewMode === "movies") currentData = filteredList;
    else if (viewMode === "fav") currentData = favorites;

    currentData.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "channel" + (i === selectedIndex ? " active" : "");
        const title = item.titulo || item.name || item;
        div.innerHTML = `<span>${title}</span> <i class="fas fa-star fav-icon"></i>`;
        channelList.appendChild(div);
    });
    
    if (listOpen && (viewMode === "movies" || viewMode === "fav") && currentData[selectedIndex]?.poster) {
        posterPreview.src = currentData[selectedIndex].poster;
        posterPreview.style.display = "block";
    } else {
        posterPreview.style.display = "none";
    }
    
    const activeItem = channelList.querySelector(".active");
    if (activeItem) activeItem.scrollIntoView({ block: "center" });
}

function renderMenu() {
    menuItems.forEach((item, i) => item.classList.toggle("active", i === menuIndex));
}

function openCategory() {
    const type = menuItems[menuIndex].getAttribute("data-type");
    listOpen = true;
    menuFocused = false;
    channelList.style.display = "block";
    selectedIndex = 0;

    if (type === "channels") viewMode = "channels";
    else if (type === "fav") viewMode = "fav";
    else if (type === "categories") viewMode = "categories";
    else if (type === "series") { viewMode = "movies"; filteredList = series; }
    else if (type === "kids_channels") viewMode = "kids_channels";
    else if (type === "kids_movies") { viewMode = "movies"; filteredList = kidsMovies; }
    else if (type === "kids_series") { viewMode = "movies"; filteredList = kidsSeries; }
    renderList();
}

document.addEventListener("keydown", e => {
    let listSize = 0;
    if (viewMode === "channels") listSize = channels.length;
    else if (viewMode === "kids_channels") listSize = kidsChannels.length;
    else if (viewMode === "categories") listSize = movieCategories.length;
    else if (viewMode === "movies") listSize = filteredList.length;
    else if (viewMode === "fav") listSize = favorites.length;

    switch (e.key) {
        case "ArrowUp":
            if (menuFocused) {
                menuIndex = (menuIndex - 1 + menuItems.length) % menuItems.length;
                renderMenu();
            } else if (listOpen && listSize > 0) {
                selectedIndex = (selectedIndex - 1 + listSize) % listSize;
                renderList();
            }
            break;
        case "ArrowDown":
            if (menuFocused) {
                menuIndex = (menuIndex + 1) % menuItems.length;
                renderMenu();
            } else if (listOpen && listSize > 0) {
                selectedIndex = (selectedIndex + 1) % listSize;
                renderList();
            }
            break;
        case "ArrowRight":
            if (menuFocused) openCategory();
            break;
        case "ArrowLeft":
            if (listOpen) {
                if (viewMode === "movies" && menuItems[menuIndex].getAttribute("data-type") === "categories") {
                    viewMode = "categories";
                    selectedIndex = 0;
                    renderList();
                } else {
                    listOpen = false;
                    menuFocused = true;
                    channelList.style.display = "none";
                    posterPreview.style.display = "none";
                }
            }
            break;
        case "Enter":
            if (menuFocused) {
                openCategory();
            } else if (listOpen) {
                let item = null;
                if (viewMode === "channels") item = channels[selectedIndex];
                else if (viewMode === "kids_channels") item = kidsChannels[selectedIndex];
                else if (viewMode === "fav") item = favorites[selectedIndex];
                else if (viewMode === "movies") item = filteredList[selectedIndex];
                else if (viewMode === "categories") {
                    const cat = movieCategories[selectedIndex];
                    filteredList = movies.filter(f => f.genero === cat || (cat.includes("Lançamentos") && f.genero === "Lançamentos" && f.year === cat.split(" ")[1]));
                    viewMode = "movies";
                    selectedIndex = 0;
                    renderList();
                    return;
                }
                if (item && (item.url || item.link)) {
                    playMedia(item.url || item.link);
                    listOpen = false;
                    channelList.style.display = "none";
                    posterPreview.style.display = "none";
                }
            }
            break;
    }
});
renderMenu();
</script>
</body>
</html>
