<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESTE DE CONEXÃO - PAIXÃOFLIX</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; }
        #sidebar { width: 300px; background: #111; height: 100vh; overflow-y: auto; border-right: 1px solid #333; }
        #player-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        video { width: 90%; background: #222; border: 2px solid #e50914; }
        .item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; }
        .item:hover { background: #333; }
        .teste-btn { background: #e50914; color: white; font-weight: bold; border: none; padding: 10px; margin: 10px; cursor: pointer; border-radius: 5px; }
        .status { color: #aaa; font-size: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div style="padding: 20px; text-align: center;">
        <h2 style="color:#e50914">PAIXÃOFLIX</h2>
        <p class="status">Modo de Teste de SSL</p>
    </div>
    
    <div class="item" style="background: #1a1a1a; border: 1px solid gold;" onclick="playTeste()">
        <strong>⭐ CANAL DE TESTE (HTTPS)</strong><br>
        <small>Se este funcionar, o erro é o HTTP da sua lista.</small>
    </div>

    <div id="channel-list">
        <p style="padding: 20px;">Carregando sua lista original...</p>
    </div>
</div>

<div id="player-area">
    <h1 id="playing-title">Aguardando Seleção</h1>
    <video id="video" controls autoplay></video>
    <div style="margin-top: 20px; max-width: 80%; text-align: center;">
        <p id="debug-info">Clique no botão dourado à esquerda para testar um link seguro.</p>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const M3U_URL = 'tv.paixaoflix.m3u';
    let hls = null;

    // 1. FUNÇÃO DE TESTE COM URL HTTPS GARANTIDA
    function playTeste() {
        const httpsUrl = "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"; 
        document.getElementById('playing-title').innerText = "TESTE HTTPS: Big Buck Bunny";
        document.getElementById('debug-info').innerText = "Se você está vendo este vídeo, significa que seu site (Cloudflare/HTTPS) está funcionando perfeitamente. O problema são os links da sua lista que são HTTP e estão sendo bloqueados pelo navegador.";
        startVideo(httpsUrl);
    }

    // 2. CARREGAR SUA LISTA ORIGINAL LOGO ABAIXO
    async function carregarM3U() {
        try {
            const r = await fetch(M3U_URL);
            const t = await r.text();
            const linhas = t.split('\n');
            const container = document.getElementById('channel-list');
            container.innerHTML = '<div style="padding:10px; color:gold">Sua Lista Original:</div>';

            for (let i = 0; i < linhas.length; i++) {
                if (linhas[i].includes('#EXTINF')) {
                    let nome = linhas[i].split(',')[1]?.trim();
                    let url = linhas[i+1]?.trim();
                    if (url && url.startsWith('http')) {
                        const d = document.createElement('div');
                        d.className = 'item';
                        d.innerText = nome;
                        d.onclick = () => {
                            document.getElementById('playing-title').innerText = nome;
                            document.getElementById('debug-info').innerText = "Tentando carregar link original: " + url;
                            startVideo(url);
                        };
                        container.appendChild(d);
                    }
                }
            }
        } catch (e) {
            document.getElementById('channel-list').innerHTML = "<p style='padding:20px'>Erro ao carregar tv.paixaoflix.m3u</p>";
        }
    }

    function startVideo(url) {
        if (hls) hls.destroy();
        
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    document.getElementById('debug-info').innerText = "ERRO FATAL: O navegador bloqueou este link. (Provavelmente bloqueio de conteúdo misto HTTP/HTTPS)";
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    carregarM3U();
</script>
</body>
</html>
