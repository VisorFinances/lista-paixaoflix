<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Poppins;background:#000;color:#fff;overflow:hidden}
::-webkit-scrollbar{display:none}

#app{display:flex;height:100vh}

/* SIDEBAR */
#side{width:420px;background:#111;display:flex;flex-direction:column;border-right:1px solid #222}

/* HEADER */
#header{padding:16px;display:flex;align-items:center;gap:16px}
#header img{width:160px}
#timebox{margin-left:auto;text-align:right}
#clock{font-size:20px}
#date{font-size:12px;opacity:.9}

/* SEARCH */
#search{margin:10px 16px;padding:10px;font-size:16px;background:#000;color:#fff;border:2px solid #e50914;border-radius:6px}

/* NOW */
#now{margin:0 16px;font-size:13px}
#now span{font-size:14px}

/* MENU */
#menu{margin:10px 16px;display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.btn{padding:6px;font-size:13px;background:#222;border-radius:6px;text-align:center;white-space:nowrap}
.btn.active{background:#e50914}
.btn.focus{box-shadow:0 0 0 3px rgba(255,255,255,.6)}
.btn.kids{background:#0056b3}

/* LIST */
#list{flex:1;overflow-y:auto}
.item{padding:12px;border-bottom:1px solid #222;display:flex;justify-content:space-between;font-size:16px}
.item.focus{background:#222;border-left:6px solid #e50914}
.star{opacity:.6}
.star.active{color:#e50914;opacity:1}

/* PLAYER */
#player{flex:1;position:relative}
video{width:100%;height:100%}

/* OVERLAY */
#zap{position:absolute;bottom:40px;left:40px;background:rgba(0,0,0,.8);padding:10px 20px;font-size:20px;border-left:6px solid #e50914;display:none}
</style>
</head>

<body>

<div id="app">

<div id="side">
<div id="header">
<img src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<div id="timebox">
<div id="clock"></div>
<div id="date"></div>
</div>
</div>

<input id="search" placeholder="Pesquisar...">

<div id="now">Assistindo agora: <span>—</span></div>

<div id="menu">
<div class="btn active focus" data-section="tv">TV</div>
<div class="btn" data-section="filmes">Filmes</div>
<div class="btn" data-section="series">Séries</div>
<div class="btn kids" data-section="kids">Canal Kids</div>
<div class="btn kids" data-section="kidsconteudo">Filmes/Séries Kids</div>
<div class="btn" data-section="fav">Favoritos</div>
</div>

<div id="list"></div>
</div>

<div id="player">
<video id="video" autoplay></video>
<div id="zap"></div>
</div>

</div>

<script>
/* CLOCK */
setInterval(()=>{
const d=new Date()
clock.innerText=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})
date.innerText=d.toLocaleDateString('pt-BR')
},1000)

/* STATE */
let items=[],view=[],idx=0,menuIdx=0,focus='menu',hls=null
let favs=JSON.parse(localStorage.getItem('favs')||'[]')

/* LOADERS */
async function loadM3U(path){
const t=await fetch('data/'+path).then(r=>r.text())
let n='',out=[]
t.split('\n').forEach(l=>{
if(l.startsWith('#EXTINF'))n=l.split(',').pop()
else if(l.startsWith('http'))out.push({nome:n,url:l})
})
return out
}
async function loadJSON(path){return fetch('data/'+path).then(r=>r.json())}

/* LOAD SECTIONS */
async function loadSection(s){
if(s==='tv') items=await loadM3U('canais.m3u')
if(s==='kids') items=await loadM3U('kids_canais.m3u')
if(s==='filmes') items=await loadJSON('filmes.json')
if(s==='series') items=await loadJSON('series.json')
if(s==='kidsconteudo'){
items=[
...(await loadJSON('kids_filmes.json')),
...(await loadJSON('kids_series.json'))
]}
if(s==='fav') items=favs
view=[...items]
render()
select(0,true)
}

/* RENDER */
function render(){
list.innerHTML=''
view.forEach(i=>{
const d=document.createElement('div')
const fav=favs.some(f=>f.nome===i.nome)
d.className='item'
d.innerHTML=`<span>${i.nome||i.titulo}</span><span class="star ${fav?'active':''}">★</span>`
d.onclick=()=>select(view.indexOf(i))
d.querySelector('.star').onclick=e=>{
e.stopPropagation()
toggleFav(i)
}
list.appendChild(d)
})
idx=0
updateListFocus()
}

/* FAVORITOS */
function toggleFav(i){
if(favs.some(f=>f.nome===i.nome))
favs=favs.filter(f=>f.nome!==i.nome)
else favs.push(i)
localStorage.setItem('favs',JSON.stringify(favs))
render()
}

/* PLAYER */
function select(i,auto=false){
const it=view[i]
if(!it)return
idx=i
updateListFocus()
if(!it.url)return
if(hls){hls.destroy();hls=null}
if(it.url.includes('.m3u8')&&Hls.isSupported()){
hls=new Hls();hls.loadSource(it.url);hls.attachMedia(video)
}else video.src=it.url
video.play().catch(()=>{})
now.querySelector('span').innerText=it.nome||it.titulo
zap.innerText=it.nome||it.titulo
zap.style.display='block'
setTimeout(()=>zap.style.display='none',1200)
}

/* FOCUS */
function updateListFocus(){
document.querySelectorAll('.item').forEach((e,i)=>e.classList.toggle('focus',i===idx))
document.querySelectorAll('.item')[idx]?.scrollIntoView({block:'center'})
}
function updateMenuFocus(){
document.querySelectorAll('.btn').forEach((b,i)=>b.classList.toggle('focus',i===menuIdx))
}

/* KEYS */
document.addEventListener('keydown',e=>{
if(e.key==='ArrowRight'&&focus==='menu'){menuIdx=Math.min(menuIdx+1,5);updateMenuFocus()}
if(e.key==='ArrowLeft'&&focus==='menu'){menuIdx=Math.max(menuIdx-1,0);updateMenuFocus()}
if(e.key==='ArrowDown'){
if(focus==='menu')focus='list'
else if(focus==='list'){idx=Math.min(idx+1,view.length-1);updateListFocus();select(idx,true)}
}
if(e.key==='ArrowUp'){
if(focus==='list'&&idx===0)focus='menu'
else if(focus==='list'){idx=Math.max(idx-1,0);updateListFocus();select(idx,true)}
}
if(e.key==='Enter'){
if(focus==='menu'){
const s=document.querySelectorAll('.btn')[menuIdx].dataset.section
loadSection(s)
}
if(focus==='list')select(idx)
}
})

/* SEARCH */
search.addEventListener('input',()=>{
const q=search.value.toLowerCase()
view=items.filter(i=>(i.nome||i.titulo).toLowerCase().includes(q))
render()
})

/* INIT */
loadSection('tv')
</script>

</body>
</html>
