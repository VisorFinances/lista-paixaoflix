<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; overflow: hidden; }
body, html { background: #000; color: #fff; font-family: 'Poppins', sans-serif; height: 100%; width: 100%; position: fixed; }
#layout-principal { display: flex; height: 100vh; width: 100vw; }

/* --- MENU LATERAL --- */
#barra-menu { width: 220px; background: #001a1a; border-right: 2px solid #003333; display: flex; flex-direction: column; z-index: 100; flex-shrink: 0; }
#header-logo { padding: 15px 10px; text-align: center; flex-shrink: 0; }
#header-logo img { height: 120px; width: auto; max-width: 100%; object-fit: contain; }
#searchBox { padding: 0 10px 15px; flex-shrink: 0; }
#searchInput { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #003333; background: #000; color: #fff; outline: none; font-size: 12px; }
#itens-menu { flex: 1; padding: 10px; overflow-y: auto !important; }

.item-clicavel { padding: 12px; font-size: 13px; margin-bottom: 8px; border-radius: 8px; background: #0080ff; border-bottom: 3px solid #004d99; display: flex; align-items: center; cursor: pointer; color: #fff; }
.item-clicavel i { margin-right: 15px; width: 20px; text-align: center; }
.item-clicavel.selecionado { background: #fff !important; color: #000 !important; font-weight: bold; border-bottom: 3px solid #ccc; }

/* --- ÁREA DO PLAYER --- */
#area-player { flex: 1; position: relative; background: #000; height: 100%; }
#meu-video { width: 100%; height: 100%; background: #000; object-fit: contain; }
#painel-conteudo { position: absolute; left: 0; top: 0; height: 100%; background: rgba(0,0,0,0.95); z-index: 50; display: none; align-items: center; }
#lista-canais { width: 280px; height: 100%; border-right: 1px solid #444; overflow-y: auto; }

.canal-item { padding: 12px 15px; font-size: 14px; border-bottom: 1px solid #222; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
.canal-item.ativo { background: #fff; color: #000; font-weight: bold; }
.fav-btn { color: #888; padding: 5px; transition: 0.2s; }
.fav-btn.active { color: #ffeb3b !important; }

#container-capa { padding: 0 20px; }
#imagem-capa { height: 350px; width: auto; border-radius: 10px; border: 3px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

/* --- AJUSTES MOBILE --- */
@media (max-width: 850px) {
    #barra-menu { width: 120px; }
    #header-logo img { height: 100px; width: 100px; }
    #searchBox { display: none; }
    .item-clicavel { font-size: 9px; padding: 10px 6px; }
    .item-clicavel i { margin-right: 8px; }
    #lista-canais { width: 160px; }
    #imagem-capa { height: 180px; }
}
#relogio { font-size: 11px; color: #888; margin-top: 5px; text-align: center; }
</style>
</head>
<body>

<div id="layout-principal">
    <div id="barra-menu">
        <div id="header-logo">
            <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
            <div id="relogio"></div>
        </div>
        <div id="searchBox"><input type="text" id="searchInput" placeholder="Pesquisar..."></div>
        <div id="itens-menu">
            <div class="item-clicavel selecionado" data-type="channels" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u"><i class="fas fa-tv"></i> TV ao vivo</div>
            <div class="item-clicavel" data-type="fav"><i class="fas fa-star" style="color:#ffeb3b"></i> Favoritos</div>
            <div class="item-clicavel" data-type="movies" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json"><i class="fas fa-film"></i> Cinema</div>
            <div class="item-clicavel" data-type="series" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json"><i class="fas fa-clapperboard"></i> Séries</div>
            <div class="item-clicavel" data-type="kids_channels" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_kids_canais.m3u"><i class="fas fa-child"></i> Canais Kids</div>
            <div class="item-clicavel" data-type="kids_movies" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json"><i class="fas fa-icons"></i> Filmes Kids</div>
            <div class="item-clicavel" data-type="kids_series" data-url="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_series.json"><i class="fas fa-robot"></i> Séries Kids</div>
        </div>
    </div>

    <div id="area-player">
        <video id="meu-video" autoplay playsinline controls></video>
        <div id="painel-conteudo">
            <div id="lista-canais"></div>
            <div id="container-capa"><img id="imagem-capa" src=""></div>
        </div>
    </div>
</div>

<script>
const video = document.getElementById("meu-video");
const painelConteudo = document.getElementById("painel-conteudo");
const listaCanaisDiv = document.getElementById("lista-canais");
const imgCapa = document.getElementById("imagem-capa");
const menuItems = document.querySelectorAll('.item-clicavel');

let currentData = [];
let menuIndex = 0;
let itemIndex = 0;
let menuFocused = true;
let hls = null;
let favoritos = JSON.parse(localStorage.getItem('paixaoflix_favs')) || [];

function carregarRelogio() {
    const d = new Date();
    document.getElementById("relogio").innerText = d.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
}
setInterval(carregarRelogio, 1000); carregarRelogio();

async function fetchData(url, type) {
    try {
        const response = await fetch(url);
        if (url.endsWith('.m3u')) {
            const text = await response.text();
            let items = [], temp = null;
            text.split('\n').forEach(line => {
                if (line.startsWith('#EXTINF')) temp = { titulo: line.split(',').pop().trim() };
                else if (line.startsWith('http') && temp) { temp.url = line.trim(); items.push(temp); temp = null; }
            });
            return items;
        }
        return await response.json();
    } catch (e) { return []; }
}

async function carregarMenu(index) {
    menuItems.forEach(i => i.classList.remove('selecionado'));
    menuItems[index].classList.add('selecionado');
    const type = menuItems[index].dataset.type;
    const url = menuItems[index].dataset.url;

    if (type === 'fav') { currentData = favoritos; } 
    else { currentData = await fetchData(url, type); }
    
    itemIndex = 0;
    renderLista();
    painelConteudo.style.display = "flex";
}

function renderLista() {
    listaCanaisDiv.innerHTML = "";
    currentData.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = `canal-item ${i === itemIndex ? 'ativo' : ''}`;
        div.innerHTML = `<span>${item.titulo || item.name}</span>`;
        
        const favBtn = document.createElement('i');
        const isFav = favoritos.some(f => (f.url || f.link) === (item.url || item.link));
        favBtn.className = `fas fa-star fav-btn ${isFav ? 'active' : ''}`;
        favBtn.onclick = (e) => { e.stopPropagation(); toggleFav(item); };
        
        div.appendChild(favBtn);
        div.onclick = () => playMedia(item);
        listaCanaisDiv.appendChild(div);
        if (i === itemIndex) {
            div.scrollIntoView({ block: 'center' });
            imgCapa.src = item.poster || item.logo || "";
        }
    });
}

function toggleFav(item) {
    const idx = favoritos.findIndex(f => (f.url || f.link) === (item.url || item.link));
    if (idx > -1) favoritos.splice(idx, 1);
    else favoritos.push(item);
    localStorage.setItem('paixaoflix_favs', JSON.stringify(favoritos));
    renderLista();
}

function playMedia(item) {
    const url = (item.url || item.link || "").replace("http://", "https://");
    if (!url) return;
    if (hls) hls.destroy();
    if (url.includes(".m3u8")) {
        if (Hls.isSupported()) { hls = new Hls(); hls.loadSource(url); hls.attachMedia(video); }
        else { video.src = url; }
    } else { video.src = url; }
    painelConteudo.style.display = "none";
    menuFocused = true;
}

// NAVEGAÇÃO POR TECLADO
document.addEventListener('keydown', (e) => {
    if (menuFocused) {
        if (e.key === "ArrowDown") menuIndex = (menuIndex + 1) % menuItems.length;
        if (e.key === "ArrowUp") menuIndex = (menuIndex - 1 + menuItems.length) % menuItems.length;
        if (e.key === "Enter" || e.key === "ArrowRight") { menuFocused = false; carregarMenu(menuIndex); }
        menuItems.forEach((m, i) => m.classList.toggle('selecionado', i === menuIndex));
    } else {
        if (e.key === "ArrowDown") { itemIndex = (itemIndex + 1) % currentData.length; renderLista(); }
        if (e.key === "ArrowUp") { itemIndex = (itemIndex - 1 + currentData.length) % currentData.length; renderLista(); }
        if (e.key === "ArrowLeft") { menuFocused = true; painelConteudo.style.display = "none"; }
        if (e.key === "Enter") playMedia(currentData[itemIndex]);
    }
});

// Toque direto
menuItems.forEach((btn, i) => { btn.onclick = () => { menuIndex = i; menuFocused = false; carregarMenu(i); }; });
video.onclick = () => { painelConteudo.style.display = "none"; menuFocused = true; };
</script>
</body>
</html>
