<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paix√£oFlix - Sistema Oficial 2026</title>
    <style>
        :root {
            --amarelo-pipoca: #ffcc00;
            --azul-escuro: #001a33;
            --bg-body: #05070a;
            --sombra-3d: 0 5px 0 #b38f00;
            --sidebar-w: 90px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Open Sans', 'Segoe UI', Roboto, sans-serif; 
            outline: none; 
        }
        body { 
            background: var(--bg-body); 
            color: white; 
            overflow: hidden; 
            display: flex; 
        }
        
        /* Importar Open Sans */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');
        
        /* Estilos universais para t√≠tulos */
        .universal-title {
            font-family: 'Open Sans', sans-serif;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
        }
        
        .vertical-line {
            width: 100%;
            height: 2px;
            background: #ff6b6b;
            margin: 15px 0;
            font-weight: 200;
        }

        /* --- BARRA LATERAL (ESTILO DISNEY+) --- */
        #sidebar {
            width: var(--sidebar-w); height: 100vh; background: #000; border-right: 1px solid #1a1a1a;
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 1000;
        }
        .logo { width: 60px; cursor: pointer; margin-bottom: 25px; transition: 0.3s; }
        .logo:focus { transform: scale(1.1); }
        
        .nav-icons { display: flex; flex-direction: column; gap: 15px; }
        .icon-btn { 
            width: 55px; height: 55px; border-radius: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn svg { width: 30px; fill: #666; }
        .icon-btn:focus { background: var(--amarelo-pipoca); box-shadow: 0 0 15px var(--amarelo-pipoca); }
        .icon-btn:focus svg { fill: #000; }

        /* --- BARRA SUPERIOR --- */
        #topbar {
            position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: linear-gradient(to bottom, #000, transparent); z-index: 900;
        }
        /* --- SISTEMA DE REL√ìGIO --- */
        #relogio-txt { 
            font-size: 14px; 
            opacity: 0.8; 
            font-family: 'Open Sans', sans-serif;
        }
        #contador-global { 
            color: var(--amarelo-pipoca); 
            font-weight: bold; 
            font-size: 18px; 
            text-transform: uppercase; 
            font-family: 'Open Sans', sans-serif;
        }

        /* --- CONTE√öDO PRINCIPAL --- */
        main { 
            margin-left: 0; 
            width: calc(100% - var(--sidebar-w)); 
            height: 100vh; 
            overflow-y: auto; 
            padding: 90px 40px 40px; 
            scroll-behavior: smooth;
        }
        
        /* Suporte para navega√ß√£o por teclado e controle remoto */
        .capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn {
            -webkit-tap-highlight-color: transparent;
            -webkit-focus-ring-color: transparent;
            outline: none;
        }
        
        .capa-item:focus, .icon-btn:focus, .btn-3d:focus, .btn-voltar:focus, .btn-assistir-dark:focus, .episode-btn:focus, .exit-btn:focus {
            outline: 2px solid var(--amarelo-pipoca);
            outline-offset: 2px;
        }
        
        /* Melhorar toque em dispositivos m√≥veis */
        @media (hover: none) and (pointer: coarse) {
            .capa-item {
                transform: scale(1);
                transition: transform 0.2s ease;
            }
            .capa-item:active {
                transform: scale(0.95);
            }
        }
        
        /* Suporte para scroll por mouse e touch */
        .row-container {
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Prevenir sele√ß√£o de texto durante navega√ß√£o */
        .capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* BOT√ïES 3D PADRONIZADOS */
        .btn-3d {
            background: var(--amarelo-pipoca); border: none; padding: 12px 25px;
            font-weight: bold; border-radius: 8px; box-shadow: var(--sombra-3d);
            cursor: pointer; transition: 0.1s; color: black; text-transform: uppercase;
        }
        .btn-3d:active, .btn-3d:focus { transform: translateY(3px); box-shadow: 0 2px 0 #b38f00; border: 2px solid white; }

        /* SE√á√ïES E CARROSSEL */
        .section-title { 
            margin: 20px 0; 
            font-size: 24px; 
            font-weight: 600; 
            font-family: 'Open Sans', sans-serif;
        }
        .row-container { 
            display: flex; 
            gap: 20px; 
            overflow-x: auto; 
            overflow-y: hidden; 
            padding: 15px 0; 
            position: relative;
            scroll-behavior: smooth;
            scrollbar-width: none; /* Esconder scrollbar */
            -ms-overflow-style: none;
            scroll-snap-type: x mandatory;
        }
        .row-container::-webkit-scrollbar {
            display: none; /* Esconder scrollbar no Chrome/Safari */
        }
        .row-container::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50px;
            background: linear-gradient(to right, transparent, var(--bg-body));
            pointer-events: none;
            z-index: 1;
        }
        .capa-item {
            scroll-snap-align: start;
            flex-shrink: 0;
        }
        
        /* Sess√µes com at√© 5 capas - ocupam tela inteira */
        .row-container.full-screen {
            gap: calc((100vw - 1000px) / 4); /* Distribuir 5 capas pela tela inteira */
            padding: 15px 40px; /* Mesmo padding do main */
            margin: 0 -40px; /* Compensar padding */
        }
        .row-container.full-screen .capa-item {
            width: calc((100vw - 160px) / 5); /* 5 capas por tela */
            height: calc((100vw - 160px) / 5 * 1.5); /* Propor√ß√£o 2:3 */
        }
        .row-container.full-screen .capa-item img {
            width: 100%;
            height: 100%;
        }
        
        /* Continuar Assistindo mant√©m padr√£o normal */
        .row-container.history .capa-item {
            width: 280px;
            height: 157.5px; /* 16:9 exact proportion */
            aspect-ratio: 16/9;
        }
        
        /* CAPAS */
        .capa-item { 
            width: 200px; 
            height: 300px; 
            position: relative; 
            cursor: pointer; 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0; /* Evitar encolhimento */
            scroll-snap-align: start;
        }
        .capa-item:focus { 
            transform: scale(1.08); 
            z-index: 10; 
            border: 3px solid white; 
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .capa-item img { 
            width: 100%; 
            height: 100%; 
            border-radius: 8px; 
            display: block; 
            object-fit: cover;
        }
        
        /* Rolagem vertical infinita para categorias */
        .category-page {
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            padding: 90px 40px 40px;
        }
        .category-page::-webkit-scrollbar {
            width: 8px;
        }
        .category-page::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .category-page::-webkit-scrollbar-thumb {
            background: var(--amarelo-pipoca);
            border-radius: 4px;
        }
        
        /* Capas 16:9 para Continuar Assistindo (mant√©m diferente) */
        .capa-item.history {
            width: 280px;
            height: 157.5px; /* 16:9 exact proportion */
            aspect-ratio: 16/9;
        }
        .capa-item.history img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        /* Barra de progresso externa */
        .progress-bar-external {
            position: absolute;
            bottom: 35px; /* Acima do footer */
            left: 8px;
            right: 8px;
            height: 6px;
            background: rgba(0,0,0,0.5);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar-internal {
            height: 100%;
            background: var(--amarelo-pipoca);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* NUMERA√á√ÉO TOP 4 */
        .num-top {
            position: absolute; left: -15px; bottom: 15px; font-size: 100px;
            font-weight: 900; color: var(--azul-escuro); -webkit-text-stroke: 2px var(--amarelo-pipoca); z-index: 5;
        }

        .capa-footer { display: flex; justify-content: center; font-size: 13px; color: #ccc; margin-top: 8px; font-weight: bold; gap: 15px; }
        
        /* Badge NOVO para lan√ßamentos */
        .novo-badge {
            position: absolute; top: 10px; right: 10px; background: var(--amarelo-pipoca);
            color: black; font-weight: bold; font-size: 12px; padding: 5px 10px;
            border-radius: 5px; z-index: 10; text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* P√ÅGINA DE DETALHES */
        #page-details {
            position: fixed; 
            inset: 0; 
            background: #000; 
            z-index: 2000; 
            display: none;
            background-size: cover; 
            background-position: center;
        }
        .details-overlay { 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(to right, rgba(5, 7, 10, 0.95) 30%, rgba(5, 7, 10, 0.8) 60%, rgba(5, 7, 10, 0.6) 100%);
            display: flex; 
            align-items: center; 
            padding: 0;
            margin: 0;
        }
        .details-content {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            gap: 60px;
        }
        .details-poster {
            flex-shrink: 0;
            width: 400px;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .details-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .details-info {
            flex: 1;
            color: white;
        }
        .details-title {
            font-size: 48px;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
            margin-bottom: 20px;
            line-height: 1.1;
            font-family: 'Open Sans', sans-serif;
        }
        .details-meta {
            font-size: 18px;
            color: #ccc;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .details-description {
            font-size: 16px;
            line-height: 1.6;
            color: #ddd;
            margin-bottom: 40px;
            max-height: 200px;
            overflow-y: auto;
        }
        .details-actions {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-direction: column;
        }
        .episodes-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .episodes-container::-webkit-scrollbar {
            width: 6px;
        }
        .episodes-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        .episodes-container::-webkit-scrollbar-thumb {
            background: var(--amarelo-pipoca);
            border-radius: 3px;
        }
        .episode-btn {
            background: var(--amarelo-pipoca);
            border: none;
            padding: 8px 12px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
            color: black;
            font-size: 12px;
            text-transform: uppercase;
        }
        .episode-btn:hover {
            background: #b38f00;
            transform: translateY(-2px);
        }
        .episode-btn.active {
            background: #fff;
            color: black;
        }
        .next-episode-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 3001;
            display: none;
            align-items: center;
            gap: 10px;
        }
        .next-episode-message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        .btn-voltar {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }
        .btn-voltar:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        .btn-assistir-dark {
            background: #b38f00;
            color: white;
            border: none;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }
        .btn-assistir-dark:hover {
            background: #997500;
            transform: translateY(-2px);
        }

        /* PLAYER */
        #player-screen { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; }
        video { width: 100%; height: 100%; }
        .exit-btn { 
            position: absolute; top: 30px; left: 30px; background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px); color: white; border: 1px solid white; padding: 10px 20px; 
            cursor: pointer; z-index: 3100; border-radius: 5px;
        }
        
        /* Footer de recomenda√ß√µes durante reprodu√ß√£o */
        .recommendations-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            padding: 20px;
            z-index: 3001;
            display: none;
        }
        .recommendations-content {
            display: flex;
            gap: 15px;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        .recommendation-item {
            width: 120px;
            height: 180px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }
        .recommendation-item:hover {
            transform: scale(1.05);
        }
        .recommendation-item img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
        }
        .recommendation-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
        }
        .recommendation-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.3);
        }
        .recommendation-progress-fill {
            height: 100%;
            background: var(--amarelo-pipoca);
            width: 0%;
            transition: width 1s linear;
        }

        /* Aclamado pela M√≠dia */
        .award-item {
            width: 200px;
            height: 300px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0;
        }
        .award-item:focus {
            transform: scale(1.08);
            z-index: 10;
            border: 3px solid white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .award-item img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: block;
            object-fit: cover;
        }
        .award-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 0 0 8px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .award-trophy {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .award-trophy::before {
            content: 'üèÜ';
            font-size: 16px;
        }
        .award-footer-text {
            font-size: 11px;
            color: white;
            text-align: center;
        }
        
        /* SISTEMA DE LIKE/DISLIKE */
        .like-dislike-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            z-index: 4000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 10px;
        }
        .like-dislike-content {
            background: var(--bg-body);
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            max-width: 400px;
        }
        .like-dislike-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        .like-dislike-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .like-dislike-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .like-btn {
            background: #4CAF50;
            color: white;
        }
        .like-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .dislike-btn {
            background: #f44336;
            color: white;
        }
        .dislike-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        .like-dislike-vote-info {
            font-size: 14px;
            color: #ccc;
            margin-top: 15px;
        }
        .vote-count {
            font-size: 24px;
            font-weight: bold;
            color: var(--amarelo-pipoca);
            margin-bottom: 10px;
        }
        .channels-page {
            padding: 90px 40px 40px;
            height: 100vh;
            overflow-y: auto;
        }
        .channels-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .channel-category {
            margin-bottom: 40px;
        }
        .category-title {
            font-size: 28px;
            font-weight: 700;
            font-style: italic;
            color: var(--amarelo-pipoca);
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        .channel-item {
            aspect-ratio: 16/9;
            background: #1a1a1a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .channel-item:focus {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.4);
            outline: 2px solid var(--amarelo-pipoca);
            outline-offset: 2px;
            z-index: 10;
        }
        .channel-item:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }
        .channel-logo {
            max-width: 80%;
            max-height: 60%;
            object-fit: contain;
        }
        .channel-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--amarelo-pipoca);
            color: black;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        .channel-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            text-align: center;
        }
        .channel-playing {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff4444;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        #search-box {
            position: fixed; top: 70px; left: var(--sidebar-w); right: 0; bottom: 0;
            background: var(--bg-body); z-index: 850; display: none; padding: 50px;
        }
        #input-busca {
            width: 100%; background: none; border: none; border-bottom: 3px solid var(--amarelo-pipoca);
            color: white; font-size: 40px; margin-bottom: 40px;
        }
        .search-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        .search-card {
            width: 200px;
            height: 300px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex-shrink: 0;
        }
        .search-card:focus {
            transform: scale(1.08);
            z-index: 10;
            border: 3px solid white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .search-card img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: block;
            object-fit: cover;
        }
        .search-card-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 0 0 8px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-card-footer span {
            font-size: 12px;
            color: white;
        }

    </style>
</head>
<body>

<nav id="sidebar">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" class="logo" onclick="location.reload()" tabindex="0">
    <div class="nav-icons">
        <div class="icon-btn" tabindex="0" onclick="toggleSearch()" title="Pesquisa"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadContent('movie', 'data/filmes.json')" title="Cinema"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadContent('serie', 'data/series.json')" title="S√©ries"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadChannels()" title="Canais ao Vivo"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14c0-1.1.9-2 2-2h2c0 1.1.9 2 2v8c0 1.1.9 2 2h8c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm4 6c0-1.1.9-2 2-2h2c0 1.1.9 2 2v8c0 1.1.9 2 2h8c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadContent('kids_movie', 'data/kids_filmes.json')" title="Filmes Kids"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadContent('kids_serie', 'data/kids_series.json')" title="S√©ries Kids"><svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadLive('data/ativa_kids_canais.m3u')" title="Canais Kids"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
        <div class="icon-btn" tabindex="0" onclick="loadContent('fav', 'data/favoritos.json')" title="Minha Lista"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
    </div>
</nav>

<header id="topbar">
    <div id="contador-global">Estamos evoluindo: <span id="val-total">0</span></div>
    <div id="relogio-txt" style="font-size: 14px; opacity: 0.8;"></div>
</header>

<main id="main-app"></main>

<div id="search-box">
    <input type="text" id="input-busca" placeholder="O que vamos assistir?" oninput="searchRealTime(this.value)" onblur="handleSearchBlur()">
    <div id="search-results" class="search-results"></div>
</div>

<div id="page-details"></div>

<div id="player-screen">
    <button class="exit-btn" onclick="stopPlayer()">SAIR DO PLAYER</button>
    <video id="html5-video" controls autoplay></video>
    <div class="recommendations-footer" id="recommendations-footer">
        <div class="recommendations-content" id="recommendations-content">
            <!-- Recommendations will be inserted here -->
        </div>
    </div>
    <div class="like-dislike-overlay" id="like-dislike-overlay">
        <div class="like-dislike-content">
            <div class="like-dislike-title">Gostou deste conte√∫do?</div>
            <div class="like-dislike-buttons">
                <button class="like-dislike-btn like-btn" onclick="submitLike(true)">üëç GOSTEI</button>
                <button class="like-dislike-btn dislike-btn" onclick="submitLike(false)">üëé N√ÉO GOSTEI</button>
            </div>
            <div class="like-dislike-vote-info">
                <div class="vote-count" id="vote-count">0 votos</div>
            </div>
        </div>
    </div>
</div>

<script>
    let masterData = [];

    // Configurar suporte para m√∫ltiplos m√©todos de entrada
    function setupInputHandlers() {
        // Prevenir comportamento padr√£o em touch events
        document.addEventListener('touchstart', function(e) {
            if (e.target.closest('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.closest('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn')) {
                e.preventDefault();
                // Disparar click programaticamente
                e.target.click();
            }
        }, { passive: false });
        
        // Suporte para controle remoto e teclado
        document.addEventListener('keydown', function(e) {
            const focusedElement = document.activeElement;
            
            // Navega√ß√£o com setas do teclado/controle remoto
            switch(e.key) {
                case 'ArrowLeft':
                case 'ArrowUp':
                    e.preventDefault();
                    navigateToElement('previous', focusedElement);
                    break;
                case 'ArrowRight':
                case 'ArrowDown':
                    e.preventDefault();
                    navigateToElement('next', focusedElement);
                    break;
                case 'Enter':
                case ' ': // Space
                    if (focusedElement) {
                        e.preventDefault();
                        focusedElement.click();
                    }
                    break;
                case 'Escape':
                case 'Back':
                    e.preventDefault();
                    handleBackButton();
                    break;
            }
        });
        
        // Melhorar scroll com mouse wheel em containers horizontais
        document.querySelectorAll('.row-container').forEach(container => {
            container.addEventListener('wheel', function(e) {
                if (e.deltaY !== 0) {
                    e.preventDefault();
                    container.scrollLeft += e.deltaY;
                }
            }, { passive: false });
        });
    }
    
    function navigateToElement(direction, currentElement) {
        if (!currentElement) {
            // Focar primeiro elemento naveg√°vel
            const firstElement = document.querySelector('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn');
            if (firstElement) firstElement.focus();
            return;
        }
        
        const allNavigableElements = Array.from(document.querySelectorAll('.capa-item, .icon-btn, .btn-3d, .btn-voltar, .btn-assistir-dark, .episode-btn, .exit-btn'));
        const currentIndex = allNavigableElements.indexOf(currentElement);
        
        if (currentIndex === -1) return;
        
        let nextIndex;
        if (direction === 'next') {
            nextIndex = (currentIndex + 1) % allNavigableElements.length;
        } else {
            nextIndex = currentIndex === 0 ? allNavigableElements.length - 1 : currentIndex - 1;
        }
        
        allNavigableElements[nextIndex].focus();
        
        // Garantir que o elemento esteja vis√≠vel
        allNavigableElements[nextIndex].scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'nearest'
        });
    }
    
    function handleBackButton() {
        const playerScreen = document.getElementById('player-screen');
        const detailsPage = document.getElementById('page-details');
        
        if (playerScreen.style.display === 'block') {
            stopPlayer();
        } else if (detailsPage.style.display === 'block') {
            detailsPage.style.display = 'none';
        } else {
            // Voltar para home se estiver em outra p√°gina
            renderHome();
        }
    }
    
    // Inicializar handlers quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', setupInputHandlers);

    // --- SISTEMA DE REL√ìGIO ---
    function clock() {
        const d = new Date();
        const fmt = d.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
        document.getElementById('relogio-txt').innerText = fmt.toUpperCase();
    }
    setInterval(clock, 1000);

    // --- CARREGAMENTO INICIAL ---
    const TMDB_API_KEY = 'b275ce8e1a6b3d5d879bb0907e4f56ad';
    const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
    const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w600_and_h900_face';
    
    async function initPaixaoFlix() {
        // Inicializar handlers de entrada primeiro
        setupInputHandlers();
        
        const files = ['data/filmes.json', 'data/series.json', 'data/kids_filmes.json', 'data/kids_series.json'];
        try {
            const res = await Promise.all(files.map(f => fetch(f).then(r => r.json())));
            masterData = res.flat();
            document.getElementById('val-total').innerText = masterData.length;
            renderHome();
        } catch(e) { console.error("Erro ao carregar banco de dados", e); }
    }
    
    async function enrichWithTMDBData() {
        for(let item of masterData) {
            try {
                // Buscar por t√≠tulo no TMDB
                const searchType = item.type === 'serie' ? 'tv' : 'movie';
                const searchResponse = await fetch(`${TMDB_BASE_URL}/search/${searchType}?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(item.titulo)}&language=pt-BR`);
                const searchData = await searchResponse.json();
                
                if(searchData.results && searchData.results.length > 0) {
                    const result = searchData.results[0];
                    
                    // Atualizar poster se n√£o existir ou se o TMDB tiver melhor qualidade
                    if(!item.poster || item.poster.includes('placeholder')) {
                        item.poster = `${TMDB_IMAGE_BASE}${result.poster_path}`;
                    }
                    
                    // Atualizar descri√ß√£o se n√£o existir
                    if(!item.desc || item.desc.length < 50) {
                        item.desc = result.overview || item.desc;
                    }
                    
                    // Atualizar rating se n√£o existir
                    if(!item.rating || item.rating === '0') {
                        item.rating = (result.vote_average / 2).toFixed(1); // Converter de 10 para 5
                    }
                    
                    // Adicionar g√™neros do TMDB se n√£o existirem
                    if(!item.genero || item.genero.length === 0) {
                        const genresResponse = await fetch(`${TMDB_BASE_URL}/genre/${searchType}/list?api_key=${TMDB_API_KEY}&language=pt-BR`);
                        const genresData = await genresResponse.json();
                        
                        if(genresData.genres && result.genre_ids && result.genre_ids.length > 0) {
                            item.genero = result.genre_ids.map(id => {
                                const genre = genresData.genres.find(g => g.id === id);
                                return genre ? genre.name : 'Geral';
                            });
                        }
                    }
                    
                    // Adicionar dados adicionais do TMDB
                    item.tmdb_id = result.id;
                    item.backdrop = result.backdrop_path ? `https://image.tmdb.org/t/p/w1280${result.backdrop_path}` : item.poster;
                    
                    // Pequeno delay para n√£o sobrecarregar a API
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            } catch(e) {
                console.warn(`Erro ao buscar dados TMDB para: ${item.titulo}`, e);
            }
        }
    }

    // --- P√ÅGINA INICIAL (TOP 4 DI√ÅRIO) ---
    function renderHome() {
        const app = document.getElementById('main-app');
        app.innerHTML = `<h2 class="section-title">Os queridinhos de agora</h2><div class="row-container full-screen" id="row-top4"></div>
                         <h2 class="section-title">Continuar Assistindo</h2><div class="row-container history" id="row-history"></div>
                         <h2 class="section-title">Novas Paix√µes da Semana</h2><div class="row-container full-screen" id="row-lancamentos"></div>
                         <h2 class="section-title">Prepare a Pipoca para Maratonar</h2><div class="row-container full-screen" id="row-maratonar"></div>
                         <h2 class="section-title">Cl√°ssicos que Aquecem o Cora√ß√£o</h2><div class="row-container full-screen" id="row-classicos"></div>
                         <h2 class="section-title">Aclamado pela M√≠dia</h2><div class="row-container" id="row-award-winners"></div>
                         <div id="sabado-noite-container"></div>`;
        
        const dailySeed = new Date().getDate();
        const top4 = masterData.slice(dailySeed % masterData.length, (dailySeed % masterData.length) + 4);
        
        const topContainer = document.getElementById('row-top4');
        top4.forEach((item, i) => {
            topContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <span class="num-top">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        loadHistory();
        renderLancamentos();
        renderMaratonar();
        renderClassicos();
        renderAwardWinners();
        renderSabadoNoite();
    }
    
    function renderAwardWinners() {
        const container = document.getElementById('row-award-winners');
        if (!container) return;
        
        // Obter data atual para calcular rota√ß√£o
        const now = new Date();
        const dayOfMonth = now.getDate();
        const currentYear = now.getFullYear();
        
        // Calcular qual conte√∫do mostrar hoje (baseado no dia do m√™s)
        const rotationIndex = Math.floor((dayOfMonth - 1) / 7) % 10; // Rota√ß√£o de 10 conte√∫dos, 1 por dia
        
        // Filtrar conte√∫dos que ganharam pr√™mios (simulado - em um sistema real viria de uma API de pr√™mios)
        const awardWinners = masterData.filter(item => {
            // Simular que estes conte√∫dos ganharam pr√™mios
            const hasAward = item.titulo.includes('Oscar') || 
                           item.titulo.includes('Globo de Ouro') || 
                           item.titulo.includes('Emmy') || 
                           item.rating >= 9.0 ||
                           item.year >= 2020;
            return hasAward;
        });
        
        // Embaralhar e selecionar at√© 10 conte√∫dos
        const shuffled = [...awardWinners].sort(() => 0.5 - Math.random());
        const selectedWinners = shuffled.slice(0, 10);
        
        container.innerHTML = '';
        selectedWinners.forEach((item, index) => {
            const awardType = getAwardType(item);
            const awardYear = getAwardYear(item);
            
            container.innerHTML += `
                <div class="award-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}" alt="${item.titulo}">
                    <div class="award-info">
                        <div class="award-trophy"></div>
                        <div class="award-footer-text">
                            <div>${awardType} ${awardYear}</div>
                            <div>${item.titulo}</div>
                        </div>
                    </div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal
        setupAwardWinnersInfiniteScroll();
    }
    
    function getAwardType(item) {
        if (item.titulo.includes('Oscar')) return 'Oscar';
        if (item.titulo.includes('Globo de Ouro')) return 'Globo de Ouro';
        if (item.titulo.includes('Emmy')) return 'Emmy';
        if (item.rating >= 9.0) return 'Nota 10';
        return 'Premiado';
    }
    
    function getAwardYear(item) {
        // Simular ano do pr√™mio baseado no ano do conte√∫do
        if (item.titulo.includes('2024')) return '2024';
        if (item.titulo.includes('2023')) return '2023';
        if (item.titulo.includes('2022')) return '2022';
        if (item.titulo.includes('2021')) return '2021';
        if (item.titulo.includes('2020')) return '2020';
        return item.year || '2024';
    }
    
    function setupAwardWinnersInfiniteScroll() {
        const container = document.getElementById('row-award-winners');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }

    function renderClassicos() {
        const classicosContainer = document.getElementById('row-classicos');
        classicosContainer.innerHTML = '';
        
        // Filtrar apenas conte√∫do da categoria "Cl√°ssicos"
        const classicos = masterData.filter(item => {
            const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
            return itemGenres.some(genre => genre.toLowerCase() === 'cl√°ssicos');
        });
        
        // Embaralhar e pegar 5 itens aleat√≥rios
        const shuffled = [...classicos].sort(() => 0.5 - Math.random());
        const selectedClassicos = shuffled.slice(0, 5);
        
        // Exibir os 5 cl√°ssicos selecionados
        selectedClassicos.forEach((item, i) => {
            classicosContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupClassicosInfiniteScroll();
    }
    
    function setupClassicosInfiniteScroll() {
        const container = document.getElementById('row-classicos');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function renderSabadoNoite() {
        const now = new Date();
        const dayOfWeek = now.getDay(); // 0 = Domingo, 6 = S√°bado
        const hour = now.getHours();
        const minute = now.getMinutes();
        const currentTime = hour * 60 + minute;
        
        // Verificar se √© s√°bado ap√≥s 17:55 ou domingo antes de 06:00
        const isSaturdayNight = (dayOfWeek === 6 && currentTime >= 17 * 60 + 55) || 
                               (dayOfWeek === 0 && currentTime < 6 * 60);
        
        if (!isSaturdayNight) {
            return; // N√£o mostrar a sess√£o
        }
        
        const container = document.getElementById('sabado-noite-container');
        container.innerHTML = `<h2 class="section-title">S√°bado a Noite Merece</h2><div class="row-container" id="row-sabado-noite"></div>`;
        
        const sabadoContainer = document.getElementById('row-sabado-noite');
        
        // Categorias espec√≠ficas para esta sess√£o
        const sabadoCategories = ['Romance', 'Com√©dia', 'Anima√ß√£o', 'Terror', 'Cl√°ssicos', 'Nacional', 'Kids', 'Suspense', 'S√©ries', 'Adulto'];
        const selectedContent = [];
        
        // Pegar um item de cada categoria
        sabadoCategories.forEach(category => {
            const categoryItems = masterData.filter(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                return itemGenres.some(genre => genre.toLowerCase() === category.toLowerCase());
            });
            
            if (categoryItems.length > 0) {
                // Selecionar item aleat√≥rio da categoria
                const randomIndex = Math.floor(Math.random() * categoryItems.length);
                selectedContent.push(categoryItems[randomIndex]);
            }
        });
        
        // Exibir os 10 itens selecionados
        selectedContent.forEach((item, i) => {
            sabadoContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupSabadoNoiteInfiniteScroll();
        
        // Configurar verifica√ß√£o peri√≥dica para esconder/mostrar a sess√£o
        setupSabadoNoiteTimer();
    }
    
    function setupSabadoNoiteInfiniteScroll() {
        const container = document.getElementById('row-sabado-noite');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function setupSabadoNoiteTimer() {
        // Verificar a cada minuto se deve mostrar ou esconder a sess√£o
        setInterval(() => {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = hour * 60 + minute;
            
            const isSaturdayNight = (dayOfWeek === 6 && currentTime >= 17 * 60 + 55) || 
                                   (dayOfWeek === 0 && currentTime < 6 * 60);
            
            const container = document.getElementById('sabado-noite-container');
            
            if (isSaturdayNight && !container.innerHTML) {
                renderSabadoNoite();
            } else if (!isSaturdayNight && container.innerHTML) {
                container.innerHTML = '';
            }
        }, 60000); // Verificar a cada minuto
    }
    
    function renderMaratonar() {
        const maratonarContainer = document.getElementById('row-maratonar');
        maratonarContainer.innerHTML = '';
        
        // Filtrar apenas s√©ries
        const allSeries = masterData.filter(item => item.type === 'serie');
        const kidsSeries = allSeries.filter(item => item.titulo.includes('kids') || item.genero.includes('Fam√≠lia') || item.genero.includes('Anima√ß√£o'));
        
        if(allSeries.length === 0) {
            maratonarContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhuma s√©rie encontrada</p>';
            return;
        }
        
        // Selecionar 2 s√©ries kids aleat√≥rias
        const selectedKidsSeries = [];
        const availableKidsSeries = [...kidsSeries];
        for(let i = 0; i < Math.min(2, availableKidsSeries.length); i++) {
            const randomIndex = Math.floor(Math.random() * availableKidsSeries.length);
            selectedKidsSeries.push(availableKidsSeries[randomIndex]);
            availableKidsSeries.splice(randomIndex, 1);
        }
        
        // Selecionar 3 s√©ries regulares aleat√≥rias
        const regularSeries = allSeries.filter(item => !selectedKidsSeries.includes(item));
        const selectedRegularSeries = [];
        const availableRegularSeries = [...regularSeries];
        for(let i = 0; i < Math.min(3, availableRegularSeries.length); i++) {
            const randomIndex = Math.floor(Math.random() * availableRegularSeries.length);
            selectedRegularSeries.push(availableRegularSeries[randomIndex]);
            availableRegularSeries.splice(randomIndex, 1);
        }
        
        // Combinar e exibir
        const selectedSeries = [...selectedKidsSeries, ...selectedRegularSeries];
        
        selectedSeries.forEach(item => {
            const generoText = Array.isArray(item.genero) ? item.genero[0] : (item.genero || 'Geral');
            
            maratonarContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupMaratonarInfiniteScroll();
    }
    
    function setupMaratonarInfiniteScroll() {
        const container = document.getElementById('row-maratonar');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }
    
    function renderLancamentos() {
        const lancamentosContainer = document.getElementById('row-lancamentos');
        lancamentosContainer.innerHTML = '';
        
        // Filtrar conte√∫dos recentes (√∫ltimos 2 anos) ou com g√™nero "Lan√ßamento"
        const recentContent = masterData.filter(item => {
            const itemYear = parseInt(item.year);
            const currentYear = new Date().getFullYear();
            const isRecent = itemYear >= currentYear - 2;
            const isLancamentoGenre = Array.isArray(item.genero) ? 
                item.genero.some(g => g.includes('Lan√ßamento')) : 
                (item.genero || '').includes('Lan√ßamento');
            return isRecent || isLancamentoGenre;
        }).sort((a, b) => {
            // Ordenar por ano (mais recente primeiro)
            const yearA = parseInt(a.year) || 0;
            const yearB = parseInt(b.year) || 0;
            return yearB - yearA;
        });
        
        if(recentContent.length === 0) {
            lancamentosContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum lan√ßamento encontrado</p>';
            return;
        }
        
        // Embaralhar e pegar 5 itens aleat√≥rios
        const shuffled = [...recentContent].sort(() => 0.5 - Math.random());
        const selectedLancamentos = shuffled.slice(0, 5);
        
        // Exibir os 5 lan√ßamentos selecionados
        selectedLancamentos.forEach((item, i) => {
            lancamentosContainer.innerHTML += `
                <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                    <span class="novo-badge">NOVO</span>
                    <img src="${item.poster}">
                    <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                </div>`;
        });
        
        // Configurar rolagem infinita horizontal para esta sess√£o
        setupLancamentosInfiniteScroll();
    }
    
    function setupLancamentosInfiniteScroll() {
        const container = document.getElementById('row-lancamentos');
        if (!container) return;
        
        let isScrolling = false;
        
        // Rolagem infinita horizontal
        container.addEventListener('scroll', () => {
            if (!isScrolling) {
                const scrollLeft = container.scrollLeft;
                const scrollWidth = container.scrollWidth;
                const clientWidth = container.clientWidth;
                
                // Se chegou no final, voltar ao in√≠cio suavemente
                if (scrollLeft + clientWidth >= scrollWidth - 50) {
                    isScrolling = true;
                    container.scrollTo({
                        left: 0,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 1000);
                }
            }
        });
    }

    // --- CARREGAR CONTE√öDO (CINEMA/S√âRIES) ---
    async function loadContent(type, file) {
        toggleSearch(true);
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="category-page"><h2 class="section-title">Carregando...</h2></div>';
        const res = await fetch(file);
        const data = await res.json();

        if(type.includes('kids')) data.sort((a,b) => a.titulo.localeCompare(b.titulo));

        // Ordem fixa das categorias
        const categoryOrder = [
            'Lan√ßamento 2026', 'Lan√ßamento 2025', 'A√ß√£o', 'Aventura', 'Com√©dia', 
            'Drama', 'Nacional', 'Romance', 'Religioso', 'Fic√ß√£o', 'Anime', 
            'Anima√ß√£o', 'Fam√≠lia', 'Cl√°ssicos', 'Dorama', 'Suspense', 'Policial', 
            'Crime', 'Terror', 'Document√°rios', 'Faroeste', 'Musical', 'Adulto'
        ];

        // Organizar por g√™neros para filmes
        if(type.includes('movie')) {
            const genres = {};
            data.forEach(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                itemGenres.forEach(genre => {
                    // Excluir categoria Adulto para conte√∫do kids
                    if(type.includes('kids') && genre === 'Adulto') return;
                    
                    if(!genres[genre]) genres[genre] = [];
                    genres[genre].push(item);
                });
            });

            let html = '';
            // Usar ordem fixa, mostrar apenas categorias que existem
            categoryOrder.forEach(genre => {
                if(genres[genre]) {
                    html += `<h2 class="section-title">${genre.toUpperCase()}</h2><div class="row-container" id="grid-${genre.replace(/\s+/g, '-')}"></div>`;
                }
            });
            
            // Adicionar categorias n√£o mapeadas no final
            const unmappedGenres = Object.keys(genres).filter(genre => !categoryOrder.includes(genre));
            unmappedGenres.sort().forEach(genre => {
                html += `<h2 class="section-title">${genre.toUpperCase()}</h2><div class="row-container" id="grid-${genre.replace(/\s+/g, '-')}"></div>`;
            });
            
            app.innerHTML = `<div class="category-page">${html}</div>`;

            // Preencher os grids e configurar rolagem infinita
            setupInfiniteScroll(genres, categoryOrder, unmappedGenres);
        } else {
            // Para s√©ries, manter o grid √∫nico com rolagem vertical infinita
            app.innerHTML = `<div class="category-page"><h2 class="section-title">${type.toUpperCase()}</h2><div class="row-container" id="grid-view" style="flex-wrap: wrap; overflow-y: auto; overflow-x: hidden;"></div></div>`;
            const grid = document.getElementById('grid-view');
            data.forEach(item => {
                grid.innerHTML += `
                    <div class="capa-item" tabindex="0" onclick='openInfo(${JSON.stringify(item)})'>
                        <img src="${item.poster}">
                        <div class="capa-footer"><span>${item.year}</span><span>‚òÖ${item.rating}</span></div>
                    </div>`;
            });
        }
    }
    
    function setupInfiniteScroll(genres, categoryOrder, unmappedGenres) {
        // Configurar rolagem infinita horizontal para cada categoria
        const allCategories = [...categoryOrder.filter(g => genres[g]), ...unmappedGenres];
        
        allCategories.forEach(genre => {
            const container = document.getElementById(`grid-${genre.replace(/\s+/g, '-')}`);
            if(container) {
                let isScrolling = false;
                
                // Rolagem infinita horizontal
                container.addEventListener('scroll', () => {
                    if(!isScrolling) {
                        const scrollLeft = container.scrollLeft;
                        const scrollWidth = container.scrollWidth;
                        const clientWidth = container.clientWidth;
                        
                        // Se chegou no final, voltar ao in√≠cio suavemente
                        if(scrollLeft + clientWidth >= scrollWidth - 50) {
                            isScrolling = true;
                            container.scrollTo({
                                left: 0,
                                behavior: 'smooth'
                            });
                            
                            setTimeout(() => {
                                isScrolling = false;
                            }, 1000);
                        }
                    }
                });
            }
        });
    }

    // --- P√ÅGINA DE DETALHES (ARCHIVE INTEGRADO) ---
    async function openInfo(item) {
        const p = document.getElementById('page-details');
        p.style.display = 'block';
        // Usar backdrop do TMDB se dispon√≠vel, sen√£o usar poster
        p.style.backgroundImage = `url(${item.backdrop || item.poster})`;
        
        let actions = `<button class="btn-assistir-dark" onclick="startPlay('${item.url || ''}', '${item.titulo}')">ASSISTIR AGORA</button>`;
        
        if(item.type === 'serie' && item.identificador_archive) {
            actions = `<div id="eps-box">Buscando epis√≥dios no Archive.org...</div>`;
            getArchiveEps(item.identificador_archive);
        } else if(item.type === 'serie' && !item.identificador_archive) {
            actions = `<p style="color:#ff6b6b;">Identificador do Archive.org n√£o encontrado</p>`;
        }
        
        // Formatar g√™neros para exibi√ß√£o
        const generoText = Array.isArray(item.genero) ? item.genero.join(' | ') : (item.genero || 'Geral');

        // Gerar ID √∫nico para o conte√∫do
        const contentId = item.titulo.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();

        p.innerHTML = `
            <div class="details-overlay">
                <div class="details-content">
                    <div class="details-poster">
                        <img src="${item.poster}" alt="${item.titulo}">
                    </div>
                    <div class="details-info">
                        <h1 class="details-title">${item.titulo}</h1>
                        <div class="vertical-line"></div>
                        <div class="details-meta">
                            <span>${item.year}</span>
                            <span>‚òÖ ${item.rating}</span>
                            <span>${generoText}</span>
                        </div>
                        <div class="details-description">${item.desc || 'Sem descri√ß√£o dispon√≠vel'}</div>
                        <div class="details-actions">
                            ${actions}
                            <button class="btn-voltar" onclick="document.getElementById('page-details').style.display='none'">VOLTAR</button>
                        </div>
                        <div class="vote-info">üëç 0 | üéé 0</div>
                    </div>
                </div>
            </div>`;
        
        // Adicionar ID do conte√∫do ao elemento
        const detailsContent = p.querySelector('.details-content');
        if (detailsContent) {
            detailsContent.dataset.contentId = contentId;
        }
        
        // Mostrar sistema de like/dislike se n√£o for canal ao vivo
        if (item.type !== 'live_channel') {
            showLikeDislikeOverlay(contentId, item.titulo);
        }
        
        // Atualizar informa√ß√µes de votos
        updateVoteDisplay();
    }

    async function getArchiveEps(id) {
        try {
            const res = await fetch(`https://archive.org/metadata/${id}`);
            const data = await res.json();
            
            if(data.files && data.files.length > 0) {
                const vids = data.files.filter(f => f.name.endsWith('.mp4') || f.name.endsWith('.mkv')).sort((a, b) => a.name.localeCompare(b.name));
                
                if(vids.length > 0) {
                    let h = '<div class="episodes-container">';
                    vids.forEach((v, i) => {
                        const url = `https://archive.org/download/${id}/${v.name}`;
                        const epNumber = String(i + 1).padStart(2, '0');
                        h += `<button class="episode-btn" onclick="playEpisode('${url}', '${v.name}', ${i})">EP. ${epNumber}</button>`;
                    });
                    h += '</div>';
                    document.getElementById('eps-box').innerHTML = h;
                    
                    // Configurar auto-pr√≥ximo epis√≥dio
                    setupAutoNextEpisode(vids, id);
                } else {
                    document.getElementById('eps-box').innerHTML = '<p style="color:#ccc;">Nenhum epis√≥dio encontrado no Archive.org</p>';
                }
            } else {
                document.getElementById('eps-box').innerHTML = '<p style="color:#ccc;">S√©rie n√£o encontrada no Archive.org</p>';
            }
        } catch(e) {
            console.error("Erro ao buscar epis√≥dios:", e);
            document.getElementById('eps-box').innerHTML = '<p style="color:#ff6b6b;">Erro ao carregar epis√≥dios do Archive.org</p>';
        }
    }
    
    function setupAutoNextEpisode(episodes, seriesId) {
        let currentEpisodeIndex = -1;
        
        // Adicionar evento de tempo para mostrar mensagem de pr√≥ximo epis√≥dio
        const video = document.getElementById('html5-video');
        
        video.addEventListener('timeupdate', () => {
            const duration = video.duration;
            const currentTime = video.currentTime;
            const timeRemaining = duration - currentTime;
            
            // Mostrar mensagem quando faltar 30 segundos
            if(timeRemaining <= 30 && timeRemaining > 0) {
                showNextEpisodeMessage(episodes, currentEpisodeIndex);
            } else {
                hideNextEpisodeMessage();
            }
        });
        
        video.addEventListener('ended', () => {
            // Tocar pr√≥ximo epis√≥dio automaticamente
            if(currentEpisodeIndex < episodes.length - 1) {
                const nextEpisode = episodes[currentEpisodeIndex + 1];
                const nextUrl = `https://archive.org/download/${seriesId}/${nextEpisode.name}`;
                const nextEpNumber = String(currentEpisodeIndex + 2).padStart(2, '0');
                
                // Mostrar mensagem de transi√ß√£o
                showTransitionMessage(`Iniciando Ep. ${nextEpNumber} automaticamente...`);
                
                setTimeout(() => {
                    playEpisode(nextUrl, nextEpisode.name, currentEpisodeIndex + 1);
                }, 2000);
            }
        });
        
        // Atualizar √≠ndice do epis√≥dio atual
        window.playEpisode = function(url, episodeName, index) {
            currentEpisodeIndex = index;
            startPlay(url, episodeName);
            
            // Marcar bot√£o atual
            document.querySelectorAll('.episode-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // Rolar para o epis√≥dio atual na lista
            const activeBtn = document.querySelector('.episode-btn.active');
            if(activeBtn) {
                activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        };
    }
    
    function showNextEpisodeMessage(episodes, currentIndex) {
        if(currentIndex < episodes.length - 1) {
            const nextEpNumber = String(currentIndex + 2).padStart(2, '0');
            const message = document.getElementById('next-episode-message') || createNextEpisodeMessage();
            message.innerHTML = `
                <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="Pr√≥ximo">
                <span>Pr√≥ximo: Ep. ${nextEpNumber} em 30 segundos</span>
            `;
            message.style.display = 'flex';
        }
    }
    
    function hideNextEpisodeMessage() {
        const message = document.getElementById('next-episode-message');
        if(message) {
            message.style.display = 'none';
        }
    }
    
    function showTransitionMessage(text) {
        const message = document.getElementById('next-episode-message') || createNextEpisodeMessage();
        message.innerHTML = `<span>${text}</span>`;
        message.style.display = 'flex';
        
        setTimeout(() => {
            message.style.display = 'none';
        }, 3000);
    }
    
    function createNextEpisodeMessage() {
        const message = document.createElement('div');
        message.id = 'next-episode-message';
        message.className = 'next-episode-message';
        document.body.appendChild(message);
        return message;
    }

    // --- SISTEMA DE LIKE/DISLIKE ---
    let currentContentId = null;
    let userVotes = JSON.parse(localStorage.getItem('paixaoflix_votes') || '{}');
    
    function showLikeDislikeOverlay(contentId, contentTitle) {
        currentContentId = contentId;
        const overlay = document.getElementById('like-dislike-overlay');
        const voteCount = document.getElementById('vote-count');
        
        // Mostrar votos existentes
        const votes = userVotes[contentId] || { likes: 0, dislikes: 0 };
        voteCount.textContent = `${votes.likes + votes.dislikes} votos`;
        
        overlay.style.display = 'flex';
        
        // Adicionar evento de tempo para mostrar 1 minuto antes do fim
        const video = document.getElementById('html5-video');
        let likeTimerShown = false;
        
        const checkTime = () => {
            if (video.duration && video.currentTime) {
                const timeRemaining = video.duration - video.currentTime;
                
                // Mostrar overlay quando faltar 1 minuto (60 segundos)
                if (timeRemaining <= 60 && timeRemaining > 0 && !likeTimerShown) {
                    likeTimerShown = true;
                } else if (timeRemaining <= 0) {
                    // Esconder overlay quando o v√≠deo terminar
                    overlay.style.display = 'none';
                }
            }
        };
        
        video.addEventListener('timeupdate', checkTime);
        video.addEventListener('ended', () => {
            overlay.style.display = 'none';
        });
    }
    
    function submitLike(liked) {
        if (!currentContentId) return;
        
        // Atualizar votos
        if (!userVotes[currentContentId]) {
            userVotes[currentContentId] = { likes: 0, dislikes: 0 };
        }
        
        if (liked) {
            userVotes[currentContentId].likes++;
        } else {
            userVotes[currentContentId].dislikes++;
        }
        
        // Salvar no localStorage
        localStorage.setItem('paixaoflix_votes', JSON.stringify(userVotes));
        
        // Atualizar interface
        updateVoteDisplay();
        
        // Prevenir m√∫ltiplos votos
        const overlay = document.getElementById('like-dislike-overlay');
        overlay.style.display = 'none';
    }
    
    function updateVoteDisplay() {
        if (!currentContentId) return;
        
        const votes = userVotes[currentContentId] || { likes: 0, dislikes: 0 };
        const voteCount = document.getElementById('vote-count');
        const totalVotes = votes.likes + votes.dislikes;
        
        voteCount.textContent = `${totalVotes} votos`;
        
        // Atualizar detalhes do conte√∫do com votos
        const contentElement = document.querySelector(`[data-content-id="${currentContentId}"]`);
        if (contentElement) {
            const voteInfo = contentElement.querySelector('.vote-info');
            if (voteInfo) {
                voteInfo.textContent = `üëç ${votes.likes} | üéé ${votes.dislikes}`;
            }
        }
    }
    
    function addVoteInfoToContent() {
        // Adicionar informa√ß√£o de votos na p√°gina de detalhes
        const allContentElements = document.querySelectorAll('[data-content-id]');
        
        allContentElements.forEach(element => {
            const contentId = element.dataset.contentId;
            const votes = userVotes[contentId] || { likes: 0, dislikes: 0 };
            const voteInfo = element.querySelector('.vote-info');
            
            if (!voteInfo) {
                const voteInfoDiv = document.createElement('div');
                voteInfoDiv.className = 'vote-info';
                voteInfoDiv.textContent = `üëç ${votes.likes} | üéé ${votes.dislikes}`;
                voteInfoDiv.style.cssText = 'position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px;';
                element.appendChild(voteInfoDiv);
            }
        });
    }
    let currentVideoTitle = '';
    let progressInterval;
    let recommendationsTimer;
    let currentRecommendations = [];
    
    function startPlay(url, title, currentTime = 0) {
        const scr = document.getElementById('player-screen');
        const v = document.getElementById('html5-video');
        scr.style.display = 'block';
        v.src = url;
        v.currentTime = currentTime;
        currentVideoTitle = title;
        saveHistory(title, url);
        
        // Iniciar sistema de recomenda√ß√µes
        startRecommendationsSystem();
        
        // Esconder sistema de like/dislike
        const likeOverlay = document.getElementById('like-dislike-overlay');
        if (likeOverlay) {
            likeOverlay.style.display = 'none';
        }
        
        // Salvar progresso em tempo real
        clearInterval(progressInterval);
        progressInterval = setInterval(() => {
            if (!v.paused && !v.ended) {
                updateWatchTime(title, v.currentTime);
            }
        }, 5000); // Salvar a cada 5 segundos
        
        // Salvar quando o v√≠deo pausar
        v.addEventListener('pause', () => {
            updateWatchTime(title, v.currentTime);
        });
        
        // Salvar quando o v√≠deo terminar
        v.addEventListener('ended', () => {
            updateWatchTime(title, v.currentTime);
            clearInterval(progressInterval);
        });
    }

    function stopPlayer() {
        const v = document.getElementById('html5-video');
        if(v.currentTime > 0) {
            updateWatchTime(currentVideoTitle, v.currentTime);
        }
        v.pause();
        document.getElementById('player-screen').style.display = 'none';
        document.getElementById('recommendations-footer').style.display = 'none';
        clearInterval(progressInterval);
        
        // Limpar timer de recomenda√ß√µes
        if(recommendationsTimer) {
            clearInterval(recommendationsTimer);
        }
    }
    
    function updateWatchTime(title, currentTime) {
        let history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const itemIndex = history.findIndex(item => item.title === title);
        
        if(itemIndex !== -1) {
            history[itemIndex].watchedTime = Math.floor(currentTime);
            localStorage.setItem('paixaoflix_history', JSON.stringify(history));
        }
    }
    
    function startRecommendationsSystem() {
        // Mostrar recomenda√ß√µes ap√≥s 30 segundos
        setTimeout(() => {
            showRecommendations();
        }, 30000);
        
        // Atualizar timer a cada segundo
        recommendationsTimer = setInterval(() => {
            updateRecommendationsTimer();
        }, 1000);
    }
    
    function showRecommendations() {
        const footer = document.getElementById('recommendations-footer');
        const content = document.getElementById('recommendations-content');
        
        // Obter conte√∫do mais assistido
        const mostWatched = getMostWatchedContent();
        currentRecommendations = getRecommendationsForUser(mostWatched);
        
        if(currentRecommendations.length === 0) return;
        
        // Mostrar apenas 3 recomenda√ß√µes
        const top3 = currentRecommendations.slice(0, 3);
        
        content.innerHTML = '';
        top3.forEach((item, index) => {
            content.innerHTML += `
                <div class="recommendation-item" onclick="playRecommendation('${item.url}', '${item.titulo}')">
                    <img src="${item.poster}" alt="${item.titulo}">
                    <div class="recommendation-progress">
                        <div class="recommendation-progress-fill" id="progress-${index}"></div>
                    </div>
                    ${index === 0 ? `<div class="recommendation-timer" id="recommendation-timer">Faltam 3:00</div>` : ''}
                </div>`;
        });
        
        footer.style.display = 'block';
        updateRecommendationsTimer();
    }
    
    function getMostWatchedContent() {
        const history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const watchCount = {};
        
        history.forEach(item => {
            watchCount[item.title] = (watchCount[item.title] || 0) + 1;
        });
        
        // Retornar conte√∫do mais assistido
        const sorted = Object.entries(watchCount)
            .sort(([,a], [,b]) => b - a)
            .map(([title]) => title);
        
        return sorted[0] || '';
    }
    
    function getRecommendationsForUser(mostWatchedTitle) {
        if(!mostWatchedTitle) {
            // Se n√£o h√° hist√≥rico, recomendar conte√∫do popular
            return [...masterData]
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
        }
        
        // Encontrar conte√∫do mais assistido
        const mostWatchedItem = masterData.find(item => item.titulo === mostWatchedTitle);
        if(!mostWatchedItem) return [];
        
        // Obter g√™neros do conte√∫do mais assistido
        const preferredGenres = Array.isArray(mostWatchedItem.genero) ? 
            mostWatchedItem.genero : 
            [mostWatchedItem.genero || 'Geral'];
        
        // Filtrar conte√∫do similar
        const similar = masterData
            .filter(item => item.titulo !== mostWatchedTitle)
            .filter(item => {
                const itemGenres = Array.isArray(item.genero) ? item.genero : [item.genero || 'Geral'];
                return itemGenres.some(genre => preferredGenres.includes(genre));
            })
            .sort(() => 0.5 - Math.random());
        
        return similar.slice(0, 3);
    }
    
    function playRecommendation(url, title) {
        const v = document.getElementById('html5-video');
        v.pause();
        startPlay(url, title);
    }
    
    function updateRecommendationsTimer() {
        const v = document.getElementById('html5-video');
        if(!v.duration) return;
        
        const timeRemaining = v.duration - v.currentTime;
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = Math.floor(timeRemaining % 60);
        
        // Atualizar timer na primeira recomenda√ß√£o
        const timerElement = document.querySelector('.recommendation-timer');
        if(timerElement && minutes < 3) {
            timerElement.textContent = `Faltam ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Atualizar barras de progresso
        currentRecommendations.forEach((item, index) => {
            const progressBar = document.getElementById(`progress-${index}`);
            if(progressBar) {
                const progress = ((v.duration - timeRemaining) / v.duration) * 100;
                progressBar.style.width = `${progress}%`;
            }
        });
    }

    // --- CANAIS AO VIVO ---
    let currentChannel = null;
    let currentChannelIndex = 0;
    
    function loadChannels() {
        toggleSearch(true); // Fechar busca se estiver aberta
        
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="channels-page" id="channels-container"></div>';
        
        renderChannels();
        setupChannelsNavigation();
    }
    
    function loadLive(categoryFile) {
        toggleSearch(true);
        
        const app = document.getElementById('main-app');
        app.innerHTML = '<div class="channels-page" id="channels-container"></div>';
        
        renderChannelsByCategory(categoryFile);
        setupChannelsNavigation();
    }
    
    function renderChannels() {
        const container = document.getElementById('channels-container');
        if (!container) return;
        
        // Canais de exemplo (em um sistema real, viria de uma API)
        const channels = [
            // NOT√çCIAS
            { id: 1, name: 'Globo News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GLOBO', category: 'Not√≠cias', url: 'https://globoplay.globo.com/' },
            { id: 2, name: 'Record News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=RECORD', category: 'Not√≠cias', url: 'https://play.r7.com/' },
            { id: 3, name: 'Band News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Not√≠cias', url: 'https://play.band.uol.com.br/' },
            { id: 4, name: 'SBT News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SBT', category: 'Not√≠cias', url: 'https://sbtplay.sbt.com.br/' },
            { id: 5, name: 'CNN Brasil', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=CNN', category: 'Not√≠cias', url: 'https://www.cnnbrasil.com.br/' },
            { id: 6, name: 'BBC News', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BBC', category: 'Not√≠cias', url: 'https://www.bbc.com/portuguese/' },
            { id: 7, name: 'Al Jazeera', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=ALJ', category: 'Not√≠cias', url: 'https://www.aljazeera.com/' },
            
            // ENTRETENIMENTO
            { id: 8, name: 'Globo', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GLOBO', category: 'Entretenimento', url: 'https://globoplay.globo.com/' },
            { id: 9, name: 'Record', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=RECORD', category: 'Entretenimento', url: 'https://play.r7.com/' },
            { id: 10, name: 'SBT', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SBT', category: 'Entretenimento', url: 'https://sbtplay.sbt.com.br/' },
            { id: 11, name: 'Band', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Entretenimento', url: 'https://play.band.uol.com.br/' },
            { id: 12, name: 'RedeTV!', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=REDETV', category: 'Entretenimento', url: 'https://redetv.globo.com/' },
            { id: 13, name: 'TV Cultura', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=CULTURA', category: 'Cultura', url: 'https://tvculturabrasil.sbt.com.br/' },
            { id: 14, name: 'TV Gazeta', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=GAZETA', category: 'Variedades', url: 'https://tvgazeta.globo.com/' },
            
            // ESPORTES
            { id: 15, name: 'ESPN Brasil', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=ESPN', category: 'Esportes', url: 'https://espn.com.br/' },
            { id: 16, name: 'Sportv', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SPORTV', category: 'Esportes', url: 'https://sportv.globo.com/' },
            { id: 17, name: 'Fox Sports', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=FOX', category: 'Esportes', url: 'https://www.foxsports.com.br/' },
            { id: 18, name: 'Premiere', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=PREMIERE', category: 'Esportes', url: 'https://www.premiere.com.br/' },
            { id: 19, name: 'SporTV', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=SPORTV', category: 'Esportes', url: 'https://www.sporthtv.com.br/' },
            { id: 20, name: 'Combate', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=COMBATE', category: 'Esportes', url: 'https://www.combate.com.br/' },
            { id: 21, name: 'BandSports', logo: 'https://via.placeholder.com/150x150/ff0000/000000?text=BAND', category: 'Esportes', url: 'https://play.band.uol.com.br/' }
        ];
        
        // Agrupar por categoria
        const categories = {};
        channels.forEach(channel => {
            if (!categories[channel.category]) {
                categories[channel.category] = [];
            }
            categories[channel.category].push(channel);
        });
        
        // Renderizar categorias e canais
        let html = '';
        Object.keys(categories).forEach(category => {
            html += `<div class="channel-category">
                <h2 class="category-title">${category.toUpperCase()}</h2>
                <div class="channels-grid">`;
            
            categories[category].forEach((channel, index) => {
                const isPlaying = currentChannel && currentChannel.id === channel.id;
                html += `
                    <div class="channel-item" tabindex="0" onclick="playChannel(${channel.id}, '${channel.name}', '${channel.url}')" data-channel-id="${channel.id}">
                        <div class="channel-number">${channel.id}</div>
                        <img src="${channel.logo}" alt="${channel.name}" class="channel-logo">
                        <div class="channel-info">${channel.name}</div>
                        ${isPlaying ? '<div class="channel-playing">AO VIVO</div>' : ''}
                    </div>`;
            });
            
            html += '</div></div>';
        });
        
        container.innerHTML = html;
    }
    
    function renderChannelsByCategory(categoryFile) {
        // Implementar l√≥gica para carregar canais de arquivo espec√≠fico
        renderChannels(); // Por enquanto, usa a mesma l√≥gica
    }
    
    function playChannel(channelId, channelName, channelUrl) {
        // Parar canal atual
        if (currentChannel) {
            // Limpar indicador de canal anterior
            document.querySelectorAll('.channel-playing').forEach(el => el.remove());
        }
        
        // Atualizar canal atual
        currentChannel = { id: channelId, name: channelName, url: channelUrl };
        currentChannelIndex = channelId;
        
        // Adicionar indicador de canal atual
        const currentChannelElement = document.querySelector(`[data-channel-id="${channelId}"]`);
        if (currentChannelElement) {
            currentChannelElement.classList.add('playing');
        }
        
        // Abrir player (em um sistema real, abriria o stream)
        const playerScreen = document.getElementById('player-screen');
        playerScreen.style.display = 'block';
        
        // Esconder sistema de like/dislike para canais ao vivo
        const likeOverlay = document.getElementById('like-dislike-overlay');
        if (likeOverlay) {
            likeOverlay.style.display = 'none';
        }
        
        // Simular reprodu√ß√£o (em um sistema real, conectaria com o stream)
        const video = document.getElementById('html5-video');
        video.src = channelUrl; // URL do stream
        video.play();
    }
    
    function setupChannelsNavigation() {
        // Navega√ß√£o por teclado e controle remoto
        document.addEventListener('keydown', function(e) {
            const focusedElement = document.activeElement;
            const allChannels = Array.from(document.querySelectorAll('.channel-item'));
            const currentIndex = allChannels.findIndex(el => el.dataset.channelId == currentChannelIndex);
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    navigateChannel('previous', currentIndex, allChannels);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    navigateChannel('next', currentIndex, allChannels);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    navigateChannel('up', currentIndex, allChannels);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    navigateChannel('down', currentIndex, allChannels);
                    break;
                case 'Enter':
                case ' ':
                    e.preventDefault();
                    if (focusedElement && focusedElement.classList.contains('channel-item')) {
                        const channelId = parseInt(focusedElement.dataset.channelId);
                        const channelData = findChannelById(channelId);
                        if (channelData) {
                            playChannel(channelData.id, channelData.name, channelData.url);
                        }
                    }
                    break;
                case 'Escape':
                case 'Back':
                    e.preventDefault();
                    // Voltar para home
                    location.reload();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                    e.preventDefault();
                    const channelNumber = parseInt(e.key);
                    const channelData = findChannelById(channelNumber);
                    if (channelData) {
                        playChannel(channelData.id, channelData.name, channelData.url);
                    }
                    break;
            }
        });
        
        // Suporte para navega√ß√£o por toque
        document.querySelectorAll('.channel-item').forEach(item => {
            item.addEventListener('touchend', function(e) {
                e.preventDefault();
                const channelId = parseInt(this.dataset.channelId);
                const channelData = findChannelById(channelId);
                if (channelData) {
                    playChannel(channelData.id, channelData.name, channelData.url);
                }
            });
        });
        
        // Suporte para clique do mouse
        document.querySelectorAll('.channel-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const channelId = parseInt(this.dataset.channelId);
                const channelData = findChannelById(channelId);
                if (channelData) {
                    playChannel(channelData.id, channelData.name, channelData.url);
                }
            });
        });
    }
    
    function navigateChannel(direction, currentIndex, allChannels) {
        if (currentIndex === -1) return;
        
        let nextIndex;
        const gridCols = 7; // 7 canais por linha
        
        switch(direction) {
            case 'previous':
                nextIndex = currentIndex > 0 ? currentIndex - 1 : allChannels.length - 1;
                break;
            case 'next':
                nextIndex = currentIndex < allChannels.length - 1 ? currentIndex + 1 : 0;
                break;
            case 'up':
                nextIndex = currentIndex >= gridCols ? currentIndex - gridCols : currentIndex;
                break;
            case 'down':
                nextIndex = currentIndex + gridCols < allChannels.length ? currentIndex + gridCols : currentIndex;
                break;
        }
        
        if (nextIndex >= 0 && nextIndex < allChannels.length) {
            allChannels[nextIndex].focus();
            allChannels[nextIndex].scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }
    }
    
    function findChannelById(channelId) {
        // Em um sistema real, buscaria na lista de canais carregados
        const allChannels = document.querySelectorAll('.channel-item');
        for (let channel of allChannels) {
            if (parseInt(channel.dataset.channelId) === channelId) {
                const id = parseInt(channel.dataset.channelId);
                const name = channel.querySelector('.channel-info').textContent;
                const logo = channel.querySelector('.channel-logo').src;
                return { id, name, url: `https://example-stream.com/channel/${id}` }; // URL simulada
            }
        }
        return null;
    }

    // --- BUSCA ---
    let searchTimeout;
    let lastSearchQuery = '';
    
    function toggleSearch(forceClose = false) {
        const b = document.getElementById('search-box');
        const input = document.getElementById('input-busca');
        
        if (forceClose || b.style.display === 'block') {
            b.style.display = 'none';
            clearSearch();
            renderHome(); // Voltar para home
        } else {
            b.style.display = 'block';
            input.focus();
        }
    }
    
    function handleSearchBlur() {
        setTimeout(() => {
            const input = document.getElementById('input-busca');
            const searchBox = document.getElementById('search-box');
            
            // Se n√£o h√° foco em nenhum elemento da pesquisa, limpar e voltar para home
            if (document.activeElement !== input && document.activeElement !== searchBox) {
                clearSearch();
                searchBox.style.display = 'none';
                renderHome();
            }
        }, 200);
    }
    
    function clearSearch() {
        const input = document.getElementById('input-busca');
        const results = document.getElementById('search-results');
        
        input.value = '';
        results.innerHTML = '';
        lastSearchQuery = '';
        
        // Limpar timeout anterior
        if (searchTimeout) {
            clearTimeout(searchTimeout);
        }
    }
    
    function searchRealTime(q) {
        const results = document.getElementById('search-results');
        
        // Limpar timeout anterior
        if (searchTimeout) {
            clearTimeout(searchTimeout);
        }
        
        // Se a busca est√° vazia, limpar resultados
        if (q.length < 2) {
            results.innerHTML = '';
            lastSearchQuery = '';
            return;
        }
        
        // Aguardar um pouco antes de buscar (debounce)
        searchTimeout = setTimeout(() => {
            // Se a consulta n√£o mudou, n√£o buscar novamente
            if (q === lastSearchQuery) return;
            
            lastSearchQuery = q;
            const filtered = masterData.filter(item => 
                item.titulo.toLowerCase().includes(q.toLowerCase())
            );
            
            results.innerHTML = '';
            filtered.forEach(item => {
                results.innerHTML += `
                    <div class="search-card" tabindex="0" onclick='openSearchResult(${JSON.stringify(item)})'>
                        <img src="${item.poster}" alt="${item.titulo}">
                        <div class="search-card-footer">
                            <span>${item.year}</span>
                            <span>‚òÖ${item.rating}</span>
                        </div>
                    </div>`;
            });
        }, 300); // Debounce de 300ms
    }
    
    function openSearchResult(item) {
        // Ir para p√°gina de detalhes antes de come√ßar a exibi√ß√£o
        openInfo(item);
    }

    function saveHistory(t, u) {
        // Salvar hist√≥rico com tempo de reprodu√ß√£o
        let history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        
        // Remover entrada existente do mesmo conte√∫do
        history = history.filter(item => item.title !== t);
        
        // Adicionar nova entrada no in√≠cio
        history.unshift({
            title: t,
            url: u,
            timestamp: Date.now(),
            watchedTime: 0 // Ser√° atualizado durante a reprodu√ß√£o
        });
        
        // Manter apenas os 3 mais recentes
        history = history.slice(0, 3);
        
        localStorage.setItem('paixaoflix_history', JSON.stringify(history));
    }
    
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('paixaoflix_history') || '[]');
        const historyContainer = document.getElementById('row-history');
        
        if(history.length === 0) {
            historyContainer.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum conte√∫do assistido recentemente</p>';
            return;
        }
        
        history.forEach(historyItem => {
            // Encontrar o item completo no masterData
            const fullItem = masterData.find(item => item.titulo === historyItem.title);
            if(fullItem) {
                // Calcular progresso baseado no tempo total estimado (120 min para filmes, 45 min para epis√≥dios)
                const estimatedDuration = fullItem.type === 'serie' ? 2700 : 7200; // 45min ou 120min em segundos
                const progressPercent = historyItem.watchedTime ? Math.min((historyItem.watchedTime / estimatedDuration) * 100, 100) : 0;
                
                historyContainer.innerHTML += `
                    <div class="capa-item history" tabindex="0" onclick='resumeFromHistory("${historyItem.title}", "${historyItem.url}", ${historyItem.watchedTime || 0})'>
                        <img src="${fullItem.poster}">
                        <div class="progress-bar-external">
                            <div class="progress-bar-internal" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="capa-footer"><span>${fullItem.year}</span><span>‚òÖ${fullItem.rating}</span></div>
                    </div>`;
            }
        });
    }
    
    function resumeFromHistory(title, url, currentTime) {
        startPlay(url, title, currentTime);
    }

    window.onload = initPaixaoFlix;
</script>
</body>
</html>
