<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PaixãoFlix</title>

<style>
/* ================= RESET ================= */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#0b0b0f;
  color:#ffd84d;
  overflow:hidden;
}
:root{
  --card:#1b1b25;
  --border:rgba(255,255,255,.08);
  --focus:#e50914;
}
img{width:100%;display:block;}
.hidden{display:none;}
a{color:#ffd84d;text-decoration:none;cursor:pointer;}
.focused{box-shadow:0 0 0 3px var(--focus);transform:scale(1.05);z-index:9;}
</style>

<!-- ================= SIDEBAR ================= -->
<style>
#sidebar{
  position:fixed;left:0;top:0;bottom:0;
  width:150px;background:#111118;
  border-right:1px solid var(--border);
  padding:1rem .5rem;
}
#logo{display:flex;justify-content:center;margin-bottom:2rem;}
#logo img{width:140px;}
.menu a{
  display:block;text-align:center;
  padding:.8rem;border-radius:10px;margin-bottom:.3rem;
}
.menu a:focus{outline:none;background:var(--card);}
</style>

<!-- ================= HOME ================= -->
<style>
#home{margin-left:150px;height:100vh;padding:1.2rem;overflow-y:auto;}
.section{margin-bottom:2.6rem;}
.section h2{margin-bottom:1rem;font-size:1.8rem;}
.row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;}
.card{background:var(--card);border-radius:14px;overflow:hidden;cursor:pointer;}
.card img{height:260px;object-fit:cover;}
.card span{display:block;padding:.6rem;}
.continuar-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;}
.continuar{background:var(--card);border-radius:14px;overflow:hidden;cursor:pointer;}
.continuar img{height:150px;object-fit:cover;}
.continuar p{padding:.6rem;}
.progress{height:4px;background:#333;}
.progress span{height:100%;width:60%;background:var(--focus);display:block;}
</style>

<!-- ================= DETALHES ================= -->
<style>
#details{display:none;height:100vh;margin-left:150px;background-size:cover;background-position:center;}
.details-overlay{background:rgba(0,0,0,.8);height:100%;padding:3rem;display:flex;}
.details-poster{width:260px;margin-right:2rem;}
.details-info h1{font-size:calc(2rem + 2px);font-weight:500;font-style:italic;}
.details-info p{margin-top:3px;color:#fff;}
</style>

<!-- ================= CANAIS ================= -->
<style>
#catalogo{display:none;margin-left:150px;padding:1.2rem;height:calc(100vh);overflow-y:auto;scroll-behavior:smooth;}
#catalogo .canal-row{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-bottom:20px;}
.canal-card{display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;background:none;border:none;box-shadow:none;}
.canal-card img{width:100%;height:120px;object-fit:contain;}
.canal-card span{margin-top:5px;text-align:center;color:#ffd84d;font-size:0.9rem;display:block;}
</style>

</head>
<body>

<!-- ================= MENU ================= -->
<nav id="sidebar">
  <div id="logo">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
  </div>
  <div class="menu">
    <a>Início</a>
    <a>TV ao Vivo</a>
    <a>Cinema</a>
    <a>Séries</a>
    <a>Minha Lista</a>
    <a>Filmes Kids</a>
    <a>Séries Kids</a>
    <a>Canais Kids</a>
  </div>
</nav>

<!-- ================= HOME ================= -->
<div id="home">
  <section class="section"><h2>Em Alta</h2><div class="row" id="emAlta"></div></section>
  <section class="section"><h2>Novos</h2><div class="row" id="novos"></div></section>
  <section class="section"><h2>Continuar Assistindo</h2><div class="continuar-row" id="continuar"></div></section>
  <section class="section"><h2>Recomendados</h2><div class="row" id="recomendados"></div></section>
</div>

<!-- ================= DETALHES ================= -->
<div id="details">
  <div class="details-overlay">
    <div class="details-poster"><img id="detailsPoster"></div>
    <div class="details-info">
      <h1 id="detailsTitle"></h1>
      <p id="detailsMeta"></p>
      <p id="detailsDesc"></p>
    </div>
  </div>
</div>

<!-- ================= CATALOGO DE CANAIS ================= -->
<div id="catalogo"></div>

<script>
let focusables=[],currentIndex=0;

/* ================= COLETAR ELEMENTOS FOCÁVEIS ================= */
function recolherFocusables(){
  focusables=[...document.querySelectorAll('a, button, .card, .continuar, .canal-card, [tabindex]')]
    .filter(el=>el.offsetParent!==null);
  focusables.forEach((el,i)=>{el.dataset.focusIndex=i;el.tabIndex=-1;el.classList.remove('focused');});
}

/* ================= DEFINIR FOCO ================= */
function setFoco(index){
  if(!focusables[index]) return;
  focusables.forEach(el=>el.classList.remove('focused'));
  currentIndex=index;
  const el=focusables[currentIndex];
  el.classList.add('focused');
  el.tabIndex=0;
  el.focus({preventScroll:true});
  el.scrollIntoView({block:'nearest',inline:'nearest'});
}

/* ================= MOVER FOCO ================= */
function moveFoco(dir){
  let next=currentIndex;
  let cols=4;
  if(focusables[currentIndex]?.classList.contains('canal-card')) cols=7;
  switch(dir){
    case'left':next--;break;
    case'right':next++;break;
    case'up':next-=cols;break;
    case'down':next+=cols;break;
  }
  if(next<0) next=0;
  if(next>=focusables.length) next=focusables.length-1;
  setFoco(next);
}

/* ================= TECLADO ================= */
document.addEventListener('keydown',e=>{
  switch(e.key){
    case'ArrowLeft':e.preventDefault();moveFoco('left');break;
    case'ArrowRight':e.preventDefault();moveFoco('right');break;
    case'ArrowUp':e.preventDefault();moveFoco('up');break;
    case'ArrowDown':e.preventDefault();moveFoco('down');break;
    case'Enter':case'OK':e.preventDefault();focusables[currentIndex]?.click();break;
  }
});

/* ================= HOME ================= */
function renderCard(item,container){
  if(!item)return;
  const div=document.createElement('div');
  div.className='card';div.tabIndex=0;
  div.innerHTML=`<img src="${item.poster}"><span>${item.titulo}</span>`;
  div.onclick=()=>openDetails(item);
  container.appendChild(div);
}

function loadCategory(path,container){
  fetch(path).then(r=>r.json()).then(data=>{
    container.innerHTML='';
    data.slice(0,4).forEach(i=>renderCard(i,container));
    recolherFocusables();
  });
}

/* ================= DETALHES ================= */
function openDetails(item){
  document.getElementById('home').style.display='none';
  document.getElementById('catalogo').style.display='none';
  document.getElementById('details').style.display='block';
  detailsPoster.src=item.poster;
  detailsTitle.textContent=item.titulo;
  detailsMeta.textContent=`⭐ ${item.rating} • ${item.year}`;
  detailsDesc.textContent=item.desc;
}

/* ================= VOLTAR HOME ================= */
function goHome(){
  document.getElementById('details').style.display='none';
  document.getElementById('catalogo').style.display='none';
  document.getElementById('home').style.display='block';
  recolherFocusables();
  const inicio=document.querySelector('#sidebar .menu a:first-child');
  setFoco(parseInt(inicio.dataset.focusIndex||0));
}

/* ================= CATALOGO CANAIS ================= */
function abrirCanais(path,titulo){
  document.getElementById('home').style.display='none';
  document.getElementById('details').style.display='none';
  const catalogo=document.getElementById('catalogo');
  catalogo.style.display='block';
  catalogo.innerHTML=`<h2>${titulo}</h2><div id="canais-grid" class="canal-row"></div>`;
  const grid=document.getElementById('canais-grid');
  fetch(path).then(r=>r.json()).then(data=>{
    data.forEach(c=>{
      const div=document.createElement('div');
      div.className='canal-card';
      div.tabIndex=0;
      div.innerHTML=`<img src="${c.logo}" alt="${c.nome}"><span>${c.nome}</span>`;
      div.onclick=()=>openDetails(c);
      grid.appendChild(div);
    });
    recolherFocusables();
    const firstChannel=focusables.findIndex(f=>f.classList.contains('canal-card'))||0;
    setFoco(firstChannel);
  });
}

/* ================= MENU ================= */
document.querySelectorAll('#sidebar .menu a').forEach(btn=>{
  const txt=btn.textContent.trim();
  switch(txt){
    case'Início': btn.onclick=goHome; break;
    case'TV ao Vivo': btn.onclick=()=>abrirCanais('data/ativa_canais.json','TV ao Vivo'); break;
    case'Canais Kids': btn.onclick=()=>abrirCanais('data/ativa_kids_canais.json','Canais Kids'); break;
    case'Cinema': btn.onclick=()=>loadCategory('data/filmes.json',emAlta); break;
    case'Séries': btn.onclick=()=>loadCategory('data/series.json',emAlta); break;
    case'Filmes Kids': btn.onclick=()=>loadCategory('data/kids_filmes.json',emAlta); break;
    case'Séries Kids': btn.onclick=()=>loadCategory('data/kids_series.json',emAlta); break;
    case'Minha Lista': btn.onclick=()=>loadCategory('data/favoritos.json',emAlta); break;
  }
});

/* ================= INIT ================= */
window.addEventListener('load',()=>{
  recolherFocusables();
  const inicio=document.querySelector('#sidebar .menu a:first-child')||focusables[0];
  setFoco(parseInt(inicio.dataset.focusIndex||0));
  loadCategory('data/filmes.json',document.getElementById('emAlta'));
  loadCategory('data/series.json',document.getElementById('novos'));
});
</script>

</body>
</html>
