<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <title>PaixãoFlix – Web TV</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
    <style>
        :root { --primary: #e50914; --bg: #000; --side: #111; --text: #fff; }
        body { margin:0; background:var(--bg); color:var(--text); font-family:sans-serif; display:flex; height:100vh; overflow:hidden; }
        #sidebar { width:280px; min-width:280px; background:var(--side); display:flex; flex-direction:column; border-right:1px solid #222; }
        .logo-area { padding:15px; text-align:center; border-bottom:1px solid #222; }
        .logo-area img { height:50px; }
        .search-area { padding:10px; }
        #search { width:calc(100% - 24px); padding:10px; border-radius:4px; border:1px solid #333; background:#222; color:#fff; outline:none; }
        #channel-list { flex:1; overflow-y:auto; scrollbar-width: thin; }
        .cat-title { background:#000; padding:10px; color:var(--primary); font-weight:bold; font-size:11px; text-transform:uppercase; position:sticky; top:0; z-index:5; }
        .item { padding:12px; cursor:pointer; font-size:13px; border-bottom:1px solid #1a1a1a; transition: 0.1s; }
        .item:hover, .item.active { background:#222; border-left:3px solid var(--primary); }
        #main-view { flex:1; background:#000; display:flex; position:relative; }
        video { width:100%; height:100%; }
        mark { background: var(--primary); color: #fff; }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="logo-area"><img src="https://tv.paixaoflix.vip/logo.png" alt="Logo"></div>
        <div class="search-area"><input type="text" id="search" placeholder="Buscar em 17.994 itens..."></div>
        <div id="channel-list">Carregando canais...</div>
    </div>
    <div id="main-view"><video id="player" controls autoplay playsinline></video></div>

    <script>
        const PROXY = 'https://tv.paixaoflix-vip.workers.dev/?url=';
        let catalogo = [];
        const video = document.getElementById('player');
        let hls = null;

        async function init() {
            try {
                const res = await fetch('catalogo.json');
                catalogo = await res.json();
                render(catalogo);
                if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
            } catch (e) { document.getElementById('channel-list').innerText = "Erro ao carregar catálogo."; }
        }

        function render(canais, q = "") {
            const list = document.getElementById('channel-list');
            list.innerHTML = '';
            let lastG = '';
            canais.forEach(c => {
                if(c.g !== lastG && !q) {
                    const h = document.createElement('div'); h.className = 'cat-title'; h.innerText = c.g;
                    list.appendChild(h); lastG = c.g;
                }
                const div = document.createElement('div');
                div.className = 'item'; 
                let t = c.t;
                if(q) { t = t.replace(new RegExp(`(${q})`, 'ig'), '<mark>$1</mark>'); }
                div.innerHTML = t;
                div.onclick = () => playStream(c.v, div);
                list.appendChild(div);
            });
        }

        function playStream(url, el) {
            document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const finalUrl = PROXY + encodeURIComponent(url);
            if (hls) hls.destroy();
            if (Hls.isSupported()) {
                hls = new Hls(); hls.loadSource(finalUrl); hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else { video.src = finalUrl; }
        }

        let timer;
        document.getElementById('search').oninput = (e) => {
            clearTimeout(timer);
            const q = e.target.value.toLowerCase();
            timer = setTimeout(() => {
                const filtrados = catalogo.filter(c => c.t.toLowerCase().includes(q) || c.g.toLowerCase().includes(q));
                render(filtrados.slice(0, 500), q); // Limita a 500 na busca para não travar a tela
            }, 200);
        };

        init();
    </script>
</body>
</html>
