<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>PaixãoFlix – Web TV</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
  <style>
    :root{--primary:#e50914;--bg:#000;--side:#111;--text:#fff}
    body{margin:0;background:var(--bg);color:var(--text);font-family:'Poppins',sans-serif;display:flex;height:100vh;overflow:hidden}
    #sidebar{width:320px;min-width:320px;background:var(--side);display:flex;flex-direction:column;border-right:1px solid #222}
    .header-area{padding:15px;border-bottom:1px solid #222;display:flex;flex-direction:column;gap:12px}
    .logo-area img{width:100%;max-height:55px;object-fit:contain}
    #search-box{width:100%;padding:12px;border-radius:4px;border:1px solid #333;background:#222;color:#fff;font-size:14px;outline:none;font-family:'Poppins'}
    #channel-list{flex:1;overflow-y:auto;outline:none}
    .cat-title{background:#000;padding:15px;color:#fff;font-weight:700;font-size:14px;text-transform:uppercase;position:sticky;top:0;z-index:5;border-bottom:1px solid #1a1a1a}
    .item{padding:12px 15px;cursor:pointer;font-size:13px;border-bottom:1px solid #1a1a1a;border-left:4px solid transparent;color:#ccc}
    .item.active{background:#1a1a1a;border-left-color:var(--primary);font-weight:700;color:#fff}
    #main-view{flex:1;background:#000;position:relative;display:flex;align-items:center;justify-content:center}
    video{width:100%;height:100%;background:#000}
    #loader{position:absolute;background:rgba(0,0,0,.9);width:100%;height:100%;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:10;font-weight:700}
    .spin{border:4px solid #333;border-top:4px solid var(--primary);border-radius:50%;width:50px;height:50px;animation:s 1s linear infinite;margin-bottom:15px}
    @keyframes s{100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div id="sidebar">
    <div class="header-area">
      <div class="logo-area"><img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logo.png" alt="logo"></div>
      <input id="search-box" type="text" placeholder="Pesquisar canal...">
    </div>
    <div id="channel-list" tabindex="0"></div>
  </div>

  <div id="main-view">
    <div id="loader"><div class="spin"></div>CONECTANDO SINAL...</div>
    <video id="player" controls autoplay playsinline></video>
  </div>

  <script>
    // Configurações principais
    const M3U = 'https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/tv.paixaoflix.m3u';
    const PROXY = 'https://tv.paixaoflix.vip/sinal/';

    const video = document.getElementById('player');
    const listEl = document.getElementById('channel-list');
    const loader = document.getElementById('loader');
    const searchBox = document.getElementById('search-box');
    let channels = [], filtered = [], currentIndex = 0, hls = null;

    async function init(){
      try{
        const txt = await (await fetch(M3U)).text();
        let grp = 'CANAIS';
        channels = [];
        const lines = txt.split('\n');
        for(let i=0; i<lines.length; i++){
          if(lines[i].startsWith('#EXTINF:')){
            const name = lines[i].split(',').pop().trim();
            const g = lines[i].match(/group-title="([^"]+)"/);
            if(g) grp = g[1];
            const url = lines[i+1]?.trim();
            if(url && url.startsWith('http')) channels.push({t:name, g:grp, v:url});
          }
        }
        filtered = channels; render(); play(0);
      }catch(e){ console.error("Erro ao carregar M3U:", e); }
    }

    function render(){
      listEl.innerHTML = ''; let last = '';
      filtered.forEach((c, i)=>{
        if(c.g !== last){
          const d = document.createElement('div'); d.className = 'cat-title'; d.textContent = c.g;
          listEl.appendChild(d); last = c.g;
        }
        const d = document.createElement('div'); d.className = 'item'; d.id = 'ch' + i; d.textContent = c.t;
        d.onclick = () => play(i); listEl.appendChild(d);
      });
    }

    function play(idx){
      if(idx < 0 || idx >= filtered.length) return;
      currentIndex = idx;
      
      // Estilo de seleção
      document.querySelectorAll('.item').forEach(el => el.classList.remove('active'));
      const sel = document.getElementById('ch' + idx);
      if(sel){ sel.classList.add('active'); sel.scrollIntoView({block:'center'}); }
      
      if(hls){ hls.destroy(); hls = null; }
      video.pause();
      loader.style.display = 'flex';

      // CORREÇÃO: O link AGORA passa pelo seu PROXY HTTPS
      const rawUrl = filtered[idx].v;
      const finalUrl = PROXY + rawUrl; 

      console.log("Abrindo sinal via Proxy:", finalUrl);

      if(Hls.isSupported()){
        hls = new Hls({
            manifestLoadingMaxRetry: 10,
            manifestLoadingRetryDelay: 1000,
            enableWorker: true
        });
        hls.loadSource(finalUrl);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          loader.style.display = 'none';
          video.play().catch(e => console.log("Auto-play barrado"));
        });
        hls.on(Hls.Events.ERROR, (e, data) => {
          if(data.fatal){ hls.startLoad(); }
        });
      } else {
        video.src = finalUrl;
        video.onloadeddata = () => { loader.style.display = 'none'; video.play(); };
      }
    }

    // Navegação e Busca
    window.addEventListener('keydown', e => {
      if(document.activeElement === searchBox) return;
      if(e.key === 'ArrowDown'){ e.preventDefault(); play(currentIndex + 1); }
      else if(e.key === 'ArrowUp'){ e.preventDefault(); play(currentIndex - 1); }
    });

    searchBox.oninput = () => {
      const q = searchBox.value.toLowerCase();
      filtered = channels.filter(c => c.t.toLowerCase().includes(q));
      render();
    };

    init();
  </script>
</body>
</html>
