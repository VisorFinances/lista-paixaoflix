
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PaixãoFlix</title>

<style>
/* ================= RESET ================= */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#0b0b0f;
  color:#ffd84d;
  overflow:hidden;
}
:root{
  --card:#1b1b25;
  --border:rgba(255,255,255,.08);
  --focus:#e50914;
}
img{width:100%;display:block}
.hidden{display:none}
</style>

<!-- ================= SIDEBAR (NÃO MEXER) ================= -->
<style>
#sidebar{
  position:fixed;
  left:0;top:0;bottom:0;
  width:150px;
  background:#111118;
  border-right:1px solid var(--border);
  padding:1rem .5rem
}
#logo{display:flex;justify-content:center;margin-bottom:2rem}
#logo img{width:140px}

.menu a{
  display:block;
  text-align:center;
  padding:.8rem;
  border-radius:10px;
  margin-bottom:.3rem;
  color:#ffd84d;
  cursor:pointer;
}
.menu a:focus{
  outline:none;
  background:var(--card);
  box-shadow:0 0 0 3px var(--focus)
}
</style>

<!-- ================= HOME ================= -->
<style>
#home{
  margin-left:150px;
  height:100vh;
  padding:1.2rem;
}
.section{margin-bottom:2.6rem}
.section h2{
  margin-bottom:1rem;
  font-size:1.5rem;
}
.row{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:1rem
}
.card{
  background:var(--card);
  border-radius:14px;
  overflow:hidden
}
.card:focus{
  outline:none;
  box-shadow:0 0 0 4px var(--focus)
}
.card img{height:260px;object-fit:cover}
.card span{display:block;padding:.6rem}
</style>

<!-- ================= CONTINUAR ================= -->
<style>
.continuar-row{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:1rem
}
.continuar{
  background:var(--card);
  border-radius:14px;
  overflow:hidden
}
.continuar:focus{
  outline:none;
  box-shadow:0 0 0 4px var(--focus)
}
.continuar img{height:150px;object-fit:cover}
.progress{height:4px;background:#333}
.progress span{height:100%;width:60%;background:var(--focus);display:block}
.continuar p{padding:.6rem}
</style>

<!-- ================= DETALHES ================= -->
<style>
#details{
  display:none;
  height:100vh;
  margin-left:150px;
  background-size:cover;
  background-position:center;
}
.details-overlay{
  background:rgba(0,0,0,.8);
  height:100%;
  padding:3rem;
  display:flex
}
.details-poster{width:260px;margin-right:2rem}
.details-info h1{
  font-size:calc(2rem + 2px);
  font-weight:500;
  font-style:italic;
}
.details-info p{
  margin-top:3px;
  color:#fff;
}
</style>
</head>

<body>

<!-- ================= MENU ================= -->
<nav id="sidebar">
  <div id="logo">
    <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
  </div>

  <div class="menu">
    <a tabindex="1" onclick="goHome()">Início</a>
    <a tabindex="2" onclick="openTV('data/ativa_canais.m3u')">TV ao Vivo</a>
    <a tabindex="3" onclick="loadCategory('data/filmes.json')">Cinema</a>
    <a tabindex="4" onclick="loadCategory('data/series.json')">Séries</a>
    <a tabindex="5" onclick="loadCategory('data/favoritos.json')">Minha Lista</a>
    <a tabindex="6" onclick="loadCategory('data/kids_filmes.json')">Filmes Kids</a>
    <a tabindex="7" onclick="loadCategory('data/kids_series.json')">Séries Kids</a>
    <a tabindex="8" onclick="openTV('data/ativa_kids_canais.m3u')">Canais Kids</a>
  </div>
</nav>

<!-- ================= HOME ================= -->
<div id="home">

<section class="section">
<h2>Em Alta</h2>
<div class="row" id="emAlta"></div>
</section>

<section class="section">
<h2>Novos</h2>
<div class="row" id="novos"></div>
</section>

<section class="section">
<h2>Continuar Assistindo</h2>
<div class="continuar-row" id="continuar"></div>
</section>

<section class="section">
<h2>Recomendados</h2>
<div class="row" id="recomendados"></div>
</section>

</div>

<!-- ================= DETALHES ================= -->
<div id="details">
  <div class="details-overlay">
    <div class="details-poster">
      <img id="detailsPoster">
    </div>
    <div class="details-info">
      <h1 id="detailsTitle"></h1>
      <p id="detailsMeta"></p>
      <p id="detailsDesc"></p>
    </div>
  </div>
</div>

<script>
/* ================= NAVEGAÇÃO TV ================= */
let area='menu'
let menu=[...document.querySelectorAll('.menu a')]
let focusables=[]
let m=0,c=0
menu[m].focus()

document.addEventListener('keydown',e=>{
  if(area==='menu'){
    if(e.key==='ArrowDown') m=(m+1)%menu.length
    if(e.key==='ArrowUp') m=(m-1+menu.length)%menu.length
    if(e.key==='ArrowRight'){area='home';c=0;focusables[c]?.focus();return}
    if(e.key==='Enter') menu[m].click()
    menu[m].focus()
  }else{
    const cols=4
    if(e.key==='ArrowRight') c=Math.min(c+1,focusables.length-1)
    if(e.key==='ArrowLeft'){
      if(c%cols===0){area='menu';menu[m].focus();return}
      c--
    }
    if(e.key==='ArrowDown') c=Math.min(c+cols,focusables.length-1)
    if(e.key==='ArrowUp') c=Math.max(c-cols,0)
    if(e.key==='Enter') focusables[c]?.click()
    focusables[c]?.focus()
  }
})

/* ================= HOME / DETALHES ================= */
function openDetails(item){
  home.style.display='none'
  details.style.display='block'
  details.style.backgroundImage=`url(${item.poster})`
  detailsPoster.src=item.poster
  detailsTitle.textContent=item.titulo
  detailsMeta.textContent=`⭐ ${item.rating} • ${item.year}`
  detailsDesc.textContent=item.desc
}

function goHome(){
  details.style.display='none'
  home.style.display='block'
  area='menu'
  menu[m].focus()
}

/* ================= LOADERS ================= */
function renderCard(item, container){
  const div=document.createElement('div')
  div.className='card'
  div.tabIndex=0
  div.innerHTML=`<img src="${item.poster}"><span>${item.titulo}</span>`
  div.onclick=()=>openDetails(item)
  container.appendChild(div)
}

function loadCategory(path){
  fetch(path).then(r=>r.json()).then(data=>{
    emAlta.innerHTML=''
    data.slice(0,4).forEach(i=>renderCard(i,emAlta))
    refreshFocus()
  })
}

function openTV(){
  console.log('TV:', 'data/ativa_canais.m3u', 'data/ativa_kids_canais.m3u')
}

function openKids(){
  loadCategory('data/kids_filmes.json')
}

/* ================= INIT ================= */
function refreshFocus(){
  focusables=[...document.querySelectorAll('.card,.continuar')]
}
fetch('data/filmes.json').then(r=>r.json()).then(d=>{
  d.slice(0,4).forEach(i=>renderCard(i,emAlta))
  refreshFocus()
})
</script>

<!-- ================= PATCH HOME 4 CAPAS FIXAS ================= -->
<style>
/* Garante apenas 4 capas grandes por sessão */
#home .row{
  grid-template-columns:repeat(4,1fr) !important;
}

/* Capas maiores */
#home .card img{
  height:340px !important;
}

/* Remove QUALQUER pista visual de continuidade horizontal */
#home .row::before,
#home .row::after{
  display:none !important;
}
</style>

<!-- ================= PATCH TITULOS HOME ================= -->
<style>
#home .section h2{
  font-size: calc(1.5rem + 8px) !important;
}
</style>

<!-- ================= PATCH ANTI DUPLICAÇÃO HOME ================= -->
<script>
const usadosHome = new Set()

function renderCardHome(item, container){
  if(!item || usadosHome.has(item.poster)) return
  usadosHome.add(item.poster)

  const div=document.createElement('div')
  div.className='card'
  div.tabIndex=0
  div.innerHTML=`
    <img src="${item.poster}">
    <span>${item.titulo}</span>
    <span class="info">${item.year} • ⭐ ${item.rating}</span>
  `
  div.onclick=()=>openDetails(item)
  container.appendChild(div)
}
</script>

<script>
function loadEmAlta(){
  usadosHome.clear()

  Promise.all([
    fetch('data/filmes.json').then(r=>r.json()),
    fetch('data/series.json').then(r=>r.json()),
    fetch('data/kids_filmes.json').then(r=>r.json()),
    fetch('data/kids_series.json').then(r=>r.json())
  ]).then(([f,s,kf,ks])=>{
    emAlta.innerHTML=''
    renderCardHome(f[0],emAlta)
    renderCardHome(s[0],emAlta)
    renderCardHome(kf[0],emAlta)
    renderCardHome(ks[0],emAlta)
  })
}
</script>

<script>
function loadEmAlta(){
  usadosHome.clear()

  Promise.all([
    fetch('data/filmes.json').then(r=>r.json()),
    fetch('data/series.json').then(r=>r.json()),
    fetch('data/kids_filmes.json').then(r=>r.json()),
    fetch('data/kids_series.json').then(r=>r.json())
  ]).then(([f,s,kf,ks])=>{
    emAlta.innerHTML=''
    renderCardHome(f[0],emAlta)
    renderCardHome(s[0],emAlta)
    renderCardHome(kf[0],emAlta)
    renderCardHome(ks[0],emAlta)
  })
}
</script>

<script>
function loadNovos(){
  fetch('data/filmes.json').then(r=>r.json()).then(data=>{
    novos.innerHTML=''

    const y26=data.filter(i=>i.year=="2026")
    const y25=data.filter(i=>i.year=="2025")
    const y25=data.filter(i=>i.year=="2025")

    function pick(arr){
      return arr.find(i=>!usadosHome.has(i.poster))
    }

    const ordem=[
      pick(y26),
      pick(y25),
      pick(y26.slice(1)),
      pick(y25.slice(1))
    ]

    ordem.forEach(i=>renderCardHome(i,novos))
    refreshFocus()
  })
}
</script>
  
<!-- ================= PATCH RECOMENDADOS POSIÇÃO ================= -->
<style>
.rank-badge{
  bottom:27px !important; /* +7px */
}
</style>

<script>
loadEmAlta()
loadNovos()
loadContinuar()
loadRecomendados()
</script>

<style>
:focus{
  outline:none;
}

.focused{
  box-shadow:0 0 0 3px #ffd200;
  transform:scale(1.05);
  z-index:9;
}
</style>

<script>
let focusables=[]
let currentIndex=0

function collectFocusables(){
  focusables=[...document.querySelectorAll(
    'a,button,.card,[tabindex]'
  )].filter(el=>!el.disabled && el.offsetParent!==null)

  focusables.forEach((el,i)=>{
    el.dataset.focusIndex=i
    el.tabIndex=-1
  })
}

function setFocus(index){
  if(!focusables[index]) return

  focusables.forEach(el=>el.classList.remove('focused'))

  currentIndex=index
  const el=focusables[currentIndex]
  el.classList.add('focused')
  el.focus({preventScroll:true})
  el.scrollIntoView({block:'nearest',inline:'nearest'})
}

function moveFocus(dir){
  const cols=4
  let next=currentIndex

  if(dir==='left')  next--
  if(dir==='right') next++
  if(dir==='up')    next-=cols
  if(dir==='down')  next+=cols

  if(next<0) next=0
  if(next>=focusables.length) next=focusables.length-1

  setFocus(next)
}

document.addEventListener('keydown',e=>{
  switch(e.key){
    case'ArrowLeft':  e.preventDefault();moveFocus('left');break
    case'ArrowRight': e.preventDefault();moveFocus('right');break
    case'ArrowUp':    e.preventDefault();moveFocus('up');break
    case'ArrowDown':  e.preventDefault();moveFocus('down');break
    case'Enter':
    case'OK':
      e.preventDefault()
      focusables[currentIndex]?.click()
      break
  }
})
</script>

 <script>
window.addEventListener('load',()=>{
  collectFocusables()

  // força foco no botão INÍCIO
  const inicio=document.querySelector('#menu-inicio,.inicio,.home-btn')
  if(inicio){
    setTimeout(()=>{
      currentIndex=parseInt(inicio.dataset.focusIndex||0)
      setFocus(currentIndex)
    },50)
  }else{
    setFocus(0)
  }
})
</script>

<script>
function abrirCanais(url){
  window.location.href = url
}

/* TV AO VIVO */
document.querySelectorAll(
  '#menu-tv, .menu-tv, [data-menu="tv"]'
).forEach(btn=>{
  btn.addEventListener('click',()=>{
    abrirCanais('data/ativa_canais.m3u')
  })
})

/* CANAIS KIDS */
document.querySelectorAll(
  '#menu-canais-kids, .menu-canais-kids, [data-menu="kids-tv"]'
).forEach(btn=>{
  btn.addEventListener('click',()=>{
    abrirCanais('data/ativa_kids_canais.m3u')
  })
})
</script>

<script>
/* ================= PATCH MENU TV ================= */

function openTV(){
  window.location.href = 'canais.html'
}

function openKids(){
  window.location.href = 'canais_kids.html'
}

</script>
  
</body>
</html>
