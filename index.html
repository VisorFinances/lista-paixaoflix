<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Poppins;background:#000;color:#fff;overflow:hidden}
::-webkit-scrollbar{display:none}
#app{display:flex;height:100vh}

/* SIDEBAR */
#side{width:420px;background:#111;display:flex;flex-direction:column;border-right:1px solid #222}

/* HEADER */
#header{padding:16px;display:flex;justify-content:space-between;align-items:center}
#logo{width:160px}
#clock{font-size:20px}
#date{font-size:12px}

/* SEARCH */
#search{margin:10px 16px;padding:10px;font-size:16px;background:#000;color:#fff;border:2px solid #e50914;border-radius:6px}
.focus-search{outline:2px solid #fff}

/* NOW */
#now{margin:4px 16px;font-size:13px}
#now span{font-size:14px}

/* MENU */
#menu{margin:10px 16px;display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.btn{padding:6px;font-size:13px;background:#222;border-radius:6px;text-align:center;white-space:nowrap}
.btn.kids{background:#0056b3}
.btn.active{background:#e50914}
.btn.focus{box-shadow:0 0 0 2px #fff inset}

/* LIST */
#list{flex:1;overflow-y:auto}
.item{padding:12px;border-bottom:1px solid #222;font-size:16px}
.item.focus{background:#222;border-left:6px solid #e50914}

/* PLAYER */
#player{flex:1;position:relative}
video{width:100%;height:100%}

/* OVERLAY */
#zap{position:absolute;bottom:40px;left:40px;background:rgba(0,0,0,.8);padding:10px 20px;font-size:20px;border-left:6px solid #e50914;display:none}
</style>
</head>

<body>
<div id="app">

<div id="side">
  <div id="header">
    <img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
    <div>
      <div id="clock"></div>
      <div id="date"></div>
    </div>
  </div>

  <input id="search" placeholder="Pesquisar...">

  <div id="now">Assistindo agora: <span>—</span></div>

  <div id="menu">
    <div class="btn active" data="tv">TV</div>
    <div class="btn" data="filmes">Filmes</div>
    <div class="btn" data="series">Séries</div>
    <div class="btn kids" data="kids">Canal Kids</div>
    <div class="btn kids" data="kidsconteudo">Filmes/Séries Kids</div>
    <div class="btn" data="fav">Favoritos</div>
  </div>

  <div id="list"></div>
</div>

<div id="player">
  <video id="video" autoplay></video>
  <div id="zap"></div>
</div>

</div>

<script>
/* CLOCK */
setInterval(()=>{
  const d=new Date()
  clock.textContent=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})
  date.textContent=d.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'2-digit'})
},1000)

/* STATE */
let items=[],view=[]
let zone='list' // search | menu | list
let idx=0,menuIdx=0
let hls=null

const menuBtns=[...document.querySelectorAll('.btn')]

/* LOAD TV */
async function loadTV(){
  const t=await fetch('data/canais.m3u').then(r=>r.text())
  items=[]
  let n=''
  t.split('\n').forEach(l=>{
    if(l.startsWith('#EXTINF')) n=l.split(',').pop()
    else if(l.startsWith('http')) items.push({title:n,url:l})
  })
  view=[...items]
  render()
  play(0)
}

/* RENDER */
function render(){
  list.innerHTML=''
  view.forEach(v=>{
    const d=document.createElement('div')
    d.className='item'
    d.textContent=v.title
    list.appendChild(d)
  })
  idx=0
  updateFocus()
}

/* PLAY */
function play(i){
  const it=view[i]
  if(!it) return
  if(hls){hls.destroy();hls=null}
  if(it.url.includes('.m3u8') && Hls.isSupported()){
    hls=new Hls();hls.loadSource(it.url);hls.attachMedia(video)
  }else video.src=it.url
  video.play().catch(()=>{})
  now.querySelector('span').textContent=it.title
  zap.textContent=it.title
  zap.style.display='block'
  setTimeout(()=>zap.style.display='none',1200)
}

/* FOCUS */
function updateFocus(){
  document.querySelectorAll('.item').forEach((e,i)=>e.classList.toggle('focus',zone==='list'&&i===idx))
  menuBtns.forEach((b,i)=>b.classList.toggle('focus',zone==='menu'&&i===menuIdx))
  search.classList.toggle('focus-search',zone==='search')
  if(zone==='list') document.querySelectorAll('.item')[idx]?.scrollIntoView({block:'center'})
}

/* KEYS */
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowDown'){
    if(zone==='search') zone='menu'
    else if(zone==='menu') zone='list'
    else if(zone==='list'){ idx=Math.min(idx+1,view.length-1); play(idx) }
  }
  if(e.key==='ArrowUp'){
    if(zone==='list' && idx===0) zone='menu'
    else if(zone==='menu') zone='search'
    else if(zone==='list'){ idx-- }
  }
  if(e.key==='ArrowLeft' && zone==='menu') menuIdx=Math.max(menuIdx-1,0)
  if(e.key==='ArrowRight' && zone==='menu') menuIdx=Math.min(menuIdx+1,menuBtns.length-1)
  if(e.key==='Enter' && zone==='menu'){
    menuBtns.forEach(b=>b.classList.remove('active'))
    menuBtns[menuIdx].classList.add('active')
  }
  updateFocus()
})

/* INIT */
loadTV()
</script>
</body>
</html>
