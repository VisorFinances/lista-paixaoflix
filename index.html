<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Paix√£oFlix</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;font-size:16px;color:#fff}
body{height:100vh;display:flex;background:#111;overflow:hidden}
#sidebar{position:fixed;left:0;top:0;width:250px;height:100%;background:#C0C0C0;display:flex;flex-direction:column;align-items:center;z-index:9999}
#logo{width:90%;max-width:180px;margin-top:8px}
#clock{margin:4px 0;font-weight:600;color:#000}
#search{width:90%;margin:5px 0;padding:8px;border-radius:5px;border:0;color:#000}
.navBtn{width:90%;margin:3px 0;background:#363636;border:none;padding:10px;border-radius:6px;cursor:pointer;transition:.2s;color:#fff}
.navBtn:hover,.navBtn.active{background:#033f99;transform:scale(1.03)}
#sairBtn{background:#770000}
#main{flex:1;margin-left:250px;display:flex;flex-direction:column}
#content{flex:1;display:flex;flex-wrap:wrap;gap:8px;padding:8px;overflow-y:auto}
.card{position:relative;width:150px;cursor:pointer}
.card img{width:100%;border-radius:6px}
.card .info{font-size:12px;text-align:center;margin-top:2px}
#player{display:none;position:fixed;inset:0;z-index:10000;background:#000}
video{width:100%;height:100%}
#exitPlayer{position:absolute;top:10px;right:10px;background:#fff2;color:#fff;border:0;padding:6px 10px;border-radius:5px}
.scrollRow{display:flex;width:100%;overflow-x:auto;gap:8px;-webkit-overflow-scrolling:touch}
.lineTitle{width:100%;font-weight:600;margin:6px 0 4px 4px}
@media (max-width:700px){
 body{flex-direction:column}
 #sidebar{display:none;width:100%;height:auto;flex-direction:row;flex-wrap:wrap}
 #sidebar.active{display:flex}
 #main{margin-left:0}
 #logo{max-width:120px}
}
</style>
</head>
<body>
<div id="sidebar">
 <img id="logo" src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" alt="logo">
 <button id="sairBtn" class="navBtn">Sair</button>
 <div id="clock"></div>
 <input type="text" id="search" placeholder="Pesquisar...">
 <button class="navBtn" data-sec="tv">üì∫ TV ao Vivo</button>
 <button class="navBtn" data-sec="cinema">üé¨ Cinema</button>
 <button class="navBtn" data-sec="series">üì∫ S√©ries</button>
 <button class="navBtn" data-sec="tvkids">üß∏ Canais Kids</button>
 <button class="navBtn" data-sec="filmeskids">üé• Filmes Kids</button>
 <button class="navBtn" data-sec="serieskids">üì∫ S√©ries Kids</button>
 <button class="navBtn" data-sec="cont">‚è≥ Continue</button>
</div>

<div id="main">
 <div id="content"></div>
</div>

<div id="player">
 <video id="videoEl" controls></video>
 <button id="exitPlayer">Sair</button>
</div>

<script>
const sources={
 tv:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_canais.m3u",
 cinema:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/filmes.json",
 series:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/series.json",
 tvkids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/ativa_kids_canais.m3u",
 filmeskids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json",
 serieskids:"https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/data/kids_filmes.json"
};
let dataStore={};
let continueList=JSON.parse(localStorage.getItem("cont")||"[]");
const cont=document.getElementById("content");
const search=document.getElementById("search");
const player=document.getElementById("player");
const videoEl=document.getElementById("videoEl");
const exitBtn=document.getElementById("exitPlayer");

function formatDate(){
 const d=new Date();
 return d.toLocaleDateString('pt-br',{weekday:'long',day:'2-digit',month:'2-digit',year:'2-digit'})+" | "+d.toLocaleTimeString('pt-br',{hour:'2-digit',minute:'2-digit'});
}
function m3uToJson(txt){
 const lines=txt.split('\n');
 let arr=[],item={};
 for(const l of lines){
  if(l.startsWith('#EXTINF')){
   item={titulo:l.split(',')[1],logo:(l.match(/tvg-logo="(.*?)"/)||[])[1]||"",url:"",type:"live"};
  }else if(item.titulo&&l.trim()&&!l.startsWith('#')){
   item.url=l.trim();
   arr.push(item);
   item={};
  }
 }
 return arr;
}
function makeCard(o){
 const d=document.createElement("div");
 d.className="card";
 d.tabIndex=0;
 d.innerHTML=`<img src="${o.poster||o.logo||''}" alt="${o.titulo}"><div class="info">${o.year||''}  ‚≠ê ${o.rating||''}</div>`;
 d.onclick=()=>play(o);
 return d;
}
function play(o){
 const hist=continueList.find(x=>x.url===o.url);
 videoEl.src=o.url;
 player.style.display="block";
 videoEl.play();
 if(hist) videoEl.currentTime=hist.time||0;
 videoEl.onpause=()=>saveHist(o,videoEl.currentTime);
 videoEl.onended=()=>player.style.display="none";
}
function saveHist(o,t){
 o.time=t;
 o.timestamp=Date.now();
 continueList=continueList.filter(x=>Date.now()-x.timestamp<86400000);
 const idx=continueList.findIndex(x=>x.url===o.url);
 if(idx>-1) continueList.splice(idx,1);
 continueList.unshift(o);
 localStorage.setItem("cont",JSON.stringify(continueList));
}
function render(sec){
 cont.innerHTML="";
 if(sec==="cont"){
  continueList.forEach(x=>cont.appendChild(makeCard(x)));
  return;
 }
 if(sec==="tv"||sec==="tvkids"){
  const map={};
  dataStore[sec].forEach(ch=>{
   const g=ch.group||"Outros";
   if(!map[g])map[g]=[];
   map[g].push(ch);
  });
  Object.keys(map).sort().forEach(cat=>{
   const row=document.createElement("div");
   row.className="scrollRow";
   row.innerHTML=`<div class="lineTitle">${cat}</div>`;
   const inner=document.createElement("div");
   inner.className="scrollRow";
   map[cat].forEach(c=>inner.appendChild(makeCard(c)));
   cont.appendChild(row);
   cont.appendChild(inner);
  });
  return;
 }
 dataStore[sec].forEach(o=>cont.appendChild(makeCard(o)));
}
async function load(sec){
 if(!dataStore[sec]){
  const raw=await fetch(sources[sec]).then(r=>r.text());
  dataStore[sec]= sources[sec].endsWith(".json") ? JSON.parse(raw) : m3uToJson(raw);
  if(sec.includes("kids")) dataStore[sec].sort((a,b)=>a.titulo.localeCompare(b.titulo));
 }
 render(sec);
}
document.querySelectorAll(".navBtn[data-sec]").forEach(b=>b.onclick=()=>load(b.dataset.sec));
search.addEventListener("input",()=>{
 const q=search.value.toLowerCase();
 const list=[];
 Object.values(dataStore).flat().forEach(o=>{
  if(JSON.stringify(o).toLowerCase().includes(q))list.push(o);
 });
 cont.innerHTML="";
 list.forEach(o=>cont.appendChild(makeCard(o)));
});
exitBtn.onclick=()=>{player.style.display="none";videoEl.pause();};
document.getElementById("sairBtn").onclick=()=>location.href="about:blank";
document.getElementById("clock").textContent=formatDate();
setInterval(()=>document.getElementById("clock").textContent=formatDate(),60000);
// for√ßar landscape em mobile
screen.orientation&&screen.orientation.lock("landscape").catch(()=>{});
// teclas
window.addEventListener("keydown",e=>{
 if(e.key==="Escape")exitBtn.click();
 if(e.key==="ArrowUp"||e.key==="ArrowDown")videoEl.focus();
});
load("tv");
</script>
</body>
</html>
