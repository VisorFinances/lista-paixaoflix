<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaixãoFlix 2026 - Versão Estável</title>
    <style>
        :root {
            --amarelo: #ffcc00;
            --vermelho: #ff0000;
            --bg: #05070a;
            --gap: 12px;
            --sidebar-w: 80px;
        }

        /* RESET E OCULTAR SCROLL */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body, html { width: 100%; height: 100%; background: var(--bg); color: white; overflow: hidden; }
        ::-webkit-scrollbar { display: none; }

        /* LAYOUT ESTRUTURAL */
        body { display: flex; }
        
        #sidebar {
            width: var(--sidebar-w); height: 100vh; background: #000;
            display: flex; flex-direction: column; align-items: center; padding: 20px 0;
            border-right: 1px solid #1a1a1a; z-index: 100;
        }
        .nav-btn { width: 50px; height: 50px; margin-bottom: 15px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .nav-btn:focus { background: var(--amarelo); outline: none; }
        .nav-btn svg { fill: #666; width: 26px; }
        .nav-btn:focus svg { fill: #000; }

        main { flex: 1; height: 100vh; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }

        /* TÍTULOS */
        .titulo-container { margin-bottom: 12px; }
        .vermelho { color: var(--vermelho); font-size: 38px; font-weight: 900; text-transform: uppercase; }
        .amarelo { color: var(--amarelo); font-size: 38px; font-weight: 900; text-transform: uppercase; }
        .cat-titulo { color: var(--amarelo); font-size: 24px; font-weight: bold; margin-bottom: 8px; }

        /* TOP 4 - PREENCHIMENTO TOTAL */
        #top4-container { display: flex; gap: var(--gap); height: 60vh; margin-bottom: 30px; }
        .capa-top { 
            position: relative; flex: 1; height: 100%; border-radius: 10px; 
            overflow: hidden; cursor: pointer; transition: 0.3s;
        }
        .capa-top img { width: 100%; height: 100%; object-fit: cover; }
        .num-destaque { 
            position: absolute; left: -10px; bottom: -10px; font-size: 120px; font-weight: 900;
            color: #001a33; -webkit-text-stroke: 2px var(--amarelo); z-index: 2;
        }

        /* CATEGORIAS - 4 POR LINHA */
        .row-section { margin-bottom: 12px; position: relative; }
        .carousel-track { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--gap);
            width: 100%; transition: transform 0.5s ease;
        }

        .capa { 
            position: relative; border-radius: 8px; overflow: hidden; 
            aspect-ratio: 2/3; cursor: pointer; border: 3px solid transparent;
        }
        .capa:focus { border-color: white; transform: scale(1.02); outline: none; }
        .capa img { width: 100%; height: 100%; object-fit: cover; }

        /* METADADOS AMARELOS */
        .meta { 
            display: flex; justify-content: center; gap: 10px; margin-top: 5px;
            color: var(--amarelo); font-size: 14px; font-weight: bold;
        }

        /* SETA DE CONTINUAÇÃO */
        .seta-row {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            color: var(--amarelo); font-size: 30px; text-shadow: 2px 2px 5px black; z-index: 5;
        }

        /* PLAYER */
        #player-layer { position: fixed; inset: 0; background: #000; z-index: 500; display: none; }
    </style>
</head>
<body>

<nav id="sidebar">
    <div class="nav-btn" tabindex="0" onclick="location.reload()"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
    <div class="nav-btn" tabindex="0"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
</nav>

<main id="main-content">
    <div class="titulo-container">
        <span class="vermelho">PaixãoFlix</span> <span class="amarelo">indica hoje</span>
    </div>
    
    <div id="top4-container"></div>

    <div id="categorias-lista"></div>
</main>

<div id="player-layer">
    <button onclick="fecharPlayer()" style="position:absolute; top:20px; left:20px; z-index:600; padding:10px">VOLTAR</button>
    <video id="video-player" controls autoplay style="width:100%; height:100%"></video>
</div>

<script>
    const db_filmes = "data/filmes.json"; // Ajuste para seus caminhos
    const categorias_ordem = ["Lançamento 2026", "Ação", "Comédia", "Terror"];

    async function carregarSistema() {
        try {
            const res = await fetch(db_filmes);
            const data = await res.json();
            
            renderTop4(data);
            renderCategorias(data);
        } catch (e) { console.error("Erro ao carregar banco de dados"); }
    }

    function renderTop4(data) {
        const container = document.getElementById('top4-container');
        const destaques = data.slice(0, 4);
        
        destaques.forEach((item, i) => {
            container.innerHTML += `
                <div class="capa-top" tabindex="0" onclick="abrirPlayer('${item.url}')">
                    <span class="num-destaque">${i+1}</span>
                    <img src="${item.poster}">
                    <div class="meta">${item.year} | ★ ${item.rating}</div>
                </div>
            `;
        });
    }

    function renderCategorias(data) {
        const container = document.getElementById('categorias-lista');
        
        categorias_ordem.forEach(cat => {
            const filtrados = data.filter(f => f.genero === cat);
            if(filtrados.length === 0) return;

            // Lógica de 4 capas: Pegamos múltiplos de 4 para não quebrar a linha
            const htmlCapas = filtrados.map(item => `
                <div class="capa" tabindex="0" onclick="abrirPlayer('${item.url}')">
                    <img src="${item.poster}">
                    <div class="meta">${item.year} | ★ ${item.rating}</div>
                </div>
            `).join('');

            container.innerHTML += `
                <div class="row-section">
                    <div class="cat-titulo">${cat}</div>
                    <div class="carousel-track" id="track-${cat.replace(/\s/g, '')}">
                        ${htmlCapas}
                    </div>
                    <div class="seta-row">➤</div>
                </div>
            `;
        });
    }

    // NAVEGAÇÃO INTELIGENTE (4 EM 4 COM LOOP)
    document.addEventListener('keydown', (e) => {
        const foco = document.activeElement;
        if (!foco.classList.contains('capa')) return;

        const track = foco.parentElement;
        const capas = Array.from(track.querySelectorAll('.capa'));
        const index = capas.indexOf(foco);

        if (e.key === 'ArrowRight') {
            if ((index + 1) % 4 === 0 || index === capas.length - 1) {
                // Se estiver no fim da linha de 4 ou fim da lista, volta ao início do bloco
                e.preventDefault();
                const proximoInicio = index + 1 >= capas.length ? 0 : index + 1;
                capas[proximoInicio].focus();
            }
        }
        
        if (e.key === 'ArrowLeft') {
            if (index % 4 === 0) {
                e.preventDefault();
                // Opcional: Voltar para o fim da linha anterior ou início
                if(index === 0) capas[capas.length - 1].focus();
                else capas[index - 1].focus();
            }
        }
    });

    function abrirPlayer(url) {
        const p = document.getElementById('player-layer');
        const v = document.getElementById('video-player');
        p.style.display = 'block';
        v.src = url;
    }

    function fecharPlayer() {
        const p = document.getElementById('player-layer');
        document.getElementById('video-player').pause();
        p.style.display = 'none';
    }

    window.onload = carregarSistema;
</script>
</body>
</html>
