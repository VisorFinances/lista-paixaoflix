<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins}
body{background:#000;color:#fff;overflow:hidden;height:100vh;display:flex}
::-webkit-scrollbar{display:none}

/* SIDEBAR */
#side{width:420px;background:#111;display:flex;flex-direction:column;border-right:1px solid #222;position:relative}

/* HEADER */
#header{display:flex;align-items:center;justify-content:space-between;padding:16px}
#header img{width:160px;height:auto}
#timebox{text-align:right}
#clock{font-size:20px;color:#fff}
#date{font-size:12px;color:#fff;opacity:0.9}

/* SEARCH */
#search{margin:10px 16px;padding:10px;font-size:16px;background:#000;color:#fff;border:2px solid #e50914;border-radius:6px;outline:none}

/* NOW PLAYING */
#now{margin:5px 16px;font-size:13px;color:#fff}
#now span{font-size:14px;color:#fff}

/* MENU */
#menu{margin:10px 16px;display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.btn{padding:6px;font-size:14px;background:#222;border-radius:6px;text-align:center;cursor:pointer}
.btn.active{background:#e50914}
.btn.kids{background:#0056b3}

/* LIST */
#list{flex:1;overflow-y:auto;margin:0 16px}
.item{padding:12px;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;font-size:16px;cursor:pointer}
.item.focus{background:#222;border-left:6px solid #e50914;box-shadow:0 0 8px #fff}
.fav-icon{font-size:18px;opacity:0.3;cursor:pointer}
.item.is-fav .fav-icon{opacity:1;color:#e50914}

/* PLAYER */
#player{flex:1;position:relative}
video{width:100%;height:100%;background:#000}

/* OVERLAY */
#zap{position:absolute;bottom:40px;left:40px;background:rgba(0,0,0,.8);padding:10px 20px;font-size:20px;border-left:6px solid #e50914;display:none}
</style>
</head>
<body>

<div id="side">
  <div id="header">
    <img src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
    <div id="timebox">
      <div id="clock"></div>
      <div id="date"></div>
    </div>
  </div>

  <input id="search" placeholder="Pesquisar...">
  <div id="now">Assistindo agora: <span>—</span></div>

  <div id="menu">
    <div class="btn active" data-btn="tv">TV</div>
    <div class="btn" data-btn="filmes">Filmes</div>
    <div class="btn" data-btn="series">Séries</div>
    <div class="btn kids" data-btn="kids">Canal Kids</div>
    <div class="btn kids" data-btn="kidsconteudo">Filmes/Séries Kids</div>
    <div class="btn" data-btn="fav">Favoritos</div>
  </div>

  <div id="list"></div>
</div>

<div id="player">
  <video id="video" autoplay></video>
  <div id="zap"></div>
</div>

<script>
/* CLOCK */
function updateClock(){
  const d=new Date();
  clock.innerText=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
  date.innerText=d.toLocaleDateString('pt-BR');
}
setInterval(updateClock,1000); updateClock();

/* STATE */
let items=[],view=[],idx=0,hls=null,favs=[],currentBtn='tv';

/* FUNÇÕES DE CARREGAMENTO */
async function loadM3U(file){
  const res=await fetch(file).then(r=>r.text());
  const list=[];
  let name='';
  res.split('\n').forEach(l=>{
    if(l.startsWith('#EXTINF')) name=l.split(',').pop();
    else if(l.startsWith('http')) list.push({nome:name,url:l,type:'tv'});
  });
  return list;
}

async function loadJSON(file,type){
  const res=await fetch(file).then(r=>r.json());
  return res.map(x=>({...x,type:type}));
}

/* FUNÇÃO PRINCIPAL DE LOAD */
async function loadContent(btn){
  currentBtn=btn;
  view=[]; items=[];
  switch(btn){
    case 'tv': items=await loadM3U('canais.m3u'); break;
    case 'filmes': items=await loadJSON('filmes.json','movie'); break;
    case 'series': items=await loadJSON('series.json','serie'); break;
    case 'kids': items=await loadM3U('kids_canais.m3u'); break;
    case 'kidsconteudo': items=[...(await loadJSON('kids_filmes.json','movie')), ...(await loadJSON('kids_series.json','serie'))]; break;
    case 'fav': items=JSON.parse(localStorage.getItem('flix_favs')||'[]'); break;
  }
  view=[...items];
  renderList();
  idx=0;
  play(idx);
}

/* RENDER LIST */
function renderList(){
  list.innerHTML='';
  view.forEach((i,n)=>{
    const d=document.createElement('div');
    const isFav=favs.some(f=>f.nome===i.nome);
    d.className='item'+(isFav?' is-fav':'');
    d.innerHTML=`<span>${i.nome||i.titulo}</span><span class="fav-icon">★</span>`;
    d.querySelector('.fav-icon').onclick=e=>{
      e.stopPropagation();
      toggleFav(i);
    };
    d.onclick=()=>play(n);
    list.appendChild(d);
  });
  refreshFocus();
  focusItem();
}

/* FOCUS */
let focusElements=[],focusIndex=0;
function refreshFocus(){
  focusElements=[search,...document.querySelectorAll('.btn'),...document.querySelectorAll('.item')];
}
function focusItem(){
  focusElements.forEach((el,i)=>el.classList.toggle('focus',i===focusIndex));
  const el=focusElements[focusIndex];
  if(el?.classList.contains('item')) el.scrollIntoView({block:'center'});
}

/* PLAY */
function play(i){
  const it=view[i];
  if(!it) return;
  if(hls){hls.destroy(); hls=null;}
  if(it.url?.includes('.m3u8')&&Hls.isSupported()){
    hls=new Hls(); hls.loadSource(it.url); hls.attachMedia(video);
  } else video.src=it.url;
  video.play().catch(()=>{});
  now.querySelector('span').innerText=it.nome||it.titulo;
  zap.innerText=it.nome||it.titulo;
  zap.style.display='block';
  setTimeout(()=>zap.style.display='none',1200);
  focusIndex=focusElements.findIndex(el=>el.classList.contains('item') && el.innerText.includes(it.nome||it.titulo));
  focusItem();
}

/* FAVORITOS */
function toggleFav(i){
  let fs=JSON.parse(localStorage.getItem('flix_favs')||'[]');
  const idx=fs.findIndex(f=>f.nome===i.nome);
  if(idx>-1) fs.splice(idx,1); else fs.push(i);
  localStorage.setItem('flix_favs',JSON.stringify(fs));
  renderList();
}

/* PESQUISA */
search.addEventListener('input',()=>{
  const q=search.value.toLowerCase();
  view=items.filter(i=>(i.nome||i.titulo).toLowerCase().includes(q));
  renderList();
});

/* MENU */
document.querySelectorAll('.btn').forEach(b=>{
  b.onclick=()=>loadContent(b.dataset.btn);
});

/* TECLADO / DIRECIONAL */
document.addEventListener('keydown',e=>{
  refreshFocus();
  switch(e.key){
    case 'ArrowDown': focusIndex=Math.min(focusIndex+1,focusElements.length-1); e.preventDefault(); break;
    case 'ArrowUp': focusIndex=Math.max(focusIndex-1,0); e.preventDefault(); break;
    case 'ArrowRight': if(focusElements[focusIndex]===search) play(0); break;
    case 'ArrowLeft': break;
    case 'Enter': focusElements[focusIndex].click(); break;
  }
  focusItem();
});

/* INIT */
loadContent('tv');
</script>

</body>
</html>
