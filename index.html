<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PaixãoFlix TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
* { overflow: -moz-scrollbars-none; scrollbar-width: none; }
*::-webkit-scrollbar { display:none; }
html,body{margin:0;padding:0;background:#000;color:#fff;height:100%;overflow:hidden}
#app{display:flex;height:100%}
#menu{width:280px;background:#1a1a1a;padding:12px}
#content{position:absolute;left:280px;width:calc(100% - 280px);height:100%;display:flex;justify-content:center;align-items:center}
#videoContainer{width:100%;height:56.25vw;max-height:100vh;background:#000}
video{width:100%;height:100%;background:#000;object-fit:contain}
#channelList{position:absolute;width:340px;height:100%;background:#000;display:none;overflow-y:auto}
.channel{padding:15px;cursor:pointer}
.channel.active{background:#ff9800;color:#000}
</style>
</head>

<body>
<div id="app">
<div id="menu">
<img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png" height="90">
<div id="currentTitle">...</div>
</div>

<div id="content">
<div id="videoContainer">
<video id="video" autoplay playsinline></video>
</div>
<div id="channelList"></div>
</div>
</div>

<script>
/* ================= PLAYER CONTROLLER ================= */

const video = document.getElementById("video");
let hls = null;
let playState = "idle";
let retryCount = 0;

function requestFullscreen() {
    if (video.requestFullscreen) video.requestFullscreen();
    else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
}

function resetPlayer() {
    if (hls) { hls.destroy(); hls = null; }
    video.pause();
    video.removeAttribute("src");
    video.load();
    retryCount = 0;
}

function safePlay() {
    video.play().then(() => {
        playState = "playing";
    }).catch(() => {
        if (retryCount < 3) {
            retryCount++;
            setTimeout(() => video.play(), 400);
        }
    });
}

function playMedia(item) {
    if (!item || (!item.url && !item.link)) return;
    const url = item.url || item.link;
    document.getElementById("currentTitle").innerText = item.titulo || item.name;

    resetPlayer();
    playState = "loading";

    setTimeout(() => {
        if (url.includes(".m3u8") && Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                safePlay();
                requestFullscreen();
            });
        } else {
            video.src = url;
            video.oncanplay = () => {
                safePlay();
                requestFullscreen();
            };
        }
    }, 300);
}

/* ================= CONTROLE REMOTO ================= */

document.addEventListener("keydown", e => {
    if (e.key === "Enter") {
        if (playState === "playing") {
            video.pause();
            playState = "paused";
        } else {
            safePlay();
        }
    }
});

/* ================= DEMO AUTOMÁTICO ================= */
/* Remova depois: apenas para validar funcionamento */
setTimeout(() => {
    playMedia({
        titulo: "Teste Cinema",
        link: "https://archive.org/download/BigBuckBunny_328/BigBuckBunny_512kb.mp4"
    });
}, 2000);
</script>
</body>
</html>
