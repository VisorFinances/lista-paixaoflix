<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>PaixãoFlix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:Poppins;overflow:hidden}
::-webkit-scrollbar{display:none}
#app{display:flex;height:100vh}

/* SIDEBAR */
#side{width:420px;background:#111;display:flex;flex-direction:column;border-right:1px solid #222}

/* HEADER */
#header{padding:14px;display:flex;justify-content:space-between;align-items:center}
#logo{width:160px}
#timebox{text-align:right}
#clock{font-size:20px}
#date{font-size:12px;color:#ccc}

/* SEARCH */
#search{
margin:8px 14px;
padding:10px;
font-size:15px;
background:#000;
color:#fff;
border:2px solid #e50914;
border-radius:6px;
outline:none
}
#search.focus{outline:2px solid #fff}

/* MENU */
#menu{
margin:10px 14px;
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px
}
.btn{
height:40px;
display:flex;
align-items:center;
justify-content:center;
font-size:13px;
background:#222;
border-radius:6px;
white-space:nowrap
}
.btn.active{background:#e50914}
.btn.focus{outline:2px solid #fff}
.btn.kids{background:#0056b3}

/* LIST */
#list{flex:1;overflow-y:auto}
.item{
padding:12px;
border-bottom:1px solid #222;
font-size:16px
}
.item.focus{
background:#222;
border-left:6px solid #e50914
}

/* PLAYER */
#player{flex:1;position:relative}
video{width:100%;height:100%;background:#000}

/* OVERLAY */
#overlay{
position:absolute;
bottom:40px;
left:40px;
background:rgba(0,0,0,.8);
padding:10px 20px;
font-size:20px;
border-left:6px solid #e50914;
display:none
}
</style>
</head>

<body>
<div id="app">

<div id="side">
  <div id="header">
    <img id="logo" src="https://github.com/VisorFinances/lista-paixaoflix/blob/main/logoof512.png?raw=true">
    <div id="timebox">
      <div id="clock"></div>
      <div id="date"></div>
    </div>
  </div>

  <input id="search" placeholder="Pesquisar...">

  <div id="menu">
    <div class="btn active" data-type="tv">TV</div>
    <div class="btn" data-type="filmes">Filmes</div>
    <div class="btn" data-type="series">Séries</div>
    <div class="btn kids" data-type="kids">Canal Kids</div>
    <div class="btn kids" data-type="kidsconteudo">Filmes/Séries Kids</div>
    <div class="btn" data-type="fav">Favoritos</div>
  </div>

  <div id="list"></div>
</div>

<div id="player">
  <video id="video" autoplay></video>
  <div id="overlay"></div>
</div>

</div>

<script>
/* CLOCK */
setInterval(()=>{
const d=new Date()
clock.textContent=d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})
date.textContent=d.toLocaleDateString('pt-BR')
},1000)

/* STATE */
let focusArea='search'   // search → menu → list
let menuIndex=0
let listIndex=0
let items=[]
let hls=null

const buttons=[...document.querySelectorAll('.btn')]

/* LOADERS */
async function loadM3U(file){
const txt=await fetch('data/'+file).then(r=>r.text())
items=[]
let name=''
txt.split('\n').forEach(l=>{
if(l.startsWith('#EXTINF')) name=l.split(',').pop()
else if(l.startsWith('http')) items.push({nome:name,url:l})
})
renderList()
playTV(0)
}

async function loadJSON(file){
items=await fetch('data/'+file).then(r=>r.json())
renderList()
}

/* RENDER */
function renderList(){
list.innerHTML=''
items.forEach((i)=>{
const d=document.createElement('div')
d.className='item'
d.textContent=i.nome || i.titulo
list.appendChild(d)
})
listIndex=0
updateListFocus()
}

/* FOCUS */
function clearFocus(){
buttons.forEach(b=>b.classList.remove('focus'))
search.classList.remove('focus')
}

function focusSearch(){
clearFocus()
focusArea='search'
search.classList.add('focus')
search.focus()
}

function focusMenu(){
clearFocus()
focusArea='menu'
buttons[menuIndex].classList.add('focus')
}

function focusList(){
clearFocus()
focusArea='list'
updateListFocus()
}

function updateListFocus(){
const els=[...document.querySelectorAll('.item')]
els.forEach((e,i)=>e.classList.toggle('focus',i===listIndex))
els[listIndex]?.scrollIntoView({block:'center'})
}

/* PLAYER */
function playTV(i){
const it=items[i]
if(!it)return
if(hls){hls.destroy();hls=null}
if(it.url.includes('.m3u8') && Hls.isSupported()){
hls=new Hls()
hls.loadSource(it.url)
hls.attachMedia(video)
}else video.src=it.url
video.play().catch(()=>{})
overlay.textContent=it.nome
overlay.style.display='block'
setTimeout(()=>overlay.style.display='none',1200)
}

/* MENU ACTION */
function selectMenu(){
buttons.forEach(b=>b.classList.remove('active'))
buttons[menuIndex].classList.add('active')
listIndex=0

const t=buttons[menuIndex].dataset.type
if(t==='tv') loadM3U('canais.m3u')
if(t==='kids') loadM3U('kids_canais.m3u')
if(t==='filmes') loadJSON('filmes.json')
if(t==='series') loadJSON('series.json')
if(t==='kidsconteudo') loadJSON('kids_filmes.json')
if(t==='fav') loadJSON('favoritos.json')

focusList()
}

/* KEYS */
document.addEventListener('keydown',e=>{
switch(e.key){

case 'ArrowDown':
  if(focusArea==='search') focusMenu()
  else if(focusArea==='menu') focusList()
  else if(focusArea==='list' && listIndex<items.length-1){
    listIndex++; updateListFocus()
  }
break

case 'ArrowUp':
  if(focusArea==='list' && listIndex===0) focusMenu()
  else if(focusArea==='menu') focusSearch()
  else if(focusArea==='list'){
    listIndex--; updateListFocus()
  }
break

case 'ArrowLeft':
  if(focusArea==='menu' && menuIndex>0){
    menuIndex--; focusMenu()
  }
break

case 'ArrowRight':
  if(focusArea==='menu' && menuIndex<buttons.length-1){
    menuIndex++; focusMenu()
  }
break

case 'Enter':
  if(focusArea==='menu') selectMenu()
  else if(focusArea==='list' && buttons[menuIndex].dataset.type==='tv'){
    playTV(listIndex)
  }
break
}
})

/* SEARCH */
search.addEventListener('input',()=>{
const q=search.value.toLowerCase()
items=items.filter(i=>(i.nome||i.titulo).toLowerCase().includes(q))
renderList()
})

/* INIT */
focusSearch()
loadM3U('canais.m3u')
</script>

</body>
</html>
